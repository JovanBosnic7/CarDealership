!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).augLoop=e()}}((function(){return function e(t,n,o){function r(i,a){if(!n[i]){if(!t[i]){var c="function"==typeof require&&require;if(!a&&c)return c(i,!0);if(s)return s(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[i]={exports:{}};t[i][0].call(l.exports,(function(e){return r(t[i][1][e]||e)}),l,l.exports,e,t,n,o)}return n[i].exports}for(var s="function"==typeof require&&require,i=0;i<o.length;i++)r(o[i]);return r}({"@ms/office-online-telemetry":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o={getUlsLogger:!0};Object.defineProperty(n,"getUlsLogger",{enumerable:!0,get:function(){return a.getUlsLogger}});var r=e(116);Object.keys(r).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(n,e,{enumerable:!0,get:function(){return r[e]}}))}));var s=e(109);Object.keys(s).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(n,e,{enumerable:!0,get:function(){return s[e]}}))}));var i=e(111);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(n,e,{enumerable:!0,get:function(){return i[e]}}))}));var a=e(112),c=e(108);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(n,e,{enumerable:!0,get:function(){return c[e]}}))}));var u=e(107);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(o,e)||Object.defineProperty(n,e,{enumerable:!0,get:function(){return u[e]}}))}))},{107:107,108:108,109:109,111:111,112:112,116:116}],1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.arrayOperators=void 0,function(e){e.some="some",e.every="every",e.none="none"}(n.arrayOperators||(n.arrayOperators={}))},{}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.comparisonOperators=void 0,function(e){e.eq="eq",e.ne="ne",e.ge="ge",e.gt="gt",e.lt="lt",e.le="le"}(n.comparisonOperators||(n.comparisonOperators={}))},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isLogicalCondition=n.isComparisonCondition=n.isArrayCondition=void 0;var o=e(1),r=e(2),s=e(10);n.isArrayCondition=function(e){return e.operator in o.arrayOperators};n.isComparisonCondition=function(e){return e.operator in r.comparisonOperators};n.isLogicalCondition=function(e){return e.operator in s.logicalOperators}},{1:1,10:10,2:2}],5:[function(e,t,n){"use strict";var o=e("spreadArraysHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.getTypesFromLambdas=n.functionReviver=n.functionReplacer=void 0;var r=function(e,t,n){var r=this;this.reviver=function(e,t){if("string"==typeof t){var n=t.match(/function[^\(]*\(([^\)]*)\)\s*{([\w\W]*?)}$/)||t.match(/\(([^\)]*)\)\s*=>\s*{([\w\W]*?)}$/);if(n){var s=n[1].split(",").map((function(e){return e.replace(/\s+/,"")})),i=r.functionName?n[2].concat("//# sourceURL="+r.functionName+".js"):n[2];return r.debuggable&&(i="debugger;".concat(i)),r.dependencyArguments&&(s=s.concat(Array.from(r.dependencyArguments))),Function.apply(void 0,o(s,[i]))}}return t},this.functionName=e,this.debuggable=n,this.dependencyArguments=t};n.functionReplacer=function(e,t){return"function"==typeof t?t.toString():t};n.functionReviver=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=!1),new r(e,t,n).reviver};n.getTypesFromLambdas=function(e){for(var t=[],n=0,o=e;n<o.length;n++){var r=o[n];r.inputSchema&&t.push(r.inputSchema),r.outputSchema&&t.push(r.outputSchema),r.configSchema&&t.push(r.configSchema)}return t}},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isStopWorkflowMessage=n.setStopAndFilterWorkflowMessage=n.setMessageException=n.getMessageExceptionType=n.getMessageExceptionDescription=n.filterWorkflowSchema=n.exceptionSchema=void 0;var o=e(80);n.exceptionSchema={category:o.TypeCategory.Schema,schema:{name:"Exception",path:"message-schema.proto"}},n.filterWorkflowSchema={category:o.TypeCategory.Schema,schema:{name:"Filter",path:"message-schema.proto"}};n.getMessageExceptionDescription=function(e,t){if(void 0===t&&(t=!1),null==e)return"Invalid message passed";if(null==e.payload)return o.ExceptionType[o.ExceptionType.NoOutput]+": Payload is null";if(null==e.payload.exceptionType)return"Payload is not an exception";var n=o.ExceptionType[e.payload.exceptionType];return n+=e.payload.message?": "+e.payload.message:": No description",n+=t&&e.payload.data?"\n"+e.payload.data.toString():""};n.getMessageExceptionType=function(e){return null==e||null==e.payload||null==e.payload.exceptionType?o.ExceptionType.Unknown:e.payload.exceptionType};n.setMessageException=function(e,t){if(null==e)throw new Error("Cannot set exception on null message");e.payload=t,e.payloadSchema=n.exceptionSchema,e.messageType=o.MessageType.Exception};n.setStopAndFilterWorkflowMessage=function(e,t){if(null==e)throw new Error("Cannot set filter on null message");var r={condition:t};e.payload=r,e.payloadSchema=n.filterWorkflowSchema,e.messageType=o.MessageType.StopAndFilterWorkflow};n.isStopWorkflowMessage=function(e){return(e||{}).messageType==o.MessageType.StopAndFilterWorkflow}},{80:80}],7:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(1),n),o(e(2),n),o(e(4),n),o(e(5),n),o(e(3),n),o(e(6),n),o(e(8),n),o(e(9),n),o(e(10),n)},{1:1,10:10,2:2,3:3,4:4,5:5,6:6,8:8,9:9}],8:[function(e,t,n){"use strict";var o=e("assignHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.elementTypeFrom=n.arrayTypeFrom=n.isArrayType=n.schemaRefToString=n.typeToString=n.areTypesEqual=n.isTypePrimitive=n.MessageSchema=n.TypeSchema=n.FunctionType=n.BufferType=n.StringType=n.NumberType=n.BooleanType=n.UndefinedType=void 0;var r=e(80);n.UndefinedType={category:r.TypeCategory.Undefined},n.BooleanType={category:r.TypeCategory.Boolean},n.NumberType={category:r.TypeCategory.Number},n.StringType={category:r.TypeCategory.String},n.BufferType={category:r.TypeCategory.Buffer},n.FunctionType={category:r.TypeCategory.Function},n.TypeSchema={category:r.TypeCategory.Schema,schema:{name:"Type",path:"type-schema.proto"}},n.MessageSchema={category:r.TypeCategory.Schema,schema:{name:"BufferMessage",path:"message-schema.proto"}};n.isTypePrimitive=function(e){if(null==e)return!1;switch(e.category){case r.TypeCategory.Boolean:case r.TypeCategory.Number:case r.TypeCategory.String:return!0;default:return!1}};n.areTypesEqual=function(e,t){return n.typeToString(e)===n.typeToString(t)};n.typeToString=function(e){if(void 0===e)return"";if(null===e)return"null";var t,n=Object.keys(e).sort().map((function(t){return i(t,e[t])})).filter((function(e){return!!e}));return t="{".concat(n.join(",")).concat("}"),Number(t),t};var s=function(e){if(void 0===e)return"";if(null===e)return"null";var t=Object.keys(e).sort().map((function(t){return i(t,e[t])})).filter((function(e){return!!e}));return"{".concat(t.join(",")).concat("}")},i=function(e,t){return"schema"===e?'"'+e+'":'+s(t):"path"===e?"":"nestedArrayLevel"===e?t?'"'+e+'":'+t:"":void 0===t?"":"string"==typeof t?'"'+e+'":"'+t+'"':'"'+e+'":'+t};n.schemaRefToString=s;n.isArrayType=function(e){return!!e&&e.nestedArrayLevel>0};n.arrayTypeFrom=function(e){var t=o({},e);return t.nestedArrayLevel=n.isArrayType(e)?e.nestedArrayLevel+1:1,t};n.elementTypeFrom=function(e){var t=o({},e);return t.nestedArrayLevel=n.isArrayType(e)?e.nestedArrayLevel-1:0,t}},{80:80}],9:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.matchmakerType=n.executeOnStopWorkflow=n.isBuiltInLambda=n.BuiltInLambdaType=void 0,function(e){e.Expression="Expression",e.MessageOutput="MessageOutput",e.Edge="Edge",e.EnterWorkflow="EnterWorkflow",e.ExitWorkflow="ExitWorkflow",e.Join="Join",e.SerializePayload="SerializePayload",e.DeserializePayload="DeserializePayload",e.Inline="Inline"}(o=n.BuiltInLambdaType||(n.BuiltInLambdaType={}));n.isBuiltInLambda=function(e){return!!o[e]};n.executeOnStopWorkflow=function(e){return n.isBuiltInLambda(e)&&e!=o.Inline||e==n.matchmakerType},n.matchmakerType="Matchmaker"},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.logicalOperators=void 0,function(e){e.All="All",e.Any="Any"}(n.logicalOperators||(n.logicalOperators={}))},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],12:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.runtimeALv1=void 0,o(e(18),n),o(e(11),n);var r=e(17);Object.defineProperty(n,"runtimeALv1",{enumerable:!0,get:function(){return r.runtimeALv1}})},{11:11,17:17,18:18}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ReduceTimerCache=void 0;var o=function(){function e(){this.cache=new Map}return e.prototype.setReduceTimer=function(e,t,n,o,r,s){var i=this;void 0===o&&(o=500),void 0===r&&(r=function(){return!1}),void 0===s&&(s=5e3),this.cache.has(e)||this.cache.set(e,new Map);var a=this.cache.get(e);a.has(t)&&clearTimeout(a.get(t).timer);var c=function(){var c=a.get(t),u=Date.now()-c.start;r()&&u<s?c.timer=setTimeout(c.timerCallback,Math.min(o,s-u)):(a.size>1?a.delete(t):i.cache.delete(e),n())};a.set(t,{start:Date.now(),timerCallback:c,timer:setTimeout(c,o)})},e.prototype.clear=function(e,t){this.cache.forEach((function(n,o){e&&e!==o||n.forEach((function(e,n){t&&t!==n||clearTimeout(e.timer)}))})),this.cache.clear()},e}();n.ReduceTimerCache=o},{}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.executeRemoteLambda=n.clearTokenCache=void 0;var o,r=e(36),s=e(57),i=e(80);n.clearTokenCache=function(){o=new s.TokenCache},n.clearTokenCache();var a=function(e,t,n,c,u,l,p,f,d,g){var h={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":u},body:JSON.stringify({payload:t.payload,payloadSchema:n,requestedSchema:c,clientMetadata:l,tokens:o.getAuthTokenEntries(p,d.docId)})};s.internalFetch(e,h,(function(s,h){s?g(new Error("Fetch error in remote lambda request to "+e+": "+s)):401===h.status?f>0?(r.Log.info(572838109,r.LogCategory.CoreDefault,"Auth token required for remote lambda request"),h.json().then((function(e){return o.updateAuthToken(p,{Tickets:[e],DocId:d.docId})})).then((function(){a(e,t,n,c,u,l,p,f-1,d,g)})).catch((function(e){g({exceptionType:i.ExceptionType.Authentication,message:e.message})}))):g({exceptionType:i.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"}):h.ok?h.json().then((function(e){if(Array.isArray(e))if(e.length>0)for(var n=0,o=0,r=e;o<r.length;o++){var s=r[o];t.moreResults=++n<e.length,g(null,s)}else g(new Error("No output"));else g(new Error("Did not receive a valid response for remote lambda request"))})).catch((function(e){g({exceptionType:i.ExceptionType.LambdaThrow,message:e.message})})):g(new Error("Remote lambda request failed with status "+h.status))}))};n.executeRemoteLambda=function(e,t,n,r,s,c,u,l,p){Array.isArray(l.authTickets)?o.updateAuthToken(u,{Tickets:l.authTickets,DocId:l.docId}).then((function(){a(e,t,n,r,s.id,c,u,1,l,p)})).catch((function(e){p({exceptionType:i.ExceptionType.Authentication,message:e.message})})):a(e,t,n,r,s.id,c,u,1,l,p)}},{36:36,57:57,80:80}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.testWebSocketConnection=n.executeRemoteLambda=n.clearTokenCache=void 0;var o,r=e(36),s=e(57),i=e(80),a=e(20);n.clearTokenCache=function(){o=new s.TokenCache},n.clearTokenCache();var c=new a.WebSocketRequestManager(3e4,(function(){return new s.WebSocketWorker}),50),u=function(e,t,n,s,a,l,p,f,d,g){var h={payload:t.payload,payloadSchema:n,requestedSchema:s,clientMetadata:l,tokens:o.getAuthTokenEntries(p,d.docId)},y="";s&&s.schema&&(y=s.schema.name);var m=!1;c.addRequest(e,h,a,y,(function(c,h,y){if(!m)if(m=!0,null!=h)if(h.exceptionType===i.ExceptionType.Authentication)try{var v=JSON.parse(h.data);f>0?(r.Log.info(572838108,r.LogCategory.CoreDefault,"Auth token required for remote lambda WebSocket request"),o.updateAuthToken(p,{Tickets:[v],DocId:d.docId}).then((function(){u(e,t,n,s,a,l,p,f-1,d,g)})).catch((function(e){g({exceptionType:i.ExceptionType.Authentication,message:e.message})}))):g({exceptionType:i.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"})}catch(e){g({exceptionType:i.ExceptionType.Authentication,message:e.message})}else g(new Error("Error in remote lambda WebSocket request to "+e+": "+h));else t.moreResults=!1,g(null,c)}))};n.executeRemoteLambda=function(e,t,n,r,s,a,c,l,p){Array.isArray(l.authTickets)?o.updateAuthToken(c,{Tickets:l.authTickets,DocId:l.docId}).then((function(){u(e,t,n,r,s.id,a,c,1,l,p)})).catch((function(e){p({exceptionType:i.ExceptionType.Authentication,message:e.message})})):u(e,t,n,r,s.id,a,c,1,l,p)};n.testWebSocketConnection=function(e,t){return c.testConnection(e,t)}},{20:20,36:36,57:57,80:80}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ResultCache=void 0;var o=function(){function e(){this.cache=new Map,this.bucketSizes=new Map}return e.prototype.setBucketSize=function(e,t){this.bucketSizes.set(e,t)},e.prototype.setResult=function(e,t,n){if(t.primary){var o=this.cache.get(e);o||(o=new Map,this.cache.set(e,o));var r=o.get(t.primary);if(r||(r=t.secondary?new Map:[],o.set(t.primary,r)),t.secondary){r.set(t.secondary,n)}else{var s=r;s.length==this.getBucketSize(e)&&s.shift(),s.push(n)}}},e.prototype.getResults=function(e,t){var n=this.cache.get(e);if(n){var o=n.get(t.primary);if(o){if(!t.secondary)return o;var r=Array.from(o.values());if(r.length>0)return r}}return[]},e.prototype.clear=function(e,t){t?this.cache.forEach((function(n,o){if(!e||e===o)if(t.secondary){var r=n.get(t.primary);r&&r.delete(t.secondary)}else n.delete(t.primary)})):e?this.cache.delete(e):this.cache.clear()},e.prototype.getBucketSize=function(e){return this.bucketSizes.get(e)||10},e}();n.ResultCache=o},{}],17:[function(e,t,n){"use strict";var o=e("assignHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.runtimeALv1=n.ClientRuntimeALv1=n.getTypeFromSchema=n.Workflow=void 0;var r,s=e(7),i=e(36),a=e(57),c=e(79),u=e(80),l=e(13),p=e(14),f=e(15),d=e(16),g=e(18),h=e(19);!function(e){e[e.Restricted=0]="Restricted",e[e.Unrestricted=1]="Unrestricted",e[e.Suppressed=2]="Suppressed"}(r||(r={}));var y=function(){function e(){this.canaryTextTileEventSubmittedByDocSessionId=new Set,this.stateByDocSessionId=new Map,this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map}return e.prototype.getOutputSchema=function(){return this.lambdas[this.lambdas.length-1].outputSchema},e.prototype.scheduleExecution=function(t,n){var o;o=e.trackingByDocSessionIdEnabled?this.docSessionIdExtractor?this.docSessionIdExtractor(t):void 0:this.docIdExtractor?this.docIdExtractor(t):void 0;var s=this.getStateForDocSessionId(o);if(s===r.Restricted){var i=this.getExecutionQueueForDocSessionId(o);i.push(n),1===i.length&&n()}else s===r.Unrestricted?n():r.Suppressed},e.prototype.onStart=function(e){this.incrementExecutionCountForDocSessionId(e)},e.prototype.onFinish=function(e,t){if(this.decrementExecutionCountForDocSessionId(e),t===u.ExceptionType.Authentication)this.stateByDocSessionId.set(e,r.Suppressed),this.executionQueueByDocSessionId.delete(e);else if(this.stateByDocSessionId.get(e)===r.Restricted){var n=this.getExecutionQueueForDocSessionId(e);if(n.shift(),void 0===t){this.stateByDocSessionId.set(e,r.Unrestricted),this.executionQueueByDocSessionId.delete(e);for(var o=0,s=n;o<s.length;o++){(0,s[o])()}}else if(n.length>0){(0,n[0])()}}},e.prototype.onRefresh=function(e){this.stateByDocSessionId=new Map,this.triggerOnRefresh&&(e?(this.executionQueueByDocSessionId.delete(e),this.executionCountByDocSessionId.delete(e)):(this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map)),this.canaryTextTileEventSubmittedByDocSessionId.delete(e)},e.prototype.getStateForDocSessionId=function(t){var n=this.stateByDocSessionId.get(t);return void 0===n&&(n=e.executionQueuesEnabled?r.Restricted:r.Unrestricted,this.stateByDocSessionId.set(t,n)),n},e.prototype.getExecutionQueueForDocSessionId=function(e){var t=this.executionQueueByDocSessionId.get(e);return void 0===t&&(t=[],this.executionQueueByDocSessionId.set(e,t)),t},e.prototype.incrementExecutionCountForDocSessionId=function(e){var t=this.executionCountByDocSessionId.get(e)||0;this.executionCountByDocSessionId.set(e,t+1)},e.prototype.decrementExecutionCountForDocSessionId=function(e){var t=this.executionCountByDocSessionId.get(e)||0;t<=1?this.executionCountByDocSessionId.delete(e):this.executionCountByDocSessionId.set(e,t-1)},e.executionQueuesEnabled=!0,e.trackingByDocSessionIdEnabled=!0,e}();n.Workflow=y;n.getTypeFromSchema=function(e){return{category:u.TypeCategory.Schema,schema:{name:e}}};var m="Tiling.TextTileEvent",v=function(e,t){return e===m&&t&&t.type==c.Tiling.TextTileEventType.Refresh},S=function(e,t){return"ClpSlideTile"===e&&t&&t.eventType==c.Ppt.SlideTileEventType.Refresh},T=function(e,t){return v(e,t)||S(e,t)},b=function(e,t){var n,o;return e===m?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.docSessionId:"ClpSlideTile"===e?t.docId:void 0},_=function(){function e(){this.inputSchemasToWorkflows=new Map,this.inputSchemasToReduceWorkflows=new Map,this.reduceWorkflowsGroupingKeyExtractors=new Map,this.defaultWorkflowOptions={canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!1},triggerOnRefresh:!1},this.resultCache=new d.ResultCache,this.reduceTimerCache=new l.ReduceTimerCache,this.lookupTableCache=new Map,this.throttling=new h.ExecutionWithThrottling,this.lastTileRefreshSeq=-1,this.lastTileRefreshSeqByDocSessionId=new Map,this.tileRefreshByDocSessionIdEnabled=!0}return e.prototype.init=function(e,t,n){var o=this,r=new i.Operation({operationName:"InitRuntimeALv1",resourceId:e});r.start(),this.clientMetadata=t,this.clientMetadata&&(this.clientMetadata.runtimeVersion=a.getVersion()),this.hostCallbacks=n;var s=[];return s.push(this.isFeatureEnabled("DisableWebSocket").then((function(n){if(!!n)return!1;return!(["Outlook Mac","Outlook Win32","PowerPoint Mac","PowerPoint Web","PowerPoint Win32","Word Mac","Word Win32"].indexOf(t.appName+" "+t.appPlatform)>=0)||f.testWebSocketConnection(a.Utils.convertServiceUrlToWebSocket(e),o.clientMetadata)})).then((function(t){e&&(o.serviceUrl=t?a.Utils.convertServiceUrlToWebSocket(e):e,o.executeRemoteLambda=t?f.executeRemoteLambda:p.executeRemoteLambda,o.clearRemoteLambdaTokenCache=t?f.clearTokenCache:p.clearTokenCache,o.serviceProtocol=o.serviceUrl.split(":")[0].toLowerCase())}))),s.push(this.isFeatureEnabled("WorkflowQueuesDisabled").then((function(e){y.executionQueuesEnabled=!e}))),s.push(this.isFeatureEnabled("WorkflowTrackingByDocSessionIdDisabled").then((function(e){y.trackingByDocSessionIdEnabled=!e}))),s.push(this.isFeatureEnabled("TileRefreshByDocSessionIdDisabled").then((function(e){o.tileRefreshByDocSessionIdEnabled=!e}))),Promise.all(s).then((function(){o.logOperation(r,!0)})).catch((function(e){o.logOperation(r,!1,"Error",e?e.message:"(no error)")}))},e.prototype.getServiceProtocol=function(){return this.serviceProtocol},e.prototype.registerSchemas=function(e,t){return Promise.resolve()},e.prototype.registerSimpleLocalWorkflow=function(e,t,n){return void 0===n&&(n=this.defaultWorkflowOptions),t.source=t.source||g.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToWorkflows,n)},e.prototype.registerSimpleRemoteWorkflow=function(e,t,n,o,r){void 0===r&&(r=this.defaultWorkflowOptions);var s=[];return t&&(t.source=g.LambdaSource.Custom,s.push(t)),n.source=n.func?g.LambdaSource.Custom:g.LambdaSource.Remote,s.push(n),o&&(o.source=g.LambdaSource.Custom,s.push(o)),this.registerHardcodedWorkflow(e,s,this.inputSchemasToWorkflows,r)},e.prototype.registerMultipleLambdasWorkflow=function(e,t,n){return void 0===n&&(n=this.defaultWorkflowOptions),this.registerHardcodedWorkflow(e,t,this.inputSchemasToWorkflows,n)},e.prototype.registerReduceWorkflow=function(e,t,n,o,r){return void 0===o&&(o=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t.inputSchema,n),this.resultCache.setBucketSize(t.inputSchema,o),t.source=t.source||g.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToReduceWorkflows,r)},e.prototype.registerMultipleLambdasReduceWorkflow=function(e,t,n,o,r){return void 0===o&&(o=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t[0].inputSchema,n),this.resultCache.setBucketSize(t[0].inputSchema,o),this.registerHardcodedWorkflow(e,t,this.inputSchemasToReduceWorkflows,r)},e.prototype.submit=function(e,t,n){this.submitToWorkflows(e,t,n,this.inputSchemasToWorkflows)},e.prototype.getGroupingKey=function(e,t,n){var o=this.reduceWorkflowsGroupingKeyExtractors.get(n);if(null==o)throw new Error("Reduce workflow does not have a grouping extractor");return o(t,e)},e.prototype.submitToWorkflows=function(e,t,n,o){if(void 0===o&&(o=this.inputSchemasToWorkflows),this.hostCallbacks){var r;r=n?i.CorrelationVector.fromString(n):new i.CorrelationVector,this.handleTileRefresh(e,t,r);for(var s,a=0,c=o.get(e)||[];a<c.length;a++){var u=c[a];T(e,t)&&!u.triggerOnRefresh||(u.useCanaryTextTile&&e===m&&!u.canaryTextTileEventSubmittedByDocSessionId.has(b(e,t))&&(this.submitToWorkflow(m,{type:(s=t).type,tile:{metadata:{docSessionId:s.tile.metadata.docSessionId,docId:s.tile.metadata.docId,seqnoCLPRefresh:s.tile.metadata.seqnoCLPRefresh,tileId:"A56B3127DBDFD0D6"},elements:[{text:"B91153AE828B4E48"}]}},r,u,o),u.canaryTextTileEventSubmittedByDocSessionId.add(b(e,t))),this.submitToWorkflow(e,t,r,u,o))}}},e.prototype.submitToWorkflow=function(e,t,o,r,s){var a=this,c={messageType:u.MessageType.Input,correlationVector:o.newChild(),payload:t,payloadSchema:n.getTypeFromSchema(r.lambdas[0].inputSchema),clientMetadata:this.clientMetadata},l=new i.Operation({cv:c.correlationVector.toString(),operationName:"ExecuteWorkflow",resourceId:r.name});l.start(),r.scheduleExecution(t,(function(){try{if(c.payload&&c.payload.tile&&c.payload.tile.metadata&&c.payload.tile.metadata.tileId){var n=c.payload.tile.metadata.tileId;a.throttling.execute(n,r,(function(){return a.executeWorkflow(l,c,t,r,e,s)}))}else a.executeWorkflow(l,c,t,r,e,s)}catch(e){l.success=!1,l.resultSignature="ExecuteException",l.resultDescription=e?e.message:"(no error)",i.Log.error(559290447,i.LogCategory.CoreDefault,l.stop())}}))},e.prototype.handleTileRefresh=function(e,t,n){var o=this;if(T(e,t)){var r=this.tileRefreshByDocSessionIdEnabled?b(e,t):void 0,s=function(e,t){var n,o;return v(e,t)?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.seqnoCLPRefresh:(S(e,t),-1)}(e,t);if(this.tileRefreshByDocSessionIdEnabled){var a=this.lastTileRefreshSeqByDocSessionId.get(r);if(a>=0&&s<=a)return}else if(s<=this.lastTileRefreshSeq)return;var c=new i.Operation({cv:n.toString(),operationName:"TileRefresh",resultDescription:"",success:!0});if(c.start(),this.tileRefreshByDocSessionIdEnabled&&!r)return c.success=!1,c.resultDescription="NoDocSessionId",void i.Log.info(559290448,i.LogCategory.CoreDefault,c.stop());this.inputSchemasToReduceWorkflows.forEach((function(e,t){e.some((function(e){return e.triggerOnRefresh}))&&(o.tileRefreshByDocSessionIdEnabled?(o.resultCache.clear(t,{primary:r}),o.resultCache.clear(o.getForcedDocLevelSchema(t),{primary:r}),o.reduceTimerCache.clear(t,r)):(o.resultCache.clear(t),o.resultCache.clear(o.getForcedDocLevelSchema(t)),o.reduceTimerCache.clear(t)),e.some((function(e){return!e.triggerOnRefresh}))&&(c.resultDescription+="X_"),c.resultDescription+=t+" ")})),this.clearRemoteLambdaTokenCache();var u=[];this.inputSchemasToWorkflows.forEach((function(e){return u.push.apply(u,e)})),this.inputSchemasToReduceWorkflows.forEach((function(e){return u.push.apply(u,e)}));for(var l=0,p=u;l<p.length;l++){var f=p[l];this.tileRefreshByDocSessionIdEnabled?f.onRefresh(r):f.onRefresh()}this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.set(r,s):this.lastTileRefreshSeq=s,i.Log.info(559290449,i.LogCategory.CoreDefault,c.stop())}},e.prototype.executeWorkflow=function(e,t,n,o,r,a){var c=this,l=o.docIdExtractor?o.docIdExtractor(t.payload):void 0,p=y.trackingByDocSessionIdEnabled?o.docSessionIdExtractor(n):l,f=this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.get(p):this.lastTileRefreshSeq;o.onStart(p);var d=function(t){var l=c.tileRefreshByDocSessionIdEnabled?c.lastTileRefreshSeqByDocSessionId.get(p):c.lastTileRefreshSeq;if(o.triggerOnRefresh&&l!==f)return e.success=!0,e.resultSignature="TileRefreshIgnore",void i.Log.info(559290450,i.LogCategory.CoreDefault,e.stop());var d=t.messageType==u.MessageType.Exception&&t.payload.exceptionType==u.ExceptionType.NoOutput,g=d&&o.canProduceNullResult,h=g?o.lambdas[o.lambdas.length-1].outputSchema:t.payloadSchema.schema.name,y=g?null:t.payload;t.messageType===u.MessageType.Input||g?(o.shouldSendResultsToHost&&(a===c.inputSchemasToReduceWorkflows?c.hostCallbacks.onResult("Reduce.Input",n,h,y):c.hostCallbacks.onResult(r,n,h,y)),e.success=!0,e.resultSignature=d?"NoOutput":"ValidOutput"):d?(e.success=!0,e.resultSignature="NoOutput"):(e.success=!1,e.resultSignature="Exception",e.resultDescription=s.getMessageExceptionDescription(t)),a!==c.inputSchemasToReduceWorkflows&&c.updateResultCacheForReduceWorkflows(r,n,h,y,t.correlationVector.toString()),t.moreResults||(e.stop(),i.Log.info(559290451,i.LogCategory.CoreDefault,e),o.onFinish(p,t.payload&&t.payload.exceptionType?s.getMessageExceptionType(t):void 0))};o.preExecutionPromise.then((function(){for(var e={lookupTable:c.lookupTableCache.get(o.name),docId:l},n=d,r=o.lambdas.length-1;r>=0;r--)n=c.createLambdaExecutionStep(o.name,o.lambdas[r],e,n,d);n(t)}))},e.prototype.getForcedDocLevelSchema=function(e){return"~"+e},e.prototype.updateResultCacheForReduceWorkflows=function(e,t,n,o,r){var s=this,a=this.inputSchemasToReduceWorkflows.get(n);if(a){var u;"docId"===e?(u=this.getGroupingKey(e,t,n),this.resultCache.setResult(this.getForcedDocLevelSchema(n),u,o),u.secondary="*"):(u=this.getGroupingKey(e,t,n),!function(e,t){return e===m&&t&&t.type==c.Tiling.TextTileEventType.Delete||"ClpSlideTile"===e&&t&&t.eventType==c.Ppt.SlideTileEventType.Delete}(e,t)||null==u.primary||null==u.secondary?this.resultCache.setResult(n,u,o):this.resultCache.clear(void 0,u));var l=a.some((function(e){return e.deferReduceUntilIdle})),p=[];this.inputSchemasToWorkflows.forEach((function(e){return p.push.apply(p,e.filter((function(e){return e.getOutputSchema()===n})))}));var f=a.map((function(e){return e.deferReduceUntilIdleMaxDelayMs||0})).reduce((function(e,t){return Math.max(e,t)}));this.reduceTimerCache.setReduceTimer(n,u.primary,(function(){var e=s.resultCache.getResults(n,u);if(e.push.apply(e,s.resultCache.getResults(s.getForcedDocLevelSchema(n),{primary:u.primary})),Array.isArray(e)){var t={id:u.primary,values:e,isReduceInput:!0};s.submitToWorkflows(n,t,r,s.inputSchemasToReduceWorkflows)}else i.Log.error(559290452,i.LogCategory.CoreDefault,'Cached results have unexpected type "'+typeof e+'"')}),500,(function(){return l&&p.some((function(e){return e.executionCountByDocSessionId.get(u.primary)>0}))}),f)}},e.prototype.isFeatureEnabled=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n="None"),this.hostCallbacks&&this.hostCallbacks.isFeatureEnabled?this.hostCallbacks.isFeatureEnabled("Microsoft.Office.AugLoop."+e,n).catch((function(){return Promise.resolve(t)})):Promise.resolve(t)},e.prototype.areLicenseFeaturesEnabled=function(e){return this.hostCallbacks&&this.hostCallbacks.areLicenseFeaturesEnabled?this.hostCallbacks.areLicenseFeaturesEnabled(e).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)},e.prototype.isWorkflowEnabled=function(e,t,n,o,r){var s=this;if(t.some((function(e){return e.source===g.LambdaSource.Remote||e.source===g.LambdaSource.BatchedRemote}))){if(!this.serviceUrl)return r.resultDescription="Disabled because no service URL available for remote workflow",Promise.resolve(!1);if(this.clientMetadata&&this.clientMetadata.privateMode&&t.some((function(e){return(e.source===g.LambdaSource.Remote||e.source===g.LambdaSource.BatchedRemote)&&!e.canRunInPrivateMode})))return r.resultDescription="Disabled because we are running in private mode",Promise.resolve(!1)}return(!this.clientMetadata||"Mac"!==this.clientMetadata.appPlatform&&"Win32"!==this.clientMetadata.appPlatform)&&(o=!0,r.resultDescription="Enabled by default due to platform name"),(o?Promise.resolve(!0):this.isFeatureEnabled("WorkflowEnabled."+e)).then((function(t){return t?s.isFeatureEnabled("WorkflowDisabled."+e).then((function(e){return e?(r.resultDescription="Disabled because explicitly disabled",!1):!n||s.areLicenseFeaturesEnabled(n).then((function(e){return e||(r.resultDescription="Disabled because license check failed"),e}))})):(r.resultDescription="Disabled because not explicitly enabled",!1)}))},e.prototype.registerHardcodedWorkflow=function(e,t,o,r){var s=this;if(void 0===o&&(o=this.inputSchemasToWorkflows),!e||e.length>40)throw new Error("Workflow name has invalid length");if(!1===new RegExp(/^[A-Z][a-zA-Z0-9_]+$/).test(e))throw new Error("Workflow name has invalid format");o.forEach((function(t){if(t.some((function(t){return t.name===e})))throw new Error("Workflow name already registered.")}));var a=new i.Operation({operationName:"WorkflowRegistration",resourceId:e,success:!0});return a.setClientMetadata(this.clientMetadata),a.start(),this.isWorkflowEnabled(e,t,r.licenseFeatures,r.enabledByDefault,a).then((function(c){if(a.resultSignature=c?"Enabled":"Disabled",a.stop(),i.Log.info(559290453,i.LogCategory.CoreDefault,a),c){var l=t[0].inputSchema,p=o.get(l);p||(p=[],o.set(l,p));var f=Promise.resolve();r.lookupTableLambda&&(f=new Promise((function(t,o){var a=new i.CorrelationVector,c={messageType:u.MessageType.Input,correlationVector:a,payloadSchema:n.getTypeFromSchema(r.lookupTableLambda.inputSchema),clientMetadata:s.clientMetadata,payload:{}},l=function(n){n.messageType===u.MessageType.Input&&n.payload&&s.lookupTableCache.set(e,n.payload),t()};s.createLambdaExecutionStep("",r.lookupTableLambda,{},l,l)(c)})));var d=new y;d.name=e,d.lambdas=t,d.canProduceNullResult=r.canProduceNullResult,d.shouldSendResultsToHost=r.shouldSendResultsToHost,d.triggerOnRefresh=r.triggerOnRefresh,d.throttleSettings=r.throttleSettings||s.defaultWorkflowOptions.throttleSettings,d.docIdExtractor=r.docIdExtractor,d.docSessionIdExtractor=function(e){return e.isReduceInput?e.id:b(l,e)},d.deferReduceUntilIdle=r.deferReduceUntilIdle,d.deferReduceUntilIdleMaxDelayMs=r.deferReduceUntilIdleMaxDelayMs,d.useCanaryTextTile=r.useCanaryTextTile,d.preExecutionPromise=f,p.push(d)}}))},e.prototype.logOperation=function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,i.Log.info(559290454,i.LogCategory.CoreDefault,e)},e.prototype.handleLambdaError=function(e,t,n,o,r){null!=e.exceptionType?s.setMessageException(t,e):e instanceof Error?s.setMessageException(t,{exceptionType:o,message:e.message}):s.setMessageException(t,{exceptionType:u.ExceptionType.Unknown,message:e?e.toString():void 0}),this.logOperation(n,!1,"Exception",s.getMessageExceptionDescription(t)),r(t)},e.prototype.handleLambdaOutput=function(e,t,o,r,i,a){e&&e.exceptionType!==u.ExceptionType.NoOutput?null!=e.exceptionType?this.handleLambdaError(e,t,o,e.exceptionType,a):e instanceof Error?this.handleLambdaError(e,t,o,u.ExceptionType.LambdaErrorCallback,a):(t.payload=e,t.payloadSchema=n.getTypeFromSchema(r),this.logOperation(o,!0),i(t)):(s.setMessageException(t,{exceptionType:u.ExceptionType.NoOutput}),this.logOperation(o,!0,"NoOutput"),a(t))},e.prototype.executeCustomLambdaStep=function(e,t,n,o,r,i){var a=this;if(null==n.func)s.setMessageException(e,{exceptionType:u.ExceptionType.LambdaThrow,message:"No lambda function set"}),this.logOperation(t,!1,"Error",s.getMessageExceptionDescription(e)),i(e);else{try{n.func(e.payload,n.config,o,(function(o){a.handleLambdaOutput(o,e,t,n.outputSchema,r,i)}),(function(n,o){a.handleLambdaOutput(n,e,t,o,i,i)}))}catch(n){this.handleLambdaError(n,e,t,u.ExceptionType.LambdaThrow,i)}}},e.prototype.executeLocalLambdaStep=function(e,t,n,o,r){var i=this;null==this.hostCallbacks.executeLocalLambda?(s.setMessageException(e,{exceptionType:u.ExceptionType.LambdaThrow,message:"No local lambda host callback set"}),this.logOperation(t,!1,"Error",s.getMessageExceptionDescription(e)),r(e)):this.hostCallbacks.executeLocalLambda(n.inputSchema,e.payload,n.outputSchema).then((function(s){i.handleLambdaOutput(s,e,t,n.outputSchema,o,r)})).catch((function(n){i.handleLambdaError(n,e,t,u.ExceptionType.LambdaThrow,r)}))},e.prototype.executeRemoteLambdaStep=function(e,t,o,r,i,c){var l=this;if(this.serviceUrl){t.resourceId+="."+this.serviceProtocol;var p=function(n,r){n?l.handleLambdaError(n,e,t,n.exceptionType||u.ExceptionType.LambdaErrorCallback,c):l.handleLambdaOutput(r,e,t,o.outputSchema,i,c)};if(r.authTickets=o.authTickets,o.source===g.LambdaSource.Remote)this.executeRemoteLambda(this.serviceUrl,e,n.getTypeFromSchema(o.inputSchema),n.getTypeFromSchema(o.outputSchema),e.correlationVector,this.clientMetadata,this.hostCallbacks,r,p);else{this.batchedRemoteLambdaManager||(this.batchedRemoteLambdaManager=new a.BatchManager((function(e,t,o){var r=t.context,s=r.remoteLambda,i=r.lambdaContext;l.executeRemoteLambda(l.serviceUrl,{messageType:u.MessageType.Input,correlationVector:{id:t.cv},payload:e,payloadSchema:n.getTypeFromSchema(s.inputSchema),clientMetadata:l.clientMetadata},n.getTypeFromSchema(s.remoteInputSchema),n.getTypeFromSchema(s.remoteOutputSchema),{id:t.cv},l.clientMetadata,l.hostCallbacks,i,o)}),(function(e,t,n){var o=n.lambdaContext;l.updateResultCacheForReduceWorkflows("docId",o.docId,e,t)})));var f=o.batchOptions,d=this.normalizeBatchOptions(f),h=d.groupingKeyExtractor;d.groupingKeyExtractor=function(e){return o.name+"-"+h(e)};var y={name:o.name,remoteLambda:o,lambdaContext:r};this.batchedRemoteLambdaManager.addBatchItem(e.payload,d,y,e.correlationVector.id.length>127?e.correlationVector.id.substring(0,127)+"!":e.correlationVector.id,void 0,p)}}else s.setMessageException(e,{exceptionType:u.ExceptionType.LambdaThrow,message:"No URL for remote lambda"}),this.logOperation(t,!1,"Error",s.getMessageExceptionDescription(e)),c(e)},e.prototype.createLambdaExecutionStep=function(e,t,n,o,r){var a=this;return function(c){var l=new i.Operation({cv:c.correlationVector.toString(),operationName:"ExecuteLambda",resourceId:t.name,dimension0:e});l.start(),t.source===g.LambdaSource.Custom?a.executeCustomLambdaStep(c,l,t,n,o,r):t.source===g.LambdaSource.Local?a.executeLocalLambdaStep(c,l,t,o,r):t.source===g.LambdaSource.Remote||t.source===g.LambdaSource.BatchedRemote?a.executeRemoteLambdaStep(c,l,t,n,o,r):(s.setMessageException(c,{exceptionType:u.ExceptionType.LambdaThrow,message:"Unknown/No lambda location set"}),a.logOperation(l,!1,"Error",s.getMessageExceptionDescription(c)),r(c))}},e.prototype.normalizeBatchOptions=function(e){if(!e)throw new Error("Expected batchConfig");var t=o({},e);return e.estimateSize||(t.estimateSize=a.estimateSize),t},e}();n.ClientRuntimeALv1=_,n.runtimeALv1=new _},{13:13,14:14,15:15,16:16,18:18,19:19,36:36,57:57,7:7,79:79,80:80}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LambdaSource=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Local=1]="Local",e[e.Custom=2]="Custom",e[e.Remote=3]="Remote",e[e.BatchedRemote=4]="BatchedRemote"}(n.LambdaSource||(n.LambdaSource={}))},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExecutionWithThrottling=void 0;var o=e(57),r=function(){function e(){this.throttleInfoMap=new Map}return e.prototype.execute=function(e,t,n){var r=this;if(t.throttleSettings.shouldBeThrottled&&t.throttleSettings.throttlingInterval>0){var s=this.getWorkflowThrottleInfo(t.name);if(null==s.currentTileId)s.currentTileId=e,s.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),n();else if(s.currentTileId===e){var i=o.Utils.getCurrentTimeMs(),a=this.delayTime(s,i,t.throttleSettings.throttlingInterval);a>0?(s.latestCallback=n,null==s.lastTimeout&&(s.lastTimeout=setTimeout((function(){var e=r.getWorkflowThrottleInfo(t.name);e.lastTimeout=void 0,e.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),e.latestCallback()}),a))):(s.timeOfPreviousStartedEvent=i,n())}else null!=s.lastTimeout&&(clearTimeout(s.lastTimeout),s.latestCallback(),s.lastTimeout=void 0),s.currentTileId=e,s.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),n()}else n()},e.prototype.delayTime=function(e,t,n){var o=t-e.timeOfPreviousStartedEvent;return Math.max(n-o,0)},e.prototype.getWorkflowThrottleInfo=function(e){var t=this.throttleInfoMap.get(e);return t||(t={currentTileId:void 0,timeOfPreviousStartedEvent:-1,latestCallback:function(){},lastTimeout:void 0},this.throttleInfoMap.set(e,t)),t},e}();n.ExecutionWithThrottling=r},{57:57}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketRequestManager=void 0;var o=e(36),r=e(57),s=function(){function e(e,t,n,o,r,s){this.requestId=e,this.correlationId=t,this.schemaName=n,this.data=o,this.callback=r,this.requestTimeoutInMs=s,this.ended=!1,this.startTime=0}return e.prototype.startRequest=function(){this.startTime=r.Utils.getCurrentTimeMs()},e.prototype.getMsUntilTimeout=function(){var e=r.Utils.getCurrentTimeMs()-this.startTime;return this.requestTimeoutInMs-e},e.prototype.endRequest=function(e){this.ended||(this.invokeCallback(null,e,!0),this.ended=!0)},e.prototype.addResponseData=function(e){this.invokeCallback(e,null,!1)},e.prototype.invokeCallback=function(e,t,n){var o=this;new Promise((function(){return o.callback(e,t,n)})).catch((function(e){}))},e}(),i=function(){function e(e,t,n){this.requestCounter=0,this.activeRequests=[],this.pendingRequests=[],this.requestTimeoutInMs=e,this.workerFactory=t,this.maxActiveRequests=n}return e.prototype.testConnection=function(e,t){var n=this,s=!1,i=new o.Operation({cv:(new o.CorrelationVector).toString(),operationName:"WebSocketTest",resourceId:e,success:!0}).start();return new Promise((function(a){var c=r.Utils.createHealthCheckRequest(t);e?n.addRequest(e,c,i.cv,"HealthCheckRequest",(function(e,t,n){t&&(i.success=!1,i.resultSignature="Error",i.resultDescription=t.message||t),e&&"OK"===e.status&&(s=!0),n&&(i.success&&!s&&(i.success=!1,i.resultSignature="NoResponseData"),o.Log.info(556617949,o.LogCategory.CoreDefault,i.stop()),a(i.success))})):(i.success=!1,i.resultSignature="EmptyUrl",o.Log.info(557641870,o.LogCategory.CoreDefault,i.stop()),a(i.success))}))},e.prototype.addRequest=function(e,t,n,o,r){var i=(this.requestCounter++).toString(),a=new s(i,n,o,t,r,this.requestTimeoutInMs);this.getWorker(e),this.pendingRequests.push(a),this.egressPendingRequests()},e.prototype.egressPendingRequests=function(){for(;this.pendingRequests.length>0&&this.activeRequests.length<this.maxActiveRequests;){var e=this.pendingRequests.shift();if(this.activeRequests.push(e),1===this.activeRequests.length){var t=e.getMsUntilTimeout();setTimeout(this.onTimeout.bind(this),t)}e.startRequest(),this.worker&&this.worker.egress(this.createRequestMessage(e.data,e.requestId,e.correlationId))}},e.prototype.createRequestMessage=function(e,t,n){return JSON.stringify({correlationId:n,requestId:t,body:e})},e.prototype.onTimeout=function(){for(;this.activeRequests.length>0;){var e=this.activeRequests[0],t=e.getMsUntilTimeout();if(!(t<=0))return void setTimeout(this.onTimeout.bind(this),t);var n=new Error("Request timed out");e.endRequest(n),this.activeRequests.shift(),this.egressPendingRequests()}},e.prototype.onMessage=function(e){try{for(var t=JSON.parse(e),n=0;n<this.activeRequests.length;n++){var r=this.activeRequests[n];if(r.requestId===t.requestId){t.end?(this.activeRequests.splice(n,1),r.endRequest(t.error),this.egressPendingRequests()):t.body&&r.addResponseData(t.body);break}}}catch(e){o.Log.error(557641871,o.LogCategory.CoreDefault,e)}},e.prototype.onClose=function(e){for(var t=new Error("Connection closed: "+e),n=0,o=this.activeRequests;n<o.length;n++){o[n].endRequest(t)}this.activeRequests=[];for(var r=0,s=this.pendingRequests;r<s.length;r++){s[r].endRequest(t)}this.pendingRequests=[],this.worker=void 0},e.prototype.getWorker=function(e){return this.worker||(this.worker=this.workerFactory(),this.worker.init(e,this.onMessage.bind(this),(function(){}),this.onClose.bind(this))),this.worker},e}();n.WebSocketRequestManager=i},{36:36,57:57}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExcelSessionCloseReason=n.ExcelKeepAlive=n.ExcelAccessTokenRefreshed=n.ExcelWorkbookUpdated=n.ExcelServerSessionExtensionConfig=n.ExcelServerSessionInitMessage=void 0;var o=e(102),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelServerSessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SessionInitMessage","AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelServerSessionInitMessage=r;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelServerSessionExtensionConfig"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelServerSessionExtensionConfig=s;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelWorkbookUpdated"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelWorkbookUpdated=i;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelAccessTokenRefreshed"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelAccessTokenRefreshed=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelKeepAlive"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelKeepAlive=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelSessionCloseReason"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelSessionCloseReason=u},{102:102}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserType=n.AuthTokenType=void 0,function(e){e[e.EditorLowPrivilege=0]="EditorLowPrivilege",e[e.AugLoopLowPrivilege=1]="AugLoopLowPrivilege",e[e.Anonymous=2]="Anonymous",e[e.ClientAssertion=3]="ClientAssertion",e[e.ClientAssertionV2=4]="ClientAssertionV2",e[e.AutoClpLowPrivilege=5]="AutoClpLowPrivilege",e[e.AutoClpAppOnlyLowPrivilege=6]="AutoClpAppOnlyLowPrivilege",e[e.Substrate=7]="Substrate",e[e.WacAutoClpUserInfo=8]="WacAutoClpUserInfo",e[e.OwaExchange=9]="OwaExchange",e[e.SmartCompose=10]="SmartCompose",e[e.WritingAnalyticsLowPrivilege=11]="WritingAnalyticsLowPrivilege",e[e.DWEngineLowPrivilege=12]="DWEngineLowPrivilege",e[e.SubstrateApp=13]="SubstrateApp",e[e.CortanaAppPop=14]="CortanaAppPop",e[e.OfficeAppsAppOnly=15]="OfficeAppsAppOnly",e[e.PPTFrontdoorAppPop=16]="PPTFrontdoorAppPop",e[e.EditorAppOnlyLowPrivilege=17]="EditorAppOnlyLowPrivilege",e[e.AugLoopApp=18]="AugLoopApp",e[e.MeetingIntelligenceApp=19]="MeetingIntelligenceApp",e[e.GraphApp=20]="GraphApp"}(n.AuthTokenType||(n.AuthTokenType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Consumer=1]="Consumer",e[e.Enterprise=2]="Enterprise"}(n.UserType||(n.UserType={}))},{}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EnvironmentNameTranslation=n.Environment=void 0,function(e){e.dev="dev",e.int="int",e.test="test",e.dogfood="dogfood",e.prod="prod",e.gcc="gcc",e.dod="dod",e.gccHigh="gcchigh",e.ag08="ag08",e.ag09="ag09"}(n.Environment||(n.Environment={})),n.EnvironmentNameTranslation={gcc:"fairfax"}},{}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GridSubtreeFilter=n.SequentialItemFilter=n.ItemFilter=void 0;var o=e(102),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Interfaces_ItemFilter"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ItemFilter=r;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Interfaces_SequentialItemFilter"},e.getBaseTypes=function(){return["AugLoop_Interfaces_ItemFilter"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SequentialItemFilter=s;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Interfaces_GridSubtreeFilter"},e.getBaseTypes=function(){return["AugLoop_Interfaces_ItemFilter"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.GridSubtreeFilter=i},{102:102}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Type=void 0,function(e){e[e.None=0]="None",e[e.Booleans=1]="Booleans",e[e.Float32s=2]="Float32s",e[e.Float64s=3]="Float64s",e[e.Int8s=4]="Int8s",e[e.Int16s=5]="Int16s",e[e.Int32s=6]="Int32s",e[e.Strings=7]="Strings",e[e.UnsignedInt8s=8]="UnsignedInt8s",e[e.UnsignedInt16s=9]="UnsignedInt16s",e[e.UnsignedInt32s=10]="UnsignedInt32s"}(n.Type||(n.Type={}))},{}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LoggingLevel=void 0,function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=3]="info",e[e.metric=4]="metric",e[e.verbose=5]="verbose",e[e.debug=6]="debug"}(n.LoggingLevel||(n.LoggingLevel={}))},{}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isExceptionMessage=void 0;var o=e(80);n.isExceptionMessage=function(e){return null==e||null==e.messageType||e.messageType==o.MessageType.Exception}},{80:80}],28:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(22),n),o(e(23),n),o(e(24),n),o(e(25),n),o(e(26),n),o(e(27),n),o(e(29),n),o(e(30),n),o(e(31),n),o(e(32),n)},{22:22,23:23,24:24,25:25,26:26,27:27,29:29,30:30,31:31,32:32}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SerializationProfile=n.Pattern=void 0,function(e){e[e.PubSub=0]="PubSub",e[e.RequestReply=1]="RequestReply"}(n.Pattern||(n.Pattern={})),function(e){e[e.JSONB=0]="JSONB",e[e.JSON=1]="JSON",e[e.JSOND=2]="JSOND",e[e.Disabled=3]="Disabled",e[e.COMPRESSEDJSON=4]="COMPRESSEDJSON"}(n.SerializationProfile||(n.SerializationProfile={}))},{}],30:[function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ExpectedError=n.WorkflowKind=void 0,function(e){e[e.SingleItem=0]="SingleItem",e[e.Reduce=1]="Reduce",e[e.Grid=2]="Grid",e[e.DynamicText=3]="DynamicText",e[e.Join=4]="Join",e[e.Generic=5]="Generic"}(n.WorkflowKind||(n.WorkflowKind={}));var s=function(e){function t(n){void 0===n&&(n="ExpectedError");var o=e.call(this,n)||this;return o.__proto__=t.prototype,o}return r(t,e),t}(Error);n.ExpectedError=s},{}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.gatewayType=void 0,n.gatewayType="Gateway"},{}],32:[function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.CoherencyError=n.ItemCardinality=n.ItemRole=void 0,function(e){e[e.Input=1]="Input",e[e.Output=2]="Output"}(n.ItemRole||(n.ItemRole={})),function(e){e[e.Single=1]="Single",e[e.Any=-1]="Any",e[e.Optional=-2]="Optional",e[e.Some=-3]="Some"}(n.ItemCardinality||(n.ItemCardinality={}));var s=function(e){function t(n){void 0===n&&(n="CoherencyError");var o=e.call(this,n)||this;return o.__proto__=t.prototype,o}return r(t,e),t}(Error);n.CoherencyError=s},{}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.JSOND=void 0;var o=e(34);Object.defineProperty(n,"JSOND",{enumerable:!0,get:function(){return o.JSOND}})},{34:34}],34:[function(e,t,n){"use strict";var o,r,s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(n,"__esModule",{value:!0}),n.JSOND=void 0,"undefined"==typeof TextEncoder?(e(120),o=TextEncoder,r=TextDecoder,TextEncoder=void 0,TextDecoder=void 0):(o=TextEncoder,r=TextDecoder);var i=function(){function e(){}return e.deserialize=function(t,n){if(void 0===n&&(n=function(e){return e}),t[0]!==e.IDENTIFIERBYTE)throw"Invalid Binary: Incorrect Identifier";for(var o=1,r=[],s=new DataView(t.buffer,t.byteOffset,t.byteLength);o<t.byteLength;){if(o+4>t.byteLength)throw"Invalid Binary: Error reading fragment length";var i=s.getUint32(o);if(o+i+4>t.byteLength)throw"Invalid Binary: Fragment out of range";"undefined"!=typeof Buffer&&Buffer.from?r.push(Buffer.from(t.buffer,t.byteOffset+o+4,i)):r.push(new Uint8Array(t.buffer,t.byteOffset+o+4,i)),o+=4+i}if(r.length<1)throw"Invalid Binary: No fragments found";var a=e.textDecoder.decode(r[0]);return JSON.parse(a,(function(t,o){if("string"==typeof o){if(o.substring(0,e.BINARYKEYWORD.length)===e.BINARYKEYWORD){var s=parseInt(o.substring(e.BINARYKEYWORD.length),10);if("number"!=typeof s||s>=r.length-1)throw"Invalid Binary: Binary index out of range";return n(r[s+1])}if(o.substring(0,e.ESCAPEKEYWORD.length)===e.ESCAPEKEYWORD)return o.substring(e.ESCAPEKEYWORD.length)}return o}))},e.serialize=function(t){var n,o,r=[void 0],i=JSON.stringify(t,(function(t,n){return ArrayBuffer.isView(n)?(r.push(n),""+e.BINARYKEYWORD+(r.length-2)):n&&"Buffer"===n.type&&Array.isArray(n.data)?(r.push(new Uint8Array(n.data)),""+e.BINARYKEYWORD+(r.length-2)):"string"==typeof n&&n.substring(0,e.ESCAPEKEYWORD.length)===e.ESCAPEKEYWORD?e.ESCAPEKEYWORD+n:n}));r[0]=e.textEncoder.encode(i);var a=r.reduce((function(e,t){return e+4+t.byteLength}),0),c=new Uint8Array(a+1);c[0]=e.IDENTIFIERBYTE;var u=1,l=new DataView(c.buffer,c.byteOffset,c.byteLength);try{for(var p=s(r),f=p.next();!f.done;f=p.next()){var d=f.value;l.setUint32(u,d.byteLength),c.set(d,u+4),u+=4+d.byteLength}}catch(e){n={error:e}}finally{try{f&&!f.done&&(o=p.return)&&o.call(p)}finally{if(n)throw n.error}}return c},e.IDENTIFIERBYTE=3,e.BINARYKEYWORD=":b",e.ESCAPEKEYWORD=":",e.textDecoder=new r,e.textEncoder=new o,e}();n.JSOND=i},{120:120}],35:[function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationMetaDataChange=void 0;var s=function(e){function t(t){var n=e.call(this,t)||this;return n.eventName="AnnotationMetaDataChange",n}return r(t,e),t}(e(93).AnnotationMetaDataChangeEvent);n.AnnotationMetaDataChange=s},{93:93}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Operation=n.LoggingAggregator=n.LogCategory=n.Log=n.CorrelationVector=void 0;var o=e(37);Object.defineProperty(n,"CorrelationVector",{enumerable:!0,get:function(){return o.CorrelationVector}});var r=e(39);Object.defineProperty(n,"Log",{enumerable:!0,get:function(){return r.Log}}),Object.defineProperty(n,"LogCategory",{enumerable:!0,get:function(){return r.LogCategory}});var s=e(38);Object.defineProperty(n,"LoggingAggregator",{enumerable:!0,get:function(){return s.LoggingAggregator}});var i=e(41);Object.defineProperty(n,"Operation",{enumerable:!0,get:function(){return i.Operation}})},{37:37,38:38,39:39,41:41}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CorrelationVector=void 0;var o=function(){function e(e){this.childCount=0,this.id=e||function(){for(var e=0;e<22;e++)s[e]=r[Math.floor(Math.random()*r.length)];return s.join("")}()}return e.fromString=function(t,n){if(!t)throw new Error("Received invalid correlation vector string");var o;return o=-1===t.indexOf(".0",t.length-2)?new e(t):new e(t.substring(0,t.length-2)),n&&(o.childCount=n),o},e.prototype.newChild=function(){return++this.childCount,new e(this.id+"."+this.childCount.toString())},e.prototype.toString=function(){return this.id.length>127?this.id.substr(0,127)+"!":this.id},e}();n.CorrelationVector=o;var r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],s=new Array(22)},{}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LoggingAggregator=void 0;var o=/\|\~/g,r=function(){this.count=0,this.measureSums=new Map},s=function(e,t,n,s,i){var a=this;this.buckets=new Map,this.init=function(e){a.log=e},this.add=function(e){if(a.condition&&a.condition(e)){for(var t=[],n=0,s=a.dimensions;n<s.length;n++){var i=s[n];if(void 0===e[i])t.push(null);else{var c="";"boolean"==typeof e[i]?c="b~":"number"==typeof e[i]&&(c="n~"),t.push(""+c+e[i].toString().replace(o,"_"))}}var u=t.join("|"),l=a.buckets.get(u);if(!l){(l=new r).traceLevel=e.traceLevel;for(var p=0,f=a.avgMeasures;p<f.length;p++){var d=f[p];l.measureSums.set(d,0)}a.buckets.set(u,l)}l.count++;for(var g=0,h=a.avgMeasures;g<h.length;g++)e[d=h[g]]&&l.measureSums.set(d,l.measureSums.get(d)+e[d])}else a.log(e,!1)},this.flush=function(e){void 0===e&&(e=!1),a.buckets.forEach((function(e,t){for(var n={traceLevel:e.traceLevel,eventName:a.eventName,count:e.count},o=t.split("|"),r=0;r<a.dimensions.length;r++){var s=a.dimensions[r],i=o[r];0===i.indexOf("b~")?n[s]="b~true"===i:0===i.indexOf("n~")?n[s]=parseInt(i.slice("n~".length),10):n[s]=i}for(var c=0,u=a.avgMeasures;c<u.length;c++){var l=u[c];n[l]=Math.round(e.measureSums.get(l)/e.count)}a.log(n,!0)})),a.buckets.clear(),e&&(a.condition=null,clearInterval(a.interval))},this.eventName=e,this.condition=t,this.dimensions=n,this.avgMeasures=s,i>0&&(this.interval=setInterval(this.flush,1e3*i))};n.LoggingAggregator=s},{}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LogCategory=n.tagIdToString=n.argsToString=n.Log=void 0;var o,r,s=e(28),i="undefined"!=typeof process&&process.env?process.env.SERVICE_NAME:"client",a="abcdefghijklmnopqrstuvwxyz0123456789",c={97:0,98:1,99:2,100:3,101:4,102:5,103:6,104:7,105:8,106:9,107:10,108:11,109:12,110:13,111:14,112:15,113:16,114:17,115:18,116:19,117:20,118:21,119:22,120:23,121:24,122:25,48:26,49:27,50:28,51:29,52:30,53:31,54:32,55:33,56:34,57:35},u=[],l=[],p=new Map,f=new Map,d=new Map,g=new Map;!function(e){e.defineCoreLogCategory=function(e){return{root:"Core",name:e}},e.defineWorkflowLogCategory=function(e){return{root:"Workflow",name:e}},e.clearLoggers=function(){u=[],l=[],f.clear(),d.clear()},e.addLogger=function(e){u.push(e),Object.keys(s.LoggingLevel).map((function(e){return s.LoggingLevel[e]})).filter((function(t){return t<=e.level})).forEach((function(t){f.has(t)?f.get(t).push(e):f.set(t,[e])}))},e.addDecidingLogger=function(e){l.push(e),Object.keys(s.LoggingLevel).map((function(e){return s.LoggingLevel[e]})).filter((function(t){return t<=e.level})).forEach((function(t){d.has(t)?d.get(t).push(e):d.set(t,[e])}))},e.setCorrelationContextCallback=function(e){o=e},e.addAggregator=function(e){e.init((function(e,t){v(e,t)})),p.set(e.eventName,e)},e.flushAggregators=function(e){p.forEach((function(t){t.flush(e)}))},e.setTagLevelOverride=function(e,t){var n=S(e);g.set(n,t)},e.resetTagLevelOverrides=function(){g.clear()},e.error=function(e,t,n,o,r,i,a,c,u,l){m(e,t,s.LoggingLevel.error,n,o,r,i,a,c,u,l)},e.warn=function(e,t,n,o,r,i,a,c,u,l){m(e,t,s.LoggingLevel.warn,n,o,r,i,a,c,u,l)},e.info=function(e,t,n,o,r,i,a,c,u,l){m(e,t,s.LoggingLevel.info,n,o,r,i,a,c,u,l)},e.verbose=function(e,t,n,o,r,i,a,c,u,l){m(e,t,s.LoggingLevel.verbose,n,o,r,i,a,c,u,l)},e.debug=function(e,t,n,o,r,i,a,c,u,l){m(e,t,s.LoggingLevel.debug,n,o,r,i,a,c,u,l)},e.metric=function(e,t,n,o,r,i,a,c,u,l){m(e,t,s.LoggingLevel.metric,n,o,r,i,a,c,u,l)},e.dynamic=function(e){v(e)}}(r=n.Log||(n.Log={}));n.argsToString=function(e){return"string"==typeof e?e:e.map((function(e){return e instanceof Error?JSON.stringify({message:e.message,name:e.name,stack:e.stack}):"object"==typeof e?JSON.stringify(e):e})).join(" ")};var h=function(e){return void 0!==e?f.get(e)||[]:u},y=function(e,t){return(void 0!==e?d.get(e)||[]:l).filter((function(e){return e.shouldLog(t)}))},m=function(e,t,o,r,s,i,a,c,u,l,f){o=g.get(e)||o;var d=h(o),m=y(o,r);if(0!=d.length||0!=m.length){var S=n.tagIdToString(e),T=function(e,t,n,o,r,s,i,a){if(void 0===t&&("string"==typeof e||"object"==typeof e))return e;if(void 0===t&&"function"==typeof e)return e();for(var c=[],u=0,l=[e,t,n,o,r,s,i,a];u<l.length;u++){var p=l[u];void 0!==p&&c.push("function"==typeof p?p():p)}return c}(r,s,i,a,c,u,l,f);if(Array.isArray(T)||"object"!=typeof T)v({eventName:"Log",tagId:S,category:t.root+"."+t.name,traceLevel:o,message:n.argsToString(T)},!1,d,m);else{var b=T;b.tagId=S,"Operation"===b.eventName&&"Workflow"===t.root&&(b.eventName="WorkflowOperation"),b.traceLevel=o;var _=p.get(b.eventName);_?_.add(b):v(b,!1,d,m)}}},v=function(e,t,n,r){var s,a,c;if(void 0===t&&(t=!1),null==n&&(n=h(e.traceLevel)),r=r||[],n.length>0||r.length>0){if(e.serviceName=i,!t&&o){var u=o();if(u){e.cv=e.cv?e.cv:u.cv.toString(),e.sessionKey=e.sessionKey?e.sessionKey:u.sessionKey,e.workflow=e.workflow?e.workflow:u.workflow;var l=null===(s=u.clientMetadata)||void 0===s?void 0:s.appName;e.clientAppName=e.clientAppName?e.clientAppName:l;var p=null===(a=u.clientMetadata)||void 0===a?void 0:a.appPlatform;e.clientAppPlatform=e.clientAppPlatform?e.clientAppPlatform:p;var f=null===(c=u.clientMetadata)||void 0===c?void 0:c.releaseAudienceGroup;e.clientReleaseAudienceGroup=e.clientReleaseAudienceGroup?e.clientReleaseAudienceGroup:f}}for(var d=0,g=n;d<g.length;d++){g[d].log(e)}for(var y=0,m=r;y<m.length;y++){m[y].log(e)}}};n.tagIdToString=function(e){return a[e>>24&63]+a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[e>>0&63]};var S=function(e){return e&&5===e.length?c[e.charCodeAt(0)]<<24|c[e.charCodeAt(1)]<<18|c[e.charCodeAt(2)]<<12|c[e.charCodeAt(3)]<<6|c[e.charCodeAt(4)]:-1},T=function(){function e(){}return e.CoreDefault=r.defineCoreLogCategory("Default"),e.WorkflowDefault=r.defineWorkflowLogCategory("Default"),e}();n.LogCategory=T},{28:28}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.now=void 0;n.now="undefined"!=typeof process&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Date.now()}},{}],41:[function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.Operation=void 0;var s=e(94),i=e(40),a=function(e){function t(t,n,o){var r=e.call(this,t)||this;return r.eventName="Operation",t&&null!=t.count||(r.count=1),n&&r.setClientMetadata(n),o&&r.setUserContext(o),r}return r(t,e),t.prototype.setClientMetadata=function(e){e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientDeviceId=e.deviceId)},t.prototype.setUserContext=function(e){e&&(this.userId=e.puid||e.oid,this.userType=e.userType&&e.userType.toString())},t.prototype.start=function(){return this.startTime=i.now(),this},t.prototype.stop=function(){var e=i.now();return this.durationMs=Math.round(e-this.startTime),this},t}(s.OperationEvent);n.Operation=a},{40:40,94:94}],42:[function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.SessionHealth=n.SessionHealthImpact=n.SessionHealthReason=n.SessionHealthSource=void 0;var s,i,a,c=e(95),u=e(40);!function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.ClientRuntime=5]="ClientRuntime"}(s=n.SessionHealthSource||(n.SessionHealthSource={})),function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.Network=5]="Network",e[e.AugLoopDependency=6]="AugLoopDependency",e[e.WorkflowDependency=7]="WorkflowDependency",e[e.ClientRuntime=8]="ClientRuntime"}(i=n.SessionHealthReason||(n.SessionHealthReason={})),function(e){e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.MissingInput=2]="MissingInput",e[e.MissingOutput=3]="MissingOutput"}(a=n.SessionHealthImpact||(n.SessionHealthImpact={}));var l=function(e){function t(t,n){var o,r,c=e.call(this,{source:s[t.source],reason:i[t.reason],reasonDependency:t.reasonDependency,subReason:t.subReason,sessionHealthEventName:t.sessionHealthEventName,impact:a[t.impact],success:t.success,durationMs:null!==(o=t.durationMs)&&void 0!==o?o:0,count:"number"==typeof t.count?t.count:1,message:t.message,affectedWorkflows:(null!==(r=t.affectedWorkflows)&&void 0!==r?r:[]).join(","),resourceId:t.resourceId,dimension0:t.dimension0,dimension1:t.dimension1,dimension2:t.dimension2,dimension3:t.dimension3,cv:t.cv,resultSignature:t.resultSignature,resultDescription:t.resultDescription})||this;return c.eventName="SessionHealth",n&&c.setClientMetadata(n),c}return r(t,e),t.prototype.setClientMetadata=function(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId),this},t.prototype.setReason=function(e){return this.reason=i[e],this},t.prototype.setSource=function(e){return this.source=s[e],this},t.prototype.setImpact=function(e){return this.impact=a[e],this},t.prototype.setAffectedWorkflows=function(e){return this.affectedWorkflows=(null!=e?e:[]).join(","),this},t.prototype.getAffectedWorkflows=function(){return this.affectedWorkflows.split(",")},t.prototype.start=function(){return this.startTime=u.now(),this},t.prototype.stop=function(){var e=u.now();return this.durationMs=Math.round(e-this.startTime),this},t}(c.SessionHealthEvent);n.SessionHealth=l},{40:40,95:95}],43:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ModelDownloader=void 0;var o=e(44);Object.defineProperty(n,"ModelDownloader",{enumerable:!0,get:function(){return o.ModelDownloader}})},{44:44}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ModelDownloader=void 0;var o,r=e(36),s=e(121);!function(e){e.URL="URL",e.ArrayBuffer="ArrayBuffer"}(o||(o={}));var i=function(){function e(e,t){var n=this;this.dbName="ALModels_db",this.osName="ALModels_os",this.baseURL="https://"+t+"/web/"+e;var o,s=new r.Operation({operationName:"UpdateSessionsSinceModelsUsed",success:!0,resultDescription:""});s.start();var i=new Promise((function(e,t){o=setTimeout((function(){t(new Error("Took longer than 10000 ms"))}),1e4)})),a=this.accessDB().then((function(e){return e.transaction(n.osName,"readwrite").objectStore(n.osName).openCursor()})).then((function e(t){if(t){var n=t.value;return n.timesSinceUsage||(n.timesSinceUsage=0),n.timesSinceUsage++,n.timesSinceUsage>5?t.delete():t.update(n),t.continue().then(e)}}));this.initPromise=Promise.race([i,a]).catch((function(e){s.success=!1,s.resultDescription+=e.message+" "})).then((function(){clearTimeout(o),n.closeDBAndEndLog(s,"initializing idb storage")}))}return e.prototype.getResourceAsArrayBuffer=function(e,t){var n=new r.Operation({operationName:"GetModelArrayBuffer",success:!0,resultDescription:"",dimension0:e,dimension1:t});n.start();var s={};return this.getResource(e,t,o.ArrayBuffer,n,(function(e){return Promise.all(Array.from(e.keys()).map((function(t){var n=e.get(t);return n.arrayBuffer?n.arrayBuffer().then((function(e){s[t]=e})):new Promise((function(e,o){var r=new FileReader;r.readAsArrayBuffer(n),r.onload=function(n){var r=n.target.result;r instanceof ArrayBuffer?(s[t]=r,e()):o(new Error("Unable to obtain ArrayBuffer"))}}))})))})).then((function(){return s}))},e.prototype.getResourceAsURL=function(e,t){var n=new r.Operation({operationName:"GetModelURL",success:!0,resultDescription:"",dimension0:e,dimension1:t});n.start();var s={};return this.getResource(e,t,o.URL,n,(function(e){return Promise.all(Array.from(e.keys()).map((function(t){s[t]=URL.createObjectURL(e.get(t))})))})).then((function(){return s}))},e.prototype.getResource=function(e,t,n,o,r){var s=this;return this.initPromise.catch((function(e){o.success=!1,o.resultDescription+=e.message+" ",o.resultSignature="Issue initializing"})).then((function(){return s.getIndexedDBFiles(e,t,o)})).then((function(e){return r(e)})).then((function(){s.closeDBAndEndLog(o,"retrieving "+e)})).catch((function(t){throw o.resultDescription!==t.message+" "&&(o.success=!1,o.resultDescription+=t.message+" "),o.resultSignature="Issue retrieving from CDN or translating to "+n,s.closeDBAndEndLog(o,"retrieving "+e),t}))},e.prototype.isSafari=function(){return!!("undefined"!=typeof window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.toLowerCase().indexOf("safari")>-1&&window.navigator.userAgent.toLowerCase().indexOf("chrome")<=-1)},e.prototype.accessDB=function(){return this.isSafari()?this.accessDBPromise=Promise.reject(new Error("Unable to use IDB with Safari")):"undefined"!=typeof Proxy?this.accessDBPromise||(this.accessDBPromise=this.openDBCall().then((function(e){if(!e)throw new Error("No database returned from openDB request");return e}))):this.accessDBPromise=Promise.reject(new Error("Proxy does not exist, therefore idb not supported")),this.accessDBPromise},e.prototype.openDBCall=function(){var e=this;return s.openDB(this.dbName,1,{upgrade:function(t){t&&!t.objectStoreNames.contains(e.osName)&&t.createObjectStore(e.osName,{keyPath:"modelId"})}})},e.prototype.endLog=function(e,t){e.success?(e.resultDescription="Success "+t,r.Log.info(573329487,r.LogCategory.CoreDefault,e.stop())):(e.resultDescription+="error "+t,r.Log.error(573329488,r.LogCategory.CoreDefault,e.stop()))},e.prototype.closeDBAndEndLog=function(e,t){var n=this;this.accessDBPromise&&this.accessDBPromise.then((function(e){e.close()})).catch((function(t){e.resultDescription!==t.message+" "&&(e.success=!1,e.resultDescription+=(t.message?t.message:"Error closing db")+" ",e.resultSignature="Issue closing db")})).then((function(){n.accessDBPromise=void 0,n.endLog(e,t)}))},e.prototype.getIndexedDBFiles=function(e,t,n){var o=this;return this.getModel(e).then((function(e){return e&&e.model&&e.version==t?Promise.resolve(e.model):Promise.reject()})).catch((function(r){return r&&(n.resultDescription!==r.message+" "&&(n.success=!1,n.resultDescription+=r.message+" "),n.resultSignature="Issue retrieving from DB"),o.downloadFiles(e,t)})).then((function(r){return o.putModel(e,r,t).then((function(){return r})).catch((function(e){return n.resultDescription!==e.message+" "&&(n.success=!1,n.resultDescription+=e.message+" "),n.resultSignature="Issue adding to DB",r}))}))},e.prototype.downloadFiles=function(e,t){var n=this;return fetch(this.baseURL+"/catalog_"+e+"_"+t+".json").then((function(e){if(e.ok)return e.text();throw new Error("CDN download response status: "+e.status)})).then((function(o){var r=JSON.parse(o),s=r.MajorVersion+"."+r.MinorVersion+"/ModelResources",i=e+"/"+t+"/";return Promise.all(r.Resources.map((function(e){return e.Name.length>i.length&&e.Name.substring(0,i.length)===i&&(e.Name=e.Name.substring(i.length)),fetch(n.baseURL+"/"+s+"/"+i+e.Name+"."+e.Type).then((function(e){if(e.ok)return e.blob();throw new Error("CDN download response status: "+e.status)})).then((function(t){return[e.Name+"."+e.Type,t]}))})))})).then((function(e){return new Map(e)}))},e.prototype.getModel=function(e){var t=this;return this.accessDB().then((function(n){return n.get(t.osName,e)}))},e.prototype.putModel=function(e,t,n){var o=this;return this.accessDB().then((function(r){return r.put(o.osName,{modelId:e,model:t,version:n,timesSinceUsage:0})}))},e}();n.ModelDownloader=i},{121:121,36:36}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ALFactoryGlobal=n.AugLoopFactory=void 0;var o=e(46),r=e(57),s=function(){function e(){this._augLoopRuntimeManager=new o.AugLoopRuntimeManager}return e.prototype.getAugLoopRuntimeManager=function(){return this._augLoopRuntimeManager},e.prototype.createSingleItemWorkflow=function(e){return r.SingleItemWorkflow.create(e)},e}();n.AugLoopFactory=s,n.ALFactoryGlobal=new s},{46:46,57:57}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AugLoopRuntimeManager=n.IdentityProvider=void 0;var o=e(57),r=e(12),s=e(80);Object.defineProperty(n,"IdentityProvider",{enumerable:!0,get:function(){return s.IdentityProvider}});var i=e(43),a=e(48),c=e("@ms/office-online-telemetry"),u=e(21),l=e(51),p=function(e,t){for(var n,o=[],r=0,s=Object.keys(e);r<s.length;r++){var i=s[r];if(void 0!==e[i]&&null!==e[i]){var a={name:t?t+"."+i:i,dataType:(n=e[i],"string"==typeof n?0:"boolean"==typeof n?1:"number"==typeof n?2:void c.ULS.sendTraceTag(572838285,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Warning,"Unsupported data field type")),value:e[i],classification:4};o.push(a)}}return o},f=function(e){return Promise.resolve(!1)},d=function(){var e=this;this._telemetryAggregationIntervalSec=30,this._eventHandlerDictionary={},this.initialize=function(t){if(e._runtimeInitPromise)c.ULS.sendTraceTag(572838286,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Info,"Runtime already initialized");else if(c.ULS.sendTraceTag(572838287,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Info,"Start and initialize augloop runtime ..."),t){var n=t.serviceUrl,s=t.appName,u=t.appVersion,l=t.uiLanguage,p=t.releaseAudienceGroup,d=t.releaseChannel,g=t.releaseFork,h=t.sessionId,y=t.flights,m=t.privateMode,v=t.disabledServiceGroups,S=t.sessionCreationOptions,T=e.isFeatureEnabled("ModelDownloaderEbrake","None").then((function(n){n?c.ULS.sendTraceTag(556376070,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Info,"Resource downloader not created due to feature gate"):e.modelDownloaderFromCDN=t.appName&&t.downloadBaseUrl&&!function(){if("undefined"!=typeof window&&window.navigator&&window.navigator.userAgent){var e=window.navigator.userAgent;return(!e.indexOf||e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0)&&(c.ULS.sendTraceTag(556376069,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Info,"Resource downloader not created due to IE or lack of user agent"),!0)}return!0}()?new i.ModelDownloader(t.appName,t.downloadBaseUrl):void 0}));e.inferenceService=t.appName&&t.inferenceServiceVersion?a.OnnxInferenceService.create(t.appName,t.inferenceServiceVersion):void 0,e.excelServerParameters=t.excelServer,e.powerpointParameters=t.powerpoint;var b={appName:s,appPlatform:"Web",appVersion:u,uiLanguage:l,releaseAudienceGroup:p,releaseChannel:d,releaseFork:g,sessionId:h,flights:y,privateMode:m,disabledServiceGroups:v},_={onResult:e.onResult.bind(e),onAnnotationResult:e.onAnnotationResult.bind(e),sendTelemetryEvent:e.sendTelemetryEvent.bind(e),requestAuthToken:e.requestAuthToken.bind(e),isFeatureEnabled:e.isFeatureEnabled.bind(e),setSessionData:e.setSessionData.bind(e),areLicenseFeaturesEnabled:f,onInitSession:e.onInitSession.bind(e),overrideSessionInitMessage:e.overrideSessionInitMessage.bind(e)},w=T.then((function(){return o.runtime.init(n,b,_,{telemetryAggregationIntervalSec:e._telemetryAggregationIntervalSec,modelDownloader:e.modelDownloaderFromCDN,inferenceService:e.inferenceService})})).then((function(){return r.runtimeALv1.init(n,b,_)}));e.createSession=function(){e._runtimeInitPromise=w.then((function(){return o.runtime.createSession(S)}))},e.createSession()}else c.ULS.sendTraceTag(572838288,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"initialize failed due to null parameters")},this.getSession=function(){return e._runtimeInitPromise},this.setULSLogger=function(e){if(e){var t=e.ulsLogger;null!=t&&c.ULS.setLogger(t)}else c.ULS.sendTraceTag(572838289,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"setULSLogger failed due to null parameters")},this.setSendOTelEventCallback=function(t){if(t){var n=t.sendOTelEvent;e._sendOTelEventCallback=n}else c.ULS.sendTraceTag(572838290,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"setSendOTelEventCallback failed due to null parameters")},this.setRequestAuthTokenCallback=function(t){if(t){var n=t.requestAuthTokenCallback;e._requestAuthTokenCallback=n}else c.ULS.sendTraceTag(572838291,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"setRequestAuthTokenCallback failed due to null parameters")},this.setIsFeatureEnabledCallback=function(t){if(t){var n=t.featureEnabledCallback;e._featureEnabledCallback=n}else c.ULS.sendTraceTag(572838292,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"setIsFeatureEnabledCallback failed due to null parameters")},this.registerLocalWorkflow=function(t){t?e._runtimeInitPromise?t.workflow?e._runtimeInitPromise.then((function(e){e.registerLocalWorkflow(t.workflow)})):c.ULS.sendTraceTag(572838295,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"registerLocalWorkflow workflow was null"):c.ULS.sendTraceTag(572838294,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"registerLocalWorkflow called before initialize"):c.ULS.sendTraceTag(572838293,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"registerLocalWorkflow failed due to null parameters")},this.activateAnnotation=function(t){return t&&t.annotationType?e._runtimeInitPromise?e._runtimeInitPromise.then((function(e){var n;return(t.handler||t.stateUpdateHandler)&&(n={callback:t.handler,stateUpdateCallback:t.stateUpdateHandler}),e.activateAnnotation(t.annotationType,n)})):Promise.reject(new Error("Called before initialize")):Promise.reject(new Error("Invalid parameters"))},this.releaseAnnotation=function(t){return t&&t.token?e._runtimeInitPromise?e._runtimeInitPromise.then((function(e){return e.releaseAnnotation(t.token)})):Promise.reject(new Error("Called before initialize")):Promise.reject(new Error("Invalid parameters"))},this.submitOperation=function(t){if(t){var n=t.operation;n?e._runtimeInitPromise?e._runtimeInitPromise.then((function(e){e.submitOperation(n)})):c.ULS.sendTraceTag(572838298,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"submitOperation called before initialize"):c.ULS.sendTraceTag(572838297,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"Operation was null")}else c.ULS.sendTraceTag(572838296,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"submitOperation failed due to null parameters")},this.setSessionDataCallback=function(t){if(t){var n=t.handler,o=t.sessionDataCallback;o?e._setSessionDataCallback=o:n&&(e._setSessionDataCallback=function(e,t,o){return n(e,t)})}else c.ULS.sendTraceTag(572838299,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"setSessionDataCallback failed due to null parameters")},this.setAnnotationResultCallback=function(t){if(t){var n=t.handler;e._annotationResultCallback=n}else c.ULS.sendTraceTag(572838300,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"setAnnotationResultCallback failed due to null parameters")},this.setAnnotationState=function(t){t?e._runtimeInitPromise.then((function(e){e.setAnnotationState(t.parentPath,t.id,t.value)})):c.ULS.sendTraceTag(572838301,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"setAnnotationState failed due to null parameters")},this.setAnnotationMetadata=function(t){t?e._runtimeInitPromise.then((function(e){e.setAnnotationMetadata(t.parentPath,t.id,t.value)})):c.ULS.sendTraceTag(570810580,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"setAnnotationMetadata failed due to null parameters")},this.setInitSessionCallback=function(t){if(t){var n=t.initSessionCallback;e._initSessionCallback=n}else c.ULS.sendTraceTag(572838302,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"setInitSessionCallback failed due to null parameters")},this.setSessionInitOverrideCallback=function(t){if(t){var n=t.handler;e._sessionInitOverrideCallback=n}else c.ULS.sendTraceTag(572838303,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"setSessionInitOverrideCallback failed due to null parameters")},this.forceReconnectSession=function(t){return e._runtimeInitPromise.then((function(n){return t.excelServerParameters&&(e.excelServerParameters=t.excelServerParameters),n.forceReconnect()}))},this.setSessionCloseCallback=function(t){if(!t)return Promise.reject(new Error("setSessionCloseCallback failed due to null parameters"));var n=t.callback;return n?e._runtimeInitPromise.then((function(e){e.setSessionCloseCallback(n)})):Promise.reject(new Error("setSessionCloseCallback callback was null"))},this.submitCustomMessage=function(t){if(!t){var n="submitCustomMessage failed due to null parameters";return c.ULS.sendTraceTag(572838304,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,n),Promise.reject(new Error(n))}var o=t.message;if(o)return e._runtimeInitPromise?e._runtimeInitPromise.then((function(e){return e.submitCustomMessage(o)})):(n="submitCustomMessage called before initialize",c.ULS.sendTraceTag(572838306,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,n),Promise.reject(new Error(n)));var n="Message was null";return c.ULS.sendTraceTag(572838305,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,n),Promise.reject(new Error(n))},this.closeSession=function(){if(e._runtimeInitPromise)return e._runtimeInitPromise.then((function(e){e.close()}));var t="closeSession called before initialize";return c.ULS.sendTraceTag(572838307,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,t),Promise.reject(new Error(t))},this.startNewSession=function(){e.createSession?e.createSession():c.ULS.sendTraceTag(572838336,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"startNewSession called before initialize")},this.submit=function(t){if(t){var n=t.inputSchema,o=t.input,s=t.correlationVector;e._runtimeInitPromise?n&&o?e._runtimeInitPromise.then((function(){r.runtimeALv1.submit(n,o,s)})):c.ULS.sendTraceTag(572838339,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"Null parameter. inputSchema:"+n+" correlationVector:"+s+" input:"+o):c.ULS.sendTraceTag(572838338,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"onSubmit called before initialize")}else c.ULS.sendTraceTag(572838337,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"submit failed due to null parameters")},this.addEventHandler=function(t){if(t){var n=t.schemaName,o=t.handler;if(n){var r=e._eventHandlerDictionary[n]||[];r.push(o),e._eventHandlerDictionary[n]=r}}else c.ULS.sendTraceTag(572838340,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"addEventHandler failed due to null parameters")},this.removeEventHandler=function(t){if(t){var n=t.schemaName,o=t.handler;if(n&&o){var r=e._eventHandlerDictionary[n];if(Array.isArray(r)){var s=r.indexOf(o);s>=0&&r.splice(s,1)}}}else c.ULS.sendTraceTag(572838341,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"removeEventHandler failed due to null parameters")},this.registerSimpleRemoteWorkflow=function(t){if(!t)return c.ULS.sendTraceTag(572838342,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"registerSimpleRemoteWorkflow failed due to null parameters"),Promise.resolve();var n=t.name,o=t.lambdaBefore,s=t.lambdaRemote,i=t.lambdaAfter;if(e._runtimeInitPromise){if(n&&s)return e._runtimeInitPromise.then((function(){return r.runtimeALv1.registerSimpleRemoteWorkflow(n,o,s,i)}));c.ULS.sendTraceTag(572838344,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"Null parameters. name:"+n+" lambdaRemote:"+s)}else c.ULS.sendTraceTag(572838343,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"registerSimpleRemoteWorkflow called before initialize");return Promise.resolve()},this.registerSimpleLocalWorkflow=function(t){if(!t)return c.ULS.sendTraceTag(572838345,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"registerSimpleLocalWorkflow failed due to null parameters"),Promise.resolve();var n=t.name,o=t.lambda;if(e._runtimeInitPromise){if(n&&o)return e._runtimeInitPromise.then((function(){return r.runtimeALv1.registerSimpleLocalWorkflow(n,o)}));c.ULS.sendTraceTag(572838347,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"Null parameters. name:"+n+" lambda:"+o)}else c.ULS.sendTraceTag(572838346,c.LogCategory.msoulscat_Wac_BrowserGeneral,c.TraceLevel.Error,"registerSimpleLocalWorkflow called before initialize");return Promise.resolve()},this.registerReduceWorkflow=function(e){return Promise.resolve()},this.registerSchemas=function(e){return Promise.resolve()},this.onResult=function(t,n,o,r){var s=e._eventHandlerDictionary[o];if(s)for(var i=0,a=s;i<a.length;i++){var c=a[i];null!=c&&c({inputSchema:t,input:n,outputSchema:o,output:r})}},this.onAnnotationResult=function(t){e._annotationResultCallback&&e._annotationResultCallback(t)},this.requestAuthToken=function(t){return e._requestAuthTokenCallback?(e._requestAuthTokenCallback(t)||Promise.resolve("")).then((function(e){var t=e||"";return Promise.resolve({Token:t})})):Promise.resolve({Token:""})},this.sendTelemetryEvent=function(t,n,o,r,s,i,a,c){e._sendOTelEventCallback&&e._sendOTelEventCallback(function(e,t,n,o,r,s,i){var a={telemetryProperties:{ariaTenantToken:e,nexusTenantToken:-1},eventName:t.split("_").join("."),dataFields:p(n),eventFlags:{dataCategories:s,diagnosticLevel:i,samplingPolicy:1}};return o&&(a.eventContract={name:o,dataFields:p(r,o.split(".").slice(-1)[0])}),a}(t,n,o,r,s,a,c))},this.isFeatureEnabled=function(t,n){if(!t)return Promise.resolve(!1);var o="Microsoft.Office.AugLoop.";if(0===t.indexOf(o)&&e._featureEnabledCallback){var r=t.slice(o.length);return Promise.resolve(e._featureEnabledCallback(r))}return Promise.resolve(!1)},this.setSessionData=function(t,n,o){e._setSessionDataCallback&&e._setSessionDataCallback(t,n,o)},this.overrideSessionInitMessage=function(t){return e._sessionInitOverrideCallback?e._sessionInitOverrideCallback(t):0===t.clientMetadata.appName.indexOf("Excel")&&e.excelServerParameters?e.overrideExcelSessionInitMessage(t):0===t.clientMetadata.appName.indexOf("PowerPoint")&&e.powerpointParameters?e.overridePowerPointSessionInitMessage(t):t},this.overrideExcelSessionInitMessage=function(t){for(var n={cluster:e.excelServerParameters.wacCluster,restUrl:e.excelServerParameters.ecsRestUrl,ecsId:e.excelServerParameters.ecsSessionId,ecsOperationUrl:e.excelServerParameters.ecsOperationUrl,workbookMetadataVersion:e.excelServerParameters.metadataVersion,serverEventVersion:e.excelServerParameters.serverEventVersion,permissionFlags:e.excelServerParameters.permissionFlags,configurations:e.excelServerParameters.configurations,collabUserListVersion:e.excelServerParameters.userListVersion,collabStateId:e.excelServerParameters.collabStateId,accessToken:e.excelServerParameters.accessToken,accessTokenTTL:e.excelServerParameters.accessTokenTTL,supportCustomMessages:e.excelServerParameters.supportCustomMessages},o=0,r=Object.keys(t);o<r.length;o++){var s=r[o];n[s]=t[s]}return new u.ExcelServerSessionInitMessage(n)},this.overridePowerPointSessionInitMessage=function(t){for(var n={downloadUrl:e.powerpointParameters.downloadUrl,getItemsEndPoint:e.powerpointParameters.getItemsEndPoint,documentOpenType:e.powerpointParameters.documentOpenType},o=0,r=Object.keys(t);o<r.length;o++){var s=r[o];n[s]=t[s]}return new l.PowerPointSessionInitMessage(n)},this.onInitSession=function(){return e._initSessionCallback?e._initSessionCallback():Promise.resolve()}};n.AugLoopRuntimeManager=d},{12:12,21:21,43:43,48:48,51:51,57:57,80:80,"@ms/office-online-telemetry":"@ms/office-online-telemetry"}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ALFactoryGlobal=void 0;var o=e(45);Object.defineProperty(n,"ALFactoryGlobal",{enumerable:!0,get:function(){return o.ALFactoryGlobal}})},{45:45}],48:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(50),n),o(e(49),n)},{49:49,50:50}],49:[function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,s,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,o&&(r=2&s[0]?o.return:s[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,s[1])).done)return r;switch(o=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(n,"__esModule",{value:!0}),n.Inputs=n.Model=n.lackingPromiseOrWasmSupport=void 0;var s=e(28),i=e(36);n.lackingPromiseOrWasmSupport=function(e){var t="";if("undefined"!=typeof window&&window.navigator&&window.navigator.userAgent){var n=window.navigator.userAgent;!n.indexOf||n.indexOf("MSIE ")>0||n.indexOf("Trident/")>0?t="Error: IE lacks necessary support":"undefined"==typeof Promise?t="Error: Promise is not supported":"undefined"==typeof WebAssembly&&(t="Error: WASM is not supported")}else t="Error: No window userAgent";return""!=t&&(e.resultDescription=t,i.Log.info(544859589,i.LogCategory.CoreDefault,e.stop()),!0)};var a=function(){function e(e){this.session=e}return e.create=function(t){return o(this,void 0,void 0,(function(){var n;return r(this,(function(o){return(n=new i.Operation({operationName:"PrepareModelForInferencing",success:!0,resultDescription:""})).start(),[2,this.getInferenceSession().create(t).then((function(t){return n.resultDescription="Success preparing model",i.Log.info(544859590,i.LogCategory.CoreDefault,n.stop()),new e(t)})).catch((function(e){throw n.resultDescription="Error: "+e,i.Log.info(544859591,i.LogCategory.CoreDefault,n.stop()),e}))]}))}))},e.getInferenceSession=function(){var e,t;if(null===(t=null===(e=window)||void 0===e?void 0:e.ort)||void 0===t?void 0:t.InferenceSession)return window.ort.InferenceSession;throw new Error("Inference session is not defined")},e.prototype.run=function(e){return o(this,void 0,void 0,(function(){var t;return r(this,(function(n){switch(n.label){case 0:return t=u.bind,[4,this.session.run(e.getInputs())];case 1:return[2,new(t.apply(u,[void 0,n.sent()]))]}}))}))},e}();n.Model=a;var c=function(){function e(){this.map={}}return e.create=function(){return new e},e.prototype.getInputs=function(){return this.map},e.prototype.add=function(e,t,n){if(Array.isArray(n)&&n.length>0&&"boolean"==typeof n[0]){var o=new Uint8Array(n);this.map[e]=new window.ort.Tensor(o,t)}else this.map[e]=new window.ort.Tensor(n,t);return this},e}();n.Inputs=c;var u=function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var o=n[t];this[o]=new l(o,e[o])}},l=function(){function e(e,t){this.resultName=e,this.result=t}return e.prototype.name=function(){return this.resultName},e.prototype.outputType=function(){switch(this.result.type){case"string":return s.Type.Strings;case"int8":return s.Type.Int8s;case"int16":return s.Type.Int16s;case"int32":return s.Type.Int32s;case"bool":return s.Type.Booleans;case"uint8":return s.Type.UnsignedInt8s;case"uint16":return s.Type.UnsignedInt16s;case"uint32":return s.Type.UnsignedInt32s;case"float32":return s.Type.Float32s;case"float64":return s.Type.Float64s;default:throw new Error("The output type "+this.result.type+" is not supported.")}},e.prototype.dimensions=function(){return this.result.dims},e.prototype.asBooleans=function(){if(this.outputType()===s.Type.Booleans)return this.result.data.map((function(e){return!!e}));throw new Error("asBooleans() was called; however, outputType() is "+this.outputType()+", not Type.Booleans.")},e.prototype.asFloat32s=function(){if(this.outputType()===s.Type.Float32s)return this.result.data;throw new Error("asFloat32s() was called; however, outputType() is "+this.outputType()+", not Type.Float32s.")},e.prototype.asFloat64s=function(){if(this.outputType()===s.Type.Float64s)return this.result.data;throw new Error("asFloat64s() was called; however, outputType() is "+this.outputType()+", not Type.Float64s.")},e.prototype.asInt8s=function(){if(this.outputType()===s.Type.Int8s)return this.result.data;throw new Error("asInt8s() was called; however, outputType() is "+this.outputType()+", not Type.Int8s.")},e.prototype.asInt16s=function(){if(this.outputType()===s.Type.Int16s)return this.result.data;throw new Error("asInt16s() was called; however, outputType() is "+this.outputType()+", not Type.Int16s.")},e.prototype.asInt32s=function(){if(this.outputType()===s.Type.Int32s)return this.result.data;throw new Error("asInt32s() was called; however, outputType() is "+this.outputType()+", not Type.Int32s.")},e.prototype.asStrings=function(){if(this.outputType()===s.Type.Strings)return this.result.data;throw new Error("asStrings() was called; however, outputType() is "+this.outputType()+", not Type.Strings.")},e.prototype.asUnsignedInt8s=function(){if(this.outputType()===s.Type.UnsignedInt8s)return this.result.data;throw new Error("asUnsignedInt8s() was called; however, outputType() is "+this.outputType()+", not Type.UnsignedInt8s.")},e.prototype.asUnsignedInt16s=function(){if(this.outputType()===s.Type.UnsignedInt16s)return this.result.data;throw new Error("asUnsignedInt16s() was called; however, outputType() is "+this.outputType()+", not Type.UnsignedInt16s.")},e.prototype.asUnsignedInt32s=function(){if(this.outputType()===s.Type.UnsignedInt32s)return this.result.data;throw new Error("asUnsignedInt32s() was called; however, outputType() is "+this.outputType()+", not Type.UnsignedInt32s.")},e}()},{28:28,36:36}],50:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OnnxInferenceService=void 0;var o=e(36),r=e(49),s=function(){function e(){}return e.create=function(t,n){var s=this,i=new o.Operation({operationName:"CreateOnnxInferenceService",success:!0,resultDescription:""});i.start();var a=function(e){i.resultDescription=e.message,o.Log.info(544859596,o.LogCategory.CoreDefault,i.stop())};if(r.lackingPromiseOrWasmSupport(i))return Promise.reject(new Error("Browser lacking necessary support for inference service"));if(!t||!n){var c=new Error("Error: appName and/or version not provided");return a(c),Promise.reject(c)}return new Promise((function(e,o){var r=document.createElement("script");r.src=s.createCdnUrl(t,n),r.onload=function(){var t;(null===(t=window)||void 0===t?void 0:t.ort)&&window.ort.InferenceSession&&window.ort.Tensor?e(void 0):o(new Error("Tensor and/or InferenceSession are undefined"))},r.onerror=o,document.body.appendChild(r)})).then((function(){return i.resultDescription="Success creating inference service",o.Log.info(544859597,o.LogCategory.CoreDefault,i.stop()),new e})).catch((function(e){throw a(e),e}))},e.createCdnUrl=function(e,t){return"https://"+e+t},e.prototype.createModel=function(e){return r.Model.create(e)},e.prototype.createInputs=function(){return r.Inputs.create()},e}();n.OnnxInferenceService=s},{36:36,49:49}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PowerPointSessionExtensionConfig=n.PowerPointSessionInitMessage=void 0;var o=e(102),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SessionInitMessage","AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.PowerPointSessionInitMessage=r;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionExtensionConfig"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.PowerPointSessionExtensionConfig=s},{102:102}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationActivationTracker=void 0;var o=e(88),r=function(){function e(t,n,o){var r=this;this.sessionManager=t,this.annotationType=n,this.options=o,this.token=n+"-"+e.nextActivationResultBatchId++,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t}))}return e.prototype.asPromise=function(){return this.promise},e.prototype.activate=function(e){var t=this;this.sessionManager().sendMessage(new o.AnnotationActivationMessage({annotationType:this.annotationType,token:this.token,config:this.options?this.options.config:void 0,ignoreExistingAnnotations:e,sendStateUpdates:this.options?!!this.options.stateUpdateCallback:void 0}),(function(e,n){t.complete(e?new Error(e.error):void 0)}))},e.prototype.release=function(){var e=this;return new Promise((function(t,n){e.sessionManager().sendMessage(new o.AnnotationReleaseMessage({token:e.token}),(function(e,o){e?n(new Error(e.error)):t(o.lastRelease)}))}))},e.prototype.complete=function(e){this.isComplete||(this.isComplete=!0,e?this.reject(e):this.resolve({token:this.token}))},e.nextActivationResultBatchId=1,e}();n.AnnotationActivationTracker=r},{88:88}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BatchManager=void 0;var o=e(36),r=e(80),s=function(){function e(e,t){this.batchesByGroupingKey=new Map,this.submit=e,this.onSummary=t}return e.prototype.addBatchItem=function(e,t,n,r,s,i){var a=this,c=t.delayMs,u=t.maxInputSize,l=t.estimateSize,p=t.groupingKeyExtractor,f=l(e),d=p(e);if(t.split&&f>u){var g;try{g=t.split(e)}catch(e){var h=new Error("Split error: "+e.message);return void(i?i(h):o.Log.error(573366352,o.LogCategory.CoreDefault,h))}if(g&&Array.isArray(g.inputs)&&g.inputs.length>1){for(var y,m=[],v=i?function(e,t){if(y=y||e,m.push(t),m.length===g.inputs.length){var n;try{n=g.join(m)}catch(e){return void i(new Error("Join error: "+e.message))}i(y,n)}}:void 0,S=0;S<g.inputs.length;S++){var T=g.inputs[S];this.addBatchItem(T,t,n,r,s&&S===g.inputs.length-1,v)}return}}var b=this.batchesByGroupingKey.get(d);b&&b.size+f>u&&(clearTimeout(b.timeout),this.executeBatch(d,b,t),b=void 0),b||(b={items:[],size:0,hasItemsWithCallbacks:!1,context:n},this.batchesByGroupingKey.set(d,b)),b.items.push({input:e,size:f,callback:i}),b.size+=f,b.hasItemsWithCallbacks=b.hasItemsWithCallbacks||!!i,b.cv=r,b.groupComplete=s,clearTimeout(b.timeout),b.groupComplete?this.executeBatch(d,b,t):b.timeout=setTimeout((function(){a.executeBatch(d,b,t)}),c)},e.prototype.removeAllBatchedItems=function(){this.batchesByGroupingKey.forEach((function(e){e.timeout&&clearTimeout(e.timeout)})),this.batchesByGroupingKey.clear()},e.prototype.executeBatch=function(e,t,n){var s=this;this.batchesByGroupingKey.delete(e);var i,a=t.items,c=function(e){return e<0?"Negative":0===e?"0":1===e?"1":"Magnitude "+e.toString().length},u=new o.Operation({operationName:"ExecuteBatch",cv:t.cv,resourceId:t.context.name,dimension0:"Count "+c(a.length),dimension1:"Size "+c(t.size)}).start(),l=function(e,n,s){var i;if(n&&n.exceptionType===r.ExceptionType.NoOutput)u.success=!0,o.Log.info(573366353,o.LogCategory.CoreDefault,u.stop());else{var c=e+" error: "+(n?n.message||n:"Unknown error");i=n||new Error(c),u.success=!1,u.resultDescription="Batch of "+a.length+" items of size "+t.size+" with "+c,u.resultSignature=e+" Error",o.Log.error(573366354,o.LogCategory.CoreDefault,u.stop())}if(t.hasItemsWithCallbacks)for(var l=0,p=a;l<p.length;l++){var f=p[l];f.callback&&f.callback(i,s)}};try{i=n.multiplex(a.map((function(e){return e.input})))}catch(e){return void l("Multiplex",e)}this.submit(i.input,t,(function(e,r){var c;if(e||r&&("exceptionType"in r||r instanceof Error))l("Submit",e||r,r);else if(t.hasItemsWithCallbacks||n.summaryExtractor){var p=void 0;if(t.hasItemsWithCallbacks)try{if((p=i.demultiplex(r)).length!==a.length)throw new Error("Mismatched output length")}catch(e){return void l("Demultiplex",e)}var f=void 0,d=void 0;if(n.summaryExtractor)try{d=(c=n.summaryExtractor(r))[0],f=c[1]}catch(e){return void l("SummaryExtractor",e)}if(u.success=!0,o.Log.info(573366342,o.LogCategory.CoreDefault,u.stop()),t.hasItemsWithCallbacks)for(var g=0;g<a.length;g++)a[g].callback&&a[g].callback(void 0,p[g]);f&&s.onSummary(d,f,t.context)}else u.success=!0,o.Log.info(573366343,o.LogCategory.CoreDefault,u.stop())}))},e}();n.BatchManager=s},{36:36,80:80}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isLargerThan=n.estimateSize=void 0;n.estimateSize=function(e){return o(e,Number.POSITIVE_INFINITY)};n.isLargerThan=function(e,t){return o(e,t)>t};var o=function(e,t){for(var n=0,o=[],r=[e];r.length>0;){var s=r.pop(),i=typeof s;if("boolean"===i)n+=4;else if("string"===i)n+=2*s.length;else if("number"===i)n+=8;else if("object"===i&&s&&-1===o.indexOf(s))if(s instanceof Uint8Array)n+=s.length;else for(var a in o.push(s),s)r.push(s[a]);if(n>t)return n}return n}},{}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.internalFetch=void 0;var o=e(60),r=e(117);n.internalFetch=function(e,t,n){var o=new r.Request(e,t);return s.add(o,n)};var s=new o.SequentialFetchQueue(r,2e4,12e4)},{117:117,60:60}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DiagnosticLevel=n.DataCategories=void 0,function(e){e[e.ProductServiceUsage=2]="ProductServiceUsage",e[e.ProductServicePerformance=4]="ProductServicePerformance"}(n.DataCategories||(n.DataCategories={})),function(e){e[e.BasicEvent=10]="BasicEvent",e[e.FullEvent=100]="FullEvent",e[e.RequiredServiceDataEvent=110]="RequiredServiceDataEvent"}(n.DiagnosticLevel||(n.DiagnosticLevel={}))},{}],57:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketWorker=n.Utils=n.TokenCache=n.TelemetryLogger=n.SingleItemWorkflow=n.getVersion=n.createRuntime=n.runtime=n.internalFetch=n.estimateSize=n.BatchManager=void 0;var r=e(53);Object.defineProperty(n,"BatchManager",{enumerable:!0,get:function(){return r.BatchManager}});var s=e(54);Object.defineProperty(n,"estimateSize",{enumerable:!0,get:function(){return s.estimateSize}});var i=e(55);Object.defineProperty(n,"internalFetch",{enumerable:!0,get:function(){return i.internalFetch}}),o(e(56),n);var a=e(59);Object.defineProperty(n,"runtime",{enumerable:!0,get:function(){return a.runtime}}),Object.defineProperty(n,"createRuntime",{enumerable:!0,get:function(){return a.createRuntime}}),Object.defineProperty(n,"getVersion",{enumerable:!0,get:function(){return a.getVersion}});var c=e(62);Object.defineProperty(n,"SingleItemWorkflow",{enumerable:!0,get:function(){return c.SingleItemWorkflow}});var u=e(63);Object.defineProperty(n,"TelemetryLogger",{enumerable:!0,get:function(){return u.TelemetryLogger}});var l=e(64);Object.defineProperty(n,"TokenCache",{enumerable:!0,get:function(){return l.TokenCache}});var p=e(65);Object.defineProperty(n,"Utils",{enumerable:!0,get:function(){return p.Utils}});var f=e(75);Object.defineProperty(n,"WebSocketWorker",{enumerable:!0,get:function(){return f.WebSocketWorker}})},{53:53,54:54,55:55,56:56,59:59,62:62,63:63,64:64,65:65,75:75}],58:[function(e,t,n){"use strict";var o=e("assignHelper"),r=e("spreadArraysHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.LocalWorkflowExecutionManager=void 0;var s=e(102),i=e(28),a=e(36),c=e(88),u=e(61),l=e(35),p=e(76),f=e(65),d=function(){function e(e,t){var n=this;this.workflowsWithSessionAffinity=new Map,this.workflowDefinitionsWithSessionAffinity=[],this.workflowsWithoutSessionAffinity=[],this.nextAnnotationId=1,this.nextSignalId=1,this.modelDownloader=e,this.inferenceService=t,t&&t.catch(function(){n.inferenceService=void 0}.bind(this))}return e.prototype.getNextClientAnnotationId=function(){return"#AC"+this.nextAnnotationId++},e.prototype.getNextClientSignalId=function(){return"#SC"+this.nextSignalId++},e.prototype.registerLocalWorkflow=function(e){var t=this,n=new a.Operation({operationName:"WorkflowRegistration",resourceId:e.id}).start();if(0===e.inputTypes.length)throw new Error("Invalid workflow params");e.isStateful?(this.workflowDefinitionsWithSessionAffinity.push(e),this.workflowsWithSessionAffinity.forEach((function(n){n.push(t.createWorkflowImplementation(e))}))):this.workflowsWithoutSessionAffinity.push(this.createWorkflowImplementation(e)),this.workflowsWithSessionAffinity.forEach((function(t,n){return n.registerContextTypes(e.requiredContextTypes,e.optionalContextTypes)})),n.success=!0,a.Log.info(572838110,a.LogCategory.CoreDefault,n.stop())},e.prototype.registerSessionLocalWorkflow=function(e,t){var n=new a.Operation({operationName:"WorkflowRegistration",resourceId:e.id}).start();if(0===e.inputTypes.length)throw new Error("Invalid workflow params");this.workflowsWithSessionAffinity.get(t).push(this.createWorkflowImplementation(e)),t.registerContextTypes(e.requiredContextTypes,e.optionalContextTypes),n.success=!0,a.Log.info(559006997,a.LogCategory.CoreDefault,n.stop())},e.prototype.addSession=function(e){for(var t=[],n=0,o=this.workflowDefinitionsWithSessionAffinity;n<o.length;n++){var r=o[n];t.push(this.createWorkflowImplementation(r))}this.workflowsWithSessionAffinity.set(e,t)},e.prototype.closeSession=function(e){this.workflowsWithSessionAffinity.delete(e)},e.prototype.runLocalWorkflows=function(e,t){for(var n,o=this,i=function(e,n,i){var c;if(s.SchemaObject.matchesTypesFor(n.body,e.workflow.inputTypes)){var l=f.shallowCloneItemWithPath(i.parentPath,n);if(s.SchemaObject.getBaseTypesFor(n.body).includes(s.ContextHolder.getTypeName())){for(var p=r(l.parentPath,[l.id]),d=!0,g=0,h=null!==(c=e.workflow.outputTypes)&&void 0!==c?c:[];g<h.length;g++){var y=h[g];if(!t.getContextAnnotations(y,u.ContextAnnotationSources.LocalWorkflow,p,e.workflow.id)){d=!1;break}}if(d)return}var m=function(){var n=t.resolveRequestedContexts(e.workflow),r=n[0],s=n[1];r?o.executeLocalWorkflow(e,[l],t,s).catch((function(e){a.Log.error(572838111,a.LogCategory.CoreDefault,e)})):(a.Log.info(545837259,a.LogCategory.WorkflowDefault,"Required contexts are not ready for "+e.workflow.id+". Retrying execution in 500 milliseconds..."),setTimeout(m,500))};m()}},c=0,l=[new s.AddOperation({parentPath:["session"],items:[{id:"#userContext#",body:new s.UserContextHolder}]}),new s.AddOperation({parentPath:["session"],items:[{id:"#tenantContext#",body:new s.TenantContextHolder}]})].concat(e);c<l.length;c++)for(var p=l[c],d=s.SchemaObject.getTypeNameFor(p),g=0,h=p.items;g<h.length;g++){var y=h[g];if(t.applyOperationForContext(p,y,u.ContextAnnotationSources.Submitted),d!==s.DeleteOperation.getTypeName()&&y.body){for(var m=0,v=this.workflowsWithoutSessionAffinity;m<v.length;m++){i(v[m],y,p)}for(var S=0,T=null!==(n=this.workflowsWithSessionAffinity.get(t))&&void 0!==n?n:[];S<T.length;S++){i(T[S],y,p)}}}},e.prototype.createWorkflowImplementation=function(e){var t=e.factory();return{workflow:e,workflowLambda:t,initPromise:this.initWorkflow(e.kind,t)}},e.prototype.getResourceAsArrayBuffer=function(e,t){return this.modelDownloader?this.modelDownloader.getResourceAsArrayBuffer(e,t):Promise.reject(new Error("Resource Downloader never created"))},e.prototype.getResourceAsURL=function(e,t){return this.modelDownloader?this.modelDownloader.getResourceAsURL(e,t):Promise.reject(new Error("Resource Downloader never created"))},e.prototype.createModel=function(e){return this.inferenceService?this.inferenceService.then((function(t){return t.createModel(e)})):Promise.reject(new Error("Inference Service never created"))},e.prototype.createModelInputs=function(){if(this.inferenceService)return this.inferenceService.then((function(e){return e.createInputs()}));throw new Error("Inference Service never created")},e.prototype.initWorkflow=function(e,t){if(e==i.WorkflowKind.SingleItem){var n={getResourceAsArrayBuffer:this.getResourceAsArrayBuffer.bind(this),getResourceAsURL:this.getResourceAsURL.bind(this),createModel:this.createModel.bind(this),createModelInputs:this.createModelInputs.bind(this)};return t.init(n)}return Promise.resolve()},e.prototype.executeLocalWorkflow=function(e,t,n,r){var f=this;return new Promise((function(d,g){var h=e.workflow,y=new a.Operation({operationName:"ExecuteWorkflow",resourceId:h.id});y.start();var m=function(e){return e?(y.resultDescription=e,y.resultSignature="Exception",a.Log.error(572838112,a.LogCategory.CoreDefault,y.stop())):(y.success=!0,a.Log.info(572838113,a.LogCategory.CoreDefault,y.stop())),e},v={model:new p.WorkflowModel(t[0],r),getToken:void 0,clientMetadata:n.getClientMetadata(),site:{getResourceAsArrayBuffer:f.getResourceAsArrayBuffer.bind(f),getResourceAsURL:f.getResourceAsURL.bind(f),createModel:f.createModel.bind(f),createModelInputs:f.createModelInputs.bind(f)}},S={getResourceAsArrayBuffer:f.getResourceAsArrayBuffer.bind(f),getResourceAsURL:f.getResourceAsURL.bind(f),createModel:f.createModel.bind(f),createModelInputs:f.createModelInputs.bind(f)},T={setAnnotations:function(r,i,p,d){for(var y,v=function(t){a.Log.info(555866112,a.LogCategory.CoreDefault,new l.AnnotationMetaDataChange({annotationType:i,annotationState:t,workflowId:e.workflow.id}))},S=0,T=p;S<T.length;S++){(O=T[S]).metadata=o(o({},O.metadata),{state:s.AnnotationState.Created}),v(s.AnnotationState.Created)}if(t[0].body===r){var b,_=t[0],w=s.SchemaObject.getTypeNameFor(_.body);if(Array.isArray(p))if(!h.outputTypes||h.outputTypes.indexOf(i)<0)b="Workflow said it would output one of ["+h.outputTypes+"] but instead output "+i;else if(_)for(var C=0,M=p;C<M.length;C++){var O=M[C];s.SchemaObject.matchesTypesFor(O,[s.Annotation.getTypeName()])?s.SchemaObject.getTypeNameFor(O)!==i&&(b="Workflow produced inconsistent annotation types in setAnnotations call ("+s.SchemaObject.getTypeNameFor(O)+" did not match expected "+i+")"):b="Workflow produced an output that is not an annotation "+s.SchemaObject.getTypeNameFor(O)}else b="No item provided";else b="Workflow produced an invalid annotation array";if(b)g(m(b));else{var k;k=d&&d.isSessionAnnotation?["session"]:d&&d.ancestorType?_.parentPath:_.parentPath.concat(_.id);for(var L=[],A=[],E=function(e){e.metadata=o(o({},e.metadata),{state:s.AnnotationState.Sent}),v(s.AnnotationState.Sent);var t=e.id,r=t?null===(y=n.getContextAnnotations(i,u.ContextAnnotationSources.LocalWorkflow,k,h.id))||void 0===y?void 0:y.filter((function(e){var n;return(null===(n=e.body)||void 0===n?void 0:n.id)==t})):void 0;1==(null==r?void 0:r.length)?1==r.length?A.push({id:r[0].id,source:h.id,body:e}):a.Log.error(545837260,a.LogCategory.CoreDefault,"Assert: Multiple existing context annotations with body id "+t+" found for "+i+" and local workflow "+h.id+")."):L.push({id:f.getNextClientAnnotationId(),source:h.id,body:e})},P=0,I=p;P<I.length;P++){E(O=I[P])}var x=[];L.length>0&&x.push(new s.AddOperation({parentPath:k,items:L})),A.length>0&&x.push(new s.UpdateOperation({parentPath:k,items:A})),n.onAnnotationResults(new c.AnnotationResultsMessage({annotationType:i,ops:x}),u.ContextAnnotationSources.LocalWorkflow,(function(){})),w!=s.UserContextHolder.getTypeName()&&w!=s.TenantContextHolder.getTypeName()&&w!=s.Document.getTypeName()||n.submitOperationsToServer(x)}}else g(m("Expected obj to be "+t[0].body+" but instead it was "+r))}.bind(f),submitSignals:function(e){var t=e.map((function(e){return{id:f.getNextClientSignalId(),source:h.id,body:e}})),o=new s.SignalOperation({parentPath:["session"],items:t});n.submitOperations([o])}.bind(f),done:function(e){m(e?e.message:null),e?g(e):d()}.bind(f)},b=e.workflowLambda;if(h.kind===i.WorkflowKind.SingleItem){1!==t.length&&m("Single item workflows expect a single input"),v.delta=t[0].delta;try{var _=b;e.initPromise||(e.initPromise=_.init(S)),e.initPromise.then((function(){_.execute(t[0].body,v,T)})).catch((function(e){m(e)}))}catch(e){m(e)}}else m("Only single item workflows supported currently")}))},e}();n.LocalWorkflowExecutionManager=d},{102:102,28:28,35:35,36:36,61:61,65:65,76:76,88:88}],59:[function(e,t,n){"use strict";var o=e("assignHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.createRuntime=n.runtime=n.ClientRuntime=n.getVersion=void 0;var r=e(36),s=e(63),i=e(75),a=e(73),c=e(61),u=e(65),l=e(68),p=e(70),f=e(72),d=e(58);n.getVersion=function(){return e(66).version};var g=function(){function e(e,t,n){this.sessionsByDocSessionId=new Map,this.settings={dropOnlySequencedSyncsOnReseedEnabled:!0,closeWSBlockedSessionEnabled:!1,sessionOfflineModeEnabled:!1},this.workerFactory=e||function(){return new i.WebSocketWorker},this.sessionManagerFactory=t||this.createDefaultSessionManagerFactory(),this.sessionFactory=n||function(e){return new c.Session(e)}}return e.prototype.init=function(e,t,o,i){var a=this,c=new r.Operation({operationName:"InitRuntime",resourceId:e});c.start(),this.inferenceService=i.inferenceService,this.localWorkflowManager=new d.LocalWorkflowExecutionManager(i.modelDownloader,this.inferenceService),this.clientMetadata=t,this.clientMetadata&&(this.clientMetadata.runtimeVersion=n.getVersion()),this.hostCallbacks=o,r.Log.addLogger(new s.TelemetryLogger(this.hostCallbacks));var l=i.telemetryAggregationIntervalSec;if(void 0===l&&(l=30),l>0){var p=function(e,t,n){return new r.LoggingAggregator(e,(function(e){return e.success&&n.indexOf(e[t])>=0}),[t,"resourceId","success","resultSignature","dimension0","dimension1","dimension2","dimension3"],["durationMs"],l)};r.Log.addAggregator(p("Operation","operationName",["ExecuteLambda","ExecuteWorkflow","ExecuteBatch","ProcessResponse"])),r.Log.addAggregator(p("SessionHealth","sessionHealthEventName",["ProcessMessage","SendMessage"]))}this.batchOptions=i.batchOptions,e&&(this.serviceUrl=u.Utils.convertServiceUrlToWebSocket(e),this.serviceProtocol=this.serviceUrl.split(":")[0].toLowerCase());var f=[];return f.push(this.isFeatureEnabled("DropOnlySequencedSyncsOnReseedDisabled").then((function(e){a.settings.dropOnlySequencedSyncsOnReseedEnabled=!e}))),f.push(this.isFeatureEnabled("CloseWSBlockedSessionEnabled").then((function(e){a.settings.closeWSBlockedSessionEnabled=e}))),f.push(this.isFeatureEnabled("SessionOfflineModeEnabled").then((function(e){a.settings.sessionOfflineModeEnabled=e}))),Promise.all(f).then((function(){a.logOperation(c,!0)})).catch((function(e){a.logOperation(c,!1,"Error",e?e.message:"(no error)")}))},e.prototype.getServiceProtocol=function(){return this.serviceProtocol},e.prototype.registerLocalWorkflow=function(e){this.localWorkflowManager.registerLocalWorkflow(e)},e.prototype.flushTelemetry=function(e){r.Log.flushAggregators(e)},e.prototype.createSession=function(e){var t=e?e.docSessionId:void 0,n=this.sessionsByDocSessionId.get(t);if(n&&!1===n.isClosed)throw new Error("docSessionId already exists");if(!this.serviceUrl)return Promise.reject(new Error("EmptyUrl"));var r=o({},this.clientMetadata);r.docSessionId=t,e&&e.flights&&(r.flights=r.flights?r.flights+";"+e.flights:e.flights);var s=this.sessionFactory({hostCallbacks:this.hostCallbacks,sessionManager:this.sessionManagerFactory(r),batchOptions:this.batchOptions,extensionConfigs:(null==e?void 0:e.extensionConfigs)||[],clientMetadata:r,localWorkflowManager:this.localWorkflowManager});return this.sessionsByDocSessionId.set(t,s),e&&e.onSessionConnect&&s.setConnectCallback(e.onSessionConnect),e&&e.onSessionDisconnect&&s.setDisconnectCallback(e.onSessionDisconnect),e&&e.onSessionReconnect&&s.setReconnectCallback(e.onSessionReconnect),e&&e.onSessionClose&&s.setSessionCloseCallback(e.onSessionClose),s.initialize?s.initialize():Promise.resolve(s)},e.prototype.createDefaultSessionManagerFactory=function(){var e=this;return function(t){var n=new f.TokenRefreshManager,o=new l.SessionStats,s=function(){r.Log.error(573321615,r.LogCategory.CoreDefault,"Unexpectedly not set sendMessage")},i=new p.SessionInitializer((function(){return o}),t,n,(function(e,t){s(e,t)}),{getAuthToken:e.getAuthToken.bind(e),overrideSessionInitMessage:e.hostCallbacks.overrideSessionInitMessage}),c=new a.WebSocketSessionManager(u.Utils.convertServiceUrlToWebSocket(e.serviceUrl),o,e.workerFactory,i,t,n,e.settings);return s=c.sendMessage.bind(c),c.on("disconnect",(function(){return n.clearRefreshTimeouts()})),c.on("connect",(function(t,n,o,r){t&&e.hostCallbacks.setSessionData&&e.hostCallbacks.setSessionData(n,o,r)})),c}},e.prototype.getAuthToken=function(){return this.hostCallbacks.requestAuthToken({Tickets:[]}).then((function(e){if(e)return e.Token})).catch((function(){}))},e.prototype.isFeatureEnabled=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n="None"),u.Utils.isFeatureEnabled(this.hostCallbacks,e,t,n)},e.prototype.logOperation=function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,r.Log.info(573321622,r.LogCategory.CoreDefault,e)},e}();n.ClientRuntime=g,n.runtime=new g;n.createRuntime=function(){return new g}},{36:36,58:58,61:61,63:63,65:65,66:66,68:68,70:70,72:72,73:73,75:75}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SequentialFetchQueue=void 0;var o=function(){function e(e,t,n){if(this.requestInProgress=!1,this.queuedRequests=[],null==e)throw new Error("No request.");this.fetch=e,this.fetchTimeout=t,this.queueTimeout=n}return e.prototype.tryProcessNextRequest=function(){if(this.requestInProgress=!1,this.queuedRequests.length>0){var e=this.queuedRequests.shift(),t=e[0],n=e[1],o=e[2];clearTimeout(o),this.add(t,n)}},e.prototype.add=function(e,t){var n=this;if(this.requestInProgress){var o=setTimeout((function(){t(new Error("Timed out waiting in queue"),null),n.queuedRequests.shift()}),this.queueTimeout);this.queuedRequests.push([e,t,o])}else{this.requestInProgress=!0,new Promise((function(t,o){var r=!1,s=setTimeout((function(){r=!0,o(new Error("Fetch timed out"))}),n.fetchTimeout);n.fetch(e).then((function(e){r||(clearTimeout(s),t(e))})).catch((function(e){r||(clearTimeout(s),o(e))}))})).then((function(e){t(null,e),n.tryProcessNextRequest()})).catch((function(e){t(e,null),n.tryProcessNextRequest()}))}},e}();n.SequentialFetchQueue=o},{}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Session=n.ContextAnnotationSources=void 0;var o,r=e(88),s=e(102),i=e(52),a=e(53),c=e(54),u=e(67),l=e(65),p=e(36);!function(e){e[e.LocalWorkflow=0]="LocalWorkflow",e[e.ServerWorkflow=1]="ServerWorkflow",e[e.Submitted=2]="Submitted"}(o=n.ContextAnnotationSources||(n.ContextAnnotationSources={}));var f=function(){function e(e){this.annotationActivationTrackers=new Map,this.annotationCallbacks=new Map,this.annotationResultStates=new Map,this.tokensByAnnotationType=new Map,this.registeredContextTypes=new Set,this.availableContexts=new Map,this.nextSyncSequenceId=1,this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.hasSessionConnected=!1,this.isSessionClosed=!1,this.isSessionConnected=!1,this.hostCallbacks=e.hostCallbacks,this.sessionManager=e.sessionManager,this.operationBatchConfig=e.batchOptions?this.getOperationBatchConfig(e.batchOptions):void 0,this.extensionConfigs=e.extensionConfigs,this.clientMetadata=e.clientMetadata,this.localWorkflowManager=e.localWorkflowManager,this.sessionManager.on("sessionClose",this.onSessionClose.bind(this)),this.sessionManager.on("reconnect",this.onReconnect.bind(this)),this.sessionManager.on("connect",this.onConnect.bind(this)),this.sessionManager.on("disconnect",this.onDisconnect.bind(this)),this.sessionManager.on("resetNextSyncSequenceId",this.resetNextSyncSequenceId.bind(this)),this.sessionManager.onMessage(r.AnnotationResultsMessage.getTypeName(),this.onAnnotationResultsFromServer.bind(this)),this.sessionManager.onMessage(r.AnnotationResultStateMessage.getTypeName(),this.onAnnotationResultStateMessage.bind(this))}return e.prototype.initialize=function(){var e=this;return this.sessionManager.init(this.extensionConfigs,this.hostCallbacks.onInitSession?this.hostCallbacks.onInitSession:void 0).then((function(){return e.localWorkflowManager.addSession(e),e}))},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.isSessionConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasConnected",{get:function(){return this.hasSessionConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isClosed",{get:function(){return this.isSessionClosed},enumerable:!1,configurable:!0}),e.prototype.registerLocalWorkflow=function(e){this.localWorkflowManager.registerSessionLocalWorkflow(e,this)},e.prototype.activateAnnotation=function(e,t){var n,o=new i.AnnotationActivationTracker(this.getSessionManager.bind(this),e,t);if(t&&t.callback){var r=this.annotationCallbacks.get(e);r||(r=new Map,this.annotationCallbacks.set(e,r)),r.set(o.token,t.callback)}var s=null!==(n=this.tokensByAnnotationType.get(e))&&void 0!==n?n:[];return-1===s.indexOf(o.token)&&s.push(o.token),this.tokensByAnnotationType.set(e,s),this.annotationActivationTrackers.set(o.token,o),o.activate(!1),o.asPromise()},e.prototype.updateAnnotationConfig=function(e,t){throw new Error("Not Yet Implemented")},e.prototype.releaseAnnotation=function(e){var t=this.annotationActivationTrackers.get(e);if(t){this.annotationActivationTrackers.delete(e);var n=this.annotationCallbacks.get(t.annotationType);return n&&(n.delete(e),0==n.size&&this.annotationCallbacks.delete(t.annotationType)),t.release()}return Promise.resolve(!1)},e.prototype.setAnnotationState=function(e,t,n){var o={state:n};this.submitOperation(new s.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:o}))},e.prototype.setAnnotationMetadata=function(e,t,n){this.submitOperation(new s.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:n}))},e.prototype.submitOperation=function(e,t){this.submitOperations([e],t)},e.prototype.submitOperations=function(e,t){var n=this,o=e.filter((function(e){return function(e){if(!Array.isArray(n.serverInputTypes)||0===n.serverInputTypes.length)return!0;if(s.SchemaObject.getTypeNameFor(e)===s.DeltaUpdateOperation.getTypeName())return!0;for(var t,o=0,r=e.items;o<r.length;o++){var i=r[o];if(s.SchemaObject.matchesTypesFor(i.body,n.serverInputTypes))return!0;t+=s.SchemaObject.getTypeNameFor(i.body)}var a=new p.Operation({operationName:"WorkflowOnlyLocal",resultDescription:t}).start();return p.Log.info(554561949,p.LogCategory.WorkflowDefault,a.stop()),!1}(e)}));this.submitOperationsToServer(o,t),this.localWorkflowManager.runLocalWorkflows(e,this)},e.prototype.submitSeedOperations=function(e,t){if(!this.allowSeed)throw new Error("Cannot submit seed operations more than once per session");this.allowSeed=!1,this.allowGroupSeed=!1,this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(e,!0,t):this.getSessionManager().sendMessage(new r.SyncMessage({cv:t,seq:0,ops:e}))},e.prototype.submitSeedGroupOperations=function(e,t,n){if(!this.allowGroupSeed)throw new Error("Seed operations are not allowed for this session");t&&(this.allowGroupSeed=!1),this.allowSeed=!1,this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(e,!!t,n):(this.seedGroupSize++,this.getSessionManager().sendMessage(new r.SyncMessage({cv:n,seq:0,ops:e,groupId:"Seed",groupSize:t?this.seedGroupSize:void 0,groupComplete:t||void 0})))},e.prototype.submitCustomMessage=function(e){var t=this;return new Promise((function(n,o){t.getSessionManager().sendMessage(e,(function(e,t){e?o(e):n(t)}))}))},e.prototype.requestCacheDump=function(e){var t=this;if(e)throw new Error("NYI");return new Promise((function(e,n){t.getSessionManager().sendMessage(new r.CacheDumpRequestMessage,(function(t,o){t?n(t):e(o)}))}))},e.prototype.forceReconnect=function(e){return this.extensionConfigs=e,this.getSessionManager().forceReconnect(e)},e.prototype.close=function(){this.isSessionClosed=!0,this.getSessionManager().closeSession(),this.localWorkflowManager.closeSession(this)},e.prototype.getClientMetadata=function(){return this.clientMetadata},e.prototype.setSessionCloseCallback=function(e){this.sessionCloseCallback=e},e.prototype.setConnectCallback=function(e){this.connectCallback=e},e.prototype.setDisconnectCallback=function(e){this.disconnectCallback=e},e.prototype.setReconnectCallback=function(e){this.reconnectCallback=e},e.prototype.onAnnotationResults=function(e,t,n){n(void 0,new r.Response);for(var o=0,s=e.ops;o<s.length;o++){var i=s[o];if(null==i?void 0:i.items)for(var a=0,c=i.items;a<c.length;a++){var u=c[a];this.applyOperationForContext(i,u,t)}this.callAnnotationCallbacks(i,e.annotationType),this.hostCallbacks.onAnnotationResult&&this.hostCallbacks.onAnnotationResult(i)}},e.prototype.onAnnotationResultStateMessage=function(e,t){var n;t(void 0,new r.Response);for(var o=0,s=e.updates;o<s.length;o++){var i=s[o],a=i.annotationType,c=i.state;if(this.tokensByAnnotationType.has(a)){var u=void 0;u=this.annotationResultStates.has(a)?this.annotationResultStates.get(a):c===r.AnnotationResultState.Idle?r.AnnotationResultState.Pending:r.AnnotationResultState.Idle;for(var l=0,p=this.tokensByAnnotationType.get(a);l<p.length;l++){var f=p[l],d=this.annotationActivationTrackers.get(f);(null===(n=d.options)||void 0===n?void 0:n.stateUpdateCallback)&&d.options.stateUpdateCallback(u,c)}}}},e.prototype.submitOperationsToServer=function(e,t){var n=this,o=function(e){return s.SchemaObject.getTypeNameFor(e)===s.SignalOperation.getTypeName()},i=e.filter((function(e){return o(e)})),c=e.filter((function(e){return!o(e)}));if(i.length>0&&this.getSessionManager().sendMessage(new r.SyncMessage({cv:t,ops:i})),c.length>0)if(this.operationBatchConfig){if(!this.batchedOperationsManager){this.batchedOperationsManager=new a.BatchManager((function(e,t,o){n.getSessionManager().sendMessage(new r.SyncMessage({cv:t.cv,seq:n.nextSyncSequenceId++,ops:e}),(function(e){o(e?new Error(e.error):void 0)}))}))}this.batchedOperationsManager.addBatchItem(c,this.operationBatchConfig,{name:"SubmitOperations"},t)}else this.getSessionManager().sendMessage(new r.SyncMessage({cv:t,seq:this.nextSyncSequenceId++,ops:c}))},e.prototype.registerContextTypes=function(e,t){for(var n=0,o=(null!=e?e:[]).concat(null!=t?t:[]);n<o.length;n++){var r=o[n];this.activateAnnotation(r),this.registeredContextTypes.add(r)}},e.prototype.applyOperationForContext=function(e,t,n){var o=this,r=s.SchemaObject.getTypeNameFor(e);if(r==s.AddOperation.getTypeName()||r==s.Operation.getTypeName()||r==s.UpdateOperation.getTypeName()||r==s.DeleteOperation.getTypeName()){r==s.Operation.getTypeName()&&(r=s.AddOperation.getTypeName());var i=l.shallowCloneItemWithPath(this.resolvePlaceholdersInOperationParentPath(e.parentPath),t),a=l.makeItemPathKey(i.parentPath);if(r==s.AddOperation.getTypeName()||r==s.UpdateOperation.getTypeName()){if(!i.body)return;var c=s.SchemaObject.getTypeNameFor(i.body);if(!this.registeredContextTypes.has(c))return;var u=this.availableContexts.get(c);u||(u=new Map,this.availableContexts.set(c,u));var f=u.get(n);if(f||(f=[],u.set(n,f)),i.id||(i.id=this.localWorkflowManager.getNextClientAnnotationId()),r==s.AddOperation.getTypeName())0==f.filter((function(e){return l.makeItemPathKey(e.parentPath)==a&&e.id==i.id})).length?f.push(i):p.Log.info(545837255,p.LogCategory.WorkflowDefault,"AddOperation for ("+n+", "+i.id+", "+i.source+") can't be applied as the context item with matching path and ID already exists. Use UpdateOperation instead.");else for(var d=0;d<f.length;d++)if(f[d].id==i.id&&l.makeItemPathKey(f[d].parentPath)==a){if(f[d].source==i.source){f[d]=i;break}p.Log.warn(545837256,p.LogCategory.WorkflowDefault,"UpdateOperation for ("+n+", "+i.id+", "+i.source+") can't be applied as the context item with provided path and ID has different source: "+f[d].source)}else p.Log.warn(545837257,p.LogCategory.WorkflowDefault,"UpdateOperation for ("+n+", "+i.id+", "+i.source+") can't be applied as the context item with matching path and ID was not found. AddOperation should be used instead")}else if(r==s.DeleteOperation.getTypeName()){if(!i.id)return;this.availableContexts.forEach((function(e,t){var r=e.get(n);r&&(0==(r=r.filter((function(e){return!(l.makeItemPathKey(e.parentPath)==a&&e.id==i.id)}))).length?e.delete(n):e.set(n,r),0==e.size?o.availableContexts.delete(t):o.availableContexts.set(t,e))}))}}},e.prototype.resolveRequestedContexts=function(e){for(var t,n,o=[],r=0,s=null!==(t=e.requiredContextTypes)&&void 0!==t?t:[];r<s.length;r++){var i=s[r];if(!this.availableContexts.has(i))return[!1,[]];if(0==(u=Array.from(this.availableContexts.get(i).values()).reduce((function(e,t){return e.concat(t)}),[])).length)throw new Error("Assert: availableContexts have the entry for "+i+" which does not contain any context annotation.");o.push.apply(o,u)}for(var a=0,c=null!==(n=e.optionalContextTypes)&&void 0!==n?n:[];a<c.length;a++){i=c[a];if(this.availableContexts.has(i)){var u;if(0==(u=Array.from(this.availableContexts.get(i).values()).reduce((function(e,t){return e.concat(t)}),[])).length)throw new Error("Assert: availableContexts have the entry for "+i+" which does not contain any context annotation.");o.push.apply(o,u)}}return[!0,o]},e.prototype.getContextAnnotations=function(e,t,n,o){var r,s,i=n?l.makeItemPathKey(n):void 0;return null===(s=null===(r=this.availableContexts.get(e))||void 0===r?void 0:r.get(t))||void 0===s?void 0:s.filter((function(e){return!(i&&l.makeItemPathKey(e.parentPath)!=i||o&&e.source!=o)}))},e.prototype.resetNextSyncSequenceId=function(){this.nextSyncSequenceId=1},e.prototype.onReconnect=function(){this.isSessionConnected=!0,this.annotationActivationTrackers.forEach((function(e){e.activate(!0)})),this.reconnectCallback&&this.reconnectCallback()},e.prototype.onSessionClose=function(e){this.isSessionClosed=!0,this.isSessionConnected=!1,this.sessionCloseCallback&&this.sessionCloseCallback(e)},e.prototype.onConnect=function(e,t,n,o,r){this.hasSessionConnected&&e&&(this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.seedBatchedOperationsManager&&(this.seedBatchedOperationsManager.removeAllBatchedItems(),this.seedBatchedOperationsManager=void 0),this.batchedOperationsManager&&(this.batchedOperationsManager.removeAllBatchedItems(),this.batchedOperationsManager=void 0)),this.isSessionConnected=!0,this.hasSessionConnected=!0,this.connectCallback&&this.connectCallback(e,t,n,o),this.serverInputTypes=r},e.prototype.onDisconnect=function(e){this.isSessionConnected=!1,this.disconnectCallback&&this.disconnectCallback(e)},e.prototype.getSessionManager=function(){return this.sessionManager||(this.sessionManager=new u.EmptySessionManager),this.sessionManager},e.prototype.callAnnotationCallbacks=function(e,t){if(0!==this.annotationCallbacks.size){var n=this.annotationCallbacks.get(t);n&&n.forEach((function(t){t(e)}))}},e.prototype.getOperationBatchConfig=function(e){return{delayMs:e.delayMs,maxInputSize:e.maxInputSize,estimateSize:c.estimateSize,groupingKeyExtractor:function(){return"operations"},multiplex:function(e){return{input:e.filter((function(e){return e.length})).reduce((function(e,t){return e.concat(t)}),[]),demultiplex:function(){return[[]]}}},split:function(e){if(!(e.length<=1))return{inputs:e.reduce((function(e,t){return e.push([t]),e}),[]),join:function(){return[]}}}}},e.prototype.sendSeedMessagesViaBatchManager=function(e,t,n){var o=this;if(!this.seedBatchedOperationsManager){this.seedBatchedOperationsManager=new a.BatchManager((function(e,t,n){o.seedGroupSize++,o.getSessionManager().sendMessage(new r.SyncMessage({cv:t.cv,seq:0,ops:e,groupId:"Seed",groupSize:t.groupComplete?o.seedGroupSize:void 0,groupComplete:t.groupComplete?t.groupComplete:void 0}),(function(e){n(e?new Error(e.error):void 0)}))}))}this.seedBatchedOperationsManager.addBatchItem(e,this.operationBatchConfig,{name:"SubmitSeedOperations"},n,t)},e.prototype.onAnnotationResultsFromServer=function(e,t){this.onAnnotationResults(e,o.ServerWorkflow,t)},e.prototype.resolvePlaceholdersInOperationParentPath=function(e){var t=e;return 3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("user_")&&(p.Log.info(545837258,p.LogCategory.WorkflowDefault,"Replacing user context placeholder for: "+l.makeItemPathKey(e)+"."),t=["session","#userContext#"]),3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("tenant_")&&(p.Log.info(544526343,p.LogCategory.WorkflowDefault,"Replacing tenant context placeholder for: "+l.makeItemPathKey(e)+"."),t=["session","#tenantContext#"]),t},e}();n.Session=f},{102:102,36:36,52:52,53:53,54:54,65:65,67:67,88:88}],62:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SingleItemWorkflow=void 0;var o=e(28),r=function(){function e(e,t){var n,r,s,i;this.kind=o.WorkflowKind.SingleItem,this.isStateful=!1,this.id=e,t&&(this.inputTypes=null!==(n=t.inputTypes)&&void 0!==n?n:this.inputTypes,this.outputTypes=null!==(r=t.outputTypes)&&void 0!==r?r:this.outputTypes,this.requiredContextTypes=null!==(s=t.requiredContextTypes)&&void 0!==s?s:this.requiredContextTypes,this.optionalContextTypes=null!==(i=t.optionalContextTypes)&&void 0!==i?i:this.optionalContextTypes)}return e.create=function(t){return new e(t)},e.prototype.setInputTypes=function(e){return this.inputTypes=e,this},e.prototype.setOutputTypes=function(e){return this.outputTypes=e,this},e.prototype.setRequiredContextTypes=function(e){return this.requiredContextTypes=e,this},e.prototype.setOptionalContextTypes=function(e){return this.optionalContextTypes=e,this},e.prototype.setLambdaType=function(e){return this.factory=e,this},e.prototype.setLambda=function(e,t){return this.factory=function(){return{init:t||function(e){return Promise.resolve()},execute:e,dispose:function(){}}},this},e.prototype.validateOptions=function(){return{isValid:!0}},e}();n.SingleItemWorkflow=r},{28:28}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TelemetryLogger=void 0;var o=e(28),r=e(56),s=function(){function e(e){this.level=o.LoggingLevel.info,this.hostCallbacks=e}return e.prototype.log=function(t){var n=this;if(null!=this.hostCallbacks&&null!=this.hostCallbacks.sendTelemetryEvent){var o=function(t,o){var s=o.charAt(0).toUpperCase()+o.slice(1);n.hostCallbacks.sendTelemetryEvent(e.augLoopAriaTenantToken,"Office_AugLoop_Client_"+s,{ResourceId:t.resourceId,ResultDescription:t.resultDescription,ResultSignature:t.resultSignature,Dimension0:t.dimension0,Dimension1:t.dimension1,Dimension2:t.dimension2,Dimension3:t.dimension3},"Office.System.Activity",{CV:t.cv,Duration:1e3*t.durationMs,Count:t.count,AggMode:2,Success:t.success},!1,r.DataCategories.ProductServiceUsage|r.DataCategories.ProductServicePerformance,r.DiagnosticLevel.RequiredServiceDataEvent)};if("Operation"===t.eventName){o(t,t.operationName)}else if("SessionHealth"===t.eventName){o(t,t.sessionHealthEventName)}}},e.augLoopAriaTenantToken="3de4087d4de34817b1c376e3d1e6e293-983c4292-5ba9-485a-ab10-9797863c788b-6770",e}();n.TelemetryLogger=s},{28:28,56:56}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TokenCache=void 0;var o=e(65),r=function(){function e(e){void 0===e&&(e=33e5),this.tokenCache=new Map,this.requestMap=new Map,this.requestRecordMap=new Map,this.tokenExpirationMs=e}return e.prototype.updateAuthToken=function(e,t){var n=this,r=JSON.stringify(t),s=this.requestRecordMap.get(r);return(void 0===s||this.isTokenExpired(s))&&(s={requestPromise:e.requestAuthToken(t).then((function(e){if(!e||!e.Token)throw new Error("No token available for request "+r);n.tokenCache.set(r,e.Token)})),requestTime:o.Utils.getCurrentTimeMs()},this.requestRecordMap.set(r,s)),s.requestPromise},e.prototype.getAuthTokenEntries=function(e,t){var n=this;return Array.from(this.tokenCache.keys()).map((function(e){var t=n.requestMap.get(e);return void 0===t&&(t=JSON.parse(e),n.requestMap.set(e,t)),{requestKey:e,request:t}})).filter((function(e){var n=e.request;return!t||n.DocId===t})).map((function(t){var o=t.requestKey,r=t.request;return n.isTokenExpired(n.requestRecordMap.get(o))&&n.updateAuthToken(e,r),{ticket:r.Tickets[0],token:n.tokenCache.get(o)}}))},e.prototype.isTokenExpired=function(e){return o.Utils.getCurrentTimeMs()>e.requestTime+this.tokenExpirationMs},e}();n.TokenCache=r},{65:65}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.makeItemPathKey=n.shallowCloneItemWithPath=n.LogCountLimiter=n.Utils=void 0;var o=e(36),r=e(80),s=function(){function e(){}return e.createHealthCheckRequest=function(e){return{payload:{},payloadSchema:{category:r.TypeCategory.Schema,schema:{name:"HealthCheckRequest"}},requestedSchema:{category:r.TypeCategory.Schema,schema:{name:"HealthCheckResponse"}},clientMetadata:e}},e.isFeatureEnabled=function(e,t,n,o){return void 0===n&&(n=!1),void 0===o&&(o="None"),e&&e.isFeatureEnabled?e.isFeatureEnabled("Microsoft.Office.AugLoop."+t,o).catch((function(){return Promise.resolve(n)})):Promise.resolve(n)},e.convertWebSocketUrlToHttp=function(e){return this.convertUrl(e,!1)},e.convertServiceUrlToWebSocket=function(e){return this.convertUrl(e,!0)},e.convertUrl=function(e,t){if(!e)return e;var n=e.split(":"),o=n[0].toLowerCase();return 0==o.indexOf(t?"http":"ws")?(o=t?o.replace("http","ws"):o.replace("ws","http"),n[0]=o,n.join(":")):e},e.getCurrentTimeMs=function(){return Date.now?Date.now():(new Date).getTime()},e}();n.Utils=s;var i=function(){function e(e){this.maxNumberOfLogs=40,this.numberOfLogs=0,this.id=e}return e.prototype.log=function(e){if(this.numberOfLogs<this.maxNumberOfLogs&&(this.numberOfLogs++,e(),this.numberOfLogs===this.maxNumberOfLogs)){var t=new o.Operation({operationName:"OnLastLog",success:!0,resourceId:this.id,resultDescription:"Limit for number of logs for id: "+this.id+" reached - all next logs will be dropped"});o.Log.warn(572838107,o.LogCategory.CoreDefault,t)}},e}();n.LogCountLimiter=i;n.shallowCloneItemWithPath=function(e,t){return{id:t.id,source:t.source,revId:t.revId,body:t.body,parentPath:e}};n.makeItemPathKey=function(e){return Array.isArray(e)?5===e.length?e[0]+"\\"+e[1]+"\\"+e[2]+"\\"+e[3]+"\\"+e[4]:4===e.length?e[0]+"\\"+e[1]+"\\"+e[2]+"\\"+e[3]:3===e.length?e[0]+"\\"+e[1]+"\\"+e[2]:2===e.length?e[0]+"\\"+e[1]:1===e.length?e[0]:e.join("\\"):"(malformed path)"}},{36:36,80:80}],66:[function(e,t,n){t.exports={version:"2.20.37"}},{}],67:[function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.EmptySessionManager=void 0;var s=e(36),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.init=function(){return Promise.resolve()},t.prototype.sendMessage=function(e,t){},t.prototype.onMessage=function(e,t){},t.prototype.forceReconnect=function(){return Promise.resolve()},t.prototype.closeSession=function(){},t.prototype.sendBytes=function(e){},t.prototype.getCorrelationVector=function(){return new s.CorrelationVector},t.prototype.setState=function(e){},t}(e(119).EventEmitter);n.EmptySessionManager=i},{119:119,36:36}],68:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SessionStats=void 0;var o=function(){};n.SessionStats=o},{}],69:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MessageQueue=n.ClientSendMessageErrorReason=void 0;var o,r=e(88),s=e(102),i=e(118),a=e(65),c=e(36);!function(e){e.ArrivedBeforeReseeding="Message is dropped from queue since it arrived before reseeding is started",e.DroppedAsOldestInQueue="Message is dropped as oldest in full queue"}(o=n.ClientSendMessageErrorReason||(n.ClientSendMessageErrorReason={}));var u=function(){function e(e){this.logOp=new c.Operation({operationName:"MessageQueue",success:!0}),this.messageQueueLogCountLimiter=new a.LogCountLimiter("MessageQueue"),this.queue=new i(1e3),this.callbacks=e}return e.prototype.push=function(e,t,n){var s=this,i=this.queue;if(1e3===i.length){this.messageQueueLogCountLimiter.log((function(){s.logOp.resourceId="QueueFull",s.logOp.durationMs=0,c.Log.warn(573187741,c.LogCategory.CoreDefault,s.logOp)}));var u=i.shift();u.onResponse&&u.onResponse(new r.ErrorResponse({error:o.DroppedAsOldestInQueue}))}i.push({message:e,onResponse:t,timeQueued:a.Utils.getCurrentTimeMs(),attemptNumber:n})},e.prototype.sendOnSessionInitialized=function(e){var t=this,n=this.queue.length,i=0;if(n>0){for(var u=a.Utils.getCurrentTimeMs()-this.queue.get(0).timeQueued;this.queue.length>0&&this.callbacks.canSendMessage();){var l=this.queue.shift();e&&l.message instanceof r.SyncMessage&&s.SchemaObject.matchesTypesFor(l.message,[r.SyncMessage.getTypeName()])&&(!this.callbacks.dropOnlySequencedSyncsOnReseed||l.message.seq>=0)?(i++,l.onResponse&&l.onResponse(new r.ErrorResponse({error:o.ArrivedBeforeReseeding}))):l.message instanceof Uint8Array?this.callbacks.sendBytes(l.message):this.callbacks.sendMessage(l.message,l.onResponse,l.attemptNumber)}this.messageQueueLogCountLimiter.log((function(){t.logOp.resourceId="SendOnSessionInitialized",t.logOp.resultDescription="Queue size before: "+n+", after: "+t.queue.length+". droppedSyncMessages: "+i,t.logOp.durationMs=u,c.Log.warn(573187742,c.LogCategory.CoreDefault,t.logOp)}))}},e}();n.MessageQueue=u},{102:102,118:118,36:36,65:65,88:88}],70:[function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.SessionInitializer=void 0;var s=e(36),i=e(88),a=e(65),c=e(72),u=function(e){function t(t,n,o,r,s){var i=e.call(this)||this;return i.getSessionStats=t,i.clientMetadata=n,i.tokenRefreshManager=o,i.sendMessage=r,i.options=s||{},i.options.overrideSessionInitMessage=i.options.overrideSessionInitMessage||function(e){return e},i}return r(t,e),t.prototype.initSession=function(e){var t=this;e.onResponse=e.onResponse||function(){};var n=a.Utils.getCurrentTimeMs(),o=this.getSessionStats().lastConnectionClose&&n-this.getSessionStats().lastConnectionClose,r=this.getSessionStats().lastSyncMessage&&n-this.getSessionStats().lastSyncMessage,c=new s.Operation({operationName:"SessionInit"}),u={sessionKey:this.sessionKey,sessionId:this.clientMetadata.sessionId,timeSinceLastConnectionClose:o,timeSinceLastSyncMessage:r,isTokenRefresh:e.isTokenRefresh,error:void 0},l=this.options.overrideSessionInitMessage(new i.SessionInitMessage({protocolVersion:i.currentProtocolVersion,clientMetadata:this.clientMetadata,sessionKey:this.sessionKey,origin:this.origin,authToken:this.anonymousToken,extensionConfigs:e.extensionConfigs,returnWorkflowInputTypes:!0}));this.sendMessage(l,(function(n,o){c.success=!n,c.resultSignature=t.getSessionStats().lastConnectionClose?"Reconnect":"FirstConnect",c.resourceId=null==o?void 0:o.sliceUrl,(null==o?void 0:o.sessionKey)&&u.sessionKey!==o.sessionKey&&(u.sessionKey=o.sessionKey),n&&(u.error=n.error),c.resultDescription=JSON.stringify(u),s.Log.info(572838103,s.LogCategory.CoreDefault,c),e.onResponse(n,o),n||e.isReconnectOnSameSlice&&o.forceReconnect||(o.anonymousToken&&o.tokenExpirationSeconds?(t.anonymousToken=o.anonymousToken,t.onSuccessfulSessionInitOnServerSide(o)):s.Log.error(572838104,s.LogCategory.CoreDefault,"AL Anonymous token was not generated for the session"))}))},t.prototype.onSuccessfulSessionInitOnServerSide=function(e){var t=this;this.tokenRefreshManager.scheduleRefresh(c.TokenType.Anonymous,e.tokenExpirationSeconds,this.initSession.bind(this,{isTokenRefresh:!0}),(function(){t.anonymousToken=void 0})),this.initHostAuthToken();var n=!!this.sessionKey,o=this.sessionKey!==e.sessionKey;this.emit("connect",o,n,e.sessionUrlBase+"/"+e.sessionKey,e.origin,this.anonymousToken,e.workflowInputTypes),this.sessionKey=e.sessionKey,this.origin=e.origin,n&&this.emit("reconnect")},t.prototype.initHostAuthToken=function(){var e=this;this.options.getAuthToken&&this.options.getAuthToken().then((function(t){t?e.sendTokenProvisionMessage(t):s.Log.info(572838105,s.LogCategory.CoreDefault,"Host auth token provision failed")})).catch((function(e){s.Log.error(572838106,s.LogCategory.CoreDefault,"Error happened while attempting to fetch host token: "+e)}))},t.prototype.sendTokenProvisionMessage=function(e){var t=new i.TokenProvisionMessage({authToken:e});this.sendMessage(t,this.onTokenProvisionResponse.bind(this))},t.prototype.onTokenProvisionResponse=function(e,t){!e&&t&&t.tokenExpirationSeconds&&this.tokenRefreshManager.scheduleRefresh(c.TokenType.Host,t.tokenExpirationSeconds,this.initHostAuthToken.bind(this))},t}(e(119).EventEmitter);n.SessionInitializer=u},{119:119,36:36,65:65,72:72,88:88}],71:[function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.ClosedState=n.DisconnectedState=n.RunningState=n.InitingState=n.BaseState=n.queueBytes=n.queueMessage=n.sendMessageNow=n.SessionState=void 0;var s,i=e(88),a=e(102);!function(e){e[e.Initing=0]="Initing",e[e.Running=1]="Running",e[e.Disconnected=2]="Disconnected",e[e.Closed=3]="Closed"}(s=n.SessionState||(n.SessionState={}));n.sendMessageNow=function(e,t,n,o){t&&(t.cv||(t.cv=e.cvParent.newChild().toString()),e.messageEndpoint.sendMessage(t,(function(t,o){t||a.SchemaObject.getTypeNameFor(o)!==i.SyncResponse.getTypeName()||(e.stats.lastSyncMessage=Date.now()),n&&n(t,o)}),void 0,o))};n.queueMessage=function(e,t,n,o){t&&(e.messageQueue.push(t,n,o),e.webSocketWorkerManager.init(void 0,e.customInitPromise))};n.queueBytes=function(e,t){t&&(e.messageQueue.push(t),e.webSocketWorkerManager.init(void 0,e.customInitPromise))};var c=function(){function e(e){this.context=e}return e.prototype.onEnter=function(e){},e.prototype.sendMessage=function(e,t,n){},e.prototype.sendBytes=function(e){},e.prototype.canSendMessage=function(){return!1},e.prototype.onConnectionClose=function(){},e}();n.BaseState=c;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=s.Initing,t.possibleNextStates=[s.Running,s.Disconnected,s.Closed],t}return r(t,e),t.prototype.sendMessage=function(e,t,o){a.SchemaObject.matchesTypesFor(e,[i.SessionInitMessage.getTypeName()])?n.sendMessageNow(this.context,e,t,o):n.queueMessage(this.context,e,t)},t.prototype.sendBytes=function(e){n.queueBytes(this.context,e)},t.prototype.onConnectionClose=function(){this.context.setState(s.Disconnected)},t}(c);n.InitingState=u;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=s.Running,t.possibleNextStates=[s.Disconnected,s.Closed],t}return r(t,e),t.prototype.onEnter=function(e){e&&e.isSessionReseedingStarted&&this.context.resetNextSyncSequenceId(),this.context.messageQueue.sendOnSessionInitialized(e&&e.isSessionReseedingStarted)},t.prototype.sendMessage=function(e,t,o){n.sendMessageNow(this.context,e,t,o)},t.prototype.sendBytes=function(e){e&&this.context.webSocketWorkerManager.egressBytes(e)},t.prototype.canSendMessage=function(){return!0},t.prototype.onConnectionClose=function(){this.context.setState(s.Disconnected)},t}(c);n.RunningState=l;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=s.Disconnected,t.possibleNextStates=[s.Initing,s.Closed],t}return r(t,e),t.prototype.onEnter=function(e){this.context.messageEndpoint.cancelPendingResponseCallbacks()},t.prototype.sendMessage=function(e,t,o){a.SchemaObject.matchesTypesFor(e,[i.SessionInitMessage.getTypeName()])?(this.context.setState(s.Initing),n.sendMessageNow(this.context,e,t,o)):a.SchemaObject.matchesTypesFor(e,[i.SessionCloseMessage.getTypeName()])?this.context.setState(s.Closed):n.queueMessage(this.context,e,t,o)},t.prototype.sendBytes=function(e){n.queueBytes(this.context,e)},t}(c);n.DisconnectedState=p;var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=s.Closed,t.possibleNextStates=[],t}return r(t,e),t}(c);n.ClosedState=f},{102:102,88:88}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TokenRefreshManager=n.TokenType=void 0,function(e){e[e.Anonymous=0]="Anonymous",e[e.Host=1]="Host"}(n.TokenType||(n.TokenType={}));var o=function(){function e(){this.timers=new Map}return e.prototype.scheduleRefresh=function(t,n,o,r){var s=this.timers.get(t);s||(s={numberOfAttempts:0},this.timers.set(t,s)),s.refreshTimeoutId&&(clearTimeout(s.refreshTimeoutId),s.refreshTimeoutId=void 0),s.expiredTimeoutId&&(clearTimeout(s.expiredTimeoutId),s.expiredTimeoutId=void 0);var i=1e3*n-e.tokenRefreshBufferMs,a=1e3*n-e.tokenExpirationBufferMs;i>0?s.numberOfAttempts=0:(++s.numberOfAttempts,i=e.tokenRefreshBackoffIntervalMs,a=e.tokenExpirationBufferMs),s.numberOfAttempts<=e.tokenRefreshMaximumAttempts&&(s.refreshTimeoutId=setTimeout((function(){o()}),i)),r&&(s.expiredTimeoutId=setTimeout((function(){r()}),a))},e.prototype.clearRefreshTimeouts=function(){this.clearTimeouts(!1)},e.prototype.clearAllTimeouts=function(){this.clearTimeouts(!0)},e.prototype.clearTimeouts=function(e){var t=this;this.timers.forEach((function(n,o){n.refreshTimeoutId&&(clearTimeout(n.refreshTimeoutId),n.refreshTimeoutId=void 0),e&&n.expiredTimeoutId&&(clearTimeout(n.expiredTimeoutId),n.expiredTimeoutId=void 0),n.expiredTimeoutId||t.timers.delete(o)}))},e.tokenRefreshBufferMs=24e4,e.tokenExpirationBufferMs=12e4,e.tokenRefreshBackoffIntervalMs=3e4,e.tokenRefreshMaximumAttempts=3,e}();n.TokenRefreshManager=o},{}],73:[function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketSessionManager=void 0;var s=e(36),i=e(42),a=e(88),c=e(102),u=e(119),l=e(65),p=e(69),f=e(71),d=e(74),g=function(e){function t(t,n,o,r,i,c,u){var g,h=e.call(this)||this;return h.cvParent=new s.CorrelationVector,h.logOp=new s.Operation({operationName:"SessionState",success:!0}).start(),h.sessionStateChangeLogCountLimiter=new l.LogCountLimiter("SessionState"),h.stats=n,h.allStates=((g={})[f.SessionState.Initing]=new f.InitingState(h),g[f.SessionState.Running]=new f.RunningState(h),g[f.SessionState.Disconnected]=new f.DisconnectedState(h),g[f.SessionState.Closed]=new f.ClosedState(h),g),h.setState(f.SessionState.Initing),h.messageEndpoint=new a.MessageEndpoint("c"),h.messageEndpoint.setClientMetadata(i),h.messageEndpoint.setEgress(h.egress.bind(h)),h.messageEndpoint.onMessage(a.SessionCloseMessage.getTypeName(),(function(e,t){h.onSessionCloseMessage(e,t)})),h.webSocketWorkerManager=new d.WebSocketWorkerManager(t,i,o,r,h.ingress.bind(h),h.onConnectionClose.bind(h),(function(){h.onSessionClose(void 0,"WSNotSupported")}),u),h.messageQueue=new p.MessageQueue({sendMessage:function(e,t,n){return h.state.sendMessage(e,t,n)},sendBytes:h.sendBytes.bind(h),canSendMessage:function(){return h.state.canSendMessage()},dropOnlySequencedSyncsOnReseed:u.dropOnlySequencedSyncsOnReseedEnabled}),r.on("connect",(function(e,t,n,o,r,s){h.setState(f.SessionState.Running,"",{isSessionReseedingStarted:e&&t}),h.emit("connect",e,n,o,r,s)})),r.on("reconnect",(function(){return h.emit("reconnect")})),h.resetNextSyncSequenceId=function(){return h.emit("resetNextSyncSequenceId")},h.tokenRefreshManager=c,h}return r(t,e),t.prototype.setState=function(e,t,n){var o=this;if(!this.state||e!==this.state.stateName){var r="undefined";this.state&&(r=f.SessionState[this.state.stateName]);var i="undefined"===r&&e===f.SessionState.Initing||this.state.possibleNextStates.indexOf(e)>=0;this.sessionStateChangeLogCountLimiter.log((function(){o.logOp.stop(),o.logOp.resourceId="New state: "+(i?f.SessionState[e]:r),o.logOp.resultDescription="Previous state: "+r,o.logOp.resultSignature=t+(o.state&&!i?"Unexpected state change":""),o.logOp.success=i,s.Log.info(573167323,s.LogCategory.CoreDefault,o.logOp)})),i&&(this.state=this.allStates[e],this.logOp.start(),this.state.onEnter(n))}},t.prototype.init=function(e,t){return this.extensionConfigs=e,this.customInitPromise=t,this.webSocketWorkerManager.init(this.extensionConfigs,this.customInitPromise,!0)},t.prototype.sendMessage=function(e,n){this.retrySendMessage(e,n,t.maxRetries)},t.prototype.sendBytes=function(e){this.state.sendBytes(e)},t.prototype.onMessage=function(e,t){this.messageEndpoint.onMessage(e,t)},t.prototype.getCorrelationVector=function(){return this.cvParent},t.prototype.forceReconnect=function(e){var t=this;return this.extensionConfigs=e||this.extensionConfigs,this.webSocketWorkerManager.close(!1),new Promise((function(e){return setTimeout((function(){e(t.webSocketWorkerManager.init(t.extensionConfigs))}),100)}))},t.prototype.closeSession=function(){this.sendMessage(new a.SessionCloseMessage),this.webSocketWorkerManager.close(!0),this.onSessionClose(void 0,"ClientRequested")},t.prototype.ingress=function(e){var t,n=this;try{t=JSON.parse(e)}catch(e){s.Log.error(573167324,s.LogCategory.CoreDefault,new i.SessionHealth({sessionHealthEventName:"ProcessMessage",resourceId:"Unknown",success:!1,resultSignature:"ParseError",resultDescription:e.message,durationMs:0,source:i.SessionHealthSource.ClientRuntime,reason:i.SessionHealthReason.Client,impact:i.SessionHealthImpact.MissingOutput,affectedWorkflows:["All"],message:""}))}t&&this.messageEndpoint.ingress(t,(function(e,t){return n.egress(e||t,(function(){}))}))},t.prototype.egress=function(e,t){e&&this.webSocketWorkerManager.egress(e).then((function(){return t()})).catch((function(e){return t(e)}))},t.prototype.onSessionCloseMessage=function(e,t){e.reconnectAllowed?this.webSocketWorkerManager.close():this.onSessionClose(e,"CloseMessageReceived"),t()},t.prototype.onSessionClose=function(e,t){this.setState(f.SessionState.Closed,t),this.tokenRefreshManager.clearAllTimeouts(),this.onConnectionClose(void 0),e&&this.emit("sessionClose",e)},t.prototype.onConnectionClose=function(e){this.state.onConnectionClose(),this.stats.lastConnectionClose=l.Utils.getCurrentTimeMs(),this.emit("disconnect",e)},t.prototype.retrySendMessage=function(e,n,o){var r=this,s=t.maxRetries-o;this.state.sendMessage(e,(function(t,s){t&&o>0&&r.canBeRetried(e)&&r.isTransientError(t)?r.retrySendMessage(e,n,o-1):n&&n(t,s)}),s)},t.prototype.canBeRetried=function(e){return!c.SchemaObject.matchesTypesFor(e,[a.SessionInitMessage.getTypeName(),a.MicroSyncMessage.getTypeName()])},t.prototype.isTransientError=function(e){var t=e.error;return t!==a.SendMessageErrorReason.SyncMessageUnsupportedBatch&&t!==a.SendMessageErrorReason.UnexpectedSeedMessage&&t!==a.SendMessageErrorReason.UnsupportedSyncMessage&&t!==a.SendMessageErrorReason.AnnotationTokenNotFound&&t!==p.ClientSendMessageErrorReason.ArrivedBeforeReseeding&&t!==p.ClientSendMessageErrorReason.DroppedAsOldestInQueue},t.maxRetries=2,t}(u.EventEmitter);n.WebSocketSessionManager=g},{102:102,119:119,36:36,42:42,65:65,69:69,71:71,74:74,88:88}],74:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketWorkerManager=n.calculateTimeToWaitForNextTry=void 0;var o=e(102),r=e(88),s=e(36),i=e(65),a=e(33),c=e(55);n.calculateTimeToWaitForNextTry=function(e,t){var n=0,o=i.Utils.getCurrentTimeMs()?i.Utils.getCurrentTimeMs()-t:0,r=[1e3,2e3,5e3,1e4,6e4];return n=r[Math.max(0,Math.min(r.length-1,e-1))],n=Math.max(n-o,1e3)};var u=function(){function e(t,n,o,r,a,u,l,p){var f=this;this.logCountLimiter=new i.LogCountLimiter(e.className),this.isWorkerReady=!1,this.permanentlyClosed=!1,this.currentReconnectAttempt=0,this.lastInitializationAttemptTimeMs=0,this.offlineInterval=void 0,this.alreadyLoggedReconnectAttempt=!1,this.httpTestsLeft=5,this.httpTestsSuccessCount=0,this.wsOpenCount=0,this.testHttpConnection=function(e){var t=i.Utils.convertWebSocketUrlToHttp(f.globalUrl),n=!e,o=null!=e?e:new s.Operation({operationName:"HttpsTest",resourceId:t,success:!1,resultDescription:"",resultSignature:"HttpResponse:"}).start(),r={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":o.cv},body:JSON.stringify(i.Utils.createHealthCheckRequest(f.clientMetadata))};c.internalFetch(t,r,(function(e,t){e?(o.dimension1="HttpErr",o.resultDescription+="HttpErr: "+e.message):t&&t.ok?(o.dimension1="HttpOK",f.leaveOfflineMode(),f.httpTestsSuccessCount++,n&&(o.success=!0)):(o.dimension1="HttpNoResp",o.resultDescription+="HttpStatus: "+(null==t?void 0:t.status)),n&&o.stop(),f.logCountLimiter.log((function(){s.Log.info(558445283,s.LogCategory.CoreDefault,o)}))}))},this.globalUrl=t,this.clientMetadata=n,this.workerFactory=o,this.sessionInitializer=r,this.ingress=a,this.onConnectionClose=u,this.onDetectedWSBlock=l,this.closeWSBlockedSession=p.closeWSBlockedSessionEnabled,this.sessionOfflineModeEnabled=p.sessionOfflineModeEnabled}return e.prototype.init=function(t,n,o){var r=this;if(void 0===o&&(o=!1),this.permanentlyClosed)return Promise.reject("permanentlyClosed");if(this.isWorkerReady||this.pendingInitPromise)return this.pendingInitPromise?this.pendingInitPromise:Promise.resolve();this.extensionConfigs=t||this.extensionConfigs;var i=function(){if(o||!r.alreadyLoggedReconnectAttempt){var t=o?e.initialAttemptTimeout:e.reconnectAttemptTimeout;r.connTimeout=setTimeout((function(){var e=new s.Operation({operationName:"ConnectionFailingOrSlow",dimension0:o?"Initial":"Reconnect",dimension1:t.toString(),dimension2:r.currentReconnectAttempt.toString()});s.Log.info(572838096,s.LogCategory.CoreDefault,e),r.alreadyLoggedReconnectAttempt=!o,r.connTimeout=void 0}),t)}};return n?this.pendingInitPromise=n().catch((function(e){s.Log.error(572838097,s.LogCategory.CoreDefault,"Error occurred during calling the custom init promise: "+e)})).then((function(){i(),r.initInternal()})):(this.pendingInitPromise=Promise.resolve(),i(),this.initInternal()),this.pendingInitPromise},e.prototype.egress=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressInternal(e)})):(this.egressInternal(e),Promise.resolve())},e.prototype.egressBytes=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressBytesInternal(e)})):(this.egressBytesInternal(e),Promise.resolve())},e.prototype.close=function(e){this.worker&&this.worker.close(),this.isWorkerReady=!1,this.worker=null,this.permanentlyClosed=e||this.permanentlyClosed,this.permanentlyClosed&&this.leaveOfflineMode()},e.prototype.initInternal=function(){var e=this;this.isWorkerReady=!1,this.permanentlyClosed||this.isOffline()||(this.currentReconnectAttempt>0?setTimeout((function(){e.tryToConnectAndInitializeSession()}),n.calculateTimeToWaitForNextTry(this.currentReconnectAttempt,this.lastInitializationAttemptTimeMs)):this.tryToConnectAndInitializeSession())},e.prototype.egressInternal=function(e){var t;this.isWorkerReady||o.SchemaObject.matchesTypesFor(e,[r.SessionInitMessage.getTypeName()])?(o.SchemaObject.matchesTypesFor(e,[r.MicroSyncMessage.getTypeName()])?(this.castBinaryData(e),t=a.JSOND.serialize(e)):t=JSON.stringify(e),this.worker.egress(t)):o.SchemaObject.matchesTypesFor(e,[r.Response.getTypeName()])||s.Log.error(572838098,s.LogCategory.CoreDefault,new s.Operation({operationName:"UnexpectedEgressCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.egressBytesInternal=function(e){this.isWorkerReady?this.worker.egress(e):s.Log.error(572838099,s.LogCategory.CoreDefault,new s.Operation({operationName:"UnexpectedEgressBytesCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.tryToConnectAndInitializeSession=function(){var e=this;this.currentReconnectAttempt++,this.lastInitializationAttemptTimeMs=i.Utils.getCurrentTimeMs();var t=function(n){e.permanentlyClosed||e.isOffline()||(e.connect(e.sliceUrl?e.sliceUrl:e.globalUrl),e.sessionInitializer.initSession({isTokenRefresh:!1,isReconnectOnSameSlice:!!e.sliceUrl,extensionConfigs:e.extensionConfigs,onResponse:function(o,r){if(n.success=!o,n.resultDescription=o?"WS Error: "+o.error:"",n.resourceId=r?r.sliceUrl:"",n.dimension0=n.success?"WSOK":"WSFail",o||!e.worker)return e.sliceUrl=void 0,e.close(),e.httpTestsLeft>0?(e.httpTestsLeft--,e.testHttpConnection(n.stop())):(e.closeWSBlockedSession&&0===e.wsOpenCount&&e.httpTestsSuccessCount>=5?(e.permanentlyClosed=!0,n.dimension1="WSBlocked",e.onDetectedWSBlock()):e.sessionOfflineModeEnabled&&0===e.httpTestsSuccessCount&&(e.startOfflineMode(),n.dimension1="WSOffline"),e.logCountLimiter.log((function(){s.Log.info(572838100,s.LogCategory.CoreDefault,n.stop())}))),void e.initInternal();if(e.logCountLimiter.log((function(){s.Log.info(555823373,s.LogCategory.CoreDefault,n.stop())})),r.forceReconnect){e.close();var i=new s.Operation({operationName:"ForcedReconnect"}).start();i.resultSignature="globalUrl: "+e.globalUrl+". sliceUrl: "+e.sliceUrl,e.sliceUrl=void 0,setTimeout((function(){t(i)}),1e3)}else void 0!==e.connTimeout&&clearTimeout(e.connTimeout),e.sliceUrl=r.sliceUrl,e.ready();e.resetHttpTestsCounter()}}))},n=new s.Operation({operationName:"TryToConnectAndInitializeSession",resultSignature:"Reconnection attempt #"+this.currentReconnectAttempt}).start();t(n)},e.prototype.connect=function(e){var t=this;this.worker=this.workerFactory(),this.worker.init(e,this.ingress,(function(){t.wsOpenCount++,t.leaveOfflineMode()}),(function(e){t.onConnectionClose(e),t.close()}))},e.prototype.ready=function(){this.isWorkerReady=!0,this.pendingInitPromise=void 0,this.currentReconnectAttempt=0},e.prototype.castBinaryData=function(e){if(e){if(Array.isArray(e.__binaryMembers__))for(var t=0,n=e.__binaryMembers__;t<n.length;t++){var o=n[t];ArrayBuffer.isView(e[o])||(e[o]=new Uint8Array(e[o]))}for(var r=0,s=Object.keys(e);r<s.length;r++){var i=s[r];"object"==typeof e[i]&&null!==e[i]&&this.castBinaryData(e[i])}}},e.prototype.isOffline=function(){return!!this.offlineInterval},e.prototype.startOfflineMode=function(){var e=this;this.offlineInterval=setInterval((function(){e.testHttpConnection()}),6e4)},e.prototype.leaveOfflineMode=function(){this.isOffline()&&(clearInterval(this.offlineInterval),this.offlineInterval=void 0,this.resetHttpTestsCounter(),this.tryToConnectAndInitializeSession())},e.prototype.resetHttpTestsCounter=function(){this.httpTestsLeft=5,this.httpTestsSuccessCount=0},e.initialAttemptTimeout=1e5,e.reconnectAttemptTimeout=2e4,e.className="WebSocketWorkerManager",e}();n.WebSocketWorkerManager=u},{102:102,33:33,36:36,55:55,65:65,88:88}],75:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketWorker=void 0;var o=e(123),r=e(36),s=e(65),i=function(){function e(){this.hasBeenOpened=!1,this.hadEgressError=!1,this.lastEgressTime=0,this.lastPongTime=0,this.remainingPingFailures=3,this.pendingEgress=[]}return e.prototype.init=function(t,n,s,i){var a=this;this.ws=new o(t),this.logOp=new r.Operation({operationName:e.className,success:!0}).start();var c=function(e){a.logPingLatencyOp&&(a.logPingLatencyOp.success=e,r.Log.info(572838091,r.LogCategory.CoreDefault,a.logPingLatencyOp.stop()),a.logPingLatencyOp=void 0)};this.ws.addEventListener("open",(function(t){s(),e.logCountLimiter.log((function(){a.logOp.resourceId="OnOpen",a.logOp.resultDescription="",a.logOp.success=!0,r.Log.info(572838092,r.LogCategory.CoreDefault,a.logOp.stop())})),a.hasBeenOpened=!0,a.pendingEgress.forEach((function(e){a.egress(e)})),a.pendingEgress=[],a.pingInterval=setInterval((function(){a.logPingLatencyOp&&(--a.remainingPingFailures,c(!1)),a.remainingPingFailures>0&&a.hasBeenOpened&&a.lastPongTime<a.lastEgressTime&&(a.logPingLatencyOp=new r.Operation({operationName:"Ping",success:!0,dimension0:a.ws.bufferedAmount>=0?a.ws.bufferedAmount.toString().length.toString():void 0}).start(),a.ws.send(e.pingPongMessage,(function(e){e&&(--a.remainingPingFailures,c(!1))})))}),3e4)})),this.ws.addEventListener("message",(function(t){a.logPingLatencyOp&&"string"==typeof t.data&&1===t.data.length&&t.data[0]===e.pingPongMessage?(c(!0),a.lastPongTime=Date.now()):n(t.data)})),this.ws.addEventListener("error",(function(t){a.errorMessage=t.message,e.logCountLimiter.log((function(){a.logOp.resourceId="OnError",a.logOp.resultDescription=a.errorMessage,a.logOp.success=!1,r.Log.info(572838093,r.LogCategory.CoreDefault,a.logOp.stop())})),a.ws.close()})),this.ws.addEventListener("close",(function(t){e.logCountLimiter.log((function(){a.logOp.resourceId="OnClose",a.logOp.resultDescription=t?"code: "+t.code+". reason: "+t.reason:"",a.logOp.success=!0,r.Log.info(572838094,r.LogCategory.CoreDefault,a.logOp.stop())})),a.pingInterval&&(clearInterval(a.pingInterval),a.pingInterval=void 0),i(a.errorMessage)}))},e.prototype.egress=function(t){var n=this;this.lastEgressTime=Date.now(),this.hasBeenOpened?this.ws.send(t,(function(t){t&&!n.hadEgressError&&(n.hadEgressError=!0,e.logCountLimiter.log((function(){n.logOp.resourceId="OnFirstEgressError",n.logOp.resultDescription=t.message,n.logOp.success=!1,r.Log.info(572838095,r.LogCategory.CoreDefault,n.logOp.stop())})))})):this.pendingEgress.push(t)},e.prototype.close=function(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),this.ws.close()},e.className="WebSocketWorker",e.logCountLimiter=new s.LogCountLimiter(e.className),e.pingPongMessage="~",e}();n.WebSocketWorker=i},{123:123,36:36,65:65}],76:[function(e,t,n){"use strict";var o=e("spreadArraysHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowModel=void 0;var r=e(102),s=function(){function e(e,t){void 0===t&&(t=[]),this.rootItem=void 0,this.normalizeFilter=function(e){if(!e)return function(e){return void 0!==e};if("function"==typeof e)throw new Error("Not implemented yet");if((e.id?1:0)+(e.ids?1:0)+(e.itemType?1:0)+(e.itemTypes?1:0)!=1)throw new Error("Exactly one condition expected on IItemFilter");if(e.itemType)return function(t){return t&&r.SchemaObject.matchesTypesFor(t.body,[e.itemType])};if(e.itemTypes)return function(t){return t&&r.SchemaObject.matchesTypesFor(t.body,e.itemTypes)};throw new Error("Not implemented yet")},this.items=o(t,[e])}return e.prototype.getItem=function(e){throw new Error("Method not implemented.")},e.prototype.getItems=function(e){throw new Error("Method not implemented.")},e.prototype.getItemBody=function(e){return this.getItemBodies(e)[0]},e.prototype.getItemBodies=function(e){var t=this.normalizeFilter(e);return this.items.filter(t).map((function(e){return e.body}))},e.prototype.getItemByReference=function(e){throw new Error("Method not implemented.")},e.prototype.getItemBodyByReference=function(e){throw new Error("Method not implemented.")},e}();n.WorkflowModel=s},{102:102}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.IdentityProvider=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.LiveId=1]="LiveId",e[e.OrgId=2]="OrgId",e[e.ActiveDirectory=3]="ActiveDirectory",e[e.ADAL=4]="ADAL",e[e.SSPI=5]="SSPI",e[e.OAuth2=6]="OAuth2",e[e.Badger=7]="Badger"}(n.IdentityProvider||(n.IdentityProvider={}))},{}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WaitOnStrategy=void 0,function(e){e[e.All=0]="All",e[e.Any=1]="Any"}(n.WaitOnStrategy||(n.WaitOnStrategy={}))},{}],79:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.MessageType=n.ExceptionType=void 0,o(e(77),n),o(e(78),n);var r=e(81);Object.defineProperty(n,"ExceptionType",{enumerable:!0,get:function(){return r.ExceptionType}}),Object.defineProperty(n,"MessageType",{enumerable:!0,get:function(){return r.MessageType}}),o(e(82),n),o(e(83),n),o(e(84),n),o(e(85),n),o(e(86),n)},{77:77,78:78,81:81,82:82,83:83,84:84,85:85,86:86}],80:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.MessageType=n.ExceptionType=void 0,o(e(77),n);var r=e(81);Object.defineProperty(n,"ExceptionType",{enumerable:!0,get:function(){return r.ExceptionType}}),Object.defineProperty(n,"MessageType",{enumerable:!0,get:function(){return r.MessageType}}),o(e(86),n)},{77:77,81:81,86:86}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExceptionType=n.MessageType=void 0,function(e){e[e.Input=0]="Input",e[e.Exception=1]="Exception",e[e.WaitOn=2]="WaitOn",e[e.StopAndFilterWorkflow=3]="StopAndFilterWorkflow"}(n.MessageType||(n.MessageType={})),function(e){e[e.Unknown=0]="Unknown",e[e.NoOutput=1]="NoOutput",e[e.Authentication=2]="Authentication",e[e.JoinTimedOut=3]="JoinTimedOut",e[e.LambdaThrow=4]="LambdaThrow",e[e.LambdaErrorCallback=5]="LambdaErrorCallback"}(n.ExceptionType||(n.ExceptionType={}))},{}],82:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Oart=void 0,function(e){!function(e){e[e.shape=0]="shape",e[e.groupShape=1]="groupShape",e[e.graphicFrame=2]="graphicFrame",e[e.connector=3]="connector",e[e.picture=4]="picture",e[e.ink=5]="ink"}(e.DrawingElementType||(e.DrawingElementType={}))}(n.Oart||(n.Oart={}))},{}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Ppt=void 0,function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.SlideTileEventType||(e.SlideTileEventType={}))}(n.Ppt||(n.Ppt={}))},{}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.JobState=void 0,function(e){e[e.Submitted=0]="Submitted",e[e.Pending=1]="Pending",e[e.Running=2]="Running",e[e.Completed=3]="Completed",e[e.Failed=4]="Failed",e[e.Aborted=5]="Aborted"}(n.JobState||(n.JobState={}))},{}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Tiling=void 0,function(e){!function(e){e[e.Unknown=0]="Unknown",e[e.Text=1]="Text",e[e.Slide=2]="Slide"}(e.TileType||(e.TileType={})),function(e){e[e.Generic=0]="Generic",e[e.Title=1]="Title",e[e.SmartArt=2]="SmartArt",e[e.TableCell=3]="TableCell",e[e.TextBox=4]="TextBox",e[e.Notes=5]="Notes"}(e.TextTileType||(e.TextTileType={})),function(e){e[e.Undefined=0]="Undefined",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(e.TextTileElementUnit||(e.TextTileElementUnit={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered"}(e.ListType||(e.ListType={})),function(e){e[e.Undefined=0]="Undefined",e[e.AlphaLcParenBoth=1]="AlphaLcParenBoth",e[e.AlphaUcParenBoth=2]="AlphaUcParenBoth",e[e.AlphaLcParenR=3]="AlphaLcParenR",e[e.AlphaUcParenR=4]="AlphaUcParenR",e[e.AlphaLcPeriod=5]="AlphaLcPeriod",e[e.AlphaUcPeriod=6]="AlphaUcPeriod",e[e.ArabicParenBoth=7]="ArabicParenBoth",e[e.ArabicParenR=8]="ArabicParenR",e[e.ArabicPeriod=9]="ArabicPeriod",e[e.ArabicPlain=10]="ArabicPlain",e[e.RomanLcParenBoth=11]="RomanLcParenBoth",e[e.RomanUcParenBoth=12]="RomanUcParenBoth",e[e.RomanLcParenR=13]="RomanLcParenR",e[e.RomanUcParenR=14]="RomanUcParenR",e[e.RomanLcPeriod=15]="RomanLcPeriod",e[e.RomanUcPeriod=16]="RomanUcPeriod",e[e.CircleNumDbPlain=17]="CircleNumDbPlain",e[e.CircleNumWdBlackPlain=18]="CircleNumWdBlackPlain",e[e.CircleNumWdWhitePlain=19]="CircleNumWdWhitePlain",e[e.ArabicDbPeriod=20]="ArabicDbPeriod",e[e.ArabicDbPlain=21]="ArabicDbPlain",e[e.Ea1ChsPeriod=22]="Ea1ChsPeriod",e[e.Ea1ChsPlain=23]="Ea1ChsPlain",e[e.Ea1ChtPeriod=24]="Ea1ChtPeriod",e[e.Ea1ChtPlain=25]="Ea1ChtPlain",e[e.Ea1JpnChsDbPeriod=26]="Ea1JpnChsDbPeriod",e[e.Ea1JpnKorPlain=27]="Ea1JpnKorPlain",e[e.Ea1JpnKorPeriod=28]="Ea1JpnKorPeriod",e[e.Arabic1Minus=29]="Arabic1Minus",e[e.Arabic2Minus=30]="Arabic2Minus",e[e.Hebrew2Minus=31]="Hebrew2Minus",e[e.ThaiAlphaPeriod=32]="ThaiAlphaPeriod",e[e.ThaiAlphaParenR=33]="ThaiAlphaParenR",e[e.ThaiAlphaParenBoth=34]="ThaiAlphaParenBoth",e[e.ThaiNumPeriod=35]="ThaiNumPeriod",e[e.ThaiNumParenR=36]="ThaiNumParenR",e[e.ThaiNumParenBoth=37]="ThaiNumParenBoth",e[e.HindiAlphaPeriod=38]="HindiAlphaPeriod",e[e.HindiNumPeriod=39]="HindiNumPeriod",e[e.HindiNumParenR=40]="HindiNumParenR",e[e.HindiAlpha1Period=41]="HindiAlpha1Period"}(e.ListNumeration||(e.ListNumeration={})),function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.TextTileEventType||(e.TextTileEventType={}))}(n.Tiling||(n.Tiling={}))},{}],86:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TypeCategory=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Schema=1]="Schema",e[e.Boolean=2]="Boolean",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Buffer=5]="Buffer",e[e.Function=6]="Function"}(n.TypeCategory||(n.TypeCategory={}))},{}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TokenProvisionResponse=n.TokenProvisionMessage=n.AnnotationResultsMessage=n.SessionDeleteMessage=n.SyncResponse=n.MicroSyncMessage=n.SyncMessage=n.AnnotationConfigUpdateResponse=n.AnnotationConfigUpdateMessage=n.AnnotationReleaseResponse=n.AnnotationReleaseMessage=n.AnnotationResultStateMessage=n.AnnotationActivationResponse=n.AnnotationActivationMessage=n.CacheDumpRequestResponse=n.CacheDumpRequestMessage=n.SessionCloseMessage=n.SessionInitResponse=n.SessionInitMessage=n.TimeoutErrorResponse=n.ErrorResponse=n.Response=n.Message=void 0;var o=e(102),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Message"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Message=r;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Response"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Response=s;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_ErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ErrorResponse=i;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TimeoutErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_ErrorResponse","AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TimeoutErrorResponse=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SessionInitMessage=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SessionInitResponse=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionCloseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SessionCloseMessage=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.CacheDumpRequestMessage=p;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.CacheDumpRequestResponse=f;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationActivationMessage=d;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationActivationResponse=g;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultStateMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationResultStateMessage=h;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationReleaseMessage=y;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationReleaseResponse=m;var v=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationConfigUpdateMessage=v;var S=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationConfigUpdateResponse=S;var T=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SyncMessage=T;var b=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_MicroSyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.MicroSyncMessage=b;var _=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SyncResponse=_;var w=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionDeleteMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SessionDeleteMessage=w;var C=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultsMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationResultsMessage=C;var M=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TokenProvisionMessage=M;var O=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TokenProvisionResponse=O},{102:102}],88:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(89),n),o(e(90),n),o(e(87),n)},{87:87,89:89,90:90}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MessageEndpoint=n.extractMessageNameFromTypeName=n.ProcessMessageErrorReason=n.SendMessageErrorReason=void 0;var o,r,s=e(36),i=e(42),a=e(102),c=e(87),u=e(92);function l(e){for(var t,n=0,o=["AugLoop_Excel_Session_Protocol_","AugLoop_Powerpoint_Session_Protocol_","AugLoop_Session_Protocol_"];n<o.length;n++){var r=o[n];if(0===e.indexOf(r)){t=r;break}}if(!t)return"MalformedMessageName";var s=e.indexOf("Message",e.length-"Message".length)===e.length-"Message".length;return e.slice(t.length,s?-"Message".length:void 0)}!function(e){e.ClientDisconnected="Client disconnected.",e.UnsupportedSyncMessage="SyncMessages with seq = -1 are not supported anymore.",e.UnexpectedSeedMessage="Unexpected seed message",e.SyncMessageUnsupportedBatch="SyncMessage with unsupported batching.",e.AnnotationTokenNotFound="Token not found"}(o=n.SendMessageErrorReason||(n.SendMessageErrorReason={})),function(e){e.ProvisionTokenValidationError="Token provision message didn't pass token validation."}(r=n.ProcessMessageErrorReason||(n.ProcessMessageErrorReason={})),n.extractMessageNameFromTypeName=l;var p=function(){function e(e){this.nextMessageId=1,this.pendingResponseCallbacks=new u.Cache({sweepInterval:5e3}),this.pendingMessageCallbacks=new u.Cache({sweepInterval:5e3}),this.messageCallbacks=new Map,this.messageIdPrefix=e,this.source="c"===e?i.SessionHealthSource.ClientRuntime:i.SessionHealthSource.Core,this.stats={sendMessageCount:0,sendMessageClientDisconnectedErrors:0,sendMessageErrors:0,sendMessageDurationMsMax:0,processMessageCount:0,processMessageProvisionTokenErrors:0,processMessageErrors:0,processMessageDurationMsMax:0}}return e.prototype.setClientMetadata=function(e){this.clientMetadata=e},e.prototype.setEgress=function(e){this.egress=e},e.prototype.ingress=function(e,t){var n=a.SchemaObject.getBaseTypesFor(e),o=a.SchemaObject.getTypeNameFor(e);o===c.Response.getTypeName()||n&&n.indexOf(c.Response.getTypeName())>=0?(this.processResponse(e),t()):this.processMessage(e,t),o!==c.SessionCloseMessage.getTypeName()||e.reconnectAllowed||this.clearAllPendingResponses()},e.prototype.sendMessage=function(e,t,n,o){var r=this;void 0===o&&(o=0);var u=new i.SessionHealth({sessionHealthEventName:"SendMessage",source:this.source,reason:i.SessionHealthReason.Client,impact:this.source===i.SessionHealthSource.ClientRuntime?i.SessionHealthImpact.MissingInput:i.SessionHealthImpact.MissingOutput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv,resourceId:l(a.SchemaObject.getTypeNameFor(e)),dimension0:o.toString()}).start(),p=function(){if(u.setClientMetadata(r.clientMetadata),u.success)s.Log.info(572836e3,s.LogCategory.CoreDefault,u.stop());else{var e="ErrorWithoutPendingResponse"===u.resultSignature||"ResponseCallbackException"===u.resultSignature||"We called into done callback"!==u.message;u.message=JSON.stringify({errorNotPropagatedToDoneCallback:e}),s.Log.error(572836001,s.LogCategory.CoreDefault,u.stop())}};e.messageId=""+this.messageIdPrefix+this.nextMessageId++;var f=a.SchemaObject.getTypeNameFor(e)===c.SessionCloseMessage.getTypeName();if(!n&&!f){var d=function(n,o){var s;if(n?(u.success=!1,u.resultSignature=n.error,u.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+n.error):u.resultSignature="Success",t)try{u.message="We called into done callback",t(n,o)}catch(e){u.success=!1,u.resultSignature="ResponseCallbackException",u.resultDescription="Web"===(null===(s=r.clientMetadata)||void 0===s?void 0:s.appPlatform)?JSON.stringify({message:e.message,stack:e.stack}):JSON.stringify({message:e.message})}r.pendingMessageCallbacks.del(e.messageId),p(),r.updateSendMessageStats(u.success,u.durationMs,n?new Error(n.error):void 0)};this.pendingResponseCallbacks.put(e.messageId,d,1e4,(function(){d(new c.TimeoutErrorResponse({error:"Timeout waiting for response"}),void 0)}))}this.egress(e,(function(t){var n,o;if(t){var s=r.pendingResponseCallbacks.get(e.messageId);s?(r.pendingResponseCallbacks.del(e.messageId),s(new c.ErrorResponse({error:t.message}))):f?(u.success=null!==(o=null===(n=t.message)||void 0===n?void 0:n.endsWith("Client disconnected."))&&void 0!==o&&o,u.resultSignature="ErrorSendingSessionCloseMessage",u.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+t.message,p()):(u.success=!1,u.resultSignature="ErrorWithoutPendingResponse",u.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+t.message,p())}}))},e.prototype.onMessage=function(e,t){this.messageCallbacks.set(e,t)},e.prototype.getStats=function(){return this.stats},e.prototype.hasMessageCallback=function(e){return this.messageCallbacks.has(e)},e.prototype.cancelPendingResponseCallbacks=function(){var e=this;this.pendingResponseCallbacks.forEach((function(t,n){t&&(e.pendingResponseCallbacks.del(n),t(new c.ErrorResponse({error:"Cancelled"})))}))},e.prototype.clearAllPendingResponses=function(){if(0!=this.pendingResponseCallbacks.size()){var e=new s.Operation({operationName:"PurgePendingResponses",resultDescription:this.pendingResponseCallbacks.size().toString(),success:!0});s.Log.info(572836002,s.LogCategory.CoreDefault,e),this.pendingResponseCallbacks.clear()}},e.prototype.processMessage=function(e,t){var n,o=this,r=new i.SessionHealth({sessionHealthEventName:"ProcessMessage",source:this.source,reason:i.SessionHealthReason.Client,impact:this.source===i.SessionHealthSource.ClientRuntime?i.SessionHealthImpact.MissingOutput:i.SessionHealthImpact.MissingInput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv}).start(),u=function(){if(r.setClientMetadata(o.clientMetadata),r.success)s.Log.info(572836003,s.LogCategory.CoreDefault,r.stop());else{var e="UnsupportedMessage"===r.resourceId||"Timeout"===r.resultSignature||"OnResponseInvokedMoreThanOnce"===r.resultSignature||"MessageCallbackException"===r.resultSignature||"We called into messageCallback"!==r.message;r.message=JSON.stringify({errorHappenedOutsideRegisteredMessageCallback:e}),s.Log.error(572836032,s.LogCategory.CoreDefault,r.stop())}},p=this.messageCallbacks.get(a.SchemaObject.getTypeNameFor(e));p?r.resourceId=l(a.SchemaObject.getTypeNameFor(e)):p=function(t,n){r.resourceId="UnsupportedMessage",n(new c.ErrorResponse({error:"Message type "+a.SchemaObject.getTypeNameFor(e)+" is not supported"}))};this.pendingMessageCallbacks.put(e.messageId,void 0,1e4,(function(){r.success=!1,r.resultSignature="Timeout",r.resultDescription="Timeout processing message callback",u(),s.Log.error(572836033,s.LogCategory.CoreDefault,"Timeout processing "+r.resourceId),o.updateProcessMessageStats(!1,r.durationMs,new Error("timeout"))}));var f=!1;try{r.message="We called into messageCallback",p(e,(function(n,s){o.pendingMessageCallbacks.del(e.messageId),f?(r.success=!1,r.resultSignature="OnResponseInvokedMoreThanOnce",r.resultDescription="Invoked onResponse for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+" more than once"):n?(r.success=!1,r.resultSignature=n.error,r.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+n.error):r.resultSignature="Success",f=!0,u(),n&&!a.SchemaObject.matchesTypesFor(n,[c.ErrorResponse.getTypeName()])&&(n=new c.ErrorResponse({error:"Internal Server Error"})),o.updateProcessMessageStats(r.success,r.durationMs,n?new Error(n.error):void 0),n?(n.messageId=e.messageId,t(n)):s?(s.messageId=e.messageId,t(void 0,s)):t()}))}catch(o){this.pendingMessageCallbacks.del(e.messageId),r.success=!1,r.resultSignature="MessageCallbackException",r.resultDescription="Web"===(null===(n=this.clientMetadata)||void 0===n?void 0:n.appPlatform)?JSON.stringify({message:o.message,stack:o.stack}):JSON.stringify({message:o.message}),u(),this.updateProcessMessageStats(!1,r.durationMs,o),t()}},e.prototype.processResponse=function(e){var t,n=new s.Operation({operationName:"ProcessResponse"});n.success=!0,n.setClientMetadata(this.clientMetadata),n.start();var o=this.pendingResponseCallbacks.get(e.messageId);o?(this.pendingResponseCallbacks.del(e.messageId),a.SchemaObject.matchesTypesFor(e,[c.ErrorResponse.getTypeName()])?o(e):o(void 0,e)):(n.resultSignature="NoPendingMessage",n.resultDescription=""+e.messageId,n.success=!1),"Production"!==(null===(t=this.clientMetadata)||void 0===t?void 0:t.releaseAudienceGroup)&&(n.resourceId=l(a.SchemaObject.getTypeNameFor(e)),s.Log.info(572836034,s.LogCategory.CoreDefault,n.stop()))},e.prototype.updateSendMessageStats=function(e,t,n){this.stats.sendMessageCount++,this.stats.sendMessageDurationMsMax=Math.max(t,this.stats.sendMessageDurationMsMax),e||n?e&&n&&s.Log.warn(572836036,s.LogCategory.CoreDefault,"Succeeded send message provided error object."):s.Log.warn(572836035,s.LogCategory.CoreDefault,"Failed send message did not provide error object."),e||(n&&n.message===o.ClientDisconnected?this.stats.sendMessageClientDisconnectedErrors++:this.stats.sendMessageErrors++)},e.prototype.updateProcessMessageStats=function(e,t,n){this.stats.processMessageCount++,this.stats.processMessageDurationMsMax=Math.max(t,this.stats.processMessageDurationMsMax),e||n?e&&n&&s.Log.warn(572836038,s.LogCategory.CoreDefault,"Succeeded process message provided error object."):s.Log.warn(572836037,s.LogCategory.CoreDefault,"Failed process message did not provide error object."),e||(n&&n.message===r.ProvisionTokenValidationError?this.stats.processMessageProvisionTokenErrors++:this.stats.processMessageErrors++)},e}();n.MessageEndpoint=p},{102:102,36:36,42:42,87:87,92:92}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationResultState=n.currentProtocolVersion=void 0,n.currentProtocolVersion=2,function(e){e[e.Idle=0]="Idle",e[e.Pending=1]="Pending"}(n.AnnotationResultState||(n.AnnotationResultState={}))},{}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Cache=void 0;var o=function(){function e(e){if(this.cache=new Map,this.options=e||{sweepInterval:100},null!=this.options.idleDurationMs&&this.options.idleDurationMs<=0)throw new Error("Idle duration must be positive");if(this.interval=this.options.sweepInterval||100,this.interval<=0)throw new Error("Sweep interval must be a positive number")}return e.prototype.put=function(e,t,n,o,r,s,i){if(null==n||n<=0)throw new Error("Cache timeout must be a positive number");(null==r||r<=0)&&(r=this.options.idleDurationMs);var a={value:t,lastUsed:r?Date.now():void 0,expire:n+Date.now(),idleDurationMs:r,expireCallback:o,expiringTriggerTime:s+Date.now(),expiringCallback:i};return this.cache.set(e,a),this.timeout||(this.timeout=setInterval(this.onInterval.bind(this),this.interval),this.timeout.unref&&this.timeout.unref()),t},e.prototype.del=function(e){if(this.options.delCallback){var t=this.cache.get(e);t&&this.options.delCallback(e,t.value)}var n=this.cache.delete(e);return 0===this.size()&&this.clear(),n},e.prototype.clear=function(){this.timeout&&(clearInterval(this.timeout),this.timeout=void 0),this.cache.clear()},e.prototype.get=function(e){var t=this.cache.get(e);if(t)return this.options.idleDurationMs&&(t.lastUsed=Date.now()),t.value},e.prototype.keys=function(){return this.cache.keys()},e.prototype.forEach=function(e){this.cache.forEach((function(t,n){e(t.value,n)}))},e.prototype.size=function(){return this.cache.size},e.prototype.updateExpireTime=function(e,t){return!!(this.cache.has(e)&&t>=0)&&(this.cache.get(e).expire=t+Date.now(),!0)},e.prototype.onInterval=function(){var e=this,t=Date.now();this.cache.forEach((function(n,o){if(n.idleDurationMs&&n.lastUsed<t-n.idleDurationMs)return e.del(o),void(e.options.idleCallback&&e.options.idleCallback(o,n.value));n.expire<t&&(e.del(o),n.expireCallback&&n.expireCallback(o,n.value)),n.expiringTriggerTime<t&&n.expiringCallback&&(n.expiringCallback(o,n.value),n.expiringCallback=void 0)}))},e}();n.Cache=o},{}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Cache=void 0;var o=e(91);Object.defineProperty(n,"Cache",{enumerable:!0,get:function(){return o.Cache}})},{91:91}],93:[function(e,t,n){var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.AnnotationMetaDataChangeEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.sessionKey="",e.prototype.annotationType="",e.prototype.annotationState=0,e.prototype.workflowId="",e}(),t.exports=r},{}],94:[function(e,t,n){var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.OperationEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.userType="",e.prototype.userId="",e}(),t.exports=r},{}],95:[function(e,t,n){var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.SessionHealthEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.userType="",e.prototype.userId="",e.prototype.sessionHealthEventName="",e.prototype.source="",e.prototype.reason="",e.prototype.reasonDependency="",e.prototype.subReason="",e.prototype.impact="",e.prototype.success=!1,e.prototype.durationMs=0,e.prototype.count=0,e.prototype.message="",e.prototype.affectedWorkflows="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.resultDescription="",e.prototype.resultSignature="",e}(),t.exports=r},{}],96:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationState=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Created=10]="Created",e[e.Sent=20]="Sent",e[e.Duplicated=30]="Duplicated",e[e.Seen=40]="Seen",e[e.Tried=50]="Tried",e[e.Kept=60]="Kept",e[e.Rejected=70]="Rejected"}(n.AnnotationState||(n.AnnotationState={}))},{}],97:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BinaryClassificationAnnotation=n.Annotation=void 0;var o=e(99),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.M_},set:function(e){this.M_=e},enumerable:!1,configurable:!0}),e.getTypeName=function(){return"AugLoop_Core_Annotation"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Annotation=r;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.M_},set:function(e){this.M_=e},enumerable:!1,configurable:!0}),e.getTypeName=function(){return"AugLoop_Core_BinaryClassificationAnnotation"},e.getBaseTypes=function(){return["AugLoop_Core_Annotation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.BinaryClassificationAnnotation=s},{99:99}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SignalOperation=n.MicroSyncOperation=n.DeltaUpdateOperation=n.VisibilityOperation=n.FocusOperation=n.PurgeOperation=n.DeleteOperation=n.UpdateOperation=n.UpdateAnnotationMetaDataOperation=n.MoveOperation=n.AddOperation=n.OperationWithSiblingContext=n.Operation=n.ItemChangesDelta=n.ItemDelta=void 0;var o=e(99),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ItemDelta"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ItemDelta=r;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ItemChangesDelta"},e.getBaseTypes=function(){return["AugLoop_Core_ItemDelta"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ItemChangesDelta=s;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Operation"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Operation=i;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_OperationWithSiblingContext"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.OperationWithSiblingContext=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_AddOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AddOperation=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MoveOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.MoveOperation=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.UpdateAnnotationMetaDataOperation=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.UpdateOperation=p;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeleteOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.DeleteOperation=f;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_PurgeOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.PurgeOperation=d;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_FocusOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.FocusOperation=g;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_VisibilityOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.VisibilityOperation=h;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeltaUpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.DeltaUpdateOperation=y;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MicroSyncOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.MicroSyncOperation=m;var v=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_SignalOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SignalOperation=v},{99:99}],99:[function(e,t,n){"use strict";var o=e("spreadArraysHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.SchemaObject=void 0;var r=function(){function e(t){e.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_SchemaObject"},e.getBaseTypes=function(){return[]},e.getTypeNameFor=function(e){return e&&e.H_?e.H_.T_:void 0},e.getBaseTypesFor=function(e){return e&&e.H_&&e.H_.B_?e.H_.B_:[]},e.getAllTypesFor=function(t){var n=e.getTypeNameFor(t);return n?o([n],e.getBaseTypesFor(t)):[]},e.matchesTypesFor=function(t,n){if(!Array.isArray(n)||0===n.length)return!0;for(var o=e.getTypeNameFor(t),r=t&&t.H_&&t.H_.B_?t.H_.B_:void 0,s=0,i=n;s<i.length;s++){var a=i[s];if(a===o)return!0;if(r&&r.indexOf(a)>=0)return!0}return!1},e.assign=function(e,t,n){if(n)for(var o=0,r=Object.keys(n);o<r.length;o++){var s=r[o];t[s]=n[s]}return t.H_=e.H_,t},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SchemaObject=r},{}],100:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Signal=void 0;var o=e(99),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_Signal"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Signal=r},{99:99}],101:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TenantContextHolder=n.UserContextHolder=n.ContextHolder=n.DynamicContext=n.GridNeighborhoodContext=n.GridCell=n.Document=n.Session=n.TileGroup=n.Binary=n.Blob=void 0;var o=e(99),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Blob"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Blob=r;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Binary"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Binary=s;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_TileGroup"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TileGroup=i;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Session"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Session=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Document"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Document=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridCell"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.GridCell=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridNeighborhoodContext"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.GridNeighborhoodContext=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DynamicContext"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.DynamicContext=p;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ContextHolder"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ContextHolder=f;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UserContextHolder"},e.getBaseTypes=function(){return["AugLoop_Core_ContextHolder"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.UserContextHolder=d;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_TenantContextHolder"},e.getBaseTypes=function(){return["AugLoop_Core_ContextHolder"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TenantContextHolder=g},{99:99}],102:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.ItemChanges=n.ItemOperation=void 0,o(e(96),n);var r=e(103);Object.defineProperty(n,"ItemOperation",{enumerable:!0,get:function(){return r.ItemOperation}}),Object.defineProperty(n,"ItemChanges",{enumerable:!0,get:function(){return r.ItemChanges}}),o(e(104),n),o(e(105),n),o(e(106),n),o(e(97),n),o(e(98),n),o(e(99),n),o(e(100),n),o(e(101),n)},{100:100,101:101,103:103,104:104,105:105,106:106,96:96,97:97,98:98,99:99}],103:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ItemChanges=n.ItemOperation=void 0,function(e){e[e.None=0]="None",e[e.Added=1]="Added",e[e.Updated=2]="Updated",e[e.Deleted=3]="Deleted"}(n.ItemOperation||(n.ItemOperation={})),function(e){e[e.ContentChanged=0]="ContentChanged",e[e.ContentWasEmpty=1]="ContentWasEmpty",e[e.FormattingChanged=2]="FormattingChanged"}(n.ItemChanges||(n.ItemChanges={}))},{}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],105:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],106:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GridConstants=n.OpenType=n.BlobRefType=void 0,function(e){e[e.None=0]="None",e[e.HttpsGetDownloadUrl=1]="HttpsGetDownloadUrl"}(n.BlobRefType||(n.BlobRefType={})),function(e){e[e.NewDocument=0]="NewDocument",e[e.EditDocument=1]="EditDocument",e[e.ViewOnlyDocument=2]="ViewOnlyDocument"}(n.OpenType||(n.OpenType={}));var o=function(){function e(){}return e.lowerIndexBound=1,e.maxNumberOfRows=1048576,e.maxNumberOfColumns=16384,e.firstColumnName="A",e.lastColumnName="XFD",e}();n.GridConstants=o},{}],107:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConsoleLogger=void 0;var o=e(111),r=e(109),s=function(){function e(){}return e.tagIntToString=function(t){return t<=e.maxNumericTag?t.toString():t>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t):e.map.charAt(t>>24&63)+e.map.charAt(t>>18&63)+e.map.charAt(t>>12&63)+e.map.charAt(t>>6&63)+e.map.charAt(63&t)},e.getLogMessage=function(t,n,o){return"tag_"+e.tagIntToString(t)+" ["+r.LogCategory[n]+"] "+o},e.prototype.sendTraceTag=function(t,n,r,s){var i=console.log;switch(r){case o.TraceLevel.Error:i=console.error;break;case o.TraceLevel.Warning:i=console.warn;break;case o.TraceLevel.Info:i=console.info;break;case o.TraceLevel.Verbose:i=console.debug;break;case o.TraceLevel.Spam:default:i=console.log}try{i(e.getLogMessage(t,n,s))}catch(e){var a="undefined"!=typeof navigator?navigator:void 0;if(a&&!/rv:11.0/i.test(a.userAgent))throw e}},e.prototype.shipAssertTag=function(t,n,o,r){console.assert(o,e.getLogMessage(t,n,r))},e.prototype.debugAssertTag=function(e,t,n,o){this.shipAssertTag(e,t,n,o)},e.maxNumericTag=65535,e.minOldSchemeHighByteValue=36,e.map="abcdefghijklmnopqrstuvwxyz0123456789",e}();n.ConsoleLogger=s},{109:109,111:111}],108:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UnitTestLogger=void 0;var o=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e}();n.UnitTestLogger=o},{}],109:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.LogCategory=void 0,n.LogCategory=o,function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence"}(o||(n.LogCategory=o={}))},{}],110:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.LogType=void 0,n.LogType=o,function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(o||(n.LogType=o={}))},{}],111:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.TraceLevel=void 0,n.TraceLevel=o,function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(o||(n.TraceLevel=o={}))},{}],112:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getUlsLogger=function(e,t){var n=new r.bUlsCache(e,t);return{sendTraceTag:function(e,t,o,r){return a(n,e,t,o,r)},shipAssertTag:function(e,t,o,r){o&&a(n,e,t,s.TraceLevel.Error,r)},debugAssertTag:function(){throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:n.flush,flushOnClose:n.flushOnClose}};var o=e(110),r=e(113),s=e(111);var i="production"!==t.env.NODE_ENV?s.TraceLevel.Verbose:s.TraceLevel.Info;function a(e,t,n,r,s){if(!(r>i)){var a={timestamp:Date.now(),category:n,tag:t,level:r,type:o.LogType.Trace,message:s};e.handleTrace(a)}}}).call(this,{env:{NODE_ENV:"production"}})},{110:110,111:111,113:113}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bUlsCache=void 0;var o=e(115),r=e(114),s=e(111),i=function(){function e(t,n){var s=this;this.uploadId=0,this.logCache=[],this.timestampBase=Date.now(),this.userSessionId="00000000-0000-0000-0000-000000000000",this.flushOnClose=function(){s.triggerUpload(!1,!1)},this.flush=function(){s.triggerUploadAsync()},this.triggerUploadAsync=function(){window.setTimeout((function(){return s.triggerUpload(!0,!0)}),0)},this.triggerUpload=function(t,n){if(window.clearTimeout(s.timeoutId),s.logCache.length>0){s.uploadId+=1;var i=(0,r.formatForUpload)(s.logCache,s.userSessionId,s.uploadId,s.timestampBase);(0,o.uploadLogs)(i,s.remoteUrlEndpoint,n),s.logCache=[],s.timestampBase=Date.now()}t&&(s.timeoutId=window.setTimeout(s.triggerUploadAsync,e.uploadCadenceInMsSec))},this.userSessionId=t,this.remoteUrlEndpoint=n+"?usid="+t,window.setTimeout((function(){return s.triggerUpload(!0,!0)}),0)}return e.prototype.handleTrace=function(t){t.message.length>e.messageMaxChars&&(t.message=t.message.substr(0,e.messageMaxChars-e.trimmedMessage.length)+e.trimmedMessage),this.logCache.push(t),(this.logCache.length>e.uploadTriggerSize||t.level===s.TraceLevel.Error)&&this.triggerUploadAsync()},e.messageMaxChars=3072,e.uploadCadenceInMsSec=3e4,e.uploadTriggerSize=30,e.trimmedMessage="... [Trimmed]",e}();n.bUlsCache=i},{111:111,114:114,115:115}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.formatForUpload=function(e,t,n,o){var r=e.map((function(e){return function(e,t){var n={};n.G=e.tag,n.T=e.timestamp-t,n.M=e.message,n.C=e.category;var o=1e3*e.type+e.level;return n.D=o,n}(e,o)})),s=function(e,t,n,o){var r={};return r.T=e,r.L=t,r.S=n,r.I=o,r.V=1,r}(o,r,t,n);return JSON.stringify(s)}},{}],115:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.uploadLogs=function(e,t,n){if(""===t)return;var o=new XMLHttpRequest;o.readyState!==XMLHttpRequest.UNSENT&&o.readyState!==XMLHttpRequest.DONE||(o.open("POST",t,n),o.send(e))}},{}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initializeLogger=function(e){if(!e)throw new Error("The 'logger' argument is missing");s.setLogger(e)},n.ULS=n.UlsLoggerWrapper=void 0;var o=e(107),r=function(){function e(){this.externalLogger=new o.ConsoleLogger}return e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,n,o){this.externalLogger.sendTraceTag(e,t,n,o)},e.prototype.debugAssertTag=function(e,t,n,o){this.externalLogger.debugAssertTag(e,t,n,o)},e.prototype.shipAssertTag=function(e,t,n,o){this.externalLogger.shipAssertTag(e,t,n,o)},e}();n.UlsLoggerWrapper=r;var s=new r;n.ULS=s},{107:107}],117:[function(e,t,n){var o=function(e){function t(){this.fetch=!1,this.DOMException=e.DOMException}return t.prototype=e,new t}("undefined"!=typeof self?self:this);!function(e){!function(t){var n="URLSearchParams"in e,o="Symbol"in e&&"iterator"in Symbol,r="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),s="FormData"in e,i="ArrayBuffer"in e;if(i)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o&&(t[Symbol.iterator]=function(){return t}),t}function f(e){this.map={},e instanceof f?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function g(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function h(e){var t=new FileReader,n=g(t);return t.readAsArrayBuffer(e),n}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:s&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():i&&r&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):i&&(ArrayBuffer.prototype.isPrototypeOf(e)||c(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(h)}),this.text=function(){var e,t,n,o=d(this);if(o)return o;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=g(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),o=0;o<t.length;o++)n[o]=String.fromCharCode(t[o]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s&&(this.formData=function(){return this.text().then(T)}),this.json=function(){return this.text().then(JSON.parse)},this}f.prototype.append=function(e,t){e=u(e),t=l(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},f.prototype.delete=function(e){delete this.map[u(e)]},f.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},f.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},f.prototype.set=function(e,t){this.map[u(e)]=l(t)},f.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},f.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),p(e)},f.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),p(e)},f.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),p(e)},o&&(f.prototype[Symbol.iterator]=f.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function S(e,t){var n,o,r=(t=t||{}).body;if(e instanceof S){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new f(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new f(t.headers)),this.method=(n=t.method||this.method||"GET",o=n.toUpperCase(),v.indexOf(o)>-1?o:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function T(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),o=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(r))}})),t}function b(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new f(t.headers),this.url=t.url||"",this._initBody(e)}S.prototype.clone=function(){return new S(this,{body:this._bodyInit})},m.call(S.prototype),m.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var _=[301,302,303,307,308];b.redirect=function(e,t){if(-1===_.indexOf(t))throw new RangeError("Invalid status code");return new b(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function w(e,n){return new Promise((function(o,s){var i=new S(e,n);if(i.signal&&i.signal.aborted)return s(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function c(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new f,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),o=n.shift().trim();if(o){var r=n.join(":").trim();t.append(o,r)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var r="response"in a?a.response:a.responseText;o(new b(r,n))},a.onerror=function(){s(new TypeError("Network request failed"))},a.ontimeout=function(){s(new TypeError("Network request failed"))},a.onabort=function(){s(new t.DOMException("Aborted","AbortError"))},a.open(i.method,i.url,!0),"include"===i.credentials?a.withCredentials=!0:"omit"===i.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),i.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),i.signal&&(i.signal.addEventListener("abort",c),a.onreadystatechange=function(){4===a.readyState&&i.signal.removeEventListener("abort",c)}),a.send(void 0===i._bodyInit?null:i._bodyInit)}))}w.polyfill=!0,e.fetch||(e.fetch=w,e.Headers=f,e.Request=S,e.Response=b),t.Headers=f,t.Request=S,t.Response=b,t.fetch=w}({})}(o),delete o.fetch.polyfill,(n=o.fetch).default=o.fetch,n.fetch=o.fetch,n.Headers=o.Headers,n.Request=o.Request,n.Response=o.Response,t.exports=n},{}],118:[function(e,t,n){"use strict";function o(e){if(this._capacity=s(e),this._length=0,this._front=0,r(e)){for(var t=e.length,n=0;n<t;++n)this[n]=e[n];this._length=t}}o.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,o=this._capacity,r=0;r<e;++r)t[r]=this[n+r&o-1];return t},o.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var o=this._capacity;if(n+t>o){for(var r=0;r<t;++r){this._checkCapacity(n+1),this[s=this._front+n&this._capacity-1]=arguments[r],n++,this._length=n}return n}for(var s=this._front,r=0;r<t;++r)this[s+n&o-1]=arguments[r],s++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[r=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},o.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},o.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},o.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){if(t+n>(r=this._capacity)){for(var o=n-1;o>=0;o--){this._checkCapacity(t+1);var r=this._capacity;this[i=(this._front-1&r-1^r)-r]=arguments[o],t++,this._length=t,this._front=i}return t}var s=this._front;for(o=n-1;o>=0;o--){var i;this[i=(s-1&r-1^r)-r]=arguments[o],s=i}return this._front=s,this._length=t+n,t+n}if(0===n)return t;this._checkCapacity(t+1);r=this._capacity;return this[o=(this._front-1&r-1^r)-r]=e,this._length=t+1,this._front=o,t+1},o.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},o.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},o.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}},o.prototype.isEmpty=function(){return 0===this._length},o.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,o=0;o<e;++o)this[t+o&n-1]=void 0;this._length=0,this._front=0},o.prototype.toString=function(){return this.toArray().toString()},o.prototype.valueOf=o.prototype.toString,o.prototype.removeFront=o.prototype.shift,o.prototype.removeBack=o.prototype.pop,o.prototype.insertFront=o.prototype.unshift,o.prototype.insertBack=o.prototype.push,o.prototype.enqueue=o.prototype.push,o.prototype.dequeue=o.prototype.shift,o.prototype.toJSON=o.prototype.toArray,Object.defineProperty(o.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),o.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(s(1.5*this._capacity+16))},o.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,o=this._length;n+o>t&&function(e,t,n,o,r){for(var s=0;s<r;++s)n[s+o]=e[s+t],e[s+t]=void 0}(this,0,this,t,n+o&t-1)};var r=Array.isArray;function s(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}t.exports=o},{}],119:[function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function s(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,n,o,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,o||e,s),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function u(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(r=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,s=n.length,i=new Array(s);o<s;o++)i[o]=n[o].fn;return i},u.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,o,s,i){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],p=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,o),!0;case 5:return l.fn.call(l.context,t,n,o,s),!0;case 6:return l.fn.call(l.context,t,n,o,s,i),!0}for(u=1,c=new Array(p-1);u<p;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var f,d=l.length;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),p){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,o);break;default:if(!c)for(f=1,c=new Array(p-1);f<p;f++)c[f-1]=arguments[f];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,o){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return c(this,s),this;var i=this._events[s];if(i.fn)i.fn!==t||o&&!i.once||n&&i.context!==n||c(this,s);else{for(var a=0,u=[],l=i.length;a<l;a++)(i[a].fn!==t||o&&!i[a].once||n&&i[a].context!==n)&&u.push(i[a]);u.length?this._events[s]=1===u.length?u[0]:u:c(this,s)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&c(this,t)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,void 0!==t&&(t.exports=u)},{}],120:[function(e,t,n){(function(e){!function(e){function t(){}function n(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1===r.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}function o(e){for(var t=0,n=Math.min(65536,e.length+1),o=new Uint16Array(n),r=[],s=0;;){var i=t<e.length;if(!i||s>=n-1){if(r.push(String.fromCharCode.apply(null,o.subarray(0,s))),!i)return r.join("");e=e.subarray(t),s=t=0}if(0==(128&(i=e[t++])))o[s++]=i;else if(192==(224&i)){var a=63&e[t++];o[s++]=(31&i)<<6|a}else if(224==(240&i)){a=63&e[t++];var c=63&e[t++];o[s++]=(31&i)<<12|a<<6|c}else if(240==(248&i)){65535<(i=(7&i)<<18|(a=63&e[t++])<<12|(c=63&e[t++])<<6|63&e[t++])&&(i-=65536,o[s++]=i>>>10&1023|55296,i=56320|1023&i),o[s++]=i}}}if(e.TextEncoder&&e.TextDecoder)return!1;var r=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var n=e.length,o=0,r=Math.max(32,n+(n>>>1)+7),s=new Uint8Array(r>>>3<<3);t<n;){var i=e.charCodeAt(t++);if(55296<=i&&56319>=i){if(t<n){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,i=((1023&i)<<10)+(1023&a)+65536)}if(55296<=i&&56319>=i)continue}if(o+4>s.length&&(r+=8,r=(r*=1+t/e.length*2)>>>3<<3,(a=new Uint8Array(r)).set(s),s=a),0==(4294967168&i))s[o++]=i;else{if(0==(4294965248&i))s[o++]=i>>>6&31|192;else if(0==(4294901760&i))s[o++]=i>>>12&15|224,s[o++]=i>>>6&63|128;else{if(0!=(4292870144&i))continue;s[o++]=i>>>18&7|240,s[o++]=i>>>12&63|128,s[o++]=i>>>6&63|128}s[o++]=63&i|128}}return s.slice?s.slice(0,o):s.subarray(0,o)},Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(n.prototype,"fatal",{value:!1}),Object.defineProperty(n.prototype,"ignoreBOM",{value:!1});var s=o;"function"==typeof Buffer&&Buffer.from?s=function(e){return Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf-8")}:"function"==typeof Blob&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&(s=function(e){var t=URL.createObjectURL(new Blob([e],{type:"text/plain;charset=UTF-8"}));try{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n.responseText}catch(t){return o(e)}finally{URL.revokeObjectURL(t)}}),n.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");return e=e instanceof Uint8Array?e:e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer):new Uint8Array(e),s(e)},e.TextEncoder=t,e.TextDecoder=n}("undefined"!=typeof window?window:void 0!==e?e:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],121:[function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t,n,o,r,s,i){try{var a=e[s](i),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(o,r)}Object.defineProperty(n,"__esModule",{value:!0});var s=e(122);var i=["get","getKey","getAll","getAllKeys","count"],a=["put","add","delete","clear"],c=new Map;function u(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(c.get(t))return c.get(t);var n=t.replace(/FromIndex$/,""),o=t!==n,s=a.indexOf(n)>=0;if(n in(o?IDBIndex:IDBObjectStore).prototype&&(s||i.indexOf(n)>=0)){var u=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var r,i,a,c,u,l,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=this.transaction(t,s?"readwrite":"readonly"),a=i.store,c=p.length,u=new Array(c>1?c-1:0),l=1;l<c;l++)u[l-1]=p[l];return o&&(a=a.index(u.shift())),e.next=6,Promise.all([(r=a)[n].apply(r,u),s&&i.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})),function(){var t=this,n=arguments;return new Promise((function(o,s){var i=e.apply(t,n);function a(e){r(i,o,s,a,c,"next",e)}function c(e){r(i,o,s,a,c,"throw",e)}a(void 0)}))});return function(e){return t.apply(this,arguments)}}();return c.set(t,u),u}}}s.replaceTraps((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}({},e,{get:function(t,n,o){return u(t,n)||e.get(t,n,o)},has:function(t,n){return!!u(t,n)||e.has(t,n)}})})),n.unwrap=s.unwrap,n.wrap=s.wrap,n.deleteDB=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.blocked,o=indexedDB.deleteDatabase(e);return n&&o.addEventListener("blocked",(function(){return n()})),s.wrap(o).then((function(){}))},n.openDB=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.blocked,r=n.upgrade,i=n.blocking,a=n.terminated,c=indexedDB.open(e,t),u=s.wrap(c);return r&&c.addEventListener("upgradeneeded",(function(e){r(s.wrap(c.result),e.oldVersion,e.newVersion,s.wrap(c.transaction))})),o&&c.addEventListener("blocked",(function(){return o()})),u.then((function(e){a&&e.addEventListener("close",(function(){return a()})),i&&e.addEventListener("versionchange",(function(){return i()}))})).catch((function(){})),u}},{122:122}],122:[function(e,t,n){"use strict";var o,r,s=function(e,t){return t.some((function(t){return e instanceof t}))};var i=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap;var p={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function f(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).indexOf(e)>=0?function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.apply(h(this),n),g(i.get(this))}:function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return g(e.apply(h(this),n))}:function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];var s=e.call.apply(e,[h(this),t].concat(o));return c.set(s,t.sort?t.sort():[t]),g(s)}}function d(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(!a.has(e)){var t=new Promise((function(t,n){var o=function(){e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=function(){t(),o()},s=function(){n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));a.set(e,t)}}(e),s(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,p):e)}function g(e){if(e instanceof IDBRequest)return t=e,(n=new Promise((function(e,n){var o=function(){t.removeEventListener("success",r),t.removeEventListener("error",s)},r=function(){e(g(t.result)),o()},s=function(){n(t.error),o()};t.addEventListener("success",r),t.addEventListener("error",s)}))).then((function(e){e instanceof IDBCursor&&i.set(e,t)})).catch((function(){})),l.set(n,t),n;var t,n;if(u.has(e))return u.get(e);var o=d(e);return o!==e&&(u.set(e,o),l.set(o,e)),o}var h=function(e){return l.get(e)};n.instanceOfAny=s,n.replaceTraps=function(e){p=e(p)},n.reverseTransformCache=l,n.unwrap=h,n.wrap=g},{}],123:[function(e,t,n){(function(e){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:void 0!==e?n=e.WebSocket||e.MozWebSocket:"undefined"!=typeof window?n=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(n=self.WebSocket||self.MozWebSocket),t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],assignHelper:[function(e,t,n){var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.exports=o},{}],exportStarHelper:[function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};t.exports=r},{}],extendsHelper:[function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.exports=r},{}],spreadArraysHelper:[function(e,t,n){var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,r++)o[r]=s[i];return o};t.exports=o},{}]},{},[47])(47)}));
//# sourceMappingURL=al.min.js.map
