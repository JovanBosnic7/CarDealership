'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[5],{1055:function(z,H,b){b.d(H,"a",function(){return n});z=b(0);var f=b(74),c=b(31);class n{static Yqa(m){const x={};for(let y of m)m=0,y in x&&(m=x[y]),x[y]=m+1;return c.c(x)}static nBg(m){let x=0;for(let y of m)y&&(m=parseInt(y),!isNaN(m)&&isFinite(m)&&(x+=m));return c.c(x)}static yph(m){const x=new f.a;for(var y of m)y&&(m=parseFloat(y),!isNaN(m)&&isFinite(m)&&x.add(m));y={};y.C=x.count;if(0<x.count){m=0;for(var v of x)m+=
v;v=m/x.count;y.M=v.toFixed(2);m=0;for(let t of x)m+=(t-v)*(t-v);m/=x.count;y.SD=Math.sqrt(m).toFixed(2)}return c.c(y)}}Object(z.a)(n,"CommonActivityAggregationMethods",null,[])},1117:function(z,H,b){b.r(H);b.d(H,"RtcUtils",function(){return m});z=b(0);var f=b(11),c=b(1164),n=b(31);class m{static Jlf(x,y=c.RealtimeChannel.Aje){let v;try{v=n.c(x)}catch(t){throw x=String.format("Failed to JSON-serialize payload : {0}",t),f.ULS.sendTraceTag(18637072,500,10,x),Error.argument("payload",x);}if(v.length>
y)throw x=String.format("Payload exceeds maximum length: {0} > {1}.",v.length,y),f.ULS.sendTraceTag(18637074,500,10,x),Error.argument("payload",x);return v}static deserialize(x,y,v,t,A=c.RealtimeChannel.Aje){if(!x)return null;if(Object.getType(x)!==String){let D;if(t)try{D=m.Jlf(x,A)}catch(U){D=String.format("Failed to JSON serialize the object with exception [{0}]",U)}else D="not allowed to log the object";x=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}]. Object: [{3}].",
y,Object.getType(x).getName(),v,D);f.ULS.sendTraceTag(18637075,500,10,x);return null}A=null;try{A=n.a(x)}catch(D){x=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}]. Object: [{3}]",y,D,v,t?x:"not allowed to log the object"),f.ULS.sendTraceTag(18637077,500,10,x)}return A}static K5b(x){if(!x)return"";if("string"===typeof x)return x.toString();try{return n.c(x)}catch(y){return x.toString()}}static Twk(x){let y,v,t;y=0;t=v=null;if(!x)return{G6h:y,
H6h:v,exception:t};try{const A=x.source;A&&Object.getType(A)===String&&(t=A);const D=x.context;D&&(x=D,y=x.status?x.status:0,v=x.statusText?x.statusText:null)}catch(A){}return{G6h:y,H6h:v,exception:t}}}Object(z.a)(m,"RtcUtils",null,[])},1157:function(z,H,b){b.r(H);z=b(0);var f=b(11),c=b(40),n=b(65),m;(function(t){t[t.SendNotification=0]="SendNotification";t[t.SendPersistentState=1]="SendPersistentState";t[t.FindSession=2]="FindSession";t[t.Last=3]="Last"})(m||(m={}));Object(z.b)("ApiType",m);var x;
(function(t){t[t.AttemptCount=0]="AttemptCount";t[t.SuccessCount=1]="SuccessCount";t[t.DropCount=2]="DropCount";t[t.FailedCount=3]="FailedCount";t[t.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";t[t.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";t[t.ThrottledCount=6]="ThrottledCount";t[t.Last=7]="Last"})(x||(x={}));Object(z.b)("EventCountType",x);var y=b(1289);b.d(H,"FrequentLoggingMetrics",function(){return v});class v{constructor(t){this.Pyh=this.fNh=null;this.Cni=this.rPh=
0;this.dv=null;this.Q2g=this.tYe=0;this.Be=t;this.Eel();this.BOe=this.rVg=this.$Ye=!1;this.wRc=0}get uwk(){return this.BOe}$Em(t){this.Q2g=t;window.setInterval(Object(c.a)(this,this.u3f,"logMetricsBatchAndReset"),t);this.tYe=(new Date).getTime()}qQ(t,A){this.Twm(t)&&!this.rVg||this.uwk||!window.navigator.onLine||this.Be.WZb||(this.dv[t][A]++,this.$Ye=!0)}Eel(){this.dv=Array(3);for(let t=0;3>t;t++){this.dv[t]=Array(7);for(let A=0;7>A;A++)this.dv[t][A]=0}}pZj(){const t={};for(let A=0;3>A;A++)for(let D=
0;7>D;D++)this.Ltl(A,D)&&(t[m[A]+x[D]]=this.dv[A][D]);t.FSDomain=this.fNh;t.ConnectionDomain=this.Pyh;t.FSRetryInterval=this.rPh;t.MaxPayloadSize=this.Cni;t.LogNumber=this.wRc;1===this.wRc&&(t.FSLatencies=y.a.instance.ZNk(),t.ConLatencies=y.a.instance.ZJk());return t}Ltl(t,A){return 2===t&&3!==A&&A?!1:!0}Twm(t){return 2===t?!1:!0}u3f(){if(this.$Ye){this.wRc++;if((new Date).getTime()-this.tYe<5E3+this.Q2g){var t=n.a.toJSON(this.pZj());f.ULS.sendTraceTag(50644352,500,15,t)}this.tYe=(new Date).getTime();
for(t=0;3>t;t++)for(let A=0;7>A;A++)this.dv[t][A]=0;this.$Ye=!1}}mDl(){this.rVg=!0}static get instance(){return v.ta}static create(t){v.instance||(v.ta=new v(t));return v.instance}}v.ta=null;Object(z.a)(v,"FrequentLoggingMetrics",null,[1232])},1164:function(z,H,b){b.r(H);z=b(0);var f=b(11),c=b(40),n=b(410),m=b(1388),x=b(57),y=b(2);class v{constructor(db,da){this.status=db;this.iwc=da}}Object(z.a)(v,"UserStatusInfo",null,[]);var t=b(44),A=b(1289);class D{constructor(db,da){this.data=db;this.timeStamp=
da}}Object(z.a)(D,"PresenceData",null,[]);class U{constructor(db){this.VGa=!1;this.QMb=0;this.GKe=!1;this.setTimeout=U.Xuf;this.clearTimeout=U.Ouf;this.rBl=Object(c.a)(this,this.MAl,"logRtcConnectingUsageStatement");this.lw=db}SMl(){this.VGa||(this.QMb=this.setTimeout(()=>{this.VGa=!1;this.wli()},8E3),this.VGa=!0,this.GKe=!1)}ENl(){this.c1()}USl(){this.wli()}wli(){this.c1();this.GKe||(this.GKe=!0,this.rBl())}MAl(){f.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",
this.lw)}c1(){this.VGa&&this.clearTimeout(this.QMb);this.QMb=0;this.VGa=!1}static Xuf(db,da){return window.setTimeout(db,da)}static Ouf(db){window.clearTimeout(db)}}Object(z.a)(U,"ConnectedUsageKpiLogger",null,[1247]);class F{constructor(){this.mEi=this.zjg;this.pEi=this.Cjg;this.oEi=this.Bjg;this.uEi=this.Ijg;this.tEi=this.Hjg;this.Rjg=this.Sjg;this.Ojg=this.Pjg;this.p8b=this.Mjg;this.Ftd=this.Njg;this.nEi=this.Ajg;this.YAa=this.I7f;this.WXa=this.J7f}zjg(){}Cjg(){}Bjg(){}Ijg(){}Hjg(){}Pjg(){}Njg(){}Mjg(){}Sjg(){}Ajg(){}I7f(){}J7f(){}}
Object(z.a)(F,"NoopRealtimeChannelMetrics",null,[1239,156]);class E{}E.cDd="presenceUpdated";E.updateNotification="updateNotification";E.Ezi="persistentStateCleared";E.updatePersistentState="persistentStateUpdated";Object(z.a)(E,"RtcClientMethodNames",null,[]);class P{}P.bbl="realtimeChannelHub";P.cDd="UpdatePresence";P.$Q="SendUpdateNotification";P.kGf="GetCompletePersistentStateWithMetadata";P.updatePersistentState="UpdatePersistentState";Object(z.a)(P,"RtcHubMethodNames",null,[]);class G{constructor(db){this.Xw=
db}Uam(db){this.Xw.on(E.cDd,db)}nbm(db){this.Xw.on(E.updateNotification,db)}Tam(db){this.Xw.on(E.updatePersistentState,db)}Sam(db){this.Xw.on(E.Ezi,db)}APm(db){this.Xw.off(E.cDd,db)}FPm(db){this.Xw.off(E.updateNotification,db)}zPm(db){this.Xw.off(E.updatePersistentState,db)}yPm(db){this.Xw.off(E.Ezi,db)}cDd(db){return this.Xw.invoke(P.cDd,db)}$Q(db,da){return this.Xw.invoke(P.$Q,db,da)}kGf(db){return this.Xw.invoke(P.kGf,db)}updatePersistentState(db,da){return this.Xw.invoke(P.updatePersistentState,
db,da)}}Object(z.a)(G,"RealtimeChannelProxy",null,[1244,1245,1246]);class K{constructor(){this.XHe=this.aOg=!1;this.VHe=0;this.WJe=this.D6e=this.C6e=this.kYe=this.fHe=!1;this.hPe=0;this.bah=!1;this.aah=this.$$g=0;this.a5e=!1;this.e5e=this.d5e=this.g5e=this.b5e=0}get wVj(){return this.XHe}get vVj(){return this.VHe}get kQj(){return this.fHe}get pBl(){return this.kYe}get Yxm(){return this.C6e}get Zxm(){return this.D6e}get b7j(){return this.WJe}get l7d(){return this.hPe}get Rjm(){return this.bah}get qLi(){return this.$$g}get Qjm(){return this.aah}get Njm(){return this.a5e}get Ojm(){return this.b5e}get vLi(){return this.g5e}get rLi(){return this.d5e}get sLi(){return this.e5e}static createInstance(db){const {RealtimeChannel:da}=
b(1164);return db?Object.assign(new K,{aOg:db.$("AwayStatusManagerIsEnabled"),XHe:db.$("AwayStatusOneMinuteTimeoutIsEnabled"),VHe:db.zb("AwayCoauthorThresholdMs",9E5),fHe:db.$("RtcAllowCrossDomainAccessEnabled"),kYe:db.$("RTCLogUpdateNotificationHintOnDeserializationFailure"),C6e:db.$("ShouldLogOnContentNotification"),D6e:db.$("ShouldLogOnHostSubscriptionNotification"),WJe:db.$("RtcClientMetricsEnabled"),hPe:db.zb("RtcFindSessionRequestTimeoutInMS",6E4),bah:db.$("RtcJsClientFrequentlyLogsMetrics"),
$$g:db.zb("RtcJsClientFrequentMetricsLatencyThresholdInMS",1E3),aah:db.zb("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),a5e:db.$("RtcClientMessageTelemetryEnabled"),b5e:db.zb("RtcClientMessageTelemetrySampleSize",5),g5e:db.zb("RtcSendTelemetryMessageIntervalInMS",3E5),d5e:db.zb("RtcLogClientMessageMetricsTimeOutInMs",2E4),e5e:db.zb("RtcMaxPayloadSizeInCharactersOverride",da.Aje)}):Object.assign(new K,{aOg:!1,XHe:!1,VHe:9E5,fHe:!1,kYe:!0,C6e:!1,D6e:!0,WJe:!1,hPe:9E4,a5e:!1,b5e:5,g5e:3E5,d5e:2E4,
e5e:da.Aje})}}Object(z.a)(K,"RealtimeChannelSettings",null,[1243]);class S extends Sys.EventArgs{constructor(db,da){super();this.newState=db;this.oldState=da}}Object(z.a)(S,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class L extends Sys.EventArgs{constructor(db){super();this.presence=db}}Object(z.a)(L,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var I=b(1590),O=b(1589),M=b(1587);class R extends Sys.EventArgs{constructor(db,da=null){super();this.Jk=db;this.OFj=da}get type(){return this.Jk}get l8(){return this.OFj}}
Object(z.a)(R,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class W extends Sys.EventArgs{constructor(){super()}}Object(z.a)(W,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class Y extends Sys.EventArgs{constructor(db,da,Wa,mb,Tb,Da){super();this.pGc=db;this.Yof=da;this.L$j=Wa;this.yLh=Tb;this.Bmf=mb;this.zy=Da}}Object(z.a)(Y,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class N extends Sys.EventArgs{constructor(db){super();this.hubConnection=db}}Object(z.a)(N,"RefreshProxyEventArgs",
Sys.EventArgs,[]);class aa extends Sys.EventArgs{constructor(db,da){super();this.Fra=db;this.errorMessage=da}}Object(z.a)(aa,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class ia extends Sys.EventArgs{constructor(db,da,Wa){super();this.type=db;this.presence=da;this.ybc=Wa}}Object(z.a)(ia,"SendPersistentStateEventArgs",Sys.EventArgs,[]);class ea extends Sys.EventArgs{constructor(db,da,Wa,mb){super();this.type=db;this.l8=da;this.Imk=Wa;this.ybc=mb}}Object(z.a)(ea,"SendUpdateNotificationEventArgs",
Sys.EventArgs,[]);class la extends Sys.EventArgs{constructor(){super()}}Object(z.a)(la,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class xa extends Sys.EventArgs{constructor(db){super();this.L0d=db}}Object(z.a)(xa,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class Ha extends Sys.EventArgs{constructor(db,da){super();this.type=db;this.NUm=da}}Object(z.a)(Ha,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var ua=b(58);class Ra{constructor(){this.la=new ua.a}n5l(db,
da){this.la.raiseEvent("CSC",new S(db,da))}Y5l(db){this.la.raiseEvent("RP",new N(db))}Qqe(db){this.la.raiseEvent("RC",db)}b6l(){this.la.raiseEvent("RMID")}X5l(db,da,Wa,mb,Tb,Da){this.la.raiseEvent("RPS",new Y(db,da,Wa,mb,Tb,Da))}ADi(db,da){this.la.raiseEvent("UPSR",new Ha(db,da))}lDi(db,da){this.la.raiseEvent("PU",new M.a(db,da))}G5l(db){this.la.raiseEvent("MPU",new L(db))}Tig(db,da,Wa,mb){this.la.raiseEvent("SUN",new ea(db,da,Wa,mb))}m6l(db,da){this.la.raiseEvent("UNR",new R(db,da))}tDi(db,da,Wa){this.la.raiseEvent("SP",
new ia(db,da,Wa))}U5l(db,da){this.la.raiseEvent("PSU",new O.a(db,da))}T5l(db){this.la.raiseEvent("PSC",new I.a(db))}A5l(db){this.la.raiseEvent("IPSC",new I.a(db))}n6l(db){this.la.raiseEvent("UPSC",new xa(db))}c6l(db,da){this.la.raiseEvent("SPC",new la(db,da))}qDi(db,da){this.la.raiseEvent("RCF",new aa(db,da))}x5l(db){this.la.raiseEvent("CPSWM",new W(db))}fya(db){this.la.addHandler("CSC",db)}Nud(db){this.la.removeHandler("CSC",db)}xOj(db){this.la.addHandler("RP",db)}wOj(db){this.la.addHandler("RC",
db)}BOj(db){this.la.addHandler("RMID",db)}vOj(db){this.la.addHandler("RPS",db)}QOj(db){this.la.addHandler("UPSR",db)}FHa(db){this.la.addHandler("PU",db)}bgb(db){this.la.removeHandler("PU",db)}TMj(db){this.la.addHandler("IPU",db)}EOj(db){this.la.addHandler("SUN",db)}UMj(db){this.la.addHandler("IUNR",db)}j5(db){this.la.addHandler("UNR",db)}cBc(db){this.la.removeHandler("UNR",db)}aYd(db){this.la.addHandler("PSU",db)}ese(db){this.la.removeHandler("PSU",db)}SMj(db){this.la.addHandler("IPSU",db)}$Xd(db){this.la.addHandler("PSC",
db)}dse(db){this.la.removeHandler("PSC",db)}RMj(db){this.la.addHandler("IPSC",db)}POj(db){this.la.addHandler("UPSC",db)}DOj(db){this.la.addHandler("SP",db)}FOj(db){this.la.addHandler("SPC",db)}static getInstance(){return Ra.ta||(Ra.ta=new Ra)}}Ra.ta=null;Object(z.a)(Ra,"RtcEventHub",null,[1242]);var ab=b(109);class Ba{constructor(db){this.AYc=null;this.IZa=0;this.cqc=!1;this.Cm=db;this.Cm.fya(Object(c.a)(this,this.ama,"onConnectionStateChanged"))}ama(db,da){this.IZa=da.newState}FTl(){f.ULS.sendTraceTag(18637070,
500,15,"Too many undelivered messages. Restarting RTC connection.");this.Cm.Qqe()}rdl(db){this.AYc.init(db)}}Object(z.a)(Ba,"ARtcMessageHandler",null,[]);class Ga{constructor(){this.Presence=null;this.TimeStamp=0}}Object(z.a)(Ga,"PresenceDataEntryForClients",null,[]);var ja=b(65);class X{constructor(db,da=""){this.mBj=db;this.X3a=da}send(){return this.mBj()}get messageId(){return this.X3a}}Object(z.a)(X,"MessageHandler",null,[1255]);var fa=b(1316);class pa extends Sys.EventArgs{constructor(db,da,
Wa,mb){super();this.Xng=db;this.reconnectDelay=da;this.reason=Wa;this.Srg=mb}}Object(z.a)(pa,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);class Ia{constructor(){this.L7e=this.If=null}get eg(){return this.If?this.L7e?this.L7e.getTime()-this.If.getTime():(new Date).getTime()-this.If.getTime():0}start(){this.If=new Date}stop(){this.L7e=new Date}}Object(z.a)(Ia,"SimpleStopwatch",null,[]);var ta=b(1392),oa;(function(db){db[db.contentUpdate=0]="contentUpdate";db[db.editorsTableUpdate=1]="editorsTableUpdate";
db[db.fileNameUpdate=2]="fileNameUpdate";db[db.wetContentUpdate=3]="wetContentUpdate";db[db.persistedContentUpdate=4]="persistedContentUpdate";db[db.clientRtcReconnectRequest=5]="clientRtcReconnectRequest";db[db.replicationTelemetry=6]="replicationTelemetry";db[db.lockUpdate=7]="lockUpdate";db[db.collabServiceContentUpdate=8]="collabServiceContentUpdate";db[db.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";db[db.saveTargetUpdate=10]="saveTargetUpdate";db[db.uploadToOcsUpdate=11]="uploadToOcsUpdate";
db[db.labelUpdate=12]="labelUpdate";db[db.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";db[db.subscribeOrExtend=14]="subscribeOrExtend";db[db.elapsedBootTelemetry=15]="elapsedBootTelemetry";db[db.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";db[db.clientToClientResponseMessage=17]="clientToClientResponseMessage";db[db.verifyNotificationPipeline=18]="verifyNotificationPipeline";db[db.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";db[db.last=
20]="last"})(oa||(oa={}));Object(z.b)("UpdateNotificationType",oa);class va extends Ba{constructor(db,da,Wa,mb,Tb,Da,La,Ta,Sa,Hb){super(La);this.Xw=null;this.I2g=!1;this.X3a=0;this.L1e=new ab.a;this.Tc=db;this.a5g=this.$4g=0;this.AYc=da;this.AYc.bYd(Object(c.a)(this,this.FTl,"onTooManyUndeliveredMessages"));this._clientId=Wa;this.jzj=Tb;this.Cm.xOj(Object(c.a)(this,this.tRl,"onRefreshProxyRequired"));this.Cm.vOj(Object(c.a)(this,this.rRl,"onRefreshAllPersistentStateRequest"));this.Cm.EOj(Object(c.a)(this,
this.$Q,"sendUpdateNotification"));this.Cm.TMj(Object(c.a)(this,this.oPl,"onInternalPresenceUpdated"));this.Cm.UMj(Object(c.a)(this,this.pPl,"onInternalUpdateNotificationReceived"));this.Cm.SMj(Object(c.a)(this,this.nPl,"onInternalPersistentStateUpdated"));this.Cm.RMj(Object(c.a)(this,this.mPl,"onInternalPersistentStateCleared"));this.Cm.DOj(Object(c.a)(this,this.Gwd,"sendPersistentState"));this.Gc=Da;this.lw=mb;this.dv=Ta;this.PX=Sa;this.rOd=Hb}tRl(db,da){this.Xw=this.jzj(da.hubConnection);this.AYc.reset();
this.Xw.Uam(Object(c.a)(this,this.aO,"onPresenceUpdated"));this.Xw.Tam(Object(c.a)(this,this.o6b,"onPersistentStateUpdated"));this.Xw.Sam(Object(c.a)(this,this.Zxc,"onPersistentStateCleared"));this.Xw.nbm(Object(c.a)(this,this.m7,"onUpdateNotificationReceived"))}ama(db,da){this.IZa=da.newState;2===da.newState&&this.znm()}znm(){for(let db of this.L1e)this.$Q(null,new ea(db.key,db.value,!1,new n.a));this.L1e=new ab.a}rRl(db,da){da.Bmf();for(db=0;2>db;++db)this.fnm(db,da)}fnm(db,da){try{this.Xw.kGf(db).done(Wa=>
{da.pGc(da.Yof,"GetCompletePresenceSuccess")&&(da.L$j.USl(),f.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.lw),this.Cm.b6l(),this.UQl(db,Wa),this.Cm.x5l(Wa),da.yLh.Pa(db)&&this.Cm.tDi(db,da.yLh.J(db),new n.a))}).fail(Wa=>{const {RtcUtils:mb}=b(1117);da.pGc(da.Yof,"GetCompletePresenceFail")&&(f.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}]",mb.K5b(Wa),this.lw),this.Cm.Qqe())}).always(()=>{da.zy&&da.zy.stop()})}catch(Wa){f.ULS.sendTraceTag(595132428,
500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",da.Yof,Wa.message)}}Gwd(db,da){var {RtcUtils:Wa}=b(1117);db=da.presence;let mb;const Tb=da.ybc;this.PX.qQ(1,0);try{mb=Wa.Jlf(db,this.rOd)}catch(La){this.PX.qQ(1,3);f.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",La.message);Tb.setException(La);return}Wa=new x.a;Wa.W(this._clientId,
Object.assign(new Ga,{Presence:db,TimeStamp:(new Date).getTime()}));this.Cm.ADi(da.type,Wa);if(2!==this.IZa)this.dv.p8b(),this.PX.qQ(1,2),Tb.We(null);else{var Da=this.X3a.toString();++this.X3a;db=new X(()=>this.Bnm(da.type,mb,Da),Da);db=this.I_i(0,da.type).add(db);db.Ime(La=>{2===La&&this.PX.qQ(1,6);Tb.We(null)});db.Hme(()=>{})}}Bnm(db,da,Wa){let mb=null;const Tb=new Ia,Da=new fa.a;f.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.lw);if(2!==this.IZa)return this.dv.p8b(),
this.PX.qQ(1,2),f.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.lw),Da.e5f(),Da;this.Gc&&20>this.$4g&&(mb=this.Gc.le("WebServiceCall","Send Presence Message"),this.$4g++);Tb.start();Da.dnd(1);try{this.Xw.updatePersistentState(db,da).done(()=>{this.dv.Ojg();this.PX.qQ(1,1);f.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",Wa,this.lw);Da.Axb(1);Tb&&(Tb.stop(),Tb.eg>this.Tc.qLi?this.PX.qQ(1,4):this.PX.qQ(1,
5))}).fail(La=>{const {RtcUtils:Ta}=b(1117);this.cqc||(this.dv.p8b(),this.PX.qQ(1,3),f.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",Wa,Ta.K5b(La),this.lw));Da.Axb(2)}).always(()=>{mb&&mb.stop()})}catch(La){f.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",La.message),this.PX.qQ(1,3),Da.Axb(2)}return Da}$Q(db,da){({RtcUtils:db}=b(1117));const Wa=da.type,mb=da.l8,Tb=da.Imk,Da=da.ybc;
let La;this.PX.qQ(0,0);try{La=db.Jlf(mb,this.rOd)}catch(Sa){this.PX.qQ(0,3);f.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",Sa.message);Da.setException(Sa);return}if(2!==this.IZa)Tb?this.L1e.W(Wa,mb):(this.dv.p8b(),this.PX.qQ(0,2)),Da.We(null);else{var Ta=this.X3a.toString();++this.X3a;da=new X(()=>this.Znm(Wa,La,Ta),Ta);da=this.I_i(1,Wa).add(da);da.Ime(Sa=>{2===Sa&&this.PX.qQ(0,6);Da.We(null)});da.Hme(()=>{})}}Znm(db,da,Wa){let mb=
null;const Tb=new Ia,Da=new fa.a;f.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.lw);if(2!==this.IZa)return this.dv.p8b(),this.PX.qQ(0,2),f.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.lw),Da.e5f(),Da;this.Gc&&3===db&&20>this.a5g&&(mb=this.Gc.le("WebServiceCall","Send WetContent Update"),this.a5g++);Tb.start();Da.dnd(1);this.Xw.$Q(db,da).done(()=>{this.dv.Ojg();this.PX.qQ(0,1);f.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",
Wa,this.lw);Da.Axb(1);Tb&&(Tb.stop(),Tb.eg>this.Tc.qLi?this.PX.qQ(0,4):this.PX.qQ(0,5))}).fail(La=>{const {RtcUtils:Ta}=b(1117);this.cqc||(this.dv.p8b(),this.PX.qQ(0,3),f.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",Wa,Ta.K5b(La),this.lw));Da.Axb(2)}).always(()=>{mb&&mb.stop()});return Da}gba(){this.Xw.APm(Object(c.a)(this,this.aO,"onPresenceUpdated"));this.Xw.zPm(Object(c.a)(this,this.o6b,"onPersistentStateUpdated"));this.Xw.yPm(Object(c.a)(this,
this.Zxc,"onPersistentStateCleared"));this.Xw.FPm(Object(c.a)(this,this.m7,"onUpdateNotificationReceived"))}oPl(db,da){this.aO(da.Hva,da.y4d)}aO(db){this.dv.Ftd();this.o6b(0,db)}nPl(db,da){this.o6b(da.type,da.Hva)}UQl(db,da){const Wa={};for(let mb in da)Wa[mb]=da[mb].Presence;this.kvi(db,Wa,da)}o6b(db,da){this.dv.Ftd();this.kvi(db,da)}kvi(db,da,Wa=null){var {RtcUtils:mb}=b(1117);if(f.ULS.R2(500,100))for(var Tb in da);delete da[this._clientId];if(!ja.a.isEmpty(da)){for(var Da in da)Tb=Da,da[Tb]=mb.deserialize(da[Da],
"Presence",Tb,!1,this.rOd);mb=new x.a;Da=(new Date).getTime();for(let La in da){Tb=da[La];let Ta=La,Sa;Wa?(Sa=Wa[Ta],Sa.Presence=Tb):Sa=Object.assign(new Ga,{Presence:Tb,TimeStamp:Da});mb.W(Ta,Sa)}this.Cm.ADi(db,mb);db?this.Cm.U5l(db,da):(this.I2g||(f.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.lw),this.I2g=!0,y.AFrameworkApplication.Dg&&y.AFrameworkApplication.Dg.gDl()),this.Cm.lDi(da,[]))}}mPl(db,da){this.Zxc(da.L0d)}Zxc(db){this.dv.Ftd();if(f.ULS.R2(500,
100))for(let da=0;da<db.length;++da);db.length&&(this.Cm.n6l(db),this.Cm.T5l(db),this.Cm.lDi({},db))}pPl(db,da){this.m7(da.type,da.l8)}m7(db,da=null){this.Tc.Yxm&&!db&&f.ULS.sendTraceTag(40128990,500,100,"Received ContentUpdate notification from the server");this.Tc.Zxm&&13===db&&f.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",da||"<none>"));this.dv.Ftd();5===db?(da=(db=this.wXl(da))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",
db.reason,db.reconnectDelay):"Received client reconnection request from the server without params.",f.ULS.sendTraceTag(18637071,500,50,da),this.Cm.Qqe(db)):(da=b(1117).RtcUtils.deserialize(da,String.format("UpdateNotification-{0}",oa[db]),null,this.Tc.pBl,this.rOd),this.Cm.m6l(db,da))}wXl(db){try{if(!db||""===db)return null;const da=JSON.parse(db);return new pa(da[ta.a.xqg],da[ta.a.Mjm],da[ta.a.Pjm],da[ta.a.Srg])}catch(da){return f.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",
da.message),null}}I_i(db,da){return this.AYc.k2k(this.l2k(db,da))}l2k(db,da){return db+","+da}}Object(z.a)(va,"RtcMessageHandler",Ba,[]);class Fa{iCh(db,da=""){const {MaxOutstandingThrottler:Wa}=b(1389);return Wa.createInstance(db,da)}cgk(db,da=""){const {MaxRateThrottler:Wa}=b(1391);return Wa.createInstance(db,da)}}Object(z.a)(Fa,"ThrottlerFactory",null,[1241]);var cb=b(1393);class Za{constructor(db){this.Tc=null;this.Ce=!1;this.la=new ua.a;this.MYe=new x.a;this.JYe=new x.a;this.f9e=db;this.lgc=
this.f9e.iCh(da=>da.send(),"GlobalMaxOustandingThrottler");this.lgc.bYd(()=>{this.la.raiseEvent("TMUDM")})}init(db){this.Ce||(this.Tc=db,this.lgc.init(this.Tc.qCb,this.Tc.r5k),this.Ce=!0)}k2k(db){var {MaxRateThrottler:da}=b(1391),{MaxOutstandingThrottler:Wa}=b(1389);this.Ce||this.init(new cb.a(da.rEh,Wa.HEh,Wa.AEh,Za.oEl));({value:da}=this.MYe.xb(db)).returnValue||(({value:da}=this.JYe.xb(db)).returnValue||(da="MaxOutstandingThrottler-"+db,da=this.f9e.iCh(Object(c.a)(this.lgc,this.lgc.add,"add"),
da),da.init(this.Tc.qCb,this.Tc.nEl),da.bYd(()=>{this.la.raiseEvent("TMUDM")}),this.JYe.add(db,da)),Wa="MaxRateThrottler-"+db,da=this.f9e.cgk(Object(c.a)(da,da.add,"add"),Wa),da.init(this.Tc.OFl),this.MYe.add(db,da));return da}reset(){for(let db of this.MYe)db.value.Qjg();for(let db of this.JYe)db.value.Qjg(),db.value.reset();this.lgc.Qjg();this.lgc.reset()}bYd(db){this.la.addHandler("TMUDM",db)}}Za.oEl=1E3;Object(z.a)(Za,"ThrottlerManager",null,[1240]);var gb;(function(db){db[db.unspecified=0]="unspecified";
db[db.word=1]="word";db[db.excel=2]="excel";db[db.powerPoint=3]="powerPoint";db[db.test=4]="test";db[db.wacFrontEnd=5]="wacFrontEnd";db[db.oneNote=6]="oneNote";db[db.visio=7]="visio";db[db.officeMobile=8]="officeMobile";db[db.last=9]="last"})(gb||(gb={}));Object(z.b)("RtcClientAppName",gb);const Ya=(db,da,Wa,mb,Tb,Da,La,Ta,Sa=null,Hb=null,Oa=null,za=null)=>{const $a=K.createInstance(y.AFrameworkApplication.K),Xb=y.AFrameworkApplication.buildVersion?y.AFrameworkApplication.buildVersion:"1.0",Eb=fb(db,
da,La,Xb),ob=$a.b7j?b(1588).RealtimeChannelMetrics.createInstance(Eb):new F;var tb=b(1157).FrequentLoggingMetrics.create(Tb);$a.Rjm&&tb.$Em($a.Qjm);var yb="";yb=Sa&&""!==Sa?Sa:"/rtc2/";tb.fNh=t.a.e6(yb);const lb=yb+"signalr";Sa=yb+"findsession";const Cc=P.bbl;yb=new Fa;Oa=Oa||Ra.getInstance();f.ULS.shipAssertTag(556867617,500,$a.sLi<=b(1164).RealtimeChannel.Dni,"Client attempting to override max payload size beyond absolute limit");const Hc=Math.min($a.sLi,b(1164).RealtimeChannel.Dni);tb.Cni=Hc;tb=
new va($a,new Za(yb),db,Eb,Jc=>new G(Jc.createHubProxy(Cc)),Ta,Oa,ob,tb,Hc);Hb||(Hb=b(1431).FindSessionStrategy.createInstance(da,Tb,Sa,Ta,Xb,La,db,Eb,Oa,Da,mb,za));Hb.l7d=$a.l7d;da=new U(Eb);Wa=Wa?Wa.split(","):null;db=new (b(1164).RealtimeChannel)(db,Wa,Eb,Ta,()=>$.hubConnection(lb),Hb,tb,da,Oa,ob,$a,Tb);db.init();return db},fb=(db,da,Wa)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",db,ib(gb[Wa]),ib("browser"),da),ib=db=>db?db.charAt(0).toLocaleUpperCase()+db.substring(1,
db.length):db;b.d(H,"RealtimeChannel",function(){return hb});class hb{constructor(db,da,Wa,mb,Tb,Da,La,Ta,Sa,Hb,Oa,za){this.J7e=!1;this.Fba=null;this.I4=new x.a;this.XJc=1;this.Zha=null;this.Fi=!1;this.MWe=(new Date(0)).getTime();this.gch=0;this._clientId=db;this.GVd=da;this.Gba=0;this.Gc=mb;this.FKe=Ta;this.OAj=La;this.Sej=Sa;this.djj=Tb;this.Rjb=Da;this.lw=Wa;this.dv=Hb;this.Tc=Oa;this.Be=za;this.QCj=1>100*Math.random()}get yxb(){return this.Rjb.yxb}set yxb(db){this.Rjb.yxb=db}get mAb(){return this.OAj}get Cm(){return this.Sej}init(){this.Cm.wOj(Object(c.a)(this,
this.w4d,"disconnectAndCreateNewConnection"));this.Cm.QOj(Object(c.a)(this,this.WTl,"onUpdatePersistentStateRequestReceivedInternal"));this.Cm.POj(Object(c.a)(this,this.VTl,"onUpdatePersistentStateClearedRequestReceived"));this.Be.oOb(this.dv);y.AFrameworkApplication.qO(()=>{const {FrequentLoggingMetrics:db}=b(1157);this.dv.Rjg();db.instance&&db.instance.u3f()});this.qCh();this.Ook();this.Cm.FOj(Object(c.a)(this,this.aRm,"updateConnectionQueryString"))}Ook(){try{const Wa=$.signalR;if(!Wa)throw Error.invalidOperation("Failed to retrieve Signalr object");
const mb=Wa.version;if(!mb)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===mb){var db=Wa.transports;if(!db)throw Error.invalidOperation("Failed to retrieve transports object");var da=db.longPolling;if(!da)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!da.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");da.supportsKeepAlive=this.Uhk()}}catch(Wa){f.ULS.sendTraceTag(6432339,
500,15,"Failed to disable longPolling KeepAlives: {0}",Wa.message)}}Uhk(){return()=>!1}qCh(){const db=++this.XJc;this.MWe=(new Date(0)).getTime();this.Zha=this.djj();this.Cm.Y5l(this.Zha);this.Zha.stateChanged(da=>{this.VMl(da,db)});this.Zha.connectionSlow(Object(c.a)(this,this.OSl,"onSlowConnection"));this.Zha.error(Object(c.a)(this,this.ISl,"onSignalRError"));this.Zha.log=Object(c.a)(this,this.JSl,"onSignalRLog")}pGc(db,da){return db!==this.XJc?(f.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",
da),!1):!0}connect(){2!==this.Gba&&1!==this.Gba&&(f.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.lw),this.FKe.SMl(),A.a.instance.aFm(),this.ama(1,this.Gba),this.vXi())}vXi(){const db=this.XJc;this.J7e=!1;this.dv.mEi();this.Rjb.uZk(Object(c.a)(this,this.J$j,"connectSignalrConnection"),Object(c.a)(this,this.Kti,"onFailureToConnect"),Object(c.a)(this.mAb,this.mAb.rdl,"initThrottlerManager"),Object(c.a)(this,this.pGc,"verifyConnectionToken"),db)}Kti(db=null){this.dv.oEi();
let da=null;!db||"documentsessiondeleted"!==(da=db.toLowerCase())&&"documentsessionexpired"!==da?this.w4d():(f.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.lw,db),this.disconnect())}w4d(db,da=null){f.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.Fba);db=(db=2===this.Gba||1===this.Gba)&&!this.mAb.cqc;let Wa=!0,mb=0;da&&Object.getType(da)!==Object.getType(Sys.EventArgs.Empty)&&
da.Xng&&""!==da.Xng&&(db=!0,this.Rjb.Otm(da.Xng),Wa=da.Srg,mb=da.reconnectDelay);db&&this.ama(1,this.Gba);++this.XJc;this.mAb.gba();this.VFm(Wa);this.Rjb.Upk();this.qCh();db&&window.setTimeout(Object(c.a)(this,this.vXi,"startConnecting"),Math.min(mb,3E4))}aRm(){let db=null;const da=({correlationId:db}=this.Rjb.lUh()).returnValue;this.Zha.qs=da;f.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.lw,db)}J$j(db){const {FrequentLoggingMetrics:da}=
b(1157);this.MWe=(new Date).getTime();let Wa=null;this.Zha.qs=({correlationId:Wa}=this.Rjb.lUh()).returnValue;this.Tc.kQj&&(this.Zha.url=db,da.instance&&(da.instance.Pyh=t.a.e6(db)));let mb=null;this.Gc&&(mb=this.Gc.le("WebServiceCall","ConnectToServer"));f.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.lw);db={};this.GVd&&(db.transport=1===this.GVd.length?this.GVd[0]:this.GVd);db.pingInterval=null;A.a.instance.Etd(1,0);db.waitForPageLoad=!1;this.Zha.start(db,null).done(Tb=>
{this.dv.pEi();A.a.instance.Etd(1,1,!0);f.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",Tb.id,Wa)}).fail(Tb=>{const {RtcUtils:Da}=b(1117);f.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1}, callback parameter:{2} for [{3}]",this.Rjb.SY,Wa,Da.K5b(Tb),this.lw);this.Kti();this.dv.nEi(Tb);A.a.instance.Etd(1,1,!1);this.Cm.qDi(0,{["CorrelationId"]:Wa,["ErrorDetails"]:Tb,["ConnectionState"]:m.a[this.Gba]})}).always(()=>
{const {FrequentLoggingMetrics:Tb}=b(1157);mb&&mb.stop();Tb.instance&&(Tb.instance.BOe=!1)})}disconnect(){const {FrequentLoggingMetrics:db}=b(1157);this.Gba?(this.dv.tEi(),db.instance&&(db.instance.BOe=!0),f.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.lw),this.mAb.cqc=!0,this.FKe.ENl(),this.ama(0,this.Gba),this.w4d(),this.mAb.cqc=!1):f.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.lw)}VFm(db){const da=
this.v1j(),Wa=this.Zha,mb=this.Fba,Tb=()=>{if(this.J7e)f.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.J7e=!0,Wa.stop(!0,db)}catch(Da){f.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",Da.message)}};0<da?(f.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",mb,da),window.setTimeout(Tb,da)):(f.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",mb),Tb())}v1j(){let db=0;this.Zha.state||
(db=this.MWe+hb.rXm-(new Date).getTime(),0>db&&(db=0));return db}get connectionState(){return this.Gba}fya(db){this.Cm.fya(db)}Nud(db){this.Cm.Nud(db)}jOi(db){this.Gwd(0,db)}Gwd(db,da){const Wa=new n.a;this.Cm.tDi(db,da,Wa);return Wa.task}FHa(db){this.Cm.FHa(db)}bgb(db){this.Cm.bgb(db)}aYd(db){this.Cm.aYd(db)}ese(db){this.Cm.ese(db)}$Xd(db){this.Cm.$Xd(db)}dse(db){this.Cm.dse(db)}tsc(db){return this.I4.Pa(db)&&this.I4.J(db).Pa(0)?this.I4.J(db).J(0).data:null}Xrb(){return this.QEf(0)}QEf(db){const da=
{};for(let Wa of this.I4)Wa.value.Pa(db)&&(da[Wa.key]=Wa.value.J(db).data);return da}WTl(db,da){for(let Wa of da.NUm)this.I4.Pa(Wa.key)||this.I4.W(Wa.key,new ab.a),db=Wa.value,this.I4.J(Wa.key).W(da.type,new D(db.Presence,new Date(db.TimeStamp))),Wa.key!==this._clientId||da.type||this.Cm.G5l(db.Presence)}VTl(db,da){for(const Wa of da.L0d)this.I4.remove(Wa)}gGk(){const db=new ab.a;if(!this.I4.Pa(this._clientId))return db;for(let da of this.I4.J(this._clientId))db.W(da.key,da.value.data);return db}$Q(db,
da=null,Wa=!1){const mb=new n.a;this.Cm.Tig(db,da,Wa,mb);return mb.task}j5(db){this.Cm.j5(db)}cBc(db){this.Cm.cBc(db)}Psb(db){let da,Wa;return({value:da}=this.I4.xb(db)).returnValue&&({value:Wa}=da.xb(0)).returnValue?new v(this.L3k(Wa),Wa.timeStamp):null}fad(){const db={};for(let da of this.I4)da.value.xb(0).returnValue&&(db[da.key]=this.Psb(da.key));return db}get clientId(){return this._clientId}get tCm(){return this.QCj}dispose(){const {FrequentLoggingMetrics:db}=b(1157);this.Fi||(this.mAb.gba(),
this.Be.yud(this.dv),this.dv.Rjg(),db.instance&&db.instance.u3f(),this.Fi=!0)}VMl(db,da){this.pGc(da,"StateChangedSignalR")&&this.ama(this.mAh(db.newState),this.mAh(db.oldState))}ama(db,da){var {FrequentLoggingMetrics:Wa}=b(1157),{ClientToClientMessageTelemetry:mb}=b(1450);if((1!==this.Gba||da||1!==db)&&this.Gba!==da){const Tb=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.Gba,da,db]));f.ULS.sendTraceTag(3290053,
500,10,Tb)}if(this.Gba!==db){switch(db){case 2:Wa.instance&&Wa.instance.mDl();this.Fba=this.Zha.id;f.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.Fba,this.lw);this.iBl(this.Zha);f.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");Wa=null;this.Gc&&(Wa=this.Gc.le("WebServiceCall","Receive First Presence"));mb=this.XJc;this.Cm.X5l(Object(c.a)(this,this.pGc,"verifyConnectionToken"),mb,this.FKe,Object(c.a)(this,this.Bmf,"clearExistingPersistentState"),
this.gGk(),Wa);this.Tc.Njm&&(Wa=100*Math.random()<=this.Tc.Ojm,b(1450).ClientToClientMessageTelemetry.bVk(this.Cm,this.Tc,Wa).start());break;case 1:2===da&&f.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.Fba);break;case 0:if(mb.instance&&mb.instance.stop(),this.mAb.cqc)f.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.Fba);else{1===da&&(f.ULS.sendTraceTag(7672737,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",
this.Fba),this.dv.uEi());2===da&&f.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.Fba);this.w4d();return}}this.Gba=db;this.Cm.n5l(db,da)}}iBl(db){if(db&&db.transport&&db.transport.name){db=db.transport.name;var da=db.toLowerCase();"websockets"===da?f.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",db,this.lw):"serversentevents"===da?f.ULS.sendTraceTag(4290752,
500,50,"Transport name - {0} for [{1}]",db,this.lw):"foreverframe"===da?f.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",db,this.lw):"longpolling"===da?f.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",db,this.lw):"mocktransport"!==da&&f.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",db)}else f.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}OSl(){f.ULS.sendTraceTag(3249544,500,50,"Detected that the connection [{0}] is slow",
this.Fba)}ISl(db){const {RtcUtils:da}=b(1117);f.ULS.sendTraceTag(3249545,600,10,"SignalR ERROR for connection [{0}]: {1}",this.Fba,da.K5b(db)||"<empty>")}JSl(db){db=b(1117).RtcUtils.K5b(db);this.tCm&&2E3>this.gch&&!db.startsWith("Invok")&&!db.startsWith("Trigger")&&(f.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",db),this.gch++)}Bmf(){let db;const da=[];({value:db}=this.I4.xb(this._clientId)).returnValue&&this.I4.remove(this._clientId);for(let Wa of this.I4.keys)Array.add(da,Wa);for(const Wa of da)this.I4.remove(Wa);
db&&this.I4.W(this._clientId,db);this.Cm.A5l(da)}mAh(db){switch(db){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",db,"Unknown SignalR state");}}L3k(db){return db&&db.timeStamp?(new Date).getTime()-db.timeStamp.getTime()>(this.Tc.wVj?6E4:this.Tc.vVj)?2:1:1}static createInstance(db,da,Wa,mb,Tb,Da,La,Ta=null,Sa=null,Hb=null,Oa=null,za=null,$a=null){return Ya(db,da,Wa,$a,mb,Tb,Da,La,Ta,Sa,Hb,za,Oa)}}hb.Dni=31E3;hb.Aje=8E3;hb.rXm=15E3;Object(z.a)(hb,
"RealtimeChannel",null,[1215,1216])},1289:function(z,H,b){b.d(H,"a",function(){return f});z=b(0);class f{constructor(){this.ddh=!1;this.UKb=null;this.xRg=0;this.fPe=this.kDh();this.iHd=this.kDh();this.YEb=this.fgc=0;this.bG=()=>new Date}get GGm(){return this.ddh}kDh(){const c=Array(6);for(let n=0;n<c.length;n++)c[n]=0;return c}ZNk(){return this.fPe.toString()}ZJk(){return this.iHd.toString()}aFm(){this.UKb=this.bG()}Etd(c,n,m=!1){this.GGm||(m&&(this.ddh=!0),m=this.bG(),!c&&5<this.fgc||1===c&&5<this.YEb||
(this.xRg<c?(1===this.fgc%2&&(this.fPe[this.fgc]=-1,this.fgc++),this.xRg=c,1===n&&(this.iHd[this.YEb]=-1,this.YEb++),this.iHd[this.YEb]=this.RAg(m),this.YEb++):c?(this.iHd[this.YEb]=this.RAg(m),this.YEb++):(this.fPe[this.fgc]=this.RAg(m),this.fgc++)))}RAg(c){const n=c.getTime()-this.UKb.getTime();this.UKb=c;return n}static get instance(){f.ta||(f.ta=new f);return f.ta}static set instance(c){f.ta=c}}f.ta=null;Object(z.a)(f,"LatencyMetrics",null,[])},1316:function(z,H,b){z=b(0);class f{constructor(){this.YOg=
this.zKe=!1;this.callback=null}npd(n){this.callback=n;this.s1i()}dni(n){this.zKe||(this.zKe=!0,this.$ij=n,this.s1i())}s1i(){this.zKe&&this.callback&&!this.YOg&&(this.YOg=!0,this.callback(this.$ij))}}Object(z.a)(f,"CompletionTask",null,[]);b.d(H,"a",function(){return c});class c{constructor(){this.J3g=new f;this.I3g=new f}Ime(n){this.J3g.npd(n)}Hme(n){this.I3g.npd(n)}dnd(n){this.J3g.dni(n)}Axb(n){this.I3g.dni(n)}e5f(){this.dnd(2);this.Axb(2)}}Object(z.a)(c,"MessageStatus",null,[1254])},1388:function(z,
H,b){b.d(H,"a",function(){return f});z=b(0);var f;(function(c){c[c.disconnected=0]="disconnected";c[c.connecting=1]="connecting";c[c.connected=2]="connected"})(f||(f={}));Object(z.b)("ChannelConnectionState",f)},1389:function(z,H,b){b.r(H);b.d(H,"MaxOutstandingThrottler",function(){return m});z=b(0);var f=b(40),c=b(58);H=b(1390);var n=b(1316);class m extends H.a{constructor(x,y=""){super(x,y);this.Owc=this.qCb=0;this.la=new c.a;this.ehc=!1;this.lPd=this.IHd=this.jHd=this.e9e=0;this.Y4=[];this.clearTimeout=
m.Ouf}add(x){this.fhc||this.init(m.HEh,m.AEh);this.WMb++;const y=new n.a;this.Vuc?this.Ive(x,y):this.lPd<this.Owc?this.Ewd(x,y):(this.Ive(x,y),this.ehc=!1);return y}Ewd(x,y){x=this.Uah(x);const v=this.setTimeout(Object(f.a)(this,this.aQl,"onMessageWaitTimeExpired"),this.qCb);++this.lPd;Array.add(this.Y4,v);const t=this.jHd;x.Ime(A=>{y.dnd(A)});x.Hme(A=>{this.jHd===t&&(this.$Pl(t,v),y.Axb(A))})}$Pl(x,y){this.jHd===x&&(--this.lPd,this.clearTimeout(y),Array.remove(this.Y4,y),this.Vuc&&this.Snm())}Snm(){this.Vuc&&
!this.ehc&&(this.e9e=this.setTimeout(Object(f.a)(this,this.Tnm,"sendThrottledMessageFromTimer"),0),this.ehc=!0)}Tnm(){this.ehc=!1;if(this.Vuc){const x=this.gVd,y=this.Akc;this.g3c(!1);this.Ewd(x,y)}}aQl(){++this.IHd;this.IHd>Math.floor(this.Owc/2)&&(this.IHd=-1E9,this.la.raiseEvent("TMUDM"))}bYd(x){this.la.addHandler("TMUDM",x)}reset(){this.WMb=this.zYc=this.FLc=this.IHd=0;++this.jHd;for(const x of this.Y4)this.clearTimeout(x);this.lPd=0;this.Y4=[];this.g3c(!0);this.ehc&&(this.clearTimeout(this.e9e),
this.e9e=0,this.ehc=!1)}init(x,y){this.fhc||(this.qCb=x,this.Owc=y,this.fhc=!0)}static createInstance(x,y=""){return new m(x,y)}static Ouf(x){window.clearTimeout(x)}}m.HEh=15E3;m.AEh=5;Object(z.a)(m,"MaxOutstandingThrottler",H.a,[1251,1252])},1390:function(z,H,b){b.d(H,"a",function(){return c});z=b(0);var f=b(11);class c{constructor(n,m=""){this.FLc=this.zYc=0;this.BUe=!1;this.Akc=this.gVd=null;this.fhc=!1;this.Uah=n;this.J_i=m;this.setTimeout=c.Xuf;this.WMb=this.zYc=this.FLc=0}Qjg(){0<this.WMb&&
0<this.FLc&&f.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.J_i,this.FLc,this.WMb);0<this.WMb&&0<this.zYc&&f.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.J_i,this.zYc,this.WMb)}get Vuc(){return this.BUe}Ive(n,m){this.zYc++;this.g3c(!0);this.BUe=!0;this.gVd=n;this.Akc=m}g3c(n){this.BUe=!1;this.Akc&&n&&(this.FLc++,this.Akc.e5f());this.Akc=this.gVd=null}static Xuf(n,m){return window.setTimeout(n,m)}}Object(z.a)(c,
"ThrottlerBase",null,[])},1391:function(z,H,b){b.r(H);b.d(H,"MaxRateThrottler",function(){return n});z=b(0);var f=b(40);H=b(1390);var c=b(1316);class n extends H.a{constructor(m,x=""){super(m,x);this.Rwc=0;this.CQc=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(m){this.fhc||(this.Rwc=m,this.fhc=!0)}add(m){this.fhc||this.init(n.rEh);this.WMb++;const x=this.currentTime(),y=new c.a;this.CQc>x&&(this.CQc=x);this.Vuc?(this.g3c(!0),this.Ive(m,y)):this.CQc+this.Rwc<=x?this.Ewd(m,
y):(this.Ive(m,y),this.setTimeout(Object(f.a)(this,this.Rnm,"sendThrottledMessage"),this.CQc+this.Rwc-x));return y}Rnm(){if(this.Vuc){const m=this.gVd,x=this.Akc;this.g3c(!1);this.Ewd(m,x)}}Ewd(m,x){this.CQc=this.currentTime();m=this.Uah(m);m.Ime(y=>{x.dnd(y)});m.Hme(y=>{x.Axb(y)})}static createInstance(m,x=""){return new n(m,x)}}n.rEh=200;Object(z.a)(n,"MaxRateThrottler",H.a,[1253,1252])},1392:function(z,H,b){b.d(H,"a",function(){return f});z=b(0);class f{}f.xqg="rr";f.Pjm="rd";f.Mjm="rbp";f.Srg=
"sa";Object(z.a)(f,"RtcReconnectParams",null,[])},1393:function(z,H,b){b.d(H,"a",function(){return f});z=b(0);class f{constructor(c,n,m,x){this.OFl=c;this.qCb=n;this.nEl=m;this.r5k=x}}Object(z.a)(f,"ThrottlerManagerSettings",null,[])},1431:function(z,H,b){b.r(H);z=b(0);var f=b(11),c=b(40),n=b(74),m=b(1388);class x{}x.Rwc="throttling_messageDelay";x.Jjd="enabled";x.qCb="throttling_timeToWaitForResponse";x.Owc="throttling_maxNumberOfOutstandingMessages";x.z2h="throttling_globalMaxNumberOfOutstandingMessages";
x.errorMessage="errorMessage";x.mWi="url";x.INa="queryString";x.SY="connectionString";Object(z.a)(x,"RtcFindSessionOutputFieldNameConstants",null,[]);var y=b(2),v=b(44),t=b(32),A=b(256),D=b(1216),U=b(65),F=b(16),E=b(130);class P{constructor(){this.A2h=this.Ani=this.Bni=this.Gni=0;this.oge=!1;this.correlationId=this.SY=this.INa=this.Zof=this.errorMessage=null}get W9j(){return this.Zof+"?"+this.INa}}Object(z.a)(P,"FindSessionResponse",null,[]);var G=b(527);class K{constructor(aa,ia,ea,la,xa,Ha){this.Z4a=
null;const {FindSessionStrategy:ua}=b(1431);this.rzj=aa;aa=String.format("{0}={1}",G.a.clientId,F.a.nj(la));aa=String.format("{0}&{1}={2}",aa,G.a.userSessionId,F.a.nj(xa));aa=String.format("{0}&{1}={2}",aa,G.a.LIg,F.a.nj(ea.toString()));aa=String.format("{0}&{1}={2}",aa,G.a.userType,F.a.nj("1"));aa=String.format("{0}&{1}={2}",aa,G.a.VIg,F.a.nj(ia));aa=String.format("{0}&{1}={2}",aa,G.a.inf,F.a.nj(ua.c7j));(ia=K.gFf(ea,Ha))&&(aa=String.format("{0}&{1}",aa,ia));this.ejj=aa}jFi(){this.Z4a=this.rzj()}hEk(){this.Z4a&&
""!==this.Z4a||(this.jFi(),f.ULS.sendTraceTag(575784194,500,this.Z4a&&""!==this.Z4a?50:15,"Query signature delegate called for refresh returned: {0} ",this.Z4a));const aa=String.format("{0}={1}",G.a.wzb,F.a.nj(this.Z4a));return String.format("{0}&{1}",aa,this.ejj)}static gFf(aa,ia){return 4===aa?String.format("{0}={1}",G.a.f8f,"1"):ia?ia.O1h():null}}Object(z.a)(K,"FindSessionQueryStringGenerator",null,[]);var S=b(1157),L=b(1289),I=b(1117),O=b(1393);class M{}M.Wzk="FSType";Object(z.a)(M,"RtcFindSessionRequestHeaders",
null,[]);class R{}R.T6l="polling";Object(z.a)(R,"RtcFindSessionTypes",null,[]);var W=b(1392);class Y{}Y.BWm="RTC-TokenProofkey";Y.cul="RTC-IsWacJsBootFsRequest";Object(z.a)(Y,"RtcRequestHeaders",null,[]);b.d(H,"FindSessionStrategy",function(){return N});class N{constructor(aa,ia,ea,la,xa,Ha,ua,Ra,ab,Ba,Ga,ja,X=null){this.p1g=(new Date(0)).getTime();this.T2g=0;this.kOd=!1;this.ebh=null;this.okg=36E5;this.Nec=N.b8h;this.jMc=0;this.m9b=null;this.IZa=0;this.QBc=this.Ryh=null;this.sAj=[x.Jjd,x.errorMessage,
x.mWi,x.SY,x.INa,x.z2h,x.Owc,x.qCb,x.Rwc];this.rAj=[x.Jjd,x.errorMessage];this.SY=this.yxb=null;this.mVg=new K(Ga?Ga:()=>y.AFrameworkApplication.yk,xa,Ha,ua,aa,ia);this.iJc=ja;this.Gc=la;this.Be=ia;this.jPe=ea;this.lw=Ra;this.Cm=ab;this.LMc=X;this.nVg=!1;this.l7d=9E4;Ba&&Ba.execute(fa=>{fa.FTa(()=>{f.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.lw);this.mVg.jFi()})});2>=100*Math.random()&&(this.okg=3E5);S.FrequentLoggingMetrics.instance&&(S.FrequentLoggingMetrics.instance.rPh=
this.okg)}Otm(aa){this.QBc=aa}init(){this.Cm.BOj(Object(c.a)(this,this.qhm,"resetGetMachineIdDelay"));this.Cm.fya(Object(c.a)(this,this.ama,"onConnectionStateChanged"))}ama(aa,ia){this.IZa=ia.newState;2===ia.newState&&(this.jMc=0)}lUh(){let aa;aa=this.m9b.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.m9b.INa,N.QAh,F.a.nj(aa)),correlationId:aa}}uZk(aa,ia,ea,la,xa){this.dnm(()=>{la(xa,"GetMachineIdSuccess")&&(f.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",
this.SY,this.lw),aa(this.ebh),ea(this.m2k()))},Ha=>{la(xa,"GetMachineIdFailure")&&(f.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.lw),ia(Ha))},la,xa)}Upk(){this.ewh();this.scl()}dnm(aa,ia,ea,la){f.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.SY);if(this.SY)aa();else{var xa=this.W0j();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(aa,ia,ea,la)},xa)}}sendFindSessionRequestToServerInternal(aa,
ia,ea,la){ea(la,"RequestMachineId")&&(this.p1g=(new Date).getTime(),ea=t.a.af(),this.N9d(xa=>{const Ha=t.a.af();this.Kyi(xa);this.qug();aa();xa=t.a.af()-Ha;f.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",xa)},xa=>{const Ha=t.a.af();this.ewh();S.FrequentLoggingMetrics.instance&&S.FrequentLoggingMetrics.instance.qQ(2,3);ia(xa);xa=t.a.af()-Ha;f.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",xa)},!1),ea=t.a.af()-ea,f.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",
ea))}scl(){this.Nec+=N.HSk;this.Nec=Math.min(this.Nec,N.aEl)}W0j(){var aa=(new Date).getTime();aa=this.p1g+this.Nec-aa;0>aa&&(aa=0);return aa}Kyi(aa){try{this.m9b=aa,this.yxb=aa.W9j,this.SY=aa.SY,this.Ryh=aa.INa,this.ebh=aa.Zof}catch(ia){f.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",ia.toString())}}ewh(){this.SY=null;this.fwh()}qug(){this.fwh();this.kOd=!0;this.T2g=window.setTimeout(Object(c.a)(this,this.H9l,"refreshMachineId"),this.okg)}fwh(){this.kOd&&
(window.clearTimeout(this.T2g),this.kOd=!1)}H9l(){this.kOd=!1;this.N9d(aa=>{const ia=this.Ryh!==aa.INa,ea=this.SY!==aa.SY,la=this.SY;this.Kyi(aa);this.IZa&&(ea?(f.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",la||"null",aa.SY),this.Cm.Qqe()):(this.Cm.c6l(ia,ea),this.qug()))},()=>{S.FrequentLoggingMetrics.instance&&S.FrequentLoggingMetrics.instance.qQ(2,3);this.qug()},!0)}qhm(){this.Nec=N.b8h}m2k(){return new O.a(this.m9b.Gni,this.m9b.Bni,
this.m9b.Ani,this.m9b.A2h)}dMm(aa){if(Object.getType(aa)!==Object)return null;for(let ia in aa);return this.Kek(aa)}Kek(aa){if(!(x.Jjd in aa))return null;const ia=aa[x.Jjd];var ea=ia?this.sAj:this.rAj;for(const la of ea)if(!(la in aa))return null;ea=Object.assign(new P,{oge:aa[x.Jjd],errorMessage:aa[x.errorMessage],correlationId:E.a.create().toString()});ia&&(ea.Zof=aa[x.mWi],ea.INa=aa[x.INa],ea.SY=aa[x.SY],ea.A2h=aa[x.z2h],ea.Ani=aa[x.Owc],ea.Bni=aa[x.qCb],ea.Gni=aa[x.Rwc]);return ea}$Nk(aa,ia){f.ULS.sendTraceTag(50448152,
500,50,"Using FindSessionUtils find session response");this.LMc.gNh.continueWith(()=>{this.LMc.gNh.result?(f.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),aa(this.LMc.hNh)):(f.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),ia(this.LMc.hNh))})}qJi(aa,ia,ea,la,xa=!1){return Ha=>{L.a.instance.Etd(0,1);aa&&aa.stop();this.iJc=this.QBc=null;this.tli(Ha.data,!0,ia);var ua=I.RtcUtils.deserialize(Ha.data.od,"FindSession",null,!0);
if(ua)if(ua=this.dMm(ua)){if(ua.oge&&ua.INa&&ua.SY){f.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.lw);this.czl(Ha.data);ea(ua);return}ia.FindSessionFailureReason="FindSessionInvalidResponse";ia.IsRtcEnabled=ua.oge;ia.IsQueryStringEmpty=!ua.INa;ia.IsConnectionStringEmpty=!ua.SY;f.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",
this.lw,ua.oge,!ua.INa,!ua.SY)}else ia.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",f.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.lw);else ia.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",f.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.lw);this.rDi(ia,xa);la(null)}}mJi(aa,ia,ea,la=!1){return xa=>{L.a.instance.Etd(0,1);aa&&aa.stop();this.iJc=this.QBc=
null;this.tli(xa.data,!1,ia);let Ha=null;var ua="unknown";let Ra="unknown";xa.data&&((ua=xa.data.Dk)&&N.Zvd in ua&&(Ha=ua[N.Zvd].toString()),ua=D.a[xa.data.status],Ra=xa.data.ff.toString());ia.FindSessionFailureReason="FindSessionRequestFailed";ia.HttpErrorCode=Ra;ia.HttpErrorStatus=ua;ia[N.Zvd]=Ha;f.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",ua,Ra,this.lw,Ha,la);this.rDi(ia,la);ea(Ra)}}N9d(aa,
ia,ea=!1){let la=null;f.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.lw);const xa={};var Ha=this.mVg.hEk();xa[A.a.Vda]=E.a.create().toString();this.QBc&&""!==this.QBc?Ha=String.format("{0}&{1}={2}",Ha,W.a.xqg,this.QBc):this.iJc&&""!==this.iJc&&(Ha=String.format("{0}&{1}={2}",Ha,W.a.xqg,this.iJc),xa[Y.BWm]="True",xa[Y.cul]="True");Ha=this.jPe+"?"+Ha;ea&&(xa[M.Wzk]=R.T6l);const ua={};ua.IsNetworkOfflineBeforeSendRequest=this.Be.WZb;ua.HasAvailableConnectionsBeforeSendRequest=
this.Be.Bsc;ua.MaxConnectionsAllowed=this.Be.PXa;ua.IsRefreshMachineId=ea;this.LMc&&!this.nVg?(this.$Nk(this.qJi(null,ua,aa,ia,ea),this.mJi(null,ua,ia,ea)),this.nVg=!0):(this.Gc&&(la=this.Gc.le("WebServiceCall","GetMachineIdFromTheServer")),S.FrequentLoggingMetrics.instance&&S.FrequentLoggingMetrics.instance.qQ(2,0),0>this.Be.xlc(Ha,1,null,xa,[N.u2d,N.Zvd,N.Qod,N.wqg,N.Opi,N.Sri,N.Rri],1,this.qJi(la,ua,aa,ia,ea),this.mJi(la,ua,ia,ea),null,!1,null,this.l7d,"3",null,!0)&&(5<this.jMc&&200>this.jMc&&
f.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.jMc),window.setTimeout(()=>{this.jMc++;ia("-1")},1E3)))}tli(aa,ia,ea){ea||(ea={});ea.IsNetworkOfflineAfterRequestComplete=this.Be.WZb;ea.IsRequestSucceeded=ia;aa&&(ea.EnqueueTime=aa.X9a,ea.InvokedTime=aa.lG,ea.CompletedTime=aa.uS,aa.Dk&&(N.u2d in aa.Dk&&(ea.CorrelationId=aa.Dk[N.u2d]),N.Qod in aa.Dk&&(ea[N.Qod]=aa.Dk[N.Qod])));f.ULS.sendTraceTag(38633565,
500,ia?50:15,I.RtcUtils.K5b(ea))}rDi(aa,ia){aa||(aa={});aa.ConnectionState=m.a[this.IZa];ia||this.Cm.qDi(1,aa)}czl(aa){try{var ia=!1,ea=!1,la=aa.Dk,xa=v.a.e6(aa.request.get_url());if(la&&N.wqg in la){const Ba=la[N.wqg].toString().toLocaleLowerCase();ea="true"===Ba;ia="false"===Ba}la=!1;const ab=0<=xa.toLocaleLowerCase().indexOf("collab");ea&&!ab?la=!0:ia&&ab&&(la=!0);if(la){ia={};ia.HostName=xa;ia.Status=D.a[aa.status];ia.HttpStatus=aa.ff.toString();var Ha=aa.request.get_headers();for(let Ba in Ha){var ua=
Ha[Ba];(xa=Ba)&&0<xa.length&&(ea=0,ua&&(ea=ua.toString().length),ia["r_"+xa]=ea)}if(aa.Dk){const Ba=new n.a;Ba.add(N.u2d);Ba.add(N.Qod);Ba.add(N.Zvd);Ba.add(N.Sri);Ba.add(N.Rri);Ba.add(N.Opi);N.eLj(ia,aa.Dk,Ba)}N.SKj(aa.request.get_url(),ia);var Ra=U.a.toJSON(ia);f.ULS.sendTraceTag(559437006,500,15,Ra)}}catch(ab){f.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",ab.toString())}}static createInstance(aa,ia,ea,la,xa,Ha,ua,Ra,ab,Ba,Ga,ja=null){return N.Afk(aa,ia,ea,la,xa,Ha,
ua,Ra,ab,Ba,Ga,ja)}static Afk(aa,ia,ea,la,xa,Ha,ua,Ra,ab,Ba,Ga,ja=null){aa=aa||E.a.create().toString();aa=new N(aa,ia,ea,la,xa,Ha,ua,Ra,ab,Ba,null,Ga,ja);aa.init();return aa}static eLj(aa,ia,ea){for(let la of ea)la in ia&&(aa[la]=ia[la])}static SKj(aa,ia){if(aa){var ea=aa.indexOf("?");if(-1!==ea)for(aa=aa.substr(ea+1).split("&"),ea=0;ea<aa.length;++ea){var la=aa[ea].split("=");if(2===la.length){const xa=la[0];if(xa&&0<xa.length){let Ha=0;if(la=la[1])Ha=la.length;ia["q_"+xa]=Ha}}}}}}N.HSk=3E3;N.aEl=
3E5;N.c7j="1.0";N.b8h=1E3;N.u2d="X-CorrelationId";N.QAh="corrid";N.Zvd="RtcErrorCode";N.Qod="X-OfficeCluster";N.wqg="X-NewEnv";N.Opi="X-MSEdge-Ref";N.Rri="X-OFFICEFD";N.Sri="X-OfficeFE";Object(z.a)(N,"FindSessionStrategy",null,[1238])},1450:function(z,H,b){b.r(H);z=b(0);var f=b(11),c=b(40),n=b(410),m=b(48),x=b(74);class y{constructor(t){this.messageId=t;this.Unm=(new Date).getTime();this.p1f=new x.a}}Object(z.a)(y,"MessageLatencyDetails",null,[]);b.d(H,"ClientToClientMessageTelemetry",function(){return v});
class v{constructor(t,A,D){this.XRa=null;this.uYe=this.$5e=0;this.Tc=A;this.K3g=D;this.NWc=!1;this.Cm=t;this.Cm.j5(Object(c.a)(this,this.k7l,"receiveMessage"))}start(){if(this.K3g&&!this.NWc){const t=this.Tc.vLi;this.uYe=this.Tc.rLi;t<=this.uYe?(f.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.Tc.vLi,this.Tc.rLi),this.K3g=!1):
(this.NWc=!0,this.$5e=window.setInterval(Object(c.a)(this,this.Yg,"sendMessage"),t))}}Yg(){if(this.NWc){const t=m.a.create().toString();this.XRa=new y(t);this.Cm.Tig(16,t,!1,new n.a);window.setTimeout(()=>{this.pAl(t)},this.uYe)}}pAl(t){this.XRa&&this.XRa.messageId===t&&(0<this.XRa.p1f.count?(t=this.XRa.p1f.toArray().join(","),f.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",t)):f.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.XRa=null)}stop(){this.$5e&&
(window.clearInterval(this.$5e),this.NWc=!1)}k7l(t,A){16===A.type?this.Cm.Tig(17,A.l8,!1,new n.a):17===A.type&&this.NWc&&A.l8&&this.c2l(A.l8)}c2l(t){t&&this.XRa&&t.toString()===this.XRa.messageId&&(t=(new Date).getTime()-this.XRa.Unm,this.XRa.p1f.add(t))}static get instance(){return v.ta}static bVk(t,A,D){return v.instance||(v.ta=new v(t,A,D))}}v.ta=null;Object(z.a)(v,"ClientToClientMessageTelemetry",null,[])},1587:function(z,H,b){b.d(H,"a",function(){return f});z=b(0);class f extends Sys.EventArgs{constructor(c,
n){super();this.Hva=c;this.y4d=n}}Object(z.a)(f,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1588:function(z,H,b){b.r(H);b.d(H,"RealtimeChannelMetrics",function(){return x});z=b(0);var f=b(11),c=b(152),n=b(65),m=b(1117);class x{constructor(){this.k5g=this.l5g=this.m5g=this.g5g=this.f5g=this.h5g=this.OSc=this.e_e=0;this.QJd=this.jXe=this.HQc=this.YWe=this.ZWe=this.LWe=this.emb=this.pQc=this.phc=this.KWe=this.OJd=this.Tfc=null;this.FYe=this.RRc=this.cbh=this.NPg=0;this.L3g=!1;this.mEi=this.zjg;this.pEi=
this.Cjg;this.oEi=this.Bjg;this.uEi=this.Ijg;this.tEi=this.Hjg;this.Rjg=this.Sjg;this.Ojg=this.Pjg;this.p8b=this.Mjg;this.Ftd=this.Njg;this.nEi=this.Ajg;this.YAa=this.I7f;this.WXa=this.J7f}zjg(){this.e_e++;this.KWe=new Date;this.Tfc||(this.Tfc=new Date)}Cjg(){this.OSc++;this.emb=new Date;this.OJd||(this.OJd=this.emb);this.HQc=this.emb;this.n$j()}Bjg(){this.h5g++;this.LWe=new Date}Ijg(){this.f5g++;this.phc=new Date}Hjg(){this.g5g++;this.pQc=new Date}Pjg(){this.ZWe=new Date;this.m5g++}Njg(){this.QJd||
(this.QJd=new Date);this.l5g++}Mjg(){this.YWe=new Date;this.k5g++}Sjg(){!this.L3g&&this.e_e&&(f.ULS.sendTraceTag(39321871,500,15,n.a.toJSON(this.n8j())),this.L3g=!0)}Ajg(y){let v,t;({G6h:y,H6h:v,exception:t}=m.RtcUtils.Twk(y));y&&y!==c.a.Kw&&(f.ULS.sendTraceTag(40157596,500,15,n.a.toJSON({["HttpErrorCode"]:y,["HttpErrorStatus"]:v,["Exception"]:t})),c.a.Thd(y)&&this.NPg++,c.a.n_f(y)&&this.cbh++)}I7f(){this.jXe=new Date}J7f(){this.phc=this.HQc=new Date}n8j(){return{["numberOfConnectionAttempts"]:this.e_e,
["numberOfSuccessfulConnections"]:this.OSc,["numberOfFailedConnections"]:this.h5g,["numberOfDisconnectedConnections"]:this.f5g,["numberOfExplicitDisconnectedConnections"]:this.g5g,["numberOfSentMessages"]:this.m5g,["numberOfReceivedMessages"]:this.l5g,["numberOfLostMessages"]:this.k5g,["firstConnectionAttempt"]:this.Tfc?this.Tfc:null,["firstMessageReceived"]:this.QJd?this.QJd:null,["firstConnectionSuccess"]:this.OJd?this.OJd:null,["lastConnectionAttempt"]:this.KWe?this.KWe:null,["lastConnectionSuccess"]:this.emb?
this.emb:null,["lastConnectionFailure"]:this.LWe?this.LWe:null,["lastMessageSent"]:this.ZWe?this.ZWe:null,["lastMessageLost"]:this.YWe?this.YWe:null,["lastDisconnect"]:this.phc?this.phc:null,["lastExplicitDisconnect"]:this.pQc?this.pQc:null,["lastTimeOnline"]:this.HQc?this.HQc:null,["lastTimeOffline"]:this.jXe?this.jXe:null,["maxDisconnectedTimeMs"]:this.RRc,["maxExplicitDisconnectedTimeMs"]:this.FYe,["clientConnectionErrors"]:this.NPg,["serverConnectionErrors"]:this.cbh}}n$j(){this.Tfc&&1===this.OSc&&
(this.RRc=Math.max(this.RRc,this.emb.getTime()-this.Tfc.getTime()));this.phc&&1<this.OSc&&(this.RRc=Math.max(this.RRc,this.emb.getTime()-this.phc.getTime()));this.pQc&&1<this.OSc&&(this.FYe=Math.max(this.FYe,this.emb.getTime()-this.pQc.getTime()))}static createInstance(y){x.ta||(x.ta=new x,f.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",y));return x.ta}}x.ta=null;Object(z.a)(x,"RealtimeChannelMetrics",null,[1239,156])},1589:function(z,H,b){b.d(H,"a",function(){return f});
z=b(0);class f extends Sys.EventArgs{constructor(c,n){super();this.type=c;this.Hva=n}}Object(z.a)(f,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1590:function(z,H,b){b.d(H,"a",function(){return f});z=b(0);class f extends Sys.EventArgs{constructor(c){super();this.L0d=c}}Object(z.a)(f,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},1718:function(z,H,b){b.r(H);var f=b(0),c=b(40);class n{constructor(Ja,sb){this.txa=null;this.d8g=Ja;this.wyj=sb}init(){this.d8g.continueWith(()=>{this.txa=this.d8g.result;
this.txa.P_c(Object(c.a)(this,this.qga,"onUsersUpdated"))})}qga(){n.Vgf(this.txa.Yrb())&&(this.txa.eng(Object(c.a)(this,this.qga,"onUsersUpdated")),this.wyj.IsRealCoauthSession=!0)}get xei(){return this.txa?n.Vgf(this.txa.Yrb()):!1}static Vgf(Ja){let sb=null;for(const Yb of Ja)if(Yb)if(Ja=Yb.isAnonymous||!Yb.email?Yb.clientId:Yb.email.toUpperCase(),!sb)sb=Ja;else if(sb!==Ja)return!0;return!1}}Object(f.a)(n,"CoauthTelemetry",null,[179]);var m=b(11),x=b(410),y=b(55),v=b(2),t;(function(Ja){Ja[Ja.badStatePreventedTelemetry=
0]="badStatePreventedTelemetry";Ja[Ja.notImplemented=1]="notImplemented";Ja[Ja.renderHandled=2]="renderHandled";Ja[Ja.renderHandledWithVeto=3]="renderHandledWithVeto"})(t||(t={}));Object(f.b)("CoauthorGalleryTelemetryEndResult",t);var A=b(78),D=b(65),U=b(107);class F{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa){this.e8g=this.dQg=this.cD=null;this.u8=Ja;this.aUd=new x.a;this.ra=Yb;this.kKe=sb;this.yI=vc;this.tf=$c;this.O1e=Md;this.$mb=Re;this.igj=Qf;this.vXg=this.oXg=!1;this.jVd=0;this.bQg=1;this.nEb=Xa;
this.vob=this.ra.$("PeoplesWellExtraButtonInfoIsEnabled");this.$Ca=Object(y.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get RXi(){return this.aUd.task}init(){U.Task.WAA.call(null,this.$mb,this.kKe,this.O1e).continueWith(()=>{this.cD=this.$mb.result;this.dQg=this.kKe.result;this.e8g=this.O1e.result;U.Task.WAA.call(null,this.kKe.result.u8a,this.O1e.result.N_i).continueWith(()=>{this.bQg=this.dQg.u8a.result;this.jVd=this.e8g.N_i.result;this.cD.P_c(Object(c.a)(this,this.Ane,
"onUsersUpdatedEventListener"));this.cD.Yrb().length&&this.qga()})})}Ane(){this.qga()}qga(){this.igj(this.cD.Yrb())?(this.cD.eng(Object(c.a)(this,this.Ane,"onUsersUpdatedEventListener")),this.jOl(this.oXg)):this.aUd.yO(1);this.oXg=!0}jOl(Ja){this.vXg?this.RXi.continueWith(()=>{m.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",t[this.RXi.result])}):(this.vXg=!0,this.L2l(!this.bQg&&!Ja))}L2l(Ja){Ja?this.yI.Lk(4,Object(c.a)(this,this.bag,"onInteractiveReady")):
this.aUd.yO(1)}bag(){const Ja=this.tf.JL("AppInitStatus_interactivityReady");m.ULS.shipAssertTag(42259235,325,!!this.jVd);const sb=this.jVd-Ja,Yb={};Yb.InteractiveTime=Ja;Yb.ReactRenderComplete=this.jVd;Yb.HadTabSwitch=this.nEb();Yb.IsModernGallery=this.vob;m.ULS.sendTraceTag(594883104,325,50,D.a.toJSON(Yb));this.vob?(m.ULS.sendTraceTag(42062997,325,15,sb.toString()),this.aUd.yO(this.MWm(sb)?3:2)):m.ULS.sendTraceTag(594883103,325,15,sb.toString())}MWm(Ja){const sb=Ja>this.ra.zb("CoauthorGalleryTimeToRenderDurationMs",
1E4),Yb="Word"===this.$Ca;if(this.nEb())return m.ULS.sendTraceTag(50455714,325,50,sb.toString()),!1;Yb&&A.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);sb&&(Yb?A.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null):A.Health.instance.recordQosError("CoauthorGalleryTimeToRenderDurationIsTooLong",["CoauthGalleryExperienceDegraded"],!1,!0,!0,!1,null),m.ULS.sendTraceTag(42062998,325,15,Ja.toString()));
return sb}}Object(f.a)(F,"CoauthorGalleryTelemetry",null,[178]);class E{constructor(Ja){this.cD=null;this.WGd={};this.CQd={};this.DOc=null;this.$mb=Ja}mae(Ja){const sb=new x.a;this.init().continueWith(()=>{Ja in this.WGd?sb.yO(this.WGd[Ja]):this.CQd[Ja]=sb});return sb.task}init(){if(this.DOc)return this.DOc.task;this.DOc=new x.a;this.$mb.continueWith(()=>{this.cD=this.$mb.result;this.cD.P_c(Object(c.a)(this,this.qga,"onUsersUpdated"));this.f6i();this.DOc.We(null)});return this.DOc.task}f6i(){const Ja=
this.cD.Yrb();Ja.sort(Object(c.a)(this,this.R9j,"comparePresenceUsers"));this.WGd={};for(let sb=0;sb<Ja.length&&Ja[sb]&&Ja[sb].uXa;sb++)this.KKj(this.WGd,Ja[sb].clientId,sb)}KKj(Ja,sb,Yb){Ja[sb]=Yb;sb in this.CQd&&(this.CQd[sb].yO(Yb),delete this.CQd[sb])}qga(){this.f6i()}R9j(Ja,sb){return Ja.uXa>sb.uXa?1:Ja.uXa<sb.uXa?-1:0}}Object(f.a)(E,"CoauthorPositionFinder",null,[177]);var P=b(74),G=b(195);class K{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(f.a)(K,
"PL",null,[]);var S=b(31);class L{constructor(){this.ct=this.vt=this.d=0}static wOi(Ja,sb,Yb){const vc=new L;vc.d=Ja;vc.vt=sb;vc.ct=Yb;return S.c(vc)}}Object(f.a)(L,"VD",null,[]);var I=b(202);class O{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa){this.If=0;this.kbh=!1;this._id=Ja;this.Ich=sb;this.ym=Yb;this.sZe=vc;this.b9e=$c;this.wNb=Md;this.EFb=Re;this.ZJe=Qf;this.nEb=Xa;this.$Ca=Object(y.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||""}JBe(Ja){U.Task.WAA(this.Ich,this.sZe,this.b9e).continueWith(()=>
{if(this.sZe.result<=this.b9e.result)Ja.yO(!1);else{this.If=this.Ich.result;var sb=this.ym-this.If,Yb=new K;Yb.id=this._id;Yb.et=this.ym;Yb.st=this.If;Yb.d=this.ym-this.If;Yb.mp=this.sZe.result;Yb.tp=this.b9e.result;Yb.ct=this.qJk(this.ZJe);Yb.vc=this.nEb();var vc=S.c(Yb),$c="Word"===this.$Ca;m.ULS.sendTraceTag(42078597,302,15,vc);if($c){const Md=new Map;Md.set("data",vc);A.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",Md)}sb>this.wNb.value&&!this.kbh&&!Yb.vc&&(this.kbh=
!0,Ja.yO(!0),Yb=Object.assign(new I.a,{extendedProperties:new Map}),Yb.extendedProperties.set("data",vc),$c?A.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,Yb):A.Health.instance.recordQosError("PresenceRenderDurationIsTooLong",["PresenceExperienceDegraded"],!1,!0,!1,!1,Yb),sb<this.EFb.value&&m.ULS.sendTraceTag(42078598,302,15,L.wOi(sb,this.wNb.value,this.EFb.value)));Ja.task.isCompleted||Ja.yO(!1)}})}qJk(Ja){switch(Ja){case 2:return"NonWac";
case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(f.a)(O,"PresenceLatencyActivityLogger",null,[]);class M{constructor(Ja,sb,Yb){this.kPg=this.aQg=this.CGd=this.VGd=this.Bdc=0;this._id=Ja;this.wNb=sb;this.EFb=Yb;this.$Ca=Object(y.a)(String,v.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get Blh(){return this.Bdc}set Blh(Ja){this.Bdc=Ja;this.Flf()}get dxh(){return this.VGd}set dxh(Ja){this.VGd=Ja;this.Flf()}get cuh(){return this.CGd}set cuh(Ja){this.CGd=Ja;
this.Flf()}get exh(){return!!this.aQg}get duh(){return!!this.kPg}Flf(){!this.exh&&this.Bdc&&this.VGd&&(this.aQg=this.JBe(this.VGd,"CoauthGalleryLightupDurationTooLong"));!this.duh&&this.Bdc&&this.CGd&&(this.kPg=this.JBe(this.CGd,"CanvasPresenceLightupDurationTooLong"))}JBe(Ja,sb){const Yb=Ja-this.Bdc;var vc=new K;vc.id=this._id;vc.et=Ja;vc.st=this.Bdc;vc.d=Yb;var $c=S.c(vc);Ja="Word"===this.$Ca;vc="CanvasPresenceLightupDurationTooLong"===sb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";
"CanvasPresenceLightupDurationTooLong"===sb?m.ULS.sendTraceTag(572289499,302,15,$c):m.ULS.sendTraceTag(571524118,302,15,$c);if(Ja){var Md=new Map;Md.set("data",$c);A.Health.instance.recordKpiUsage(vc,0,"wordcollabrel",Md)}return Yb>this.wNb.value?(Md=Object.assign(new I.a,{extendedProperties:new Map}),Md.extendedProperties.set("data",$c),$c=Yb<this.EFb.value,Md.extendedProperties.set("cash",$c?"true":"false"),Ja?A.Health.instance.recordKpiFailure(vc,sb,!1,!0,Md):A.Health.instance.recordQosError(sb,
[vc],!1,!0,!1,!1,Md),m.ULS.sendTraceTag(572289500,302,15,L.wOi(Yb,this.wNb.value,this.EFb.value)),$c?2:1):3}}Object(f.a)(M,"PresenceLightupLatencyLogger",null,[]);class R{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf=null,Xa=null,vb=null){this.a9g={};this.jKe={};this.L0g=new P.a;this.yIc=this.EOc=this.cD=this.Gh=null;this.Hch=this.Gch=0;this.wNb=new G.a(()=>Qf.y$("PresenceBootLatencyThreshold",1E4));this.EFb=new G.a(()=>Qf.y$("PresenceBootLatencyCutoffThreshold",6E4));this.wGj=new G.a(()=>Qf.y$("PresenceLightupLatencyThreshold",
2E3));this.Xjj=new G.a(()=>Qf.y$("PresenceLightupLatencyCutoffThreshold",1E4));this.yI=vc;this.zyj=$c;this.cQg=Ja;this.eah=sb;this.$mb=Yb;this.tf=Md;this.SOd=Xa;this.nEb=Re;this.Cg=vb;this.qOg=!1;this.init()}M8c(Ja,sb,Yb=null,vc=0){Yb&&(m.ULS.shipAssertTag(42274970,302,!this.SOd||this.SOd===Yb,"_myClientId is already set and you are trying to update it to something different"),this.SOd=Yb);const $c=new x.a;this.init().continueWith(()=>{this.bRl(Ja);this.ttk($c,Ja,sb,vc)})}get Wpi(){return this.SOd||
"{"+v.AFrameworkApplication.userSessionId+"}"}init(){if(this.EOc)return this.EOc.task;this.EOc=new x.a;this.nEb()&&m.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.cQg.continueWith(()=>{const Ja=this.cQg.result,sb=Ja.u8a,Yb=Ja.jpi;Yb.continueWith(()=>{sb.continueWith(()=>{this.Cg&&this.Cg.addQosPillar("RealTimeCoauth");this.Mzd(sb.result,Yb.result);this.EOc.We(null)})})});this.eah.continueWith(()=>{this.Gh=this.eah.result;this.Gh.fya(Object(c.a)(this,this.ZRl,"onRtcConnection"));this.Gh.j5(Object(c.a)(this,
this.wMl,"onCoauthorBootReceived"))});this.$mb.continueWith(()=>{this.cD=this.$mb.result;this.cD.P_c(Object(c.a)(this,this.Ane,"onUsersUpdatedEventListener"));0<this.cD.Yrb().length&&this.qga()});return this.EOc.task}fWh(){if(this.yIc)return this.yIc.task;this.yIc=new x.a;this.yI.Lk(4,()=>{this.yIc.yO(this.tf.JL("AppInitStatus_interactivityReady"))});return this.yIc.task}ZRl(Ja,sb){if(!this.qOg&&2===sb.newState){var Yb=this.fWh();Yb.continueWith(()=>{const vc=Date.now()-Yb.result,$c={};$c.clientId=
this.Wpi;$c.bootTime=vc;this.qOg=!0;this.Gh.$Q(15,$c)})}}wMl(Ja,sb){if(15===sb.type){Ja=Date.now();sb=sb.l8;var Yb=sb.bootTime;this.hJf(sb.clientId).Blh=Ja-Yb}}Ane(){this.qga()}qga(){const Ja=Date.now();var sb=this.cD.Yrb();const Yb=new P.a;for(const vc of sb)this.L0g.contains(vc.clientId)||(this.L0g.add(vc.clientId),Yb.add(vc.clientId));if(0<Yb.count)for(let vc of Yb)sb=this.hJf(vc),sb.exh||(sb.dxh=Ja)}bRl(Ja){Ja=this.hJf(Ja);Ja.duh||(Ja.cuh=Date.now())}hJf(Ja){return Ja in this.jKe?this.jKe[Ja]:
this.jKe[Ja]=new M(Ja,this.wGj,this.Xjj)}Mzd(Ja,sb=0){this.Gch=Ja;this.Hch=sb?sb:(new Date).getTime()}ttk(Ja,sb,Yb,vc){Yb=Yb?Yb.getTime():(new Date).getTime();sb in this.a9g?Ja.yva():(vc=new O(sb,this.n0k(),Yb,this.mae(this.Wpi),this.mae(sb),this.wNb,this.EFb,vc,this.nEb),this.a9g[sb]=vc,vc.JBe(Ja))}n0k(){return 1===this.Gch?U.Task.z1(this.Hch):this.fWh()}mae(Ja){return this.zyj.mae(Ja)}}Object(f.a)(R,"PresenceBootTelemetry",null,[176]);var W=b(131),Y=b(144),N=b(34),aa=b(174),ia=b(135),ea=b(21),la=
b(469);class xa{get name(){return"Common.App.CoauthTelemetry"}Nb(Ja){Ja.register(n,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").fa().zd(()=>new n(la.a.Jp(Ja.Fa("Common.IPeopleInfoProvider")),v.AFrameworkApplication.Dg));Ja.register(F,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").fa().zd(()=>new F(v.AFrameworkApplication.qa,la.a.Jp(Ja.Fa("Common.ICoauthoringTelemeryInfoProvider")),v.AFrameworkApplication.K,
W.a.get_instance(),aa.a.instance,la.a.Jp(Ja.Fa("Common.IPeoplesWell")),la.a.Jp(Ja.Fa("Common.IPeopleInfoProvider")),n.Vgf,()=>this.qrh()));Ja.register(R,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").fa().zd(()=>new R(la.a.Jp(Ja.Fa("Common.ICoauthoringTelemeryInfoProvider")),la.a.Jp(Ja.Fa("Common.IRealtimeChannelBasic")),la.a.Jp(Ja.Fa("Common.IPeopleInfoProvider")),W.a.get_instance(),Ja.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),
aa.a.instance,()=>this.qrh(),v.AFrameworkApplication.K,null,A.Health.instance));Ja.register(E,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").fa().zd(()=>new E(la.a.Jp(Ja.Fa("Common.IPeopleInfoProvider"))))}init(){v.AFrameworkApplication.K.Do(()=>{ea.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();v.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&ea.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();
v.AFrameworkApplication.K.$("CashTelemetryIsEnabled")&&(ea.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),ea.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}qrh(){return ia.a.OPb&&aa.a.instance.Jja(N.a.KIg)?0<aa.a.instance.JL(N.a.KIg)[N.a.cEd]:!1}static main(){Y.a.instance.jc(new xa)}}Object(f.a)(xa,"CoauthTelemetryPackage",null,[2,3]);class Ha extends Sys.EventArgs{constructor(){super()}}Object(f.a)(Ha,"RtcHostNotificationEventArgs",
Sys.EventArgs,[]);var ua;(function(Ja){Ja[Ja.notYetStarted=0]="notYetStarted";Ja[Ja.polling=1]="polling";Ja[Ja.subscribed=2]="subscribed";Ja[Ja.blocked=3]="blocked";Ja[Ja.permanentlyStopped=4]="permanentlyStopped"})(ua||(ua={}));Object(f.b)("RtcHostNotificationSubscriptionState",ua);var Ra=b(77),ab=b(1038),Ba=b(58);class Ga{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa){this.Ye=!1;this.TSa=this.jjc=this.fda=this.vnb=null;this.PXc=Ga.aGe;this.la=new Ba.a;this.Ynb=new ab.a(0);this.Ynb.O_c(Object(c.a)(this,
this.SSl,"onStateMachineChanged"));this.NAj=Ja;this.ESd=sb;this.MAj=Yb;this.c5e=vc;this.Za=$c;this.wh=Md;Re.execute(vb=>{this.Ye||(this.jjc=vb,this.jjc.j5(Object(c.a)(this,this.m7,"onUpdateNotificationReceived")),this.start())});Qf.execute(vb=>{this.Ye||(this.TSa=vb,vb.FTa(Object(c.a)(this,this.fma,"onTokenRefreshed")))});this.Bkc=Xa}get cEc(){return this.Ynb.currentState}get afi(){return!this.wh||this.wh.Ifa}get nfi(){return 2===this.cEc&&this.Bkc()<this.PXc}start(){this.cEc?m.ULS.sendTraceTag(573100178,
502,15,"HostNotifications: Tried starting poll when in state {0}",ua[this.cEc]):(this.Ynb.event(1),this.lsg(null))}lsg(){this.vnb=null;if(this.afi){m.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",ua[this.cEc]);let Ja=null;this.c5e&&this.c5e.length&&(Ja={},Ja.etts=this.c5e);this.jjc.$Q(14,Ja,!0);this.GMi(this.NAj)}else this.Ynb.event(3)}GMi(Ja){this.vnb=Ra.a.n1(1E3*Ja,Object(c.a)(this,this.lsg,"sendSubscribeEvent"),this.ESd,192,"RtcHostNotificationSubscribe");
this.Za.Eb(this.vnb)}ulm(Ja){Ja=1E3*(Ja+this.MAj);const sb=this.Bkc().getTime()+Ja;this.PXc=new Date(sb);Ja-=this.ESd;this.fda?this.Za.z2(this.fda,Ja):(this.fda=Ra.a.n1(Ja,Object(c.a)(this,this.YLm,"transitionToPollingEvent"),this.ESd/2,194,"RtcHostNotificationTransitionToPolling"),this.Za.Eb(this.fda))}YLm(){this.fda=null;2===this.cEc&&(this.Ynb.event(1),m.ULS.shipAssertTag(573100185,502,!!this.fda,"Missing transition to polling task"))}fma(){this.B6k()}B6k(){3===this.cEc&&this.afi&&(this.Ynb.event(this.nfi?
2:1),this.lsg(null))}m7(Ja,sb){if(13===sb.type&&(Ja=sb.l8,m.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:Ja,["DurationBeforeExpirationToResubscribeInSec"]:this.ESd}),sb=Ja.cts,!this.FNm(sb))){if(Ja.sb){var Yb=2;this.ulm(Ja.cts)}else Yb=1,this.PXc=Ga.aGe,this.fda&&(this.Za.xe(this.fda),this.fda=null);this.Ynb.event(Yb);this.vnb?this.Za.z2(this.vnb,1E3*sb):this.GMi(sb)}}FNm(Ja){if(!isNaN(Ja)&&isFinite(Ja)&&0<Ja)return!1;
this.YXi(!1);return!0}YXi(Ja){this.vnb&&(this.Za.xe(this.vnb),this.vnb=null);this.fda&&(this.Za.xe(this.fda),this.fda=null);this.jjc&&(this.jjc.cBc(Object(c.a)(this,this.m7,"onUpdateNotificationReceived")),this.jjc=null);this.TSa&&(this.TSa.V8b(Object(c.a)(this,this.fma,"onTokenRefreshed")),this.TSa=null);Ja||this.Ynb.event(4)}SSl(Ja,sb){Ja=sb.newState;const Yb=sb.y7b,vc={};vc.NewState=ua[Ja];vc.PreviousState=ua[Yb];vc.PreviousStateHits=sb.Urd;vc.PreviousStateTransitionTime=sb.Vrd.toISOString();vc.IsSubscribed=
this.nfi;this.PXc!==Ga.aGe&&(vc.SubscriptionExpiringTime=this.PXc.toISOString());m.ULS.sendTraceTag(572346515,502,4===Ja?15:50,"HostNotificationChanged: {0}",vc);this.la.raiseEvent("HN",new Ha(Yb,Ja))}dispose(){this.Ye||(this.Ye=!0,this.YXi(!0),this.fda&&(this.Za.xe(this.fda),this.fda=null))}}Ga.aGe=new Date(0);Object(f.a)(Ga,"RtcHostNotificationSubscriptionManager",null,[374,13]);var ja=b(386);class X{constructor(){this.Ce=this.Ye=!1}get name(){return"RtcHostNotificationSubscription"}Nb(Ja){Ja.register(Ga,
"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").fa().zd(()=>{const sb=v.AFrameworkApplication.K;return new Ga(sb.zb("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),sb.zb("RtcHostNotificationRetryIntervalBufferInSeconds",120),sb.zb("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.KZk(sb),v.AFrameworkApplication.Vb,ja.SessionStatusManager.instance,Ja.Fa("Common.IRealtimeChannelBasic"),
Ja.Fa("Common.ISessionExpirationManager"),()=>new Date)})}init(){v.AFrameworkApplication.K.Do(()=>{!this.Ye&&v.AFrameworkApplication.K.$("RtcHostNotificationEnabled")&&(this.Ce=!0,ea.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Ye||(this.Ye=!0,this.Ce&&ea.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}KZk(Ja){return Ja.vE("RtcEventTypesToSubscribe")?Ja.gC("RtcEventTypesToSubscribe"):
null}static main(){Y.a.instance.jc(new X)}}Object(f.a)(X,"RtcHostNotificationSubscriptionPackage",null,[2,3]);var fa=b(1286),pa=b(1444);class Ia extends pa.a{constructor(){super();this.izc=this.L2f=null}ETk(){const Ja=v.AFrameworkApplication.userName,sb=v.AFrameworkApplication.K.Oa("UserPrincipalName"),Yb=this.L2f?this.L2f.JQ:null,vc=v.AFrameworkApplication.KDd||v.AFrameworkApplication.MAa,$c=this.izc?this.izc.getStatus():null;return new pa.a(this.clientId,Ja,this.color,this.capabilities,Yb,this.x2c,
sb,this.client,this.chatThreadDiscoveryUri,vc,this.inChat,this.isReadOnly,$c)}}Object(f.a)(Ia,"MyPresenceUser",pa.a,[1404,317]);class ta{constructor(Ja,sb,Yb,vc,$c){this.Tc=Ja;this._clientId=sb;this.Xkj=$c;this.Ioj=Yb||(()=>null);this.Joj=vc||(()=>null)}get id(){return this.Tc.id}get LWd(){return this.Tc.LWd}get PWd(){return this.Tc.PWd}get OWd(){return this.Tc.OWd}get NWd(){return this.Tc.NWd}get MWd(){return this.Tc.MWd}get QWd(){return this.Tc.QWd}get Ebf(){return this.Tc.Ebf}get Dac(){return this.Tc.Dac}get hzd(){return this.Tc.hzd}get eod(){return this.Tc.eod}get clientId(){return this._clientId}get tsc(){return this.Ioj}get Psb(){return this.Joj}get Hpk(){return this.Xkj}static createInstance(Ja,
sb,Yb,vc,$c=!1){return new ta(Ja,sb,Yb,vc,$c)}}Object(f.a)(ta,"PeoplesWellSettings",null,[]);var oa=b(1118),va=b(9),Fa=b(50),cb=b(118),Za=b(75),gb=b(216),Ya=b(301),fb=b(393),ib=b(327);class hb extends gb.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.ChatCapable=this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(f.a)(hb,"PeopleButtonProps",gb.a,[]);var db=b(1287),da=b(941),Wa=b(16),mb=b(130),Tb=b(343),Da=b(57);class La{constructor(Ja){this.MDd=
new Da.a;this.huf=null;this.clientId=Ja}nvm(Ja){this.Ybm();this.Ppm(Ja);for(const sb of Ja)sb.clientId!==this.clientId&&this.Njh(sb)}get QIg(){const Ja=[];for(let sb of this.MDd.values){const Yb=this.vNi(sb);Array.add(Ja,Yb)}return Ja}get iyb(){return this.MDd.count}rdf(Ja,sb){Ja=Ja.toUpperCase();let Yb;({value:Yb}=this.MDd.xb(Ja)).returnValue||(Yb=[],this.MDd.W(Ja,Yb));Array.add(Yb,sb)}Ybm(){this.MDd=new Da.a}Ppm(Ja){for(const sb of Ja)if(sb.clientId===this.clientId){this.huf=sb;break}}}Object(f.a)(La,
"UserTracker",null,[1349]);class Ta extends La{constructor(Ja,sb){super(Ja);this.Koj=sb}Njh(Ja){Ja.isAnonymous||!Ja.email?this.rdf(Ja.clientId,Ja):this.huf&&Tb.a.ef().equals(this.huf.email,Ja.email)||this.rdf(Ja.email,Ja)}vNi(Ja){let sb=new Date(0),Yb=0<Ja.length?Ja[0]:null;for(const vc of Ja)(Ja=this.Koj(vc.clientId))&&sb.getTime()<Ja.iwc.getTime()&&(sb=Ja.iwc,Yb=vc);return Yb}}Object(f.a)(Ta,"UniqueUserTracker",La,[]);class Sa extends La{constructor(Ja){super(Ja)}Njh(Ja){this.rdf(Ja.clientId,Ja)}vNi(Ja){return Ja[0]}}
Object(f.a)(Sa,"UserInstanceTracker",La,[]);const Hb=(Ja,sb,Yb)=>Yb?new Ta(Ja,sb):new Sa(Ja);var Oa=b(66),za=b(1009),$a=b(1102),Xb=b(14);class Eb{constructor(Ja,sb=null,Yb=null,vc=null){this.cD=null;this.j9e=new x.a;this.IEb=null;this.Tc=Ja;this.Uoe=sb;Yb&&Yb.continueWith(()=>{this.cD=Yb.result;this.cD.P_c(Object(c.a)(this,this.qga,"onUsersUpdated"));this.Ltd()});vc&&vc.continueWith(()=>{this.IEb=vc.result;this.IEb.f_m(Object(c.a)(this,this.qga,"onUsersUpdated"));this.Ltd()});new fa.a(this.settings.clientId,
"Anonymous user","#cccccc",new db.a(7));this.nfe=this.FVe=!0;this.xRe=this.f8g=!1;this.GCa=Hb(this.settings.clientId,this.settings.Psb,Ja.Hpk)}get settings(){return this.Tc}get Mjl(){return v.AFrameworkApplication.K?v.AFrameworkApplication.K.$("ColorPresenceHashIsEnabled"):!1}get wai(){return v.AFrameworkApplication.K?v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"):!1}FKk(){let Ja,sb,Yb,vc;const $c=this.GKk();this.GCa.iyb?1===this.GCa.iyb?(Ja=!0,sb=this.settings.Dac.cluster,Yb=
this.settings.Dac.j3d,vc=this.GCa.QIg[0].color):(Ja=!0,sb=this.settings.eod.cluster,Yb=this.settings.eod.j3d,vc=""):(Ja=!1,vc=Yb=sb="");return{kVl:$c[0],lVl:$c.slice(1),gVl:Ja,b5m:sb,iVl:Yb,hVl:vc}}GKk(){if(2<=this.GCa.iyb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.GCa.iyb)];if(1===this.GCa.iyb){const Ja=this.GCa.QIg[0],sb=this.settings.Psb(Ja.clientId);return sb&&2===sb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Ja.userName]:[Ja.isReadOnly?
CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,Ja.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}M3k(Ja){return this.N3k(Ja)}Bth(Ja,sb,Yb){return sb?this.t2j(sb)?(Ja=this.settings.Psb(Ja))&&2===Ja.status?!1:!0:(Yb&&m.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(Yb&&m.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}r0k(Ja){return Ja.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:
CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}N3k(Ja){if(!Ja.capabilities.Tza(1))return this.r0k(Ja);const sb=Ja.isReadOnly,Yb=this.settings.Psb(Ja.clientId);Ja=this.settings.tsc(Ja.clientId);if(!Yb)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(Yb.status){case 1:return Ja?sb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.Nbk(Ja)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;
default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}oQk(Ja){if(this.Uoe.bhe)return this.Uoe.hoc(Ja.email,"O365",v.AFrameworkApplication.yk,0)}A3k(Ja){Ja=this.settings.Psb(Ja.clientId);return!Ja||Ja&&1===Ja.status?!0:!1}D3k(Ja){return this.IEb?this.IEb.A1m(Ja.clientId):Ja.capabilities.Tza(4)}B3k(Ja){var sb=String.format("buttonPeoplesWellUser-{0}",Ja.clientId),Yb=Ja.clientId,vc=this.M3k(Ja);const $c=Ja.userName,Md=Ja.color;sb=Object.assign(new hb,{Id:sb,Command:this.settings.QWd.toString(),
LabelText:"{0}",Image32by32:this.settings.hzd.cluster,Image32by32Class:this.settings.hzd.j3d,MenuItemId:Yb,CommandValueId:Yb,Alt:$c,DisplayMode:this.GTh(),LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:vc,ImageBackColor:Md,IsAnonymous:Ja.isAnonymous,LabelTextUserGeneratedPlaceholderReplacements:$a.a.itk([$c]),Upn:Ja.email});v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&this.Uoe&&(Yb=this.oQk(Ja),vc=this.A3k(Ja),sb.ImageUrl=
Yb,sb.ActiveStatus=vc,sb.JoinTimeInMS=Ja.uXa,vc=this.Bth(Ja.clientId,this.settings.tsc(Ja.clientId),!1),Ja=this.D3k(Ja),sb.CanJump=vc,sb.ChatCapable=Ja,""===Yb&&m.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return sb}ePk(){return Object.assign(new gb.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}GTh(){return this.Mjl?"Initials":"Menu32"}C3k(Ja){const sb=
[];for(const Yb of Ja)Ja=this.B3k(Yb),Array.add(sb,Ja);return sb}$hd(){return 0<this.GCa.iyb}L4l(Ja){if(!this.FVe)return!0;this.nfe||(Ja[za.a.Visible]=!0);let sb,Yb,vc,$c,Md;({kVl:sb,lVl:Yb,gVl:vc,iVl:$c,hVl:Md}=this.FKk());Ja[za.a.LabelText]=sb;Yb&&Yb.length&&(Ja[za.a.LabelTextUserGeneratedPlaceholderReplacements]=Yb);Ja[za.a.ImageIsVisible]=vc;Ja[za.a.Image16by16Class]=$c;Ja[za.a.ImageBackColor]=Md;this.FVe=!1;return!0}LZl(Ja){if(0>=this.GCa.iyb)return!1;var sb=this.rDm(this.GCa.QIg),Yb=this.C3k(sb);
sb=Object.assign(new fb.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});Yb=Object.assign(new ib.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.GTh(),ControlList:Yb});v.AFrameworkApplication.K.$("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.Uoe&&(Yb.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,Yb.TitleId="menuCoauthorsTitle",Yb.Theme="Light");Array.add(sb.MenuSectionList,Yb);v.AFrameworkApplication.K.$("DocChatIsEnabled")&&v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")&&
v.AFrameworkApplication.pa&&v.AFrameworkApplication.pa.mb.Eo&&(Yb=[],Array.add(Yb,this.ePk()),Yb=Object.assign(new ib.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:Yb}),Array.add(sb.MenuSectionList,Yb));v.AFrameworkApplication.pa&&v.AFrameworkApplication.pa.mb.Eo?Ja.MenuItems=sb:Ja.PopulationXML=Ya.t(sb);return!0}MIg(Ja){m.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Ja=Ja.MenuItemId;if(!Ja)return!1;const sb=this.settings.tsc(Ja);if(!this.Bth(Ja,sb,
!0))return!1;this.Wul(sb);return!0}B9l(){const Ja=this.wGk();this.GCa.nvm(Ja);this.nfe&&1<=this.GCa.iyb&&(m.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.nfe=!1);this.FVe=!0}qga(){this.xRe||(window.setTimeout(()=>{this.Ltd();this.xRe=!1},3E3),this.xRe=!0)}wGk(){let Ja;Ja=this.vGk()||[];for(const sb of Ja)this.xkm(sb);return Ja}xkm(Ja){Ja.clientId||(Ja.clientId=mb.a.create().toString());Ja.userName||(Ja.userName="Anonymous user");Ja.capabilities||(Ja.capabilities=
new db.a);Ja.color||(Ja.color="#cccccc");Ja.uXa||(Ja.uXa=0)}rDm(Ja){const sb=[];Array.addRange(sb,Ja);sb.sort(Eb.WUl);return sb}Qam(){v.AFrameworkApplication.K.$("CoauthorGalleryTelemetryIsEnabled")&&v.AFrameworkApplication.qa.na(Xb.a.X7j,Oa.a.frame,Object(c.a)(this,this.xMl,"onCoauthorGalleryFirstRender"));this.Ram();this.f8g=!0;this.Ltd()}xMl(Ja,sb,Yb,vc,$c){this.j9e.yO($c.RenderTime);return 32}get N_i(){return this.j9e.task}Ltd(){if(!this.f8g&&(this.j9e.yO((new Date).getTime()),m.ULS.sendTraceTag(42567504,
325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.wai))return;this.B9l();this.wai&&this.nfe?da.a.gga("ribbon","coauthorGallery"):(da.a.b7("ribbon","coauthorGallery"),da.a.Gta("ribbon","coauthorGallery"),this.C9l())}dispose(){this.cD&&(this.cD.eng(Object(c.a)(this,this.qga,"onUsersUpdated")),this.cD=null);this.IEb&&(this.IEb.H5m(Object(c.a)(this,this.qga,"onUsersUpdated")),this.IEb=null)}static WUl(Ja,sb){return Ja.capabilities.Tza(1)&&sb.capabilities.Tza(1)||
!Ja.capabilities.Tza(1)&&!sb.capabilities.Tza(1)?Wa.a.localeCompare(Ja.userName,sb.userName):Ja.capabilities.Tza(1)?-1:1}}Object(f.a)(Eb,"APeoplesWell",null,[1273,13]);var ob=b(17);class tb extends Eb{constructor(Ja,sb,Yb=null,vc=null){super(Ja,Yb,vc);this.b2a=()=>!0;this.ea=sb}N4l(Ja){return this.L4l(Ja)}NZl(Ja){return this.LZl(Ja)}oVm(Ja){return this.MIg(Ja)}Yab(Ja,sb,Yb,vc,$c,Md){Ja=!1;switch(Yb){case 1:Ja=$c(vc);break;case 2:Ja=Md(vc)}return tb.KWj(Ja)}mkl(Ja,sb,Yb,vc,$c){return this.Yab(Ja,sb,
Yb,$c,()=>this.$hd(),this.b2a)}M4l(Ja,sb,Yb,vc,$c){return this.Yab(Ja,sb,Yb,$c,Object(c.a)(this,this.N4l,"queryUsersProxy"),this.b2a)}MZl(Ja,sb,Yb,vc,$c){return this.Yab(Ja,sb,Yb,$c,this.b2a,Object(c.a)(this,this.NZl,"populateFlyoutContentsProxy"))}S8j(Ja,sb,Yb,vc,$c){return this.Yab(Ja,sb,Yb,$c,this.b2a,this.b2a)}R8j(Ja,sb,Yb,vc,$c){return this.Yab(Ja,sb,Yb,$c,this.b2a,this.b2a)}nVm(Ja,sb,Yb,vc,$c){return this.Yab(Ja,sb,Yb,$c,this.b2a,Object(c.a)(this,this.oVm,"userButtonClickProxy"))}kYl(Ja,sb,
Yb,vc,$c){return this.Yab(Ja,sb,Yb,$c,this.b2a,()=>{this.Ltd();return!0})}Ram(){this.ea.na(this.settings.LWd,ob.a.application,Object(c.a)(this,this.mkl,"isControlEnabledHandler"));this.ea.La(this.settings.PWd,ob.a.application,Object(c.a)(this,this.M4l,"queryUsersHandler"),96);this.ea.La(this.settings.NWd,ob.a.application,Object(c.a)(this,this.S8j,"commandMenuOpenHandler"),96);this.ea.La(this.settings.MWd,ob.a.application,Object(c.a)(this,this.R8j,"commandMenuCloseHandler"),96);this.ea.La(this.settings.OWd,
ob.a.application,Object(c.a)(this,this.MZl,"populateFlyoutContentsHandler"),96);this.ea.na(this.settings.QWd,ob.a.application,Object(c.a)(this,this.nVm,"userButtonClickHandler"));this.ea.La(this.settings.Ebf,ob.a.application,Object(c.a)(this,this.kYl,"peoplesWellRefreshControlHandler"),96)}dispose(){super.dispose()}static KWj(Ja){return Ja?32:8}}Object(f.a)(tb,"ABox4PeoplesWell",Eb,[]);var yb=b(3),lb=b(47),Cc=b(10),Hc=b(24),Jc=b(155),Ib=b(1205),nc=b(1242);class Gc extends tb{constructor(Ja,sb,Yb,
vc,$c,Md,Re,Qf,Xa,vb,Pb,oc,zc,Kc){super(Ja,Md,Kc,sb);this.Yhj=Yb;this.YAj=vc;this.Lzj=$c;this.Da=Re;Gc.hr=Qf;this.GF=Xa;this.Dc=vb;this.jSa=Pb;this.bbf=oc;this.Zna=zc}MIg(Ja){this.Zna.phe(Ja.CommandValueId);return super.MIg(Ja)}Wul(Ja){let sb;({Qfg:sb}=this.vZf(Ja)).returnValue&&(this.YAj(sb.ip.paragraphId,sb.ip.w7.cp),v.AFrameworkApplication.K.$("WordEditorMoveIpToUserLocationIsEnabled")&&(Ja=Gc.y_k(sb),void 0!==Ja&&null!==Ja?(m.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),
this.Da.setSelection(Ja),Fa.FocusManager.kF()&&Fa.FocusManager.instance().qf(cb.AFrame.Qn)):m.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Ja=new Ra.a(2,1,0,()=>{this.ea.Db(yb.a.Vwe,2,sb)}),Za.a.instance.Eb(Ja))}fZh(Ja){return Ja?(Ja=nc.a.P2d(Ib.a(Ja),this.GF,this.Dc,this.jSa,this.bbf.instance))&&Ja.Fc()&&Ja.ip?Ja:null:null}t2j(Ja){return this.jql(Ja)?this.Fkf(Ja)?!0:(m.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),
!1):(m.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}jql(Ja){return!!this.fZh(Ja)}vZf(Ja){Ja=this.fZh(Ja);return{returnValue:!!Ja,Qfg:Ja}}Fkf(Ja){let sb;return({Qfg:sb}=this.vZf(Ja)).returnValue?this.Yhj(sb.ip.paragraphId,sb.ip.w7.cp):!1}vGk(){if(!this.cD)return[];const Ja=[];for(let sb of this.cD.Yrb())sb.userName?Ja.push(sb):m.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Ja}Nbk(Ja){let sb;return({Qfg:sb}=this.vZf(Ja)).returnValue&&
sb.user&&sb.user.presenceStatus&&"0"!==sb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,sb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}C9l(){this.Lzj(this.settings.id)}dispose(){super.dispose()}static createInstance(Ja,sb,Yb,vc,$c,Md,Re){const Qf=va.App.oa.Ca,Xa=v.AFrameworkApplication.qa,vb=lb.a.instance,Pb=ea.a.instance.resolve("Box4.ICoauthCashTelemetry");return new Gc(Ja,sb,oc=>Qf.nc.Bi?Qf.nc.a2c(oc,!0):!1,(oc,zc)=>{Qf.nc.Bi&&
Qf.nc.wgb(oc,zc,!0,!0)},()=>{va.App.Ep.OB.tcc()},Xa,vb,Qf,Yb,vc,$c,Md,Pb,Re)}static y_k(Ja){const sb=Gc.hr.Rb.zc.Va(Ja.ip.paragraphId);if(void 0===sb||null===sb)return m.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!Cc.ParagraphReader.Mb(sb))return m.ULS.sendTraceTag(20764577,325,15,"The obtained node is not a paragraph node"),null;Ja=Hc.a.sc(sb,Ja.ip.w7.cp);return new Jc.Selection([Ja],!0)}}Gc.hr=null;Object(f.a)(Gc,"WordEditorPeoplesWell",tb,[]);class tc{get name(){return"WordEditor.PeoplesWellControl"}Nb(Ja){tc.Z=
Ja}init(){v.AFrameworkApplication.K.Do(Object(c.a)(this,this.ux,"onFullAppSettingsReady"))}ux(){v.AFrameworkApplication.neg?tc.yua.dG().continueWith(Object(c.a)(this,this.w6b,"onRtcProxyReady")):m.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")}w6b(){tc.Gh=tc.yua.dG().result;if(tc.Gh){var Ja=()=>{const sb=va.App.oa.Ca;return sb?sb.Rb?sb.Rb.zc:(m.ULS.sendTraceTag(23196876,325,15,"ActivePage is null"),null):(m.ULS.sendTraceTag(23196875,
325,15,"Workspace is null"),null)};va.App.Hka().continueWith(()=>{const sb=va.App.Hka().result.Sg,Yb=oa.CuiHelper.QWk(v.AFrameworkApplication.Hp,v.AFrameworkApplication.Hp,v.AFrameworkApplication.Hp,v.AFrameworkApplication.Hp),vc=ta.createInstance(Yb,sb,Object(c.a)(tc.Gh.$vd,tc.Gh.$vd.tsc,"getUserPresence"),Object(c.a)(tc.Gh.$vd,tc.Gh.$vd.Psb,"getUserStatusInfo"),v.AFrameworkApplication.K.$("WordEditorPresenceDedupeMultipleCoauthorInstances"));ea.a.instance.ia("RealtimePresenceUI.WordEditorPeoplesWell",
()=>Gc.createInstance(vc,la.a.Jp(tc.Z.Fa("Common.IPeopleInfoProvider")),tc.Z.sa("WordEditor.ParagraphWordIdMapping"),tc.Z.sa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ja,tc.Z.Fa("WordEditor.Presence.IWordPresenceCpFactory"),tc.Z.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").fa();tc.ta=ea.a.instance.resolve("Common.IPeoplesWell");tc.ta.Qam();m.ULS.sendTraceTag(23196877,325,50,"PeoplesWellControl is fully initialized")})}else m.ULS.sendTraceTag(23196873,
325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}dispose(){tc.ta&&(tc.ta.dispose(),tc.ta=null)}static get yua(){return tc.vGa||(tc.vGa=ea.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}}tc.ta=null;tc.Z=null;tc.Gh=null;tc.vGa=null;Object(f.a)(tc,"WordEditorPeoplesWellControlPackage",null,[2,3]);var fc=b(64),kc=b(176),Bb=b(32),Wb;(function(Ja){Ja[Ja.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Ja[Ja.peopleImageClassName=1]="peopleImageClassName";
Ja[Ja.peopleImageClusterPath=4]="peopleImageClusterPath";Ja[Ja.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Ja[Ja.imageDimension=6]="imageDimension";Ja[Ja.rtl=8]="rtl";Ja[Ja.pointerInputManager=9]="pointerInputManager";Ja[Ja.clickInputManager=10]="clickInputManager";Ja[Ja.vertical=11]="vertical";Ja[Ja.zIndex=12]="zIndex";Ja[Ja.contextMenuInputManager=13]="contextMenuInputManager";Ja[Ja.imageDomElement=14]="imageDomElement";Ja[Ja.useIdleTooltip=15]="useIdleTooltip";Ja[Ja.viewportBoundsCallback=
16]="viewportBoundsCallback";Ja[Ja.flipHorizontalDirection=17]="flipHorizontalDirection";Ja[Ja.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash"})(Wb||(Wb={}));Object(f.b)("PresenceTooltipSettingKeys",Wb);class zb{constructor(){this.Ur={}}get(Ja,sb=null){Ja=Wb[Ja];return"number"===typeof sb?(sb=this.Ur[Ja])?Number.parseInvariant(sb.toString()):0:this.Ur[Ja]}add(Ja,sb){this.Ur[Wb[Ja]]=sb}zTa(Ja,sb){Wb[Ja]in this.Ur||(this.Ur[Wb[Ja]]=sb)}remove(Ja){delete this.Ur[Wb[Ja]]}}Object(f.a)(zb,
"PresenceTooltipSettings",null,[]);class Gb extends Ba.a{constructor(Ja){super();this._element=null;this.element=Ja}get element(){return this._element}set element(Ja){this._element=Ja}get visible(){return"visible"===this.element.style.visibility}set visible(Ja){this.element.style.visibility=Ja?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Ja){this.element.dir=Ja?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Ja){this.element.style.zIndex=String(Ja)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Ja){return this.element.ownerDocument.createElement(Ja)}dna(){return!0}static ICh(Ja){return"prControl"+(Ja?"Rtl":"")}}Object(f.a)(Gb,"BasePresenceControl",Ba.a,[13,400]);class gc extends Sys.EventArgs{constructor(Ja,sb){super();this.type=Ja;this.Co=sb}}gc.mW="InteractivityChanged";Object(f.a)(gc,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class jc{static ILk(Ja){return jc.JLk(Ja)}static JLk(Ja){const sb=
document.createElementNS(jc.XKg,"svg");sb.setAttribute("viewBox",String.format(jc.dkk,jc.l8i,jc.k8i));sb.appendChild(jc.X0k(Ja));return sb}static X0k(Ja){const sb=jc.l8i/Ja,Yb=2*sb,vc=jc.k8i/2;Ja=(Ja-12-8)*sb/2;const $c=document.createElementNS(jc.XKg,"g");$c.setAttribute("class",jc.ckk);for(let Md=1;3>=Md;Md++)$c.appendChild(jc.lJk(Md,Yb,Ja+(6*Md-2)*sb,vc));return $c}static lJk(Ja,sb,Yb,vc){const $c=document.createElementNS(jc.XKg,"circle");$c.setAttribute("class",String.format("{0}-{1}",jc.A5j,
Ja));$c.setAttribute("cx",String.format("{0}",Yb));$c.setAttribute("cy",String.format("{0}",vc));$c.setAttribute("r",String.format("{0}",sb));return $c}}jc.XKg="https://www.w3.org/2000/svg";jc.ckk="prDancingDots";jc.A5j="prAnimateCircle";jc.dkk="0 0 {0} {1}";jc.k8i=40;jc.l8i=120;Object(f.a)(jc,"ModernPresenceTooltipDancingDots",null,[]);var Rb=b(86),rd=b(93),sd=b(6),Id=b(54),me=b(122),we=b(51);class Me extends Gb{constructor(Ja,sb){super(Ja);this.Vfh=this.clb=this.QJe=this._img=this.IK=this.Eq=this.Qd=
null;this.HSa=sb.get(8,!1);this.Kkb=sb.get(6,0);this.aGj=sb.get(15,!1);this.Tc=sb;this.IUg=0;this.element=Ja;this.element.className=Me.TCf;this._span=document.createElement("span");this.element.appendChild(this._span);this.rlj=jc.ILk(sb.get(6,0));this.GG(sb);this._state=5}vOb(Ja){this.addHandler(gc.mW,Ja)}U8b(Ja){this.removeHandler(gc.mW,Ja)}get user(){return this.Vfh}get state(){return this._state}dispose(){this.element&&(this.Qd.Ib(sd.a.click,this.element,Object(c.a)(this,this.onClick,"onClick")),
this.Qd.Ib(sd.a.DE,this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior")),this.Eq.Ib(sd.a.pointerDown,this.element,Object(c.a)(this,this.eI,"onPointerDown")),this.Eq.Ib(sd.a.pointerOut,this.element,Object(c.a)(this,this.OQ,"onPointerOut")),this.Eq.Ib(sd.a.pointerOver,this.element,Object(c.a)(this,this.f_,"onPointerOver")),this.IK.Ib(this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}GG(Ja){this.Qd=Ja.get(10);this.Qd.Ma(sd.a.click,
this.element,Object(c.a)(this,this.onClick,"onClick"));this.Qd.Ma(sd.a.DE,this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior"));this.Eq=Ja.get(9);this.Eq.Ma(sd.a.pointerOver,this.element,Object(c.a)(this,this.f_,"onPointerOver"));this.Eq.Ma(sd.a.pointerOut,this.element,Object(c.a)(this,this.OQ,"onPointerOut"));this.Eq.Ma(sd.a.pointerDown,this.element,Object(c.a)(this,this.eI,"onPointerDown"));this.IK=Ja.get(13);this.IK.Ma(this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior"))}hide(Ja=
null,sb=0,Yb=0){this.aGj&&Ja?this.UAm(Ja,sb,Yb):(3===this.state&&this.vGi(),this.visible=!1,this._state=5)}UAm(Ja,sb,Yb=0){this.show(Ja,sb,15,4,void 0,Yb)}OUi(Ja,sb,Yb=!1,vc=!1,$c=!1,Md=0){this.show(Ja,sb,20,Yb?2:vc?1:0,$c,Md)}uAm(Ja,sb,Yb,vc=!1,$c=0){this.show(Ja,sb,Yb+20,3,vc,$c)}show(Ja,sb,Yb,vc=3,$c=!1,Md=0){!Ja||vc===this.state&&this.U9k(sb,Yb)||(this.MIj(vc,$c,Md),this.fja(Ja,vc,Md),this._state=vc,4===Md||!Md&&!this.HSa?this.element.style.left=sb+"px":this.element.style.right=sb+"px",this.element.style.top=
Yb+"px",this.visible=!0)}fja(Ja,sb,Yb){this.Vfh=Ja;we.a.vu(this._span);me.a.P6j(this._span);this._span.id="fly_"+Ja.clientId;this._span.style.backgroundColor=Ja.color;4!==sb?(this._span.style.height=this.Kkb+"px",this._span.style.lineHeight=this.Kkb+"px",me.a.M$b(this._span,"border-radius",this.Kkb+"px")):4===Yb||!Yb&&!this.HSa?this._span.style.left="0px":this._span.style.right="0px";2!==sb&&(4===sb?we.a.eu(this._span,""):1===sb?this._span.appendChild(this.rlj):(this._span.setAttribute("dir","auto"),
Yb=Wa.a.LQk(Ja.userName),!Ja.isAnonymous&&Yb||sb?(Ja=Ja.userName,sb||(Ja=Yb,me.a.M$b(this._span,"text-align","center")),we.a.eu(this._span,Ja)):(this._img||(this._img=this.cdk()),this._span.appendChild(this._img),me.a.M$b(this._span,"text-align","start"))))}onClick(Ja){if(!this.state)return this.raiseEvent(gc.mW,new gc(1,Ja)),!0;3===this.state&&m.ULS.sendTraceTag(50436114,302,50,"User clicked on presence pill.");return!1}OQ(Ja){3===this.state&&this.raiseEvent(gc.mW,new gc(3,Ja));return!1}f_(Ja){3!==
Ja.Jf&&this.raiseEvent(gc.mW,new gc(2,Ja));return!1}eI(Ja){if(3!==Ja.Jf)return!0;this.raiseEvent(gc.mW,new gc(4,Ja));return!1}cdk(){const Ja=document.createElement("img");Ja.setAttribute("src",Rb.a.Oda("doughperson_white_glyph.svg"));Ja.setAttribute("Unselectable","on");Ja.setAttribute(Id.a.lg,Id.a.Vy);return rd.createClusteredImageFromClusterWithImageClass(this.Kkb,this.Kkb,null,null,Me.WBk,"",!1,"",this.element.ownerDocument,Ja)}MIj(Ja,sb=!1,Yb=0){if(!this.Whd(this.state)||!this.Whd(Ja))switch(Sys.UI.DomElement.removeCssClass(this.element,
this.QJe),this.state){case 4:3===Ja?this.U6a(Me.UCf,Me.mOh):this.Whd(Ja)&&this.U6a(Me.SCf,Me.mOh);break;case 3:4===Ja?this.U6a(Me.XCf,Me.lOh):this.Whd(Ja)&&(sb&&this.vGi(),this.U6a(Me.SCf,Me.lOh,sb?Me.VBk:""));break;case 0:case 1:case 2:4===Ja?this.U6a(Me.XCf,Me.VCf):3===Ja&&(sb&&this.yJj(),this.U6a(Me.UCf,Me.VCf,sb?Me.nOh:"",3===Yb?Me.ZBk:Me.XBk));break;default:4===Ja?this.U6a(Me.XCf):3===Ja?this.U6a(Me.UCf):this.Whd(Ja)&&this.U6a(Me.SCf)}}U6a(...Ja){this.QJe=Ja.join(" ");Sys.UI.DomElement.addCssClass(this.element,
this.QJe)}yJj(){this.IUg=window.setTimeout(()=>{this.element&&(this.clb=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.clb),this.element.style.zIndex="2",this.clb.style.zIndex="1")},300)}vGi(){window.clearTimeout(this.IUg);this.clb&&(Sys.UI.DomElement.removeCssClass(this.clb,Me.VCf+" "+Me.nOh),Sys.UI.DomElement.addCssClass(this.clb,Me.UBk),U.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.clb.parentNode&&this.element.parentNode.removeChild(this.clb)}),
me.a.Q8b(this.element,"z-index"))}Whd(Ja){return!Ja||1===Ja||2===Ja}U9k(Ja,sb){const Yb=me.a.k_(this.element.style.top);return me.a.k_(this.element.style.left)===Ja&&Yb===sb}Iog(Ja){3===Ja&&me.a.Lda(this.element,"left")?(Ja=me.a.k_(this.element.style.left),me.a.Q8b(this.element,"left"),this.element.style.right=-1*Ja+"px"):4===Ja&&me.a.Lda(this.element,"right")&&(Ja=me.a.k_(this.element.style.right),me.a.Q8b(this.element,"right"),this.element.style.left=-1*Ja+"px")}}Me.TCf="prModernFlyout UIFont";
Me.XCf="flyoutIdle";Me.UCf="flyoutExpanded";Me.SCf="flyoutCollapsed";Me.mOh="flyoutFromIdle";Me.lOh="flyoutFromExpanded";Me.VCf="flyoutFromCollapsed";Me.nOh="flyoutStacked";Me.VBk="flyoutFromStacked";Me.UBk="flyoutFadeOut";Me.WBk="cui-img-cont-float cui-img-20by20";Me.XBk="flyoutLtrDir";Me.ZBk="flyoutRtlDir";Object(f.a)(Me,"ModernPresenceTooltipFlyoutControl",Gb,[]);class ld{constructor(Ja,sb,Yb=2,vc=4){this.offsetTop=Ja;this.offsetLeft=sb;this.j8i=Yb;this.c6h=vc}}Object(f.a)(ld,"FlyoutsPositioningInfo",
null,[]);class Kg{constructor(Ja=!1,sb=!1){this.ak=Ja;this.wPe=sb}IRk(Ja,sb,Yb,vc,$c){const Md=$c.y,Re=$c.height;var Qf=this.fIk(vc);const Xa=Qf+sb,vb=Ja*Yb+2*(Ja-1);Yb=null;1===Ja||this.h2j(Qf,vb,Md,Re)?Ja=new ld(0,0,2):(Ja=this.yCf(Xa,vb,Md,Re),Ja.offsetTop-=Qf);this.wPe?Yb=new ld(0,0,void 0,this.ak?4:3):(vc=this.eIk(vc,$c),Qf=Math.max(0,$c.x),$c=$c.width,sb=vc+sb,this.i2j(vc,Qf,$c)?Yb=new ld(0,0,void 0,this.ak?3:4):this.j2j(sb,Qf)&&(Yb=new ld(0,0,void 0,this.ak?4:3)),Yb||(Yb=this.WAk(vc,sb,Qf,
$c)));return new ld(Ja.offsetTop,Yb.offsetLeft,Ja.j8i,Yb.c6h)}fIk(Ja){return Bb.a.N$a(Ja)}eIk(Ja,sb){return this.ak?sb.width-Bb.a.wRh(Ja):Bb.a.wFf(Ja)}h2j(Ja,sb,Yb,vc){return Ja+sb<=Yb+vc}yCf(Ja,sb,Yb,vc){let $c=1,Md=Math.max(Yb,Ja-sb);sb>Ja-Yb&&($c=2,Md=sb<vc?vc-sb:Yb);return new ld(Md,0,$c)}i2j(Ja,sb,Yb){return Ja+150<=sb+Yb}j2j(Ja,sb){return 150<=Ja-sb}WAk(Ja,sb,Yb,vc){vc-sb>=Ja-Yb?Ja=4:(sb=Ja,Ja=3);return new ld(0,sb,void 0,Ja)}}Object(f.a)(Kg,"ModernPresenceTooltipPositioner",null,[]);class Vg{constructor(Ja,
sb,Yb,vc,$c,Md,Re){this.Vba=Ja;this._parent=sb;this.fQg=Yb;this.Lij=vc;this.Kpj=$c;this.ukc=Md;this.HSa=Re;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Ja,sb){if(3!==Ja)if(5!==Ja&&this.Vba&&this.Vba.length){if(4===Ja){var Yb=this.Kpj;var vc=(this.ukc-Yb)/2;this.element.style.height=this.ukc+"px";this.element.style.width=this.ukc+"px";Ja=me.a.k_(this.Vba[0].element.style.top);sb=me.a.k_(this.HSa?this.Vba[0].element.style.right:
this.Vba[0].element.style.left)}else Yb=this.fQg,vc=(this.ukc-Yb)/2,this.element.style.height=this.ukc+"px",this.element.style.width=this.xJk()+2*vc+"px",Ja=me.a.k_(this.Vba[this.Vba.length-1].element.style.top),sb=this.q1j(this.Vba[this.Vba.length-1].element,Yb,sb);me.a.M$b(this.element,"border-radius",this.ukc+"px");this.element.style.top=Ja-vc-Yb+"px";this.HSa?this.element.style.right=sb-vc+"px":this.element.style.left=sb-vc+"px";this.element.parentNode||this._parent.insertBefore(this.element,
this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}q1j(Ja,sb,Yb){return this.HSa&&!Yb?me.a.k_(Ja.style.right):this.HSa||Yb?this.HSa&&Yb?-me.a.k_(Ja.style.left)-sb:-me.a.k_(Ja.style.right)-sb:me.a.k_(Ja.style.left)}xJk(){return this.Vba&&this.Vba.length?this.fQg+Math.min(this.Vba.length-1,2)*this.Lij:0}}Object(f.a)(Vg,"ModernPresenceTooltipTarget",null,[]);var ad=b(181);class uc extends Gb{constructor(Ja,sb,Yb){super(Ja);this.mjc=this.CRa=this.tYg=
this.KGb=!1;this.Bp=[];this.pOc={};this.Tc=Yb;this.ak=Yb.get(8,!1);this.FXg=Yb.get(15,!1);this.qkj=Yb.get(12,0);this.fpb=Yb.get(6,0);this.Jpa=sb;this.hgh=Yb.get(16);this.wPe=Yb.get(17,!1);this.DNd=0;this.Ayj=new Kg(this.ak,this.wPe);this.DHc=this.sTh();this.SFa=!1;this.wdc=[];this.tOc=[];this.element.id=uc.Srb();this.element.className=Gb.ICh(this.ak);this.u9a&&(this.zIndex=this.u9a);this.rtl=this.ak;this.ktg(sb);this.T8=this.createElement("div");this.T8.className="prFlyoutContainer";this.element.appendChild(this.T8);
this.Vba=[];this.Clb=new Vg(this.U5,this.element,this.fpb,4,6,32,this.ak);this.Eq=Yb.get(9);this.Eq.Ma(sd.a.pointerDown,this.Clb.element,Object(c.a)(this,this.Nxc,"onHitTarget"));this.Eq.Ma(sd.a.pointerOver,this.Clb.element,Object(c.a)(this,this.Nxc,"onHitTarget"));this.Eq.Ma(sd.a.pointerOut,this.Clb.element,Object(c.a)(this,this.Nxc,"onHitTarget"))}get tpe(){return ad.a.clone(this.Bp)}get U5(){return this.Vba}get u9a(){return this.qkj}get v$a(){return this.U5?this.U5.length:0}get Pbc(){return 0<
this.v$a?this.U5[0].state:5}get ybi(){return 3===this.Pbc&&!this.KGb}vOb(Ja){this.addHandler(gc.mW,Ja)}U8b(Ja){this.removeHandler(gc.mW,Ja)}dispose(){if(this.ybi)this.SFa=!0;else{if(this.U5)for(const Ja of this.U5)Ja.U8b(Object(c.a)(this,this.hYa,"onInteractivityChanged")),fc.a.kB(Ja);this.Vba=null;this.Eq.Ib(sd.a.pointerDown,this.Clb.element,Object(c.a)(this,this.Nxc,"onHitTarget"));this.Eq.Ib(sd.a.pointerOver,this.Clb.element,Object(c.a)(this,this.Nxc,"onHitTarget"));this.Eq.Ib(sd.a.pointerOut,
this.Clb.element,Object(c.a)(this,this.Nxc,"onHitTarget"));super.dispose()}}zDc(){this.lnc();this.visible=!0}Vyd(){this.visible=!0;this.CLh();this.KGb=!0}$xg(){this.Vyd()}hide(){this.ZGi();this.lbb();this.Clb.update(this.Pbc,this.mjc)}fja(Ja){const sb=this.Pbc,Yb=this.KGb;Ja.clientId||(Ja.clientId=(uc.POc++).toString());if(Ja.clientId in this.pOc){var vc=this.lUb(Ja.clientId);if(0<=vc){vc=this.Bp[vc];if(vc.color===Ja.color&&vc.userName===Ja.userName)return;this.Yfb(Ja.clientId)}}this.hide();vc=new Me(this.createElement("div"),
this.Tc);vc.vOb(Object(c.a)(this,this.hYa,"onInteractivityChanged"));this.T8.insertBefore(vc.element,this.T8.firstChild);this.pOc[Ja.clientId]=vc;Array.add(this.Bp,Ja);Array.add(this.U5,vc);this.L6i(sb,Yb);this.visible=!0}Yfb(Ja){if(this.ybi)Array.add(this.tOc,Ja);else{var sb=this.Pbc,Yb=this.KGb;this.hide();this.Iud(Ja);this.L6i(sb,Yb)}}L6i(Ja,sb){0>=this.Bp.length?this.hide():3===Ja&&sb?this.Vyd():this.zDc()}eAf(Ja){Ja=uc.yLf(Ja);if(this.T8!==Ja&&we.a.fcb(this.T8,Ja))return!0;for(const sb of this.U5)if(we.a.fcb(sb.element,
Ja))return!0;return!1}position(Ja,sb){this.element.style.top=sb+"px";this.element.style.left=Ja+"px"}lnc(Ja=!1){if(!Ja||this.CRa){this.tYg&&this.tRi(!0);var sb=Math.min(3,this.v$a)-1;Ja=0;var Yb=1,vc=0;this.mjc&&(Ja=this.DHc,Yb=-1,vc=-this.fpb);for(let $c=this.v$a-1;$c>sb;$c--)this.U5[$c].OUi(this.Bp[$c],-4*sb*Yb+vc,!0,!1,!0,Ja);for(;0<=sb;sb--)this.U5[sb].OUi(this.Bp[sb],-4*sb*Yb+vc,0<sb,Array.contains(this.wdc,this.Bp[sb].clientId),sb!==this.DNd,Ja);this.DNd=0;this.Clb.update(0,this.mjc);this.zIndex=
this.u9a;this.KGb=!1;this.ZGi(0);this.SFa&&this.dispose()}}CLh(){this.tYg&&this.tRi(!1);this.zIndex=this.u9a+1;let Ja,sb,Yb;({offsetX:sb,offsetY:Ja,b6h:Yb}=this.Srm());for(let vc=0;vc<this.v$a;vc++)this.U5[vc].uAm(this.Bp[vc],sb,Ja+(this.fpb+2)*vc,vc!==this.DNd,Yb)}lbb(){let Ja=0,sb=0;this.mjc&&(Ja=this.DHc,sb=-6);for(let Yb=0;Yb<this.v$a;Yb++)this.U5[Yb].hide(this.Bp[Yb],sb,Ja);this.zIndex=this.u9a;this.visible=this.KGb=!1;this.SFa&&this.dispose()}Qnf(Ja=0){Ja?(this.CRa=!0,U.Task.delay(Ja).continueWith(()=>
{this.FXg?this.eal():this.lnc(!0);this.CRa=!1})):this.FXg?this.hide():this.lnc()}eal(){this.CRa&&this.hide()}hYa(Ja,sb){Ja=this.Pbc;2===sb.type||4===sb.type&&3!==Ja?(this.CRa&&(this.CRa=!1),3!==Ja&&(this.CLh(),3===sb.Co.Jf&&this.Qnf(2E3))):4===sb.type&&3===Ja?(this.CRa&&(this.CRa=!1),this.Qnf()):3!==sb.type||3!==Ja||this.KGb||(1<this.v$a?(this.CRa=!0,U.Task.delay(250).continueWith(()=>{this.lnc(!0);this.CRa=!1})):this.Qnf());this.raiseEvent(gc.mW,sb)}Nxc(Ja){3===Ja.Jf?this.hYa(this,new gc(4,Ja)):
Ja.eventName===sd.a.pointerOver?this.hYa(this,new gc(2,Ja)):Ja.eventName===sd.a.pointerOut&&this.hYa(this,new gc(3,Ja));return!1}ktg(Ja){this.element.style.width=Ja+"px";this.element.style.height=this.fpb+"px"}Iud(Ja){this.Qbm(Ja);Ja=this.lUb(Ja);if(!(0>Ja)){var sb=this.Bp[Ja];Array.removeAt(this.Bp,Ja);delete this.pOc[sb.clientId];sb=this.U5[Ja];this.T8.removeChild(sb.element);this.Tc.get(18,!1)&&sb.U8b(Object(c.a)(this,this.hYa,"onInteractivityChanged"));Array.removeAt(this.U5,Ja);sb.dispose()}}ZGi(Ja=
5){if(this.tOc.length){this.visible&&this.lbb();for(let sb=0;sb<this.tOc.length;sb++)this.Iud(this.tOc[sb]);Array.clear(this.tOc);0>=this.Bp.length||5===Ja?this.hide():Ja||this.zDc()}}lUb(Ja){for(let sb=0;sb<this.Bp.length;sb++)if(this.Bp[sb].clientId===Ja)return sb;return-1}oHl(Ja){if(Ja in this.pOc){var sb=this.lUb(Ja);if(sb){const Yb=this.Bp[sb];Ja=this.pOc[Ja];Array.removeAt(this.Bp,sb);Array.insert(this.Bp,0,Yb);Array.removeAt(this.U5,sb);Array.insert(this.U5,0,Ja);this.T8.removeChild(Ja.element);
this.T8.appendChild(Ja.element);this.lnc()}}}Qbm(Ja){-1===this.lUb(Ja)?m.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.wdc,Ja)&&(Array.remove(this.wdc,Ja),this.Bp[0].clientId===Ja&&0<this.wdc.length&&this.oHl(this.wdc[this.wdc.length-1]),this.Bp[0].clientId===Ja&&1===this.Pbc&&this.lnc())}tRi(Ja){Ja?Sys.UI.DomElement.addCssClass(this.T8,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.T8,"prBackgroundSelection")}Srm(){let Ja,
sb;sb=Ja=0;var Yb=this.DHc;if(this.hgh){const vc=this.hgh(this);if(!vc)return{offsetX:Ja,offsetY:sb,b6h:Yb};const $c=4===this.Pbc;Yb=this.Ayj.IRk(this.v$a,$c?6:this.fpb,this.fpb,this.element,vc);sb=Yb.offsetTop;this.DNd=this.CQk(Yb.j8i,Yb.offsetTop);Yb=Yb.c6h;Yb!==this.DHc&&(this.Iog(Yb),this.element.dir=3===Yb?"rtl":"ltr",this.DHc=Yb);Yb!==this.sTh()?(Ja=$c?-6:-this.fpb,this.mjc=!0):this.mjc=!1}return{offsetX:Ja,offsetY:sb,b6h:Yb}}CQk(Ja,sb){if(1===Ja)return this.v$a-1;Ja=Math.abs(sb);return 0<Ja?
Ja/(this.fpb+2):0}Iog(Ja){for(let sb=0;sb<this.v$a;sb++)this.U5[sb].Iog(Ja)}sTh(){return this.ak?3:4}static Srb(){return String.format("{0}-{1}","presencetooltip",uc.POc++)}static yLf(Ja){return Ja.$a.rawEvent.relatedTarget}}uc.POc=0;Object(f.a)(uc,"ModernPresenceTooltipControl",Gb,[402,13]);var Yc=b(236),wd=b(230);class ee{constructor(Ja){this.Tc=Ja;this.Tc.zTa(10,Yc.a.instance);this.Tc.zTa(9,kc.a.instance);this.Tc.zTa(6,20);this.Tc.zTa(13,wd.a.instance);this.Tc.zTa(17,!1)}frf(Ja,sb=!1){this.Tc.zTa(15,
sb);return new uc(Ja,20,this.Tc)}}Object(f.a)(ee,"ModernPresenceTooltipFactory",null,[401]);class te extends Gb{constructor(Ja,sb){super(Ja);this.Bp=null;this.HSa=sb.get(8,!1);this.Kkb=sb.get(6,0);this.element=Ja;this.element.className=te.TCf;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.Qd=sb.get(10);this.Qd.Ma(sd.a.click,this.element,Object(c.a)(this,this.onClick,"onClick"));this.Eq=sb.get(9);this.Eq.Ma(sd.a.pointerOut,this.element,Object(c.a)(this,this.OQ,"onPointerOut"));
this.Eq.Ma(sd.a.pointerDown,this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior"));this.IK=sb.get(13);this.IK.Ma(this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior"))}vOb(Ja){this.addHandler(gc.mW,Ja)}U8b(Ja){this.removeHandler(gc.mW,Ja)}get wI(){return this.Bp}dispose(){this.element&&(this.Qd.Ib(sd.a.click,this.element,Object(c.a)(this,this.onClick,"onClick")),this.Eq.Ib(sd.a.pointerDown,this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior")),
this.Eq.Ib(sd.a.pointerOut,this.element,Object(c.a)(this,this.OQ,"onPointerOut")),this.IK.Ib(this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Ja,sb,Yb){this.hide();!Ja||0>=Ja.length||(this.HSa?this.element.style.right=sb+"px":this.element.style.left=sb+"px",this.element.style.top=Yb+"px",this.jMj(Ja),this.visible=!0)}jMj(Ja){this.Bp=Ja;we.a.vu(this._ul);for(let sb=Ja.length-1;0<=sb;sb--)this.fja(Ja[sb])}fja(Ja){const sb=
document.createElement("li");sb.style.backgroundColor=Ja.color;sb.style.height=this.Kkb+"px";sb.id="fly_"+Ja.clientId;sb.style.lineHeight=this.Kkb+"px";we.a.eu(sb,Ja.userName);sb.setAttribute("dir","auto");this._ul.appendChild(sb)}onClick(){this.hide();return!1}OQ(Ja){this.raiseEvent(gc.mW,new gc(3,Ja));return!1}}te.TCf="prFlyout UIFont";Object(f.a)(te,"PresenceTooltipFlyoutControl",Gb,[]);class wf extends Gb{constructor(Ja,sb,Yb){super(Ja);this._img=null;this.Bp=[];this.element.className="prGlyph";
this.Tc=sb;this.Ric=this.Tc.get(9);this.uo=this.Tc.get(10);this.IK=this.Tc.get(13);this.ual();this.fja(Yb);this.iUe=!1}get oeb(){return this.Bp.length}get wI(){return this.Bp}vOb(Ja){this.addHandler(gc.mW,Ja)}U8b(Ja){this.removeHandler(gc.mW,Ja)}dispose(){this.POm();super.dispose()}fja(Ja){Array.add(this.Bp,Ja);2===this.oeb?this.rna(!0):1===this.oeb?this.rna(!1):this.rna(this.iUe)}Yfb(Ja){this.Fyk(Ja)&&(1<this.oeb&&this.rna(!0),1===this.oeb?this.rna(!1):1>this.oeb&&this.hide())}show(){this.rna(2<=
this.oeb);this.visible=!0}hide(){this.visible=!1}mQk(Ja){return Ja?this.hSh(0,5):this.hSh(1,4)}Fyk(Ja){for(let sb=0;sb<this.oeb;sb++)if(this.Bp[sb].clientId===Ja)return Ja=this.Bp[sb],Array.removeAt(this.Bp,sb),Ja;return null}rna(Ja){this.iUe!==Ja&&(this._img&&this.element.removeChild(this._img),this._img=this.mQk(Ja),this.element.appendChild(this._img),this.iUe=Ja);this._img.childNodes[0].style.backgroundColor=this.Bp[this.Bp.length-1].color}hSh(Ja,sb){const Yb=this.Tc.get(6,0),vc=this.Tc.get(14);
return rd.createClusteredImageFromClusterWithImageClass(Yb,Yb,this.Tc.get(Ja),this.Tc.get(sb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,vc?vc.cloneNode(!0):null)}f_(Ja){3!==Ja.Jf&&this.raiseEvent(gc.mW,new gc(2,Ja));return!1}onClick(Ja){this.raiseEvent(gc.mW,new gc(1,Ja));return!0}OQ(Ja){3!==Ja.Jf&&this.raiseEvent(gc.mW,new gc(3,Ja));return!1}POm(){this.element&&(this.Ric.Ib(sd.a.pointerDown,this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior")),
this.Ric.Ib(sd.a.pointerOver,this.element,Object(c.a)(this,this.f_,"onPointerOver")),this.Ric.Ib(sd.a.pointerOut,this.element,Object(c.a)(this,this.OQ,"onPointerOut")),this.uo.Ib(sd.a.DE,this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior")),this.uo.Ib(sd.a.click,this.element,Object(c.a)(this,this.onClick,"onClick")),this.IK.Ib(this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior")))}ual(){this.element&&(this.Ric.Ma(sd.a.pointerDown,this.element,
Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior")),this.Ric.Ma(sd.a.pointerOver,this.element,Object(c.a)(this,this.f_,"onPointerOver")),this.Ric.Ma(sd.a.pointerOut,this.element,Object(c.a)(this,this.OQ,"onPointerOut")),this.uo.Ma(sd.a.DE,this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior")),this.uo.Ma(sd.a.click,this.element,Object(c.a)(this,this.onClick,"onClick")),this.IK.Ma(this.element,Object(c.a)(this,this.dna,"stopPropagationAndPreventDefaultBehavior")))}}
Object(f.a)(wf,"PresenceTooltipGlyph",Gb,[]);class cf extends Gb{constructor(Ja,sb,Yb){super(Ja);this.Bp=[];this.iL=[];this.hSa=0;this.lXc=this.agc=!1;this.CMg=null;this.cLd={};this.Tc=Yb;this.ak=Yb.get(8,!1);this.Toa=Yb.get(11,!1);Ja=Yb.get(12,0);this.imageDimension=Yb.get(6,0);this.Jpa=sb;this.element.id=cf.Srb();this.element.className=Gb.ICh(this.ak);Ja&&(this.zIndex=Ja);this.rtl=this.ak;this.ktg(sb);this.vEa=this.createElement("div");this.vEa.className=this.Toa?"prContainerV":"prContainerHr";
this.element.appendChild(this.vEa);this.IVg=Array(this.hSa);for(sb=0;sb<this.hSa;sb++)this.Eea[sb]=new te(this.createElement("div"),this.Tc),this.Eea[sb].vOb(Object(c.a)(this,this.hYa,"onInteractivityChanged")),this.element.appendChild(this.Eea[sb].element)}get tpe(){return ad.a.clone(this.Bp)}get Eea(){return this.IVg}get zhh(){return this.CMg}get qxe(){return this.imageDimension+2}get width(){return this.Toa?this.qxe:this.Jpa}get height(){return this.Toa?this.Jpa:this.qxe}vOb(Ja){this.addHandler(gc.mW,
Ja)}U8b(Ja){this.removeHandler(gc.mW,Ja)}dispose(){if(this.Eea)for(const Ja of this.Eea)Ja.U8b(Object(c.a)(this,this.hYa,"onInteractivityChanged")),fc.a.kB(Ja);fc.a.Hqg(this.iL);this.iL=this.IVg=null;super.dispose()}zDc(){this.lbb();this.jyg();this.visible=!0;this.agc=!1}Vyd(){!this.iL||1>this.iL.length||(this.lbb(),this.visible=!0,this.jyg(),this.npe(this.iL[this.iL.length-1]),this.agc=!0)}$xg(){if(this.iL&&!(1>this.iL.length)){this.visible=!0;this.jyg();var Ja=0;for(const sb of this.iL)this.npe(sb,
Ja++);this.agc=!1;this.lXc=!0}}hide(){this.visible=!1;this.lbb();for(let Ja=0;Ja<this.iL.length;Ja++)this.iL[Ja].hide();this.agc=!1}bvh(){if(!this.lXc)return!1;let Ja=0;for(const sb of this.Eea)sb.visible&&Ja++;return this.lXc=0<Ja&&(this.Bp.length<=this.hSa?Ja===this.Bp.length:Ja===this.hSa)}fja(Ja){if(!(0>=this.hSa)){Ja.clientId||(Ja.clientId=(cf.POc++).toString());if(Ja.clientId in this.cLd){var sb=this.lUb(Ja.clientId);if(0<=sb){sb=this.Bp[sb];if(sb.color===Ja.color&&sb.userName===Ja.userName)return;
this.Yfb(Ja.clientId)}}sb=this.bvh();var Yb=0;if(this.Bp.length<this.hSa){var vc=new wf(this.createElement("div"),this.Tc,Ja);vc.vOb(Object(c.a)(this,this.hYa,"onInteractivityChanged"));this.ak&&!this.Toa&&0<this.Bp.length?this.vEa.insertBefore(vc.element,this.vEa.firstChild):(this.vEa.appendChild(vc.element),Yb=this.iL.length);Array.add(this.iL,vc)}else this.ak&&!this.Toa?vc=this.iL[0]:(Yb=this.iL.length-1,vc=this.iL[Yb]),vc.fja(Ja);vc.show();this.cLd[Ja.clientId]=vc;Array.add(this.Bp,Ja);this.i5i(vc,
Yb);sb&&this.$xg()}}Yfb(Ja){const sb=this.bvh();sb&&this.lbb();this.Iud(Ja);this.Bp.length>=this.hSa&&this.iL.length<this.hSa&&this.v7l();0>=this.Bp.length?this.hide():sb&&this.$xg()}Iud(Ja){var sb=this.lUb(Ja);0>sb||(Ja=this.Bp[sb],Array.removeAt(this.Bp,sb),sb=this.cLd[Ja.clientId],delete this.cLd[Ja.clientId],sb.Yfb(Ja.clientId),this.i5i(sb),0>=sb.oeb&&(this.vEa.removeChild(sb.element),Array.remove(this.iL,sb),sb.dispose()))}v7l(){var Ja=this.wVk();!Ja||1>=Ja.wI.length||(Ja=Array.clone(this.Bp),
Ja.forEach(sb=>{this.Iud(sb.clientId)}),Ja.forEach(sb=>{this.fja(sb)}))}lUb(Ja){for(let sb=0;sb<this.Bp.length;sb++)if(this.Bp[sb].clientId===Ja)return sb;return-1}wVk(){return this.ak&&!this.Toa?this.iL[0]:this.iL[this.iL.length-1]}position(Ja,sb){this.element.style.top=sb+"px";this.element.style.left=Ja+"px"}jyg(){for(let Ja=0;Ja<this.iL.length;Ja++)this.iL[Ja].show()}lbb(){for(let Ja=0;Ja<this.hSa;Ja++)this.Eea[Ja].hide();this.lXc=!1}npe(Ja,sb=0){if(Ja)if(this.CMg=Ja,this.Toa){const Yb=this.imageDimension;
if(1<Ja.wI.length)this.Eea[sb].show(Ja.wI,Yb,this.height-this.imageDimension);else{const vc=this.vEa.children.length;for(let $c=0;$c<this.vEa.children.length;$c++)Ja.element===this.vEa.children[$c]&&this.Eea[sb].show(Ja.wI,Yb,this.height-(vc-$c)*this.qxe+2)}}else this.Eea[sb].show(Ja.wI,this.width,0)}hYa(Ja,sb){var Yb=Object(y.a)(wf,Ja);Yb=Yb?this.QMh(Yb):-1;if(2===sb.type||1===sb.type&&-1!==Yb&&!this.Eea[Yb].visible)this.npe(Ja);else if(1===sb.type)this.lbb(),this.agc=!1;else if(3===sb.type){if(this.eAf(sb.Co))return;
this.agc||this.lbb()}this.raiseEvent(gc.mW,sb)}eAf(Ja){Ja=cf.yLf(Ja);let sb=!1;for(const Yb of this.Eea)if(we.a.fcb(Yb.element,Ja)){sb=!0;break}return this.vEa!==Ja&&we.a.fcb(this.vEa,Ja)||sb}i5i(Ja,sb=0){const Yb=this.Ail(Ja);Yb&&0>=Ja.oeb?this.Eea[sb].hide():Yb?this.npe(Ja):this.Eea[sb].hide()}QMh(Ja){let sb=0;for(const Yb of this.iL){if(Ja===Yb)return sb;sb++}return-1}Ail(Ja){const sb=this.QMh(Ja);return!!this.zhh&&Ja===this.zhh&&-1!==sb&&this.Eea[sb].visible}ktg(Ja){this.hSa=Ja===this.imageDimension?
1:Math.floor(Ja/this.qxe);this.Toa?(this.element.style.height=Ja+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=Ja+"px",this.element.style.height=this.imageDimension+"px")}static Srb(){return String.format("{0}-{1}","presencetooltip",cf.POc++)}static yLf(Ja){Ja=Ja.$a.rawEvent;return Ja.relatedTarget||Ja.toElement}}cf.POc=0;Object(f.a)(cf,"PresenceTooltipControl",Gb,[402,13]);class xb{constructor(Ja){this.Tc=Ja;this.Tc.zTa(10,Yc.a.instance);this.Tc.zTa(9,kc.a.instance);
this.Tc.zTa(6,16);this.Tc.zTa(13,wd.a.instance)}frf(Ja){return new cf(Ja,16,this.Tc)}}Object(f.a)(xb,"PresenceTooltipFactory",null,[401]);class Mb{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa=!1){this.zjb=null;this.pPe=!0;this.o2e=this.Ap=this.WHe=null;this.la=new Ba.a;this.dSa=Ja;this.Oia=sb;this.H8g=Yb;this.LUc=vc;this.bOg=Md;Mb.Za=$c;this.Pyj=Re;this.s0=Qf;this.Qzj=Xa;U.Task.WAA(sb,Yb).continueWith(Object(c.a)(this,this.ddl,"initOnTaskReady"))}SOj(Ja){this.la.addHandler("u",Ja)}BDi(){this.la.raiseEvent("u",
null,this)}ddl(){this.Oia.result&&this.H8g.result&&(this.Ap=this.Oia.result,this.o2e=this.H8g.result,this.Ap.FHa(Object(c.a)(this,this.aO,"onPresenceUpdated")),this.WHe=new Ra.a(2,2,this.bOg,Object(c.a)(this,this.zQm,"updateAwayClientsTask"),88),Mb.Za.Eb(this.WHe))}aO(Ja,sb){(this.pPe||this.o7l(sb.Hva))&&Mb.Za.z2(this.WHe,0)}o7l(Ja){for(let Yb in Ja){var sb=this.LUc.nae({key:Yb,value:Ja[Yb]});if(sb&&sb.clientId&&(sb=sb.clientId.toLowerCase(),(sb=this.zjb[sb]||this.zjb[sb.toUpperCase()])&&2===sb.status))return!0}return!1}zQm(Ja){var sb=
this.Ap.fad();if(sb){var Yb=new Date,vc=!1;if(this.pPe){this.zjb=sb;this.pPe=!1;var $c=this.zjb;for(var Md in $c){sb=Md;var Re=$c[Md];Re.iwc<Yb&&(Yb=Re.iwc);2===Re.status&&(vc=!0,this.o2e.Jud(sb))}vc&&this.BDi();Mb.Za.z2(Ja,this.rXh(Yb))}else{Re=new P.a;Md=!1;var Qf=this.zjb;for($c in Qf){Qf=$c;if(!(Qf in this.zjb)||this.dSa.clientId===Qf)continue;var Xa=this.zjb[Qf];const vb=sb[Qf];if(Xa&&vb){Xa=Xa.status;const Pb=vb.status;2===Xa&&1===Pb?(Re.add(Qf),m.ULS.sendTraceTag(38052609,392,50,Qf+" returned from away")):
1===Xa&&2===Pb&&(Md=vc=!0,this.o2e.Jud(Qf),m.ULS.sendTraceTag(38052610,392,50,Qf+" went away"));1===Pb&&vb.iwc<Yb&&(Yb=vb.iwc)}}this.zjb=sb;Mb.Za.z2(Ja,this.rXh(Yb));(0<Re.count||vc)&&this.BDi();0<Re.count&&!this.Qzj?(Ja=this.uJk(Re),this.DKm(Ja)):Ja=new P.a;(Md||0<Ja.count)&&this.Pyj(Xb.a.Nnf,2)}}}DKm(Ja){if(Ja.count)for(let sb of Ja)Ja=this.s0.Kya(String.format(CommonUIStrings.l_EditorsToastArriving,sb),!1),Ja.image=5,Ja.xsa="CoAuth_AuthorStatus_16x16x32",this.s0.Nz(Ja)}uJk(Ja){const sb=this.Ap.Xrb(),
Yb=new P.a;for(let vc in sb){const $c={key:vc,value:sb[vc]};if(Ja.contains($c.key)){const Md=this.LUc.nae($c);Md&&(Yb.add(Md.userName),Ja.remove($c.key))}}Yb.count||m.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return Yb}rXh(Ja){const sb=new Date;return Math.max(Ja.getTime()+this.bOg-sb.getTime(),0)}}Mb.Za=null;Object(f.a)(Mb,"AwayManager",null,[]);var Ec=b(677);class ud{constructor(Ja=0){this.updates=Ja}get pQf(){return!!this.updates}Tza(Ja){return!!(this.updates&Ja)}Sgb(Ja){this.updates|=
Ja}toString(){if(this.Tza(0))return"none";const Ja=new P.a;this.Tza(1)&&Ja.add("user(s) joined");this.Tza(2)&&Ja.add("user(s) disconnected");this.Tza(4)&&Ja.add("user(s) updated");return Ja.toArray().join(", ")}}Object(f.a)(ud,"UserUpdateEvent",null,[]);var ge=b(35);class Le{constructor(Ja,sb,Yb,vc,$c=null){this.la=new Ba.a;this.bE=this.Gh=null;this.r4g=this.K4g=this.Fi=!1;this.Bp=new Da.a;Ja.continueWith(()=>{this.Gh=Ja.result;this.Gh.FHa(Object(c.a)(this,this.Qvi,"onRtcPresenceUpdate"));this.Gh.fya(Object(c.a)(this,
this.Pvi,"onRtcConnectionChange"));this.iIg(null,null)});sb.continueWith(()=>{this.bE=sb.result;this.bE.i5(Object(c.a)(this,this.wpd,"onEditorsTableUpdated"))});$c&&$c.continueWith(()=>{$c.result.SOj(Object(c.a)(this,this.iIg,"updateUserStatus"));this.iIg(null,null)});this.Zmb=Yb;this.LUc=vc}get wI(){return this.Bp}P_c(Ja){this.la.addHandler("UU",Ja)}eng(Ja){this.la.removeHandler("UU",Ja)}iIg(){if(this.Gh){var Ja=!1,sb=this.Gh.fad();for(let vc in sb){var Yb=sb[vc];const $c=vc;this.wI.Pa($c)&&(Yb=
this.k1i(Yb),Ja=this.wI.J($c).yQb!==Yb||Ja,this.wI.J($c).yQb=Yb)}Ja&&(Ja=new ud(4),this.mue(Ja))}}k1i(Ja){return 1===Ja.status?0:1}Yrb(){this.wI.count||(this.K4g||(ge.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.K4g=!0),this.a_l());const Ja=[];for(let sb of this.wI)Array.add(Ja,sb.value);return Ja}a_l(){if(this.Gh){var Ja=this.Gh.Xrb();this.o6f(Ja)}if(this.bE){Ja=this.bE.Wrb();for(const sb of Ja)sb.Id&&(Ja=this.iDh(sb.Id),this.hIg(new ud,Ja))}}Rli(Ja){({value:Ja}=
this.wI.xb(Ja));return Ja}dispose(){this.Fi||(this.Gh&&(this.Gh.bgb(Object(c.a)(this,this.Qvi,"onRtcPresenceUpdate")),this.Gh.Nud(Object(c.a)(this,this.Pvi,"onRtcConnectionChange"))),this.bE&&this.bE.Pmg(Object(c.a)(this,this.wpd,"onEditorsTableUpdated")),this.Fi=!0)}Pvi(Ja,sb){2===sb.newState&&(Ja=this.o6f(this.Gh.Xrb()),Ja.pQf&&this.mue(Ja))}wpd(Ja,sb){Ja=new ud;var Yb=this.bE.Wrb();m.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
Yb.length,sb.gsi,sb.Jke);const vc=new Da.a;for(var $c of Yb){Yb=$c.Id;const Md=this.iDh(Yb);this.hIg(Ja,Md);vc.W(Yb,Md)}if((sb=sb.leaving)&&0<sb.length)for($c=0;$c<sb.length;$c++)m.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.wI.count,sb.J($c).Id),({value:Yb}=this.wI.xb(sb.J($c).Id)).returnValue?Yb?(this.wI.remove(sb.J($c).Id),Ja.Sgb(2),vc.W(sb.J($c).Id,Yb)):m.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",sb.J($c).Id):
m.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",sb.J($c).Id);sb=this.Gh.Xrb();for(let Md in sb)$c=this.LUc.nae({key:Md,value:sb[Md]}),vc.W($c.clientId,$c);for(let Md of this.wI)vc.Pa(Md.value.clientId)||(m.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",Md.key),this.wI.remove(Md.key),Ja.Sgb(2));Ja.pQf&&this.mue(Ja)}Qvi(Ja,sb){Ja=this.o6f(sb.Hva);for(const Yb of sb.y4d)this.wI.Pa(Yb)&&(Ja.Sgb(2),this.wI.J(Yb).yQb=2);
Ja.pQf&&this.mue(Ja)}o6f(Ja){const sb=new ud;if(!Ja)return sb;for(let vc in Ja){var Yb=this.LUc.nae({key:vc,value:Ja[vc]});Yb&&(Yb=Yb.clone(),this.hIg(sb,Yb))}return sb}hIg(Ja,sb){if(sb){var Yb=sb.clientId;var vc=this.gim(sb);({value:sb}=this.wI.xb(Yb)).returnValue?sb.equals(vc)||(Ja.Sgb(4),this.wI.W(Yb,vc)):(m.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.wI.count,Yb),Ja.Sgb(1),this.wI.W(Yb,vc))}}iDh(Ja){return this.wI.Pa(Ja)?this.wI.J(Ja):fa.a.Sek(Ja)}gim(Ja){if(!Ja||
!Ja.clientId||!this.bE)return Ja;const sb=Ja.clone();sb.yQb=this.tJk(Ja);if(Ja=this.bE.DVa(sb.clientId))sb.isReadOnly=sb.isReadOnly||Ja.IsReadOnly?!0:!1,sb.userName=this.fim(sb,Ja),sb.capabilities=this.CFl(sb.capabilities,Ja.Capabilities),sb.email=sb.email||Ja.SIPAddress||Ja.EmailAddress,Ja.JoinCoauthTime&&(sb.uXa=Ja.JoinCoauthTime);sb.color=this.Zmb.yed(new Ec.a(sb.email,void 0,sb.userName,void 0,sb.isAnonymous,sb.clientId),3);return sb}tJk(Ja){if(!this.Gh)return 2;if(Ja&&Ja.clientId){const sb=this.Gh.fad();
if(Ja.clientId in sb)return this.k1i(sb[Ja.clientId])}return 2}K9j(Ja,sb){sb.Name&&Ja.userName&&sb.Name!==Ja.userName&&!this.r4g&&(this.r4g=!0,ge.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}CFl(Ja,sb){Ja=Ja||new db.a;sb&&(sb.SupportsRealtimeChannel&&Ja.Sgb(1),sb.SupportsRename&&Ja.Sgb(2),sb.SupportsChat&&Ja.Sgb(4));return Ja}fim(Ja,sb){this.K9j(Ja,sb);return sb.Name||Ja.userName||(Ja.isAnonymous||sb.IsAnonymous?CommonUIStrings.l_GuestUserName:null)}mue(Ja){m.ULS.sendTraceTag(42316245,
302,100,"PeopleInfoProvider update detected: {0}",Ja.toString());this.la.raiseEvent("UU")}}Object(f.a)(Le,"PeopleInfoProvider",null,[403,13]);var de=b(238),kf=b(100),mg=b(70),Fd=b(4),xf=b(7),He=b(20),vd=b(81),Eg=b(624),Xg=b(275),zh=b(201);class bd extends Sys.EventArgs{constructor(Ja,sb){super();this.paragraphId=Ja;this.Kwl=sb}}Object(f.a)(bd,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class qf extends Gb{constructor(Ja,sb,Yb,vc,$c,Md=null,Re=null){super(null);this.$Re=this.om=null;this.Cld=
!1;this.uva=0;this.ap=Ja;this.GYc=sb;this.Eq=Yb;this.gf=vc;this.Zna=$c;qf.fHb=0;this.emh=new Da.a;this.aKi=new Da.a;this.su=Md;this.ra=Re;this.Boa=this.ra.zb("PresenceIpRenderedFloodgateTimeLapseSec",30);this.$pa=this.ra.zb("PresenceIpRenderedFloodgateTriggerThreshold",3);this.kKc=0}get Zdb(){return v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}HMj(Ja){this.addHandler("CR",Ja)}tHi(Ja){this.removeHandler("CR",Ja)}Pqe(){this.raiseEvent("CR",new bd(this.ap.ip.paragraphId,this.Cld))}e7f(){if(Object(zh.a)(uc,
this.om)){const Ja=Object(y.a)(uc,this.om);qf.fHb=0<qf.fHb?qf.fHb+1:Ja.u9a+1;Ja.zIndex=qf.fHb;this.element.style.zIndex=String(qf.fHb)}}Ghm(){if(Object(zh.a)(uc,this.om)){const Ja=Object(y.a)(uc,this.om);qf.fHb=Ja.u9a;Ja.zIndex=Ja.u9a;this.element.style.zIndex=String(Ja.u9a)}}oli(){this.su&&!this.kMm()&&this.su.continueWith(()=>{this.su.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.Boa)&&this.kKc++})}kMm(){return this.kKc>=this.$pa}static Wki(){qf.uVg||(qf.uVg=
!0,m.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static Srb(Ja){return qf.obl+Ja.fVh()}}qf.MAi="data-presence-control";qf.Fxi="OverlayControlElementOwner";qf.obl="ipId_";qf.NAi="WacPresence";qf.QVl="PresenceIpPaddingDiv";qf.uVg=!1;qf.fHb=0;Object(f.a)(qf,"APresenceControl",Gb,[1412,13]);class Ci{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.oyd=!1}}Object(f.a)(Ci,"PresenceImageControlStyle",null,[1411]);class Og extends qf{constructor(Ja,
sb,Yb,vc,$c,Md=null,Re=null){super(Ja,sb,Yb,vc,$c,Md,Re);this.Q7g=null}Yfb(Ja){this.om&&this.om.Yfb(Ja)}wBe(){return this.om?this.om.tpe.length:0}updatePosition(Ja){if(this.element&&this.element.parentNode){var sb=this.CVh(Ja);if(sb){var Yb=Sys.UI.DomElement.getBounds(this.element.parentNode),vc,$c;({left:Yb,top:vc,height:$c,width:sb}=this.mXk(sb,Yb,this.element.parentNode,this.gf.instance));this.element.style.top=vc+"px";this.element.style.left=Yb+"px";this.element.style.height=$c+"px";this.element.style.width=
sb+"px";Yb=this.JVh(Ja);me.a.M2(this.element,Yb);Ja=this.EIf(Ja,this.ap.ip.shapeId);this.$Ri(Yb,sb,this.isSelected(Ja),v.AFrameworkApplication.isRtl);this.Ahb()}}}ND(Ja){Ja&&this.element&&Ja===this.Q7g&&(we.a.Yq(this.element),this.om.Yfb(this.ap.user.clientId),this.Pqe())}Jof(Ja,sb,Yb){const vc=new Ci;if(!Yb||!sb)return vc;sb=this.CVh(Ja);if(!sb)return vc;vc.top=sb.y;vc.left=sb.x;vc.height=sb.height;vc.width=sb.width;vc.rotation=this.jZk(Ja);vc.oyd=!0;return vc}mng(Ja,sb,Yb,vc){qf.Wki();this.$Re=
Ja;if(vc){Ja=this.EIf(Ja,this.ap.ip.shapeId);if(!Ja)return;const $c=!this.element;$c&&this.nrf(sb.ownerDocument);$c||!this.element.parentNode?Ja.appendChild(this.element):this.element.parentNode!==Ja&&(this.element.parentNode.removeChild(this.element),Ja.appendChild(this.element));this.om.fja(this.ap.user);this.Q7g=sb;this.element.style.borderColor=this.ap.user.color;this.element.id=qf.Srb(this.ap);Yb.oyd&&(this.element.style.height=Yb.height+"px",this.element.style.top=Yb.top+"px",this.element.style.left=
Yb.left+"px",this.element.style.width=Yb.width+"px",me.a.M2(this.element,Yb.rotation),me.a.M2(this.om.element,-1*Yb.rotation),this.$Ri(Yb.rotation,Yb.width,this.isSelected(Ja),v.AFrameworkApplication.isRtl),this.Ahb())}this.Cld=!vc;this.Pqe()}jZk(Ja){return this.element&&this.element.parentNode&&this.e_h(me.a.getTransform(this.element.parentNode))?this.e_h(me.a.getTransform(this.element)):this.JVh(Ja)}e_h(Ja){return Ja&&-1<Ja.indexOf("deg")&&(Ja=parseInt(Ja.substring(Ja.indexOf("(")+1,Ja.indexOf("deg"))),
!isNaN(Ja))?Ja:0}J4i(Ja){this.element.style.borderColor=this.ap.user.color;this.element.id=qf.Srb(this.ap);this.updatePosition(Ja)}nrf(Ja){this.element=Ja.createElement("div");this.element.setAttribute(qf.MAi,!0);kf.a.xj(this.element,qf.Fxi,this);this.element.className=Og.u0l;this.element.dir=v.AFrameworkApplication.isRtl?"rtl":"ltr";this.om=this.GYc.frf(this.createElement("div"),!0);this.om.fja(this.ap.user);this.om.hide();this.Eq.Ma(sd.a.pointerOut,this.om.element,Object(c.a)(this,this.OQ,"onPointerOut"));
this.Eq.Ma(sd.a.pointerDown,this.om.element,Object(c.a)(this,this.vne,"onTooltipTouch"));Sys.UI.DomElement.addCssClass(this.om.element,qf.NAi);this.element.appendChild(this.om.element)}mXk(Ja,sb,Yb,vc){let $c=Ja.y,Md=Ja.x,Re=Ja.height;Ja=Ja.width;(1<Math.abs(sb.width-Yb.offsetWidth)||1<Math.abs(sb.height-Yb.offsetHeight))&&vc&&($c=Math.round($c/vc.Kh),Md=Math.round(Md/vc.Kh),Re=Math.round(Re/vc.Kh),Ja=Math.round(Ja/vc.Kh));return{left:Md,top:$c,height:Re,width:Ja}}isSelected(Ja){return Sys.UI.DomElement.containsCssClass(Ja,
Xg.a.Ioc)}$Ri(Ja,sb,Yb,vc){this.om.element.style.left="auto";this.om.element.style.top="auto";this.om.element.style.right="auto";this.om.element.style.bottom="auto";Yb=Yb?Math.round(.5*Og.tva)+Og.eLm:0;0<=Ja&&90>Ja||360===Ja?(this.om.element.style.top=-.5*Og.tva-Yb+"px",vc?this.om.element.style.right=sb-.5*Og.tva+"px":this.om.element.style.left=sb-.5*Og.tva+"px"):90<=Ja&&180>Ja?(this.om.element.style.left=-.5*Og.tva-Yb+"px",vc?this.om.element.style.bottom=-.5*Og.tva+"px":this.om.element.style.top=
-.5*Og.tva+"px"):180<=Ja&&270>Ja?(this.om.element.style.bottom=-.5*Og.tva-Yb+"px",vc?this.om.element.style.left=sb-.5*Og.tva+"px":this.om.element.style.right=sb-.5*Og.tva+"px"):(this.om.element.style.right=-.5*Og.tva-Yb+"px",vc?this.om.element.style.top=-.5*Og.tva+"px":this.om.element.style.bottom=-.5*Og.tva+"px")}hi(Ja,sb){const Yb=this.a$d(Ja,sb);return Yb?Yb.properties:(Ja=this.GVh(Ja,sb))?Ja.properties:null}EIf(Ja,sb){var Yb=this.a$d(Ja,sb);return Yb&&(Yb=Yb.Iza(Ja.Hd))?Yb.element:(sb=this.GVh(Ja,
sb))?Object(y.a)(Eg.a,sb).wd(Ja.Ya).htmlElement:null}a$d(Ja,sb){Ja=vd.i(Ja.Aa,5);for(let Yb of Ja)if(Yb.properties.getValue(Fd.a.spc)===sb)return Yb;return null}GVh(Ja,sb){Ja=xf.GraphIterator.xa(Ja.Aa);let Yb=Ja.Ua(6);for(;Yb;){const vc=Yb.properties.getValue(Fd.a.spc);if(He.ImageReader.sx(Yb)&&vc===sb)return Yb;Yb=Ja.xd(6)}return null}hQk(Ja){let sb=mg.a.yd(He.ImageReader.fz(Ja),0);Ja=mg.a.yd(He.ImageReader.Wz(Ja),1);return{Bna:sb,G$k:Ja}}JVh(Ja){Ja=this.hi(Ja,this.ap.ip.shapeId);return He.ImageReader.aT(Ja)}CVh(Ja){var sb=
this.ap.ip;if(!sb||!sb.shapeId)return null;var Yb=this.hi(Ja,sb.shapeId);const vc=this.EIf(Ja,sb.shapeId);if(!Yb||!vc)return null;({Bna:Ja,G$k:sb}=this.hQk(Yb));let $c=1,Md=1;Yb.hasProperty(Fd.a.cO)?(Yb=Yb.getValue(Fd.a.cO),$c+=mg.a.yd(Yb[0],0),Md+=mg.a.yd(Yb[2],1)):($c+=0<vc.offsetWidth?(vc.offsetWidth-Ja)/2:2,Md+=0<vc.offsetHeight?(vc.offsetHeight-sb)/2:2);return new Sys.UI.Bounds(Math.round($c),Math.round(Md),Math.round(Ja),Math.round(sb))}OQ(){this.Toi();return!1}vne(Ja){this.om&&3===Ja.Jf&&(2!==
this.uva?(this.e7f(),this.Ahb()):this.Toi());return!1}Toi(){this.om&&(this.om.zDc(),this.uva=1)}Ahb(){for(let Ja of this.om.tpe)if(Ja.clientId===this.ap.user.clientId&&!Ja.equals(this.ap.user)){this.om.fja(this.ap.user);break}if(this.ap.n_a||2===this.uva)this.om.Vyd(),this.ap.n_a=!1,this.ap.Bfa=!0,this.uva=2;this.ap.Bfa&&1!==this.uva||(this.om.zDc(),this.ap.Bfa=!0,this.uva=1)}}Og.u0l="WACImgPresenceHighlight";Og.tva=20;Og.eLm=6;Object(f.a)(Og,"PresenceImageControl",qf,[]);var Zh=b(250);class ug{constructor(){this.height=
this.top=this.left=this.q$h=0;this.oyd=!1}}Object(f.a)(ug,"PresenceIpControlStyle",null,[1411]);class sh extends qf{constructor(Ja,sb,Yb,vc,$c,Md=null,Re=null,Qf=null){super(Ja,sb,Yb,vc,$c,Md,Re);this.wXc=this.g3a=this.Xjc=null;this.cD=Qf}nrf(Ja){this.element=Ja.createElement("div");this.element.setAttribute(qf.MAi,!0);kf.a.xj(this.element,qf.Fxi,this);this.element.className=qf.QVl;this.element.dir=v.AFrameworkApplication.isRtl?"rtl":"ltr";this.Eq.Ma(sd.a.pointerOver,this.element,Object(c.a)(this,
this.f_,"onPointerOver"));this.Zdb&&(this.Eq.Ma(sd.a.pointerOut,this.element,Object(c.a)(this,this.OQ,"onPointerOut")),this.Eq.Ma(sd.a.pointerDown,this.element,Object(c.a)(this,this.vne,"onTooltipTouch")));this.g3a=this.createElement("div");this.g3a.className=sh.v0l;this.Zdb||(this.wXc=this.createElement("div"),this.wXc.className=sh.y0l,this.g3a.appendChild(this.wXc));this.om=this.GYc.frf(this.createElement("div"),this.Zdb);Ja=this.ra.$("NoPresenceUserLookUpBeforeRender");this.cD&&!Ja&&(this.ap.user=
this.cD.Rli(this.ap.user.clientId)||this.ap.user);this.om.fja(this.ap.user);this.om.hide();Sys.UI.DomElement.addCssClass(this.om.element,this.Zdb?qf.NAi:sh.dYl);this.g3a.appendChild(this.om.element);this.element.appendChild(this.g3a)}f_(Ja){!this.om||this.Zdb&&!this.om.eAf(Ja)||(this.e7f(),this.Ote(Ja));this.J4i(this.$Re);return!1}OQ(){this.om&&this.Mka();return!1}vne(Ja){this.om&&3===Ja.Jf&&(2!==this.uva?(this.e7f(),this.Ote(Ja)):this.Mka());return!1}dmk(){this.Xjc&&(Za.a.instance.xe(this.Xjc),this.Xjc=
null)}Ahb(Ja){for(var sb of this.om.tpe)if(sb.clientId===this.ap.user.clientId&&!sb.equals(this.ap.user)){this.om.fja(this.ap.user);break}sb=!1;sh.ykk===this.ap.user.color?({value:sb}=this.emh.xb(this.ap.user.clientId,sb,!1),sb||(this.emh.W(this.ap.user.clientId,!0),m.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.ap.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):({value:sb}=this.aKi.xb(this.ap.user.clientId,sb,!1),sb||(this.aKi.W(this.ap.user.clientId,!0),m.ULS.sendTraceTag(17954773,
302,50,'{ "ClientID" : "'+this.ap.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Ja||this.ap.n_a||2===this.uva?(this.oli(),this.om.Vyd(),this.ap.n_a=!1,this.ap.Bfa=!0,this.uva=2,sh.gKm):this.ap.Bfa&&1!==this.uva?0:(this.oli(),this.om.zDc(),this.ap.Bfa=!0,this.uva=1,sh.fKm)}Ote(Ja=null){this.dmk();const sb=this.Ahb(!!Ja);this.Zdb&&Ja&&Ja.eventName===sd.a.pointerOver||this.nlm(sb)}Mka(){this.om&&this.uva&&(this.Ghm(),this.om.hide(),this.uva=0)}nlm(Ja){this.Xjc=new Ra.a(2,1,Ja,()=>{this.Xjc=
null;this.Mka()},56);Za.a.instance.Eb(this.Xjc)}updatePosition(Ja){if(this.element&&this.element.parentNode){var sb=this.jWh(Ja);if(sb){Ja=Sys.UI.DomElement.getBounds(this.element.parentNode);sb=new Sys.UI.Bounds(sb.x-Ja.x,sb.y-Ja.y,sh.u$h,sb.height);var Yb;({left:Ja,top:sb,height:Yb}=this.pXk(sb,Ja,this.element.parentNode,this.gf.instance));this.element.style.height=2*sh.zyc+Yb+"px";this.element.style.top=sb-sh.zyc+"px";this.element.style.left=Ja-sh.zyc+"px";this.g3a.style.height=Math.max(sh.Hoi,
Yb)+"px";this.Ote()}}}ND(Ja){Ja&&this.element&&Ja===this.element.parentNode&&(we.a.Yq(this.element),this.Pqe())}Jof(Ja,sb,Yb,vc){const $c=new ug;if(!Yb||!sb)return $c;Ja=this.jWh(Ja);if(!Ja)return $c;Yb=new Sys.UI.Bounds(Ja.x-sb.x,Ja.y-sb.y,sh.u$h,Ja.height);sb=Yb.y;Ja=Yb.x;Yb=Yb.height;const Md=this.gf.instance;vc&&Md&&(vc=Md.Kh,sb=Math.round(sb/vc),Ja=Math.round(Ja/vc),Yb=Math.round(Yb/vc));$c.top=sb-sh.zyc;$c.left=Ja-sh.zyc;$c.height=2*sh.zyc+Yb;$c.q$h=Math.max(sh.Hoi,Yb);$c.oyd=!0;return $c}mng(Ja,
sb,Yb,vc){qf.Wki();this.$Re=Ja;vc&&((Ja=!this.element)&&this.nrf(sb.ownerDocument),Ja||!this.element.parentNode?sb.appendChild(this.element):this.element.parentNode!==sb&&(this.element.parentNode.removeChild(this.element),sb.appendChild(this.element)),sb=this.ap.user.color,this.g3a.style.borderColor=sb,this.Zdb||(this.wXc.style.borderColor=sb),this.element.id=qf.Srb(this.ap),Yb.oyd&&(this.element.style.height=Yb.height+"px",this.element.style.top=Yb.top+"px",this.element.style.left=Yb.left+"px",this.g3a.style.height=
Yb.q$h+"px",this.Ote()));this.Cld=!vc;this.Pqe()}dispose(){this.element&&(this.ND(this.element.parentNode),this.Eq.Ib(sd.a.pointerOver,this.element,Object(c.a)(this,this.f_,"onPointerOver")),this.Zdb&&(this.Eq.Ib(sd.a.pointerOut,this.element,Object(c.a)(this,this.OQ,"onPointerOut")),this.Eq.Ib(sd.a.pointerDown,this.element,Object(c.a)(this,this.vne,"onTooltipTouch"))),fc.a.kB(this.om),this.element=this.om=null)}J4i(Ja){const sb=this.ap.user.color;this.g3a.style.borderColor=sb;this.Zdb||(this.wXc.style.borderColor=
sb);this.element.id=qf.Srb(this.ap);this.updatePosition(Ja)}pXk(Ja,sb,Yb,vc){let $c=Ja.y,Md=Ja.x;Ja=Ja.height;(1<Math.abs(sb.width-Yb.offsetWidth)||1<Math.abs(sb.height-Yb.offsetHeight))&&vc&&($c=Math.round($c/vc.Kh),Md=Math.round(Md/vc.Kh),Ja=Math.round(Ja/vc.Kh));return{left:Md,top:$c,height:Ja}}jWh(Ja){const sb=this.ap.ip;if(!sb)return null;let Yb;try{const vc=sb.w7.cp;Yb=Zh.a.wP(vc,Ja,0<vc,!1,!1,!1)}catch(vc){m.ULS.sendTraceTag(4301318,302,50,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",
Za.a.instance.mz,vc.message,vc.stack),Yb=null}return Yb}}sh.dYl="WacPawn";sh.u$h=2;sh.fKm=7E3;sh.gKm=2E3;sh.zyc=5;sh.v0l="presenceIp";sh.y0l="PresenceSmallBox";sh.Hoi=10;sh.ykk="0xcccccc";Object(f.a)(sh,"PresenceIpControl",qf,[]);class Xd{constructor(Ja,sb,Yb,vc,$c=null,Md=null,Re=null){this.wKc={};this.uKc={};this.RPg={};this.GYc=Ja;this.Eq=sb;this.tl=Yb;this.Zna=vc;this.su=$c;this.ra=Md;this.cD=Re}get Gjk(){return this.wKc}get ADh(){return this.uKc}lXk(Ja){const sb=!!this.ra&&this.ra.$("PeoplesWellExtraButtonInfoIsEnabled");
return Ja.ip.shapeId&&sb?this.qXk(Ja):this.rXk(Ja)}qXk(Ja){const sb=Ja.ip.shapeId.toString();this.RPg[Ja.user.clientId]=sb;const Yb=this.uKc[sb];return Yb?(Yb.ap=Ja,{returnValue:Yb,vBe:!0}):{returnValue:this.uKc[sb]=new Og(Ja,this.GYc,this.Eq,this.tl,this.Zna,this.su,this.ra),vBe:!1}}rXk(Ja){const sb=Ja.user.clientId,Yb=this.wKc[sb];return Yb&&Yb.ap.user.equals(Ja.user)?(Yb.ap=Ja,{returnValue:Yb,vBe:!0}):{returnValue:this.wKc[sb]=new sh(Ja,this.GYc,this.Eq,this.tl,this.Zna,this.su,this.ra,this.cD),
vBe:!1}}kWh(Ja){return this.wKc[Ja]}eQk(Ja){return(Ja=this.uKc[this.RPg[Ja]])&&!Ja.wBe()?Ja:null}Npk(){var Ja=this.wKc;for(const sb in Ja)Ja[sb].dispose();Ja=this.uKc;for(const sb in Ja)Ja[sb].dispose()}}Object(f.a)(Xd,"PresenceControlProvider",null,[]);var bi=b(162);class kg{constructor(){this.Tmb=0}tXh(){this.Tmb++;this.Tmb===Number.MAX_VALUE&&(this.Tmb=1);return this.Tmb}static get instance(){return kg.RTc}}kg.RTc=new kg;Object(f.a)(kg,"PacketIdGenerator",null,[380]);var jf=b(842);class vf{constructor(Ja,
sb,Yb){this.wlm=Ja;this.icl=sb;this.khi=Yb}}Object(f.a)(vf,"SuccessfulInboundReplicationCallbackData",null,[]);class gg{constructor(Ja,sb,Yb,vc,$c,Md,Re){this.Ap=Ja;this.FQe=sb;this.je=Yb;this.SEj=$c;this.ylj=Md;this.fFa=vc;this.wq=Re;this.Ljm.j5(Object(c.a)(this,this.Sjm,"rtcOnUpdateNotificationReceived"))}get Ljm(){return this.Ap}Sjm(Ja,sb){sb.type||(Ja=this.je.lyf>=this.ylj,this.SEj&&Ja?(Ja=this.FQe())?Ja.pzf():m.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):
this.Qq())}Qq(){const Ja=this.FQe();if(!Ja)m.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.fFa()&&Ja.daa){let sb=-1;Object(zh.a)(jf.a,Ja)&&(sb=Ja.me.bU());const Yb=this.wq.le("Task","ShoulderTapInboundReplicationTimer");Ja.Qq(Object(c.a)(this,this.VSl,"onSuccessfulReplication"),null,new vf(sb,Yb,Ja.Yk))}}VSl(Ja){if(Ja=Object(y.a)(vf,Ja)){var sb=Ja.icl.eg.toString(),Yb=this.FQe(),vc=Yb.Yk,$c="";vc!==Ja.khi&&(m.ULS.sendTraceTag(19964236,
500,50,"Time saved due to force inbound on update notification message = {0} ms",Ja.wlm.toString()),$c=this.VTk(Yb,vc,Ja.khi));m.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",$c,sb)}else m.ULS.sendTraceTag(19964235,500,10,"The callback data was null")}VTk(Ja,sb,Yb){const vc=new Sys.StringBuilder;Ja=Ja.node.zc.store.getRevision(sb);if(!Ja)return m.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:sb}),
"";for(vc.append(Ja.id.Lr);sb!==Yb;){vc.append(", ");vc.append(sb.Lr);Ja=Ja.Xj;if(!Ja)break;sb=Ja.id}return vc.toString()}}Object(f.a)(gg,"ContentNotificationManager",null,[]);class gd extends gg{constructor(Ja,sb,Yb,vc,$c,Md,Re){super(Ja,sb,Yb,vc,$c,Md,Re)}static get yua(){return gd.vGa||(gd.vGa=ea.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}static init(){if(va.App.oa){var Ja=va.App.oa.Ca;Ja&&(Ja.D9(gd.dpd),Ja=Ja.Rb)&&(gd.Np=Ja.contentReplicator,gd.Np&&va.App.Hka().continueWith(gd.lpd))}}static lpd(){gd.XGd=
va.App.Hka().result;gd.XGd&&gd.XGd.tk&&gd.yua.dG().continueWith(gd.w6b)}static w6b(){gd.Gh=gd.yua.dG().result;if(gd.Gh){var Ja=v.AFrameworkApplication.K,sb=Ja.$("Box4ThrottleInboundRequests");Ja=Ja.zb("Box4ThrottleInboundsAtUserCount",20);gd.Np.Gsb=()=>gd.Gh.yxb;gd.UGd=gd.UGd||new gd(gd.Gh,()=>gd.Np,gd.XGd,()=>v.AFrameworkApplication.ii,sb,Ja,va.App.oa.so);gd.UGd.Qq()}}static dpd(Ja){gd.UGd||(Ja.rZa(gd.dpd),gd.init())}}gd.UGd=null;gd.vGa=null;gd.Gh=null;gd.Np=null;gd.XGd=null;Object(f.a)(gd,"WordContentNotificationManager",
gg,[]);var Dh=b(48);class Lh{constructor(Ja,sb,Yb,vc,$c,Md){this.lwa=null;this.F8g=Ja;this.Dc=Yb;this.jSa=vc;this.zt=$c;this.Ff=Md;this.UGj=sb}clone(){return new Lh(this.F8g,this.edc.clone(),this.Dc,this.jSa,this.zt,this.Ff)}get edc(){return this.UGj}get cp(){if(null!=this.lwa)return this.lwa;var Ja=this.F8g.paragraphId;if(Ja.equals(Dh.a.nil))return 0;var sb=this.jSa();if(!sb)return 0;Ja=sb.Va(Ja);if(!Ja)return m.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),
0;sb=this.Dc.mqb(this.Dc.rNa(Ja.characterData,Ja.ka),this.edc);if(this.zt&&this.Ff&&Ja.iz){const Yb=Hc.a.sc(Ja,sb);Yb.gb=this.Ff.RJf(Ja,sb,this.edc.h1);sb=this.zt.Iya(Yb,!0)}return sb}Wag(){null==this.lwa&&(this.lwa=this.cp)}equals(Ja){return Ja?this.edc.isEqual(Ja.edc,!1):!1}}Object(f.a)(Lh,"WordPresenceCp",null,[394,42,395]);class Fj{constructor(Ja,sb){this.zt=Ja;this.Ff=sb}create(Ja,sb,Yb,vc){return new Lh(Ja,sb,Yb,vc,this.zt,this.Ff)}}Object(f.a)(Fj,"Factory",null,[382]);var Ag=b(612);class lg extends Sys.EventArgs{constructor(Ja,
sb,Yb){super();this.paragraphId=Ja;this.presence=sb;this.bVf=Yb}}Object(f.a)(lg,"ParagraphChangedEventArg",Sys.EventArgs,[]);class mf{constructor(Ja){this.lwa=Ja}get cp(){return this.lwa}equals(Ja){return Ja?this.cp===Ja.cp:!1}clone(){return new mf(this.lwa)}}Object(f.a)(mf,"PresenceCp",null,[394,42]);class $g{constructor(Ja,sb,Yb,vc,$c){this.paragraphId=Ja;this.cp=sb;this.length=Yb;this.shapeId=vc;this.dryDeletion=$c}}Object(f.a)($g,"SerializablePresenceIpData",null,[]);class Be{constructor(Ja,sb,
Yb,vc=0,$c=0){this.gV=null;Ja&&(this.gV=Dh.a.pe(Ja));this.QQd=new mf(sb);this.tNa=Yb;this.sTd=vc;this.MId=$c}get paragraphId(){return this.gV}get w7(){return this.QQd}get shapeId(){return this.sTd}get dryDeletion(){return this.MId}Fc(){return 0<=this.w7.cp&&!!this.paragraphId&&!this.paragraphId.equals(Dh.a.nil)}getData(){return new $g(this.paragraphId.toString(),this.w7.cp,this.tNa,this.shapeId,this.dryDeletion)}clone(){const Ja=new Be;Ja.gV=this.paragraphId;Ja.QQd=this.w7?this.w7.clone():null;Ja.tNa=
this.tNa;Ja.sTd=this.shapeId;Ja.MId=this.dryDeletion;return Ja}static oRb(Ja){return Ja.paragraphId&&void 0!==Ja.cp&&null!==Ja.cp&&void 0!==Ja.length&&null!==Ja.length?new Be(Ja.paragraphId,Ja.cp,Ja.length,void 0,Ja.dryDeletion):null}}Object(f.a)(Be,"PresenceIp",null,[376,42]);class lf{constructor(Ja,sb){this.ip=Ja;this.user=sb}}Object(f.a)(lf,"SerializablePresenceData",null,[]);class ci{constructor(Ja,sb){this.n_a=this.Bfa=this.Lwc=!1;this.f3a=sb;this.user=Ja}get ip(){return this.f3a}XLf(){return new lf(this.ip?
this.ip.getData():null,this.user.getData())}fVh(){return this.user.clientId+(this.f3a?this.f3a.paragraphId.toString():Dh.a.nil.toString())}Fc(){const Ja=!!this.user&&this.user.Fc(),sb=!this.ip||this.ip.Fc();return Ja&&sb}clone(){const Ja=new ci;Ja.user=this.user?this.user.clone():null;Ja.f3a=this.f3a?this.f3a.clone():null;Ja.Bfa=this.Bfa;Ja.Lwc=this.Lwc;Ja.n_a=this.n_a;return Ja}static oRb(Ja){return Ja?new ci(pa.a.oRb(Ja.user),Ja.ip?Be.oRb(Ja.ip):null):null}}Object(f.a)(ci,"PresenceInfo",null,[378,
42]);class Ji extends Ba.a{constructor(){super();this.fUc={};this.$0a={};this.pVg=!1}get xWl(){return this.fUc}get wdi(){return!!v.AFrameworkApplication.K&&v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled")}Skh(Ja){this.addHandler("PPC",Ja)}MHi(Ja){this.removeHandler("PPC",Ja)}Orc(Ja){return Ja.ip.paragraphId.toString()}Vcf(Ja,sb=!1){this.pVg||(this.pVg=!0,m.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var Yb=({w0l:vc}=this.vtl(Ja)).returnValue;if(vc&&!sb)(Yb=
this.$0a[Ja.user.clientId])&&0<=Yb.length&&(Yb[Yb.length-1].ip.tNa=Ja.ip.tNa);else{Yb||this.bHi(Ja.user.clientId);this.wdi&&Yb&&this.lSm(Ja);sb=this.Orc(Ja);var vc=Ja.user.clientId;var $c=this.fUc[sb]||[],Md=this.$0a[vc]||[];Md.length>=Ji.zni&&(Md=Md.splice(-Ji.mKl,Ji.zni));Yb||Array.add($c,vc);Array.add(Md,Ja);this.fUc[sb]=$c;this.$0a[vc]=Md;Ja.ip.paragraphId.equals(Dh.a.nil)||this.Qig(Ja.ip.paragraphId,Ja,!0)}}vtl(Ja){var sb=this.$0a[Ja.user.clientId];const Yb=!sb||0>=sb.length?null:sb[sb.length-
1],vc=!!Yb&&this.Orc(Yb)===this.Orc(Ja);sb=vc&&Yb.ip.w7.equals(Ja.ip.w7)&&Yb.user.equals(Ja.user);this.wdi&&sb&&Yb.ip.shapeId&&Ja.ip.shapeId&&Yb.ip.shapeId!==Ja.ip.shapeId&&(sb=!1);return{returnValue:vc,w0l:sb}}lSm(Ja){const sb=this.Ljk(Ja);sb&&sb.ip.shapeId&&(Ja.ip.shapeId&&Ja.ip.shapeId===sb.ip.shapeId||this.Qig(sb.ip.paragraphId,sb,!1))}Ljk(Ja){Ja=this.$0a[Ja.user.clientId];return!Ja||0>=Ja.length?null:Ja[Ja.length-1]}bHi(Ja){const sb=this.$0a[Ja];if(sb&&0<sb.length){const Yb=sb[0].ip.paragraphId,
vc=this.Orc(sb[0]);delete this.$0a[Ja];this.bdm(vc,Ja);Yb.equals(Dh.a.nil)||this.Qig(Yb,sb[0],!1)}}WFf(Ja){return this.fUc[Ja]}ead(Ja,sb,Yb,vc=!1){const $c=[],Md=this.WFf(Ja);if(!Md)return $c;for(let Re=0;Re<Md.length;Re++){const Qf=Md[Re],Xa=this.$0a[Qf];let vb=!1;for(let Pb=Xa.length-1;0<=Pb;Pb--){const oc=Xa[Pb];if(vc){if(oc.Bfa&&oc.ip.paragraphId.equals(Dh.a.pe(Ja))){vb=!0;Array.add($c,oc);break}}else if(Object(zh.a)(ci,oc)?oc.ip.tNa===sb:oc.ip.tNa===Yb){vb=!0;oc.Lwc=!0;Array.add($c,oc);this.$0a[Qf]=
Xa.splice(Pb,Xa.length);break}}!vb&&0<Xa.length&&Xa[0].Lwc&&Xa[0].ip.paragraphId.equals(Dh.a.pe(Ja))&&Array.add($c,Xa[0])}return $c}oGk(Ja){if(!Ja||!Ja.wa||!Ja.wa.node)return null;Ja=this.ead(Ja.wa.node.id.toString(),0,0,!0);Ja=this.Q3k(Ja);Ja.sort((sb,Yb)=>Wa.a.localeCompare(sb.userName,Yb.userName));return Ja}Q3k(Ja){if(!Ja||!Ja.length)return[];const sb=[],Yb=new Ag.a(Tb.a.ef());for(let vc=0;vc<Ja.length;vc++){const $c=Ja[vc].user;$c.isAnonymous&&Yb.contains($c.clientId)||!$c.isAnonymous&&$c.email&&
Yb.contains($c.email)||(sb.push($c),Yb.add($c.isAnonymous?$c.clientId:$c.email))}return sb}Qig(Ja,sb,Yb){this.raiseEvent("PPC",new lg(Ja,sb,Yb))}bdm(Ja,sb){Array.remove(this.fUc[Ja],sb)}}Ji.zni=10;Ji.mKl=2;Object(f.a)(Ji,"PresenceDataManager",Ba.a,[1375]);class Fe extends Ji{constructor(Ja,sb){super();this.m2e=this.A5g=!1;this.Vw=Ja;this.va=sb}Vcf(Ja,sb=!1){this.va.isFeatureEnabled(198)&&this.va.isFeatureEnabled(166)&&Object(zh.a)(ci,Ja)?this.A5g||(this.A5g=!0,m.ULS.sendTraceTag(7866380,302,15,"Presence packet received in old format")):
(Object(zh.a)(ci,Ja)&&(this.m2e=!0),super.Vcf(Ja,sb))}Orc(Ja){return this.m2e?super.Orc(Ja):Ja.ip.Gb.toString()}WFf(Ja){if(this.m2e)return super.WFf(Ja);Ja=this.Vw.Va(Dh.a.pe(Ja));if(!Ja)return null;Ja=Ja.ha(Fd.a.Gb,0);return this.xWl[Ja.toString()]}}Object(f.a)(Fe,"WordPresenceDataManager",Ji,[]);var yf=b(1081),Nc=b(1021),vg=b(1587),Rh=b(19);class Fk{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa,vb,Pb,oc,zc,Kc,Sc,ae,Bd,Rf,Ad,Yd,Sd,Jf,Fi,dm){this.hTa=Array(5);this.R$e=this._started=this.a6e=!1;this.k2e=
null;this.b9g=new Ag.a(Tb.a.ef());this.nQd={};this.jVe=!1;this.Xw=Ja;this.Da=vc;this.cD=$c;this.OKb=Md;this.ei=Xa;this.tlj=vb;this.cnb=Pb;this.MC=Yb;this.MWg=oc;this.vQe=zc;this.wQe=Kc;this.Xej=Re;this.zlj=Qf;this.dSa=Sc;this.ni=ae;this.Qb=Bd;this.Za=Rf;this.jeh=Jf;this.Dzj=dm;this.l2e=Yd;this.ra=Sd;this.UPd=sb;this.vR=Ad;Fk.SQd=new Da.a;for(Ja=0;Ja<this.UPd.length;Ja++)this.UPd[Ja].Mam(this);this.OKb.Skh(Object(c.a)(this,this.OAi,"presenceOnParagraphChanged"));this.Xw.FHa(Object(c.a)(this,this.aO,
"onPresenceUpdated"));Fi&&this.ei.mqa(Object(c.a)(this,this.nWl,"pageViewScrolled"));this.Xw.wre(this)}get ile(){return!!this.ra&&this.ra.$("PeoplesWellExtraButtonInfoIsEnabled")}nWl(){var Ja;this.R$e||this.ei.zfa&&(null===(Ja=this.ei.hnf)||void 0===Ja?0:Ja.t7f)||(Ja=new Ra.a(0,1,20,()=>{const sb=new P.a;var Yb=this.cnb.Gjk;for(var vc in Yb){const $c=Yb[vc];$c.Cld&&sb.add($c.ap.ip.paragraphId)}if(this.ile){Yb=this.cnb.ADh;for(const $c in Yb)vc=Yb[$c],vc.Cld&&!sb.contains(vc.ap.ip.paragraphId)&&sb.add(vc.ap.ip.paragraphId)}this.HQh(sb);
this.R$e=!1},72),this.Za.Eb(Ja),this.R$e=!0)}dui(){this.a6e&&(this.asg(),this.a6e=!1)}fse(Ja=!1){this.jeh&&!Ja||this.aIi()}aIi(){const Ja=new P.a,sb=this.nQd;for(const Yb in sb)Ja.add(Dh.a.pe(Yb));this.HQh(Ja);this.nQd={}}asg(){this.Da.Ia&&this.pOi(this.Da.Ia.Ra,!0)}ema(Ja,sb){this.pOi(sb.jk.Ra)}pOi(Ja,sb=!1){this.Dzj||(this.MC.rj.V$||sb?Ja?(sb=this.fhk(Ja))?this.Xw.gsg(sb):(this.Xw.gsg(null),m.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Ja.wa.contextId)):this.Xw.gsg(null):
this.a6e=!0)}fhk(Ja){if(!this.ile||!Ja.bMa)if(Ja=Rh.SelectionEditor.gk(Ja,!0,!1),!Rh.SelectionEditor.Sm(Ja))return null;return this.pjf(Ja)}pjf(Ja){const sb=Ja.wa.cpBegin,Yb=Ja.wa.node.id;Ja=this.vQe(Ja.wa.node);return new Be(Yb.toString(),sb,Ja)}aO(Ja,sb){Ja=sb.Hva;for(var Yb in Ja){const vc=Ja[Yb];this.ra.$("CashTelemetryIsEnabled")&&this.M8c(vc,new Date,null);vc.ip?this.Ocf(vc):this.Jud(vc.user.clientId)}sb=sb.y4d;for(Yb=0;Yb<sb.length;++Yb)this.Fmk(sb[Yb]);this.fse()}M8c(Ja,sb,Yb){if(this.l2e)if(Ja&&
Ja.user&&Ja.user.clientId){var vc=Ja.user.clientId;this.b9g.contains(vc)||(this.k2e?(this.k2e.M8c(vc,sb,null,Fk.tZk(Yb||Ja.user.client)),this.b9g.add(vc)):this.l2e.continueWith(()=>{this.k2e=this.l2e.result;this.M8c(Ja,sb,Yb)}))}else m.ULS.sendTraceTag(42262876,302,15,"invalid presence")}nXk(Ja){const sb=new P.a;for(let Yb=0;Yb<Ja.length;Yb++)sb.add(this.H3k(Ja[Yb]));return sb}Ocf(Ja){var sb=null;Ja&&Ja.user&&(sb=Ja.user.client);Ja=Ja.clone();Ja.user=this.cD.Rli(Ja.user.clientId)||Ja.user;this.ra.$("CashTelemetryIsEnabled")&&
this.M8c(Ja,new Date,sb);Ja.Fc()&&!Ja.user.Ju()&&(sb=Ja.user.clientId,Fk.SQd.Pa(sb)||this.y3h(sb),this.nTm(sb),Ja.user.userName=CommonUIStrings.l_AnonymousUserName);this.OKb.Vcf(Ja,!1)}nTm(Ja){let sb=!1;({value:sb}=Fk.SQd.xb(Ja,sb,!1));sb||(Fk.SQd.W(Ja,!0),m.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Ja+'" , "Event" : "CreateAnonymousGrayPawn"}'))}y3h(){}Jud(Ja){this.OKb.bHi(Ja)}Fmk(Ja){this.Jud(Ja);const sb=this.cnb.kWh(Ja);sb&&(sb.tHi(Object(c.a)(this,this.Xag,"onPresenceRendered")),sb.dispose());
this.ile&&(Ja=this.cnb.eQk(Ja))&&(Ja.tHi(Object(c.a)(this,this.Xag,"onPresenceRendered")),Ja.dispose())}yab(Ja){if(12!==Ja.type)return new P.a;Ja=this.OKb.ead(Ja.id.toString(),this.vQe(Ja),this.wQe(Ja));return 0>=Ja.length?new P.a:this.nXk(Ja)}Xag(Ja,sb){sb.paragraphId?this.wTm(sb.paragraphId.toString(),sb.Kwl,this.nQd):m.ULS.shipAssertTag(8758481,302,!1,"null paraid")}wTm(Ja,sb,Yb){!sb&&Ja in Yb&&delete Yb[Ja]}dispose(){this.stop();this.OKb.MHi(Object(c.a)(this,this.OAi,"presenceOnParagraphChanged"));
this.Xw.bgb(Object(c.a)(this,this.aO,"onPresenceUpdated"));this.Xw.WFg(this);for(let Ja=0;Ja<this.UPd.length;Ja++)this.UPd[Ja].xPm(this);fc.a.Hqg([this.Xej,this.zlj,this.Xw]);this.cnb.Npk()}H3k(Ja){let sb=!1;Ja=({vBe:sb}=this.cnb.lXk(Ja)).returnValue;sb||Ja.HMj(Object(c.a)(this,this.Xag,"onPresenceRendered"));return Ja}Q1h(Ja){Ja=this.MC.Va(Ja);if(!Ja)return this.hTa[0]||(m.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.hTa[0]=!0),null;if(!Cc.ParagraphReader.Mb(Ja))return this.hTa[1]||
(m.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.hTa[1]=!0),null;if(!Ja.wd(this.ei.Ya))return this.hTa[2]||(m.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.hTa[2]=!0),null;if(!Ja.anchor)return this.hTa[3]||(m.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.hTa[3]=!0),null;this.hTa[4]||(m.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.hTa[4]=!0);return Ja}IGi(Ja){Ja=this.OKb.ead(Ja.toString(),-1,-1,!0);if(!ad.a.Ud(Ja))for(let sb of Ja)(Ja=
this.cnb.kWh(sb.user.clientId))&&Ja.element&&Ja.ND(Ja.element.parentNode)}HQh(Ja){if(Ja.count){var sb=new P.a;for(var Yb of Ja)(Ja=this.Q1h(Yb))?sb.add(Ja):this.IGi(Yb);if(sb.count){Yb=this.Qb.wc(2);try{Yb.set(this.ni);for(let vc of sb)this.eHh(vc)}finally{Yb&&Yb.dispose()}}}}eHh(Ja){Ja.wD(this.ei.Ya,32,!0);Ja.wD(this.tlj,32,!0)}slm(Ja){this.nQd[Ja.toString()]=null;this.jeh&&!this.jVe&&(Ja=new Ra.a(0,1,200,()=>{this.jVe=!1;this.aIi()},70),this.Za.Eb(Ja),this.jVe=!0)}OAi(Ja,sb){sb.paragraphId&&(Ja=
this.MC.Va(sb.paragraphId))&&((Object(zh.a)(ci,sb.presence)?this.vQe(Ja):this.wQe(Ja))===sb.presence.ip.tNa&&this.slm(sb.paragraphId),this.ile&&this.x0l(sb))}x0l(Ja){if(Ja.presence.ip.shapeId&&!Ja.bVf){var sb=this.cnb.ADh[Ja.presence.ip.shapeId.toString()];sb&&sb.Yfb(Ja.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.Da.EBa(Object(c.a)(this,this.ema,"onSetSelectionFinished")),this.MWg.bse(Object(c.a)(this,this.dui,"onGraphOutboundReplication")))}start(){if(!this._started){this._started=
!0;this.Da.KB(Object(c.a)(this,this.ema,"onSetSelectionFinished"));this.MWg.WXd(Object(c.a)(this,this.dui,"onGraphOutboundReplication"));var Ja=this.Xw.Xrb();delete Ja[this.dSa.clientId];this.aO(null,new vg.a(Ja,[]));this.asg()}}Vwe(Ja){if(Ja&&Ja.Fc()&&Ja.ip){var sb=this.OKb.ead(Ja.ip.paragraphId.toString(),-1,-1),Yb=!1,vc=null;for(let $c=0;$c<sb.length;$c++)if(vc=sb[$c],vc.user.clientId===Ja.user.clientId){Yb=vc.n_a=!0;break}if(Yb)if(sb=vc.ip.paragraphId,Ja=this.Q1h(sb)){sb=this.Qb.wc(2);try{sb.Wa(Ja),
this.eHh(Ja)}finally{sb&&sb.dispose()}}else this.IGi(sb)}}static tZk(Ja){return Ja?Ja?1===Ja?1:2===Ja?2:0:2:0}}Fk.SQd=null;Object(f.a)(Fk,"PresenceManager",null,[1371,13,337,1372,1373,1374]);class il{constructor(Ja,sb,Yb,vc){this.Rec=null;this._started=this.MTe=!1;this.rNb=null;this.Gh=vc;this.Da=sb;this.cMe=Ja;this.gj=Yb;this.Gh.wre(this)}start(){this._started||(this._started=!0,this.rNb={},this.cMe.Skh(Object(c.a)(this,this.rvi,"onPresenceOnParagraphChanged")),this.Da.KB(Object(c.a)(this,this.Sta,
"onProcessSetSelectionFinished")),this.y5i(this.Da.Ia))}stop(){this._started&&(this._started=!1,this.rNb=null,this.cMe.MHi(Object(c.a)(this,this.rvi,"onPresenceOnParagraphChanged")),this.Da.EBa(Object(c.a)(this,this.Sta,"onProcessSetSelectionFinished")))}Sta(Ja,sb){if(!v.AFrameworkApplication.ii&&(Ja=this.y5i(sb.jk),this.Rec&&Ja)){Ja=this.cMe.ead(this.Rec.toString(),-1,-1,!0);for(sb=0;sb<Ja.length;sb++)this.rNb[Ja[sb].user.clientId]=Ja[sb];0>=Ja.length||(Ja=this.Dek(Ja),this.gj.sendNotification(Ja,
!0))}}Dek(Ja){if(1===Ja.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,Ja[0].user.userName);const sb=[],Yb=Ja.length;for(let vc=0;vc<Yb;vc++)Array.add(sb,Ja[vc].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,sb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}rvi(Ja,sb){this.Da.Ia&&!v.AFrameworkApplication.ii&&this.MTe&&this.Rec&&this.Rec.equals(sb.paragraphId)&&(Ja=null,!sb.bVf||sb.presence.user.clientId in this.rNb?
sb.bVf||(Ja=this.zCh(sb.presence.user.userName,!1),delete this.rNb[sb.presence.user.clientId]):(Ja=this.zCh(sb.presence.user.userName,!0),this.rNb[sb.presence.user.clientId]=sb.presence),Ja&&this.gj.sendNotification(Ja,!0))}zCh(Ja,sb){return String.format(sb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Ja)}dispose(){this.Gh.WFg(this);this.stop()}y5i(Ja){if(!Ja)return!1;Ja=Ja.Ra;if(!Ja)return!1;Ja=Ja.wa;if(!Ja)return!1;this.MTe=Rh.SelectionEditor.Le(Ja);Ja=
Ja.node.id;if(Ja.equals(this.Rec)||!this.MTe)return!1;this.Rec=Ja;this.rNb={};return!0}}Object(f.a)(il,"PresenceAccessibilityManager",null,[13,337]);class cj{constructor(Ja,sb){this._started=!1;this.bE=null;this.SLd=!1;this.Gh=Ja;sb&&(this.bE=sb,this.bE.i5(Object(c.a)(this,this.wpd,"onEditorsTableUpdated")));this.Gh.wre(this)}start(){this._started||(this._started=!0,this.bE?this.$Ni():this.Gh.$Q(1,this.CBh()))}wpd(){this._started&&this.$Ni()}$Ni(){const Ja=this.SLd;(this.SLd=!!this.bE.gm)&&!Ja&&this.Gh.$Q(1,
this.CBh())}CBh(){const Ja={};Ja.Id="{"+v.AFrameworkApplication.userSessionId.toUpperCase()+"}";Ja.HQ=!1;Ja.NT=1;Ja.WEB=!0;return Ja}stop(){this._started&&(this._started=this.SLd=!1)}dispose(){this.Gh.WFg(this);this.bE&&this.bE.Pmg(Object(c.a)(this,this.wpd,"onEditorsTableUpdated"))}}Object(f.a)(cj,"EditorsTableNotifier",null,[13,337]);var Si=b(324),ch=b(27),$e=b(1288);class Gf extends Fk{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa,vb,Pb,oc,zc,Kc,Sc,ae,Bd,Rf,Ad,Yd,Sd,Jf,Fi,dm,hi,jj,ac,Tn,yl,em){super(Ja,
sb,Yb,vc,$c,Md,Re,Qf,Xa,vb,Pb,zc,Kc,Sc,ae,Ad,Yd,Sd,Jf,Fi,dm,hi,jj,yl);this.je=null;oc.La(ch.a.HVi,ob.a.application,Gf.MKj,64);oc.La(ch.a.Qre,ob.a.application,Gf.Qre,64);oc.La(ch.a.iqe,ob.a.application,Gf.iqe,96);oc.La(yb.a.Vwe,ob.a.application,Gf.ABm,64);this.GF=Bd;this.Dc=Rf;this.PNb=ac;this.dSa.izc=Tn;this.dSa.izc.tOj(Gf.svi);em.continueWith(()=>{this.je=em.result});m.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized")}get Qa(){return ea.a.instance.resolve("Box4.IFeatureHelper")}g6(Ja){if(!Ja||
!Ja.anchor)return null;for(Ja=Ja.anchor.Ss;Ja;Ja=Ja.sC)if(Ja.pLa)return Ja.ws.node;return null}pjf(Ja){var sb=null;sb=v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled");if(this.Qa.isFeatureEnabled(198)&&this.Qa.isFeatureEnabled(166)){var Yb=Ja.wa.cpBegin,vc=Ja.wa.node;sb&&He.ImageReader.sx(vc)&&(vc=this.g6(vc));if(!vc)return m.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;vc=this.wQe(vc);const Md=Ja.wa.node.ha(Fd.a.Gb,0);if(!this.GF)return m.ULS.sendTraceTag(35997152,
302,15,"paragraphWordIdMapping is null"),null;var $c=this.GF.value.iKa(Md);const Re=Gf.Vw.Va($c);if(!Re)return m.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+$c),null;Yb=this.Dc.DGc(this.Dc.rNa(Re.characterData,Re.ka),Yb);Yb.h1=-1===Ja.wa.gb?0:Ja.wa.gb;$c=0;sb&&Ja.bMa&&($c=this.N_k(Ja));sb=new $e.a(this.GF.value,Md,vc,Yb,this.Dc,()=>Gf.Vw,this.PNb,$c)}else sb=super.pjf(Ja);return sb}N_k(Ja){const sb=He.ImageReader.Aza(Ja.wa);return sb?sb.properties.ha(Fd.a.spc,0):Ja.wa.node.properties.ha(Fd.a.spc,
0)}y3h(Ja){this.je&&this.je.yJ&&this.je.yJ.Qq(Object(c.a)(this,this.lsk,"editorsReplicatorSucceededCallback"),Object(c.a)(this,this.ksk,"editorsReplicatorFailedCallback"),Ja)}lsk(Ja){const sb=!!this.je.ro.DVa(Ja);m.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",Ja,sb)}ksk(Ja,sb){m.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",sb,Ja)}static get Xx(){return ea.a.instance.resolve("Common.Utils.IAriaNotifier")}static dG(){return Gf.QOc.task}static get_instance(){return Gf.RQd.task}static sXk(){return Gf.G8g.task}static get yua(){return Gf.vGa||
(Gf.vGa=ea.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}static init(){Gf.RQd||(Gf.RQd=new x.a);Gf.yVg&&(m.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),Gf.yVg=!1);if(va.App.oa){var Ja=va.App.oa.Ca;Ja?(Ja.D9(Gf.dpd),Gf.AKb=Ja.nc,Gf.AKb&&Gf.AKb.Bi?(Gf.WO=Ja.Rb.contentReplicator,Gf.WO?(Gf.Vw=Ja.Rb.zc,Gf.Vw?Gf.yua.dG().continueWith(Gf.$Rl):m.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):
m.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):m.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):m.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else m.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static $Rl(){Gf.Gh=
Gf.yua.dG().result;if(Gf.Gh){var Ja=[];Array.add(Ja,Gf.AKb.yyc);Array.add(Ja,Gf.AKb.editingView.yyc);var sb=lb.a.instance,Yb=ea.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),vc=new il(Yb,sb,Gf.Xx,Gf.Gh),$c=v.AFrameworkApplication.K.$("DoNotAddToEditorsTableOnFrameIsEnabled")?va.App.Ob.ro:null;$c=new cj(Gf.Gh,$c);var Md=ea.a.instance.Pd("WordEditor.IParagraphWordIdMapping"),Re=ea.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Qf=ea.a.instance.resolve("Common.IPeopleInfoProvider");
Gf.ta=new Gf(Gf.Gh,Ja,Gf.Vw,sb,Qf,Yb,vc,$c,Gf.AKb,Gf.AKb.editingView.Ya,ea.a.instance.resolve("Box4.Presence.PresenceControlProvider"),v.AFrameworkApplication.qa,Gf.WO,Cc.ParagraphReader.textLength,Cc.ParagraphReader.wra,ea.a.instance.resolve("Box4.Presence.MyPresenceUser"),Md,Re,va.App.rh.Ej,new Si.a,Za.a.instance,yf.a.get_instance(),la.a.Jp(ea.a.instance.Fa("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),v.AFrameworkApplication.K,v.AFrameworkApplication.K.$("Box4ThrottleAndBatchPresenceRendering"),
v.AFrameworkApplication.K.$("Box4DoNotRenderPresenceOutOfView"),ea.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),ea.a.instance.resolve("Common.IPresenceStatusProvider"),!va.App.lq&&!va.App.Hm,va.App.Hka());m.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");Gf.RQd.We(Gf.ta);Gf.QOc.We(Gf.ta);Gf.G8g.We(Gf.ta);Ja=ea.a.instance;Ja.ia("WordEditor.Presence.WordPresenceManager",()=>Gf.ta).as("Common.IPresenceRemover").as("Common.IPresenceSender").fa();Ja.resolve("WordEditor.Presence.WordPresenceManager")}else m.ULS.sendTraceTag(4203468,
302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static dpd(Ja){Gf.ta||(m.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Ja=Object(y.a)(18,Ja))&&Ja.rZa(Gf.dpd),Gf.init())}static svi(){Gf.ta.asg()}static MKj(Ja,sb,Yb,vc,$c){Yb=$c.split(",");if(!Yb||3!==Yb.length)return 8;Ja=Yb[0].trim();sb=Yb[1].trim();Yb=Number.parseInvariant(Yb[2].trim());Ja=new ci(new pa.a(Ja),new Be(sb,Yb,-1));if(!Gf.QOc.task.isCompleted)return 8;
sb=Gf.dG().result;sb.Ocf(Ja);sb.fse();return 32}static Qre(Ja,sb,Yb,vc,$c){if(!Gf.QOc.task.isCompleted)return 8;Ja=Gf.dG().result;Ja.Jud($c);Ja.fse();return 32}static ABm(Ja,sb,Yb,vc,$c){if(!Gf.QOc.task.isCompleted)return 8;Ja=Gf.dG().result;if(!Ja)return 8;Ja.Vwe($c);return 32}static iqe(Ja,sb,Yb,vc,$c){if(1===Yb)return 32;if(!Gf.yua.dG().isCompleted)return 8;Ja=Gf.yua.dG().result;if(!Ja)return m.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;$c[Nc.a.Value]=
2===Ja.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Ja.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:"";return 32}}Gf.ta=null;Gf.yVg=!0;Gf.RQd=new x.a;Gf.QOc=new x.a;Gf.G8g=new x.a;Gf.Vw=null;Gf.AKb=null;Gf.WO=null;Gf.Gh=null;Gf.vGa=null;Object(f.a)(Gf,"WordPresenceManager",Fk,[]);class xg{constructor(Ja){this.la=new Ba.a;this.GX=Ja;this.GX.CWR(()=>this.GX.result.JMj(()=>{this.la.raiseEvent("X")}))}tOj(Ja){this.la.addHandler("X",Ja)}Jem(Ja){this.la.removeHandler("X",
Ja)}getStatus(){return this.GX.isCompleted&&this.GX.result?this.GX.result.l6c.toString():"0"}}Object(f.a)(xg,"WordPresenceStatusProvider",null,[381]);class di{constructor(Ja,sb,Yb,vc){this.Gh=null;this.tVg=this.lYe=!1;this.je=Ja;this.CR=sb;this.Oia=Yb;Yb.continueWith(Object(c.a)(this,this.aSl,"onRtcReady"));this.Ruj=vc;this.Ruj.L2f=this.CR}aSl(){this.Oia.isCompleted&&this.Oia.result?(this.Gh=this.Oia.result,this.Gh.FHa(Object(c.a)(this,this.aO,"onPresenceUpdated")),m.ULS.sendTraceTag(5604372,302,
50,"Presence Update Monitor is ready.")):m.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")}aO(Ja,sb){Ja=sb.Hva;for(const Yb in Ja)if(sb=Ja[Yb],!this.lYe&&sb.user.JQ&&sb.user.JQ!==this.CR.JQ){m.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.CR.JQ,sb.user.JQ);this.lYe=!0;break}this.lYe&&this.Gh.bgb(Object(c.a)(this,this.aO,"onPresenceUpdated"));this.tVg||(m.ULS.sendTraceTag(5604374,302,50,"First presence received"),
this.tVg=!0)}}Object(f.a)(di,"WordPresenceUpdateMonitor",null,[]);var cn=b(446),Nm=b(1164),Lf=b(151),dj=b(1589),ue=b(1590);class Ce{constructor(Ja,sb,Yb,vc,$c,Md,Re){this.la=new Ba.a;this.k_g=this.E0g=this.kWe=this.H2g=!1;this.V$e=this.XVd=0;this.Vkc=null;this.dSa=Md;this.dSa.clientId=Ja.clientId;this.Ap=Ja;this.Cba=sb;this.zR=vc;this.ynj=$c;this.Za=Yb;this.Dkb=new Lf.a;this.vm=Re;this.Cba&&this.Cba.continueWith(()=>{this.Cba.Tn||this.Cba.Sh||this.Cba.result.NXd(Object(c.a)(this,this.ssi,"onAmIAloneChanged"))})}get connectionState(){return this.Ap.connectionState}FHa(Ja){this.la.addHandler("PU",
Ja)}bgb(Ja){this.la.removeHandler("PU",Ja)}fya(Ja){this.la.addHandler("CSC",Ja)}Nud(Ja){this.la.removeHandler("CSC",Ja)}aYd(Ja){this.la.addHandler("PSU",Ja)}ese(Ja){this.la.removeHandler("PSU",Ja)}$Xd(Ja){this.la.addHandler("PSC",Ja)}dse(Ja){this.la.removeHandler("PSC",Ja)}jOi(){}get clientId(){return this.Ap.clientId}j5(Ja){this.la.addHandler("UN",Ja)}cBc(Ja){this.la.removeHandler("UN",Ja)}tdl(){this.Vkc=Array(12);for(let Ja=0;12>Ja;Ja++)this.Vkc[Ja]=0;this.E0g=this.vm?this.vm.$("UpdateNotificationTaskExperimentIsEnabled"):
!0;v.AFrameworkApplication.qO(()=>{this.oBl()})}init(){this.Ap.fya(Object(c.a)(this,this.ama,"onConnectionStateChanged"));this.Ap.FHa(Object(c.a)(this,this.aO,"onPresenceUpdated"));this.Ap.aYd(Object(c.a)(this,this.o6b,"onPersistentStateUpdated"));this.Ap.$Xd(Object(c.a)(this,this.Zxc,"onPersistentStateCleared"));this.Ap.j5(Object(c.a)(this,this.m7,"onUpdateNotificationReceived"));this.Oyh();this.tdl()}wre(Ja){this.Dkb.contains(Ja,(sb,Yb)=>sb===Yb)||(this.Dkb.add(Ja),2===this.connectionState&&Ja.start())}WFg(Ja){for(let sb=
0;sb<this.Dkb.length;sb++)if(this.Dkb.J(sb)===Ja){this.Dkb.WB(sb);break}}connect(){this.kWe||this.Ap.connect()}disconnect(){this.Ap.disconnect()}get $vd(){return this.Ap}zFh(Ja){return ci.oRb(Ja)}ysg(Ja,sb){return(new ci(Ja,sb)).XLf()}gsg(Ja){Ja&&Ja.Fc()&&!this.zR()?this.Ap.jOi(this.ysg(this.dSa.ETk(),Ja)):U.Task.z1(null)}Gwd(Ja,sb){return this.Ap.Gwd(Ja,sb)}QEf(Ja){return this.Ap.QEf(Ja)}fad(){return this.Ap.fad()}$Q(Ja,sb,Yb=!1){return this.Ap.$Q(Ja,sb,Yb)}Xrb(){return this.wBh(this.Ap.Xrb())}get yxb(){return this.Ap.yxb}ama(Ja,
sb){2===sb.newState&&this.Dkb.forEach(Yb=>{Yb.start();return!0});sb.newState||this.vm.$("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.kWe||this.Dkb.forEach(Yb=>{Yb.stop();return!0});this.la.raiseEvent("CSC",sb)}ACf(Ja){return Ja.toLowerCase()}aO(Ja,sb){if(!this.zR()){Ja=this.wBh(sb.Hva);sb=this.zBh(sb.y4d);var Yb=new vg.a(Ja,sb);sb=new Ra.a(0,1,0,()=>{this.la.raiseEvent("PU",Yb)},57);this.Za.Eb(sb)}}wBh(Ja){const sb={};for(let vc in Ja){var Yb=vc;const $c=this.zFh(Ja[vc]);$c&&$c.Fc()?sb[this.ACf(Yb)]=
$c:m.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",Yb)}return sb}zBh(Ja){const sb=Array(Ja.length);for(let Yb=0;Yb<Ja.length;Yb++)sb[Yb]=this.ACf(Ja[Yb]);return sb}o6b(Ja,sb){if(!this.zR()){var Yb={};Ja=sb.Hva;for(var vc in Ja)Yb[this.ACf(vc)]=Ja[vc];vc=new Ra.a(0,1,0,()=>{this.la.raiseEvent("PSU",new dj.a(sb.type,Yb))},80);this.Za.Eb(vc)}}Zxc(Ja,sb){if(!this.zR()){Ja=this.zBh(sb.L0d);var Yb=new ue.a(Ja);Ja=new Ra.a(0,1,0,()=>{this.la.raiseEvent("PSC",Yb)},81);this.Za.Eb(Ja)}}m7(Ja,sb){this.E0g?
this.Nwi(sb):(Ja=new Ra.a(0,1,0,()=>{this.Nwi(sb)},58),this.Za.Eb(Ja))}Nwi(Ja){var sb=Date.now();this.la.raiseEvent("UN",Ja);sb=Date.now()-sb;500<=sb&&(this.XVd++,m.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Ja.type,sb),this.fAk(Ja));this.V$e++}fAk(Ja){0>Ja.type||20<=Ja.type?m.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",Ja.type):this.Vkc[Ja.type]++}oBl(){if(!this.k_g){var Ja=
{};Ja.TC=this.V$e;Ja.HRC=this.XVd;this.Vkc&&0<this.XVd&&(Ja.TBC=this.Vkc);this.XVd=this.V$e=0;this.Vkc=null;m.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",Ja);this.k_g=!0}}dispose(){this.Dkb=new Lf.a;this.Ap.Nud(Object(c.a)(this,this.ama,"onConnectionStateChanged"));this.Ap.bgb(Object(c.a)(this,this.aO,"onPresenceUpdated"));this.Ap.ese(Object(c.a)(this,this.o6b,"onPersistentStateUpdated"));this.Ap.dse(Object(c.a)(this,this.Zxc,"onPersistentStateCleared"));this.Ap.cBc(Object(c.a)(this,
this.m7,"onUpdateNotificationReceived"));this.Cba&&this.Cba.continueWith(()=>{this.Cba.Tn||this.Cba.Sh||this.Cba.result.qHi(Object(c.a)(this,this.ssi,"onAmIAloneChanged"))});this.Ap.disconnect();m.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}ssi(){this.Oyh()}Oyh(){let Ja=!1;this.Cba?this.Cba.continueWith(()=>{this.Cba.Tn||this.Cba.Sh||(Ja=!this.Cba.result.amIAlone);this.Ap.connectionState||!Ja&&!this.ynj()?2!==this.Ap.connectionState||Ja||(this.disconnect(),m.ULS.sendTraceTag(4564937,
302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),m.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.H2g&&Ja&&(m.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.H2g=!0)}):(this.connect(),m.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}G9a(){this.kWe=!0;this.disconnect();m.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(f.a)(Ce,
"RtcProxy",null,[1353,13,1216,1354]);class ij extends Ce{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa,vb,Pb,oc,zc){super(Ja,sb,Yb,vc,$c,Md,zc);this.rH=null;this.GF=Re;this.Dc=Qf;this.jSa=Xa;this.RTc=vb;this.H7e=Pb;this.PNb=oc}get zz(){return this.rH||(this.rH=this.H7e())}ama(Ja,sb){2===sb.newState&&m.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.ITm();super.ama(Ja,sb)}ITm(){this.zz&&this.zz.$L("RtcConnectionStatusLabel")}zFh(Ja){return nc.a.P2d(Ib.a(Ja),this.GF,this.Dc,this.jSa,this.PNb)}ysg(Ja,
sb){return Object(zh.a)($e.a,sb)?(Ja=new nc.a(this.RTc.tXh(),Ja,sb),Ib.b(Ja.XLf())):super.ysg(Ja,sb)}}Object(f.a)(ij,"WordRtcProxy",Ce,[]);class uk{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa,vb,Pb,oc,zc){this.iq=new x.a;this.Wbh=!0;this.GOg=Ja;this.Gc=sb;this.Za=Yb;this.zR=vc;this.dSa=$c;this.GF=Md;this.nda=Re;this.jSa=Qf;this.RTc=Xa;this.H7e=vb;this.P4=Pb;this.PNb=oc;this.ra=zc}dG(){this.CMm();return this.iq.task}bcd(){return cn.a.then(this.dG(),Ja=>Ja)}CMm(){if(this.Wbh)if(this.Wbh=!1,va.App.ckd()&&
va.App.VXf()){var Ja=v.AFrameworkApplication.he;if(Ja){Ja=Nm.RealtimeChannel.createInstance("{"+v.AFrameworkApplication.userSessionId+"}",v.AFrameworkApplication.userSessionId,v.AFrameworkApplication.wLi,Ja,this.P4,1,this.Gc,this.ra.Oa("RtcEndpointUrl"),void 0,void 0,null,this.ra.$("FindSessionOnBootIsEnabled")?ea.a.instance.resolve("Common.IFindSessionUtils"):null,this.ra.Oa("RtcBootToken"));var sb=this.ra.$("RtcAlwaysOnEnabled"),Yb=new ij(Ja,sb?null:va.App.Hka(),this.Za,this.zR,uk.SCk,this.dSa,
this.GF,this.nda,this.jSa,this.RTc,this.H7e,this.PNb,v.AFrameworkApplication.K);va.App.stm(Yb);this.Fam(Yb);Yb.init();bi.App.E2=Yb;this.P4.execute(vc=>{vc.e7a(()=>{Yb.G9a()})});this.iq.We(Yb)}else m.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else m.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}Fam(Ja){const sb=ea.a.instance;sb.ia("WordEditor.Presence.WordRtcProxy",()=>Ja).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").fa();
sb.resolve("Common.IRealtimeChannelBasic")}static SCk(){return!1}}Object(f.a)(uk,"WordRtcProxyProvider",null,[370,371]);class Gj{constructor(){this.Z=null;this.Fi=!1}get name(){return"WordEditor.Presence"}init(){m.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");va.App.i9i&&(this.Z.resolve("WordEditor.Presence.WordRtcProxyProvider").dG(),Gf.init(),this.Z.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));va.App.fqb&&gd.init();this.Z.resolve("Common.App.Presence.AwayManager");this.Z.resolve("Common.IPeopleInfoProvider")}dispose(){if(!this.Fi){this.Fi=
!0;Gf.dG().continueWith(()=>{fc.a.kB(Gf.dG().result)});var Ja=this.Z.resolve("Box4.Presence.MyPresenceUser");Ja&&Ja.izc&&Ja.izc.Jem(Gf.svi)}}Nb(Ja){this.Z=Ja;this.Z.ia("Box4.Presence.MyPresenceUser",()=>new Ia).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").fa();Ja.ia("WordEditor.Presence.IWordPresenceCpFactory",()=>new Fj(Ja.resolve("Box4.CharacterPointConverter"),Ja.resolve("Box4.IContentControlReader"))).fa();Ja.ia("WordEditor.Presence.WordPresenceUpdateMonitor",
()=>new di(new G.a(()=>va.App.Ob),de.a.instance,Ja.resolve("WordEditor.Presence.WordRtcProxyProvider").bcd(),Ja.resolve("Box4.Presence.IMyPresenceUser"))).fa();Ja.ia("WordEditor.Presence.WordRtcProxyProvider",()=>new uk(v.AFrameworkApplication.buildVersion,va.App.oa.so,Za.a.instance,()=>v.AFrameworkApplication.ii,ea.a.instance.resolve("Box4.Presence.IMyPresenceUser"),ea.a.instance.sa("WordEditor.ParagraphWordIdMapping"),ea.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),
()=>v.AFrameworkApplication.pa&&va.App.oa.Ca&&va.App.oa.Ca.Rb?va.App.oa.Ca.Rb.zc:null,kg.instance,()=>ea.a.instance.sa("WordEditor.IStatusBarUser"),ea.a.instance.Fa("Common.ISessionExpirationManager"),ea.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),v.AFrameworkApplication.K)).fa().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");Ja.ia("Box4.Presence.PresenceControlProvider",()=>new Xd(Gj.Kik(),kc.a.instance,ea.a.instance.Fa("Common.IZoomManager"),
ea.a.instance.resolve("Box4.ICoauthCashTelemetry"),la.a.Jp(ea.a.instance.Fa("Common.ISystemInitiatedFeedbackWithTimeLapse")),v.AFrameworkApplication.K,Ja.resolve("Common.IPeopleInfoProvider"))).fa();Ja.ia("Common.App.Presence.AwayManager",()=>new Mb(ea.a.instance.resolve("Common.IPresenceUser"),ea.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").bcd(),Gf.sXk(),ea.a.instance.resolve("Common.IPresenceConverter"),Za.a.instance,v.AFrameworkApplication.K.$("AwayStatusOneMinuteTimeoutIsEnabled")?
6E4:v.AFrameworkApplication.K.zb("AwayCoauthorThresholdMs",9E5),Object(c.a)(v.AFrameworkApplication.qa,v.AFrameworkApplication.qa.processAction,"processAction"),va.App.oa.notificationBar,v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"))).fa();Ja.ia("WordEditor.Presence.WordPresenceStatusProvider",()=>new xg(la.a.Jp(ea.a.instance.Fa("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").fa();Ja.ia("Common.App.Presence.PeopleInfoProvider",()=>new Le(Ja.resolve("WordEditor.Presence.WordRtcProxyProvider").bcd(),
va.App.Hka().CWR(()=>va.App.Hka().result.ro),Ja.resolve("Common.App.People.IPeopleColorUtils"),Ja.resolve("Common.IPresenceConverter"),la.a.Jp(Ja.Fa("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").fa();Ja.ia("Box4.Presence.WordPresenceDataManager",()=>new Fe(va.App.oa.Ca.Rb.zc,ea.a.instance.resolve("Box4.IFeatureHelper"))).as("Box4.IPresenceDataManager").fa()}static get uxi(){!Gj.C0e&&va.App.oa&&va.App.oa.yv&&(Gj.C0e=bi.App.Kk.yv.getElementsByClassName("OutlineContainerDisplayWrapper")[0]);
return Gj.C0e}static Kik(){const Ja=v.AFrameworkApplication.K.$("PeoplesWellExtraButtonInfoIsEnabled"),sb=new zb;sb.add(0,rd.getImageClassWithCluster(v.AFrameworkApplication.EZ,"MoreUsersGlyph16"));sb.add(5,v.AFrameworkApplication.Hp);sb.add(1,rd.getImageClassWithCluster(v.AFrameworkApplication.EZ,Ja?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));sb.add(4,v.AFrameworkApplication.Hp);sb.add(12,1);sb.add(8,v.AFrameworkApplication.isRtl);sb.add(16,Gj.m4k);return Ja?new ee(sb):new xb(sb)}static m4k(){return Gj.uxi?
Bb.a.getElementBounds(Gj.uxi):null}}Gj.C0e=null;Object(f.a)(Gj,"WordPresencePackage",null,[2,3]);var xj=b(129);class Em{constructor(Ja,sb){this.Scf=Ja;this.paragraphId=sb}get opType(){return 2}get operation(){return this.Scf}}Object(f.a)(Em,"RttAppliedAddParagraphOp",null,[373]);class Ti{constructor(Ja,sb){this.bgm=Ja;this.paragraphId=sb}get opType(){return 6}get operation(){return this.bgm}}Object(f.a)(Ti,"RttAppliedReplaceSymbolRangeOp",null,[373]);class wl{constructor(Ja,sb){this.egm=Ja;this.paragraphId=
sb}get opType(){return 1}get operation(){return this.egm}}Object(f.a)(wl,"RttAppliedReplaceTextRangeOp",null,[373]);class ke{constructor(Ja,sb,Yb){this.lXi=Ja;this.pxe=sb;this.V5c=Yb}get opType(){return 4}get operation(){return this.lXi}get jHj(){return this.lXi.Wnc()?this.V5c:this.pxe}}Object(f.a)(ke,"RttAppliedSplitParagraphOp",null,[373]);class Ui{constructor(){this.Ojb=new Da.a}T0f(Ja){return Ja.toString()}k_c(Ja,sb){Ja=this.T0f(Ja);this.Ojb.Pa(Ja)||this.Ojb.W(Ja,new P.a);this.Ojb.J(Ja).add(sb)}Bag(Ja){switch(Ja.opType){case 1:var sb=
Object(y.a)(wl,Ja);this.k_c(sb.paragraphId,Ja);break;case 6:sb=Object(y.a)(Ti,Ja);this.k_c(sb.paragraphId,Ja);break;case 4:sb=Object(y.a)(ke,Ja);this.k_c(sb.pxe,Ja);this.k_c(sb.V5c,Ja);break;case 2:sb=Object(y.a)(Em,Ja),this.k_c(sb.paragraphId,Ja)}}IOl(Ja){return this.Lxc(Ja)}Lxc(Ja){Ja=this.T0f(Ja);if(!this.Ojb.Pa(Ja))return new P.a;const sb=this.Ojb.J(Ja);this.Ojb.remove(Ja);for(let Yb of sb)Yb.operation&&(Yb.operation.vda=null);return sb}YUk(Ja){let sb;return({value:sb}=this.Ojb.xb(this.T0f(Ja),
sb)).returnValue?sb:new P.a}KFk(Ja){for(let sb of this.Ojb.values){if(!sb.count)continue;if(2!==sb.J(0).opType)continue;const Yb=sb.J(0);if(Yb.Scf.W7f===Ja)return Yb}return null}}Object(f.a)(Ui,"RttAppliedOpTracker",null,[349]);var hg=b(166),cc;(function(Ja){Ja[Ja.expired=0]="expired";Ja[Ja.dried=1]="dried"})(cc||(cc={}));Object(f.b)("RemoveChangeReason",cc);class xl{constructor(Ja){this._changes=new hg.a;this.oc=Ja}GIj(Ja){if(!Ja)return m.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),
!1;const sb=Ja.Gb,Yb=Ja.Og;this._changes.Pa(sb)||this._changes.add(sb,new hg.a);this._changes.J(sb).W(Yb,Ja);return this.bkk(sb,Yb)?(m.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",sb),this._changes.J(sb).remove(Yb),!1):!0}VJf(Ja,sb){if(!this._changes.Pa(Ja))return null;Ja=this._changes.J(Ja);return Ja.Pa(sb)?Ja.J(sb):null}O$d(Ja){const sb=new P.a;for(let Yb of this._changes.keys){const vc=this._changes.J(Yb);for(let $c of vc.keys){const Md=
vc.J($c);Ja(Md)&&sb.add(Md)}}return sb}TGi(Ja,sb){let Yb=null;({value:Yb}=this._changes.xb(Ja.Gb,Yb)).returnValue?(Ja.activity.W9f(cc[sb]),Yb.remove(Ja.Og),Yb.count||this._changes.remove(Ja.Gb)):m.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",Ja.Gb,sb)}Vlg(Ja){this.TGi(Ja,1)}Ylg(Ja){this.TGi(Ja,0)}bkk(Ja,sb){if(!this._changes.Pa(Ja))return!1;Ja=this._changes.J(Ja);if(!Ja.Pa(sb))return!1;for(var Yb=Ja.J(sb);Yb;){Yb=Yb.rha;if(Yb===sb)return!0;
if(!Ja.Pa(Yb))break;Yb=Ja.J(Yb)}return!1}}Object(f.a)(xl,"RttDataStore",null,[342,343]);var Ne=b(62),gh=b(199),Mh=b(15);class sf{constructor(Ja,sb){this.nm=Ja;if(this.Lp=sb)Ja=this.Lp.ke(12),Ja.Ps(Object(c.a)(this,this.ime,"onGraphNodeConnected")),Ja.ww(Object(c.a)(this,this.Lxc,"onGraphNodeDisconnected")),Ja.Dp(Object(c.a)(this,this.eui,"onGraphPropertyChanged"))}dispose(){if(this.Lp){const Ja=this.Lp.ke(12);Ja.Oga(Object(c.a)(this,this.ime,"onGraphNodeConnected"));Ja.tZa(Object(c.a)(this,this.Lxc,
"onGraphNodeDisconnected"));Ja.qua(Object(c.a)(this,this.eui,"onGraphPropertyChanged"))}}ime(Ja,sb){4===this.nm.opType?m.ULS.shipAssertTag(9204866,355,12===sb.node.type||11===sb.node.type,"Unexpected graph modification detected during RTT edit"):m.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")}Lxc(){m.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")}eui(){m.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")}}
Object(f.a)(sf,"GraphChangeValidator",null,[13]);class qd{constructor(Ja,sb,Yb,vc){this._id=Ja;this.yX=sb;this.Yi=Yb;this.mij=vc}get id(){return this._id}get cpBegin(){return this.yX}get cpEnd(){return this.Yi}get O3j(){return this.mij}fWm(Ja){var sb=this.id===Ja.id;sb&&(sb=this.O3j.replace("\u00a0"," "),Ja=Ja.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),sb=sb===Ja);return sb}}Object(f.a)(qd,"RttOpValidator",null,[392]);var Eh=b(1153);class qi{constructor(Ja,sb){this.vda=
this.s0a=this.activity=null;this.ixj=Ja;this.zuj=sb}get opType(){return this.ixj}get metadata(){return this.zuj}VMf(){return""}serialize(){return null}}Object(f.a)(qi,"RttOp",null,[369]);class bf extends qi{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa){super(Xa,Qf);this.qP=Ja;this.tV=sb;this.Kvj=Yb;this.Jvj=vc;this.xkc=$c;this.BEj=Md;this.oNe=Re}get Gb(){return this.qP}get Og(){return this.tV}get KT(){return this.Kvj}get c7(){return this.Jvj}get rha(){return this.xkc}get jCb(){return this.BEj}get GH(){return this.oNe}QCh(){return this.KT.isEqual(this.c7,
!0)?new Eh.a(0,this.Gb,this.Og,this.KT,void 0,void 0,void 0,this.GH):new Eh.a(1,this.Gb,this.Og,this.KT,this.Gb,this.Og,this.c7,this.GH)}static $1i(Ja,sb,Yb,vc,$c){Ja=Ja.BV;if(1===Ja.Wqe&&(Ja.wYa!==Ja.lNa||Ja.kib!==Ja.UEc))return m.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),sb=Yb=null,vc=$c=-1,{returnValue:!1,KT:sb,c7:Yb,Gb:vc,Og:$c};if(Ja.GH)return sb=Yb=null,vc=$c=-1,{returnValue:!1,KT:sb,c7:Yb,Gb:vc,Og:$c};Yb=sb=Ja.KT;1===Ja.Wqe&&(Yb=Ja.c7);
vc=Ja.wYa;$c=Ja.kib;return{returnValue:!0,KT:sb,c7:Yb,Gb:vc,Og:$c}}}Object(f.a)(bf,"RttReplaceRangeOp",qi,[]);var he=b(1154),dk=b(1397);class Cf{constructor(Ja,sb,Yb,vc,$c,Md){this.vYa=Ja;this.clientId=sb;this.clientType=Yb;this.Q_i=vc;this.PVl=$c;this.y_a=Md}static create(Ja){let sb=null;null!=Ja.y_a&&(sb=Ja.y_a);return new Cf(Ja.vYa,Ja.clientId,Ja.client,Date.now(),Ja.version,sb)}}Object(f.a)(Cf,"RttOpMetadata",null,[]);class Xj extends qi{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa){super(4,Xa);this.xkc=
0;this.qP=Ja;this.tV=sb;this.offset=Yb;this.GH=vc;this.wKg=$c;this.QCg=Md;this.$Be=Re;this.RCg=Qf;this.wKg===this.Gb?this.xkc=this.QCg:this.$Be===this.Gb?this.xkc=this.RCg:(m.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.xkc=0)}get Gb(){return this.qP}get Og(){return this.tV}get rha(){return this.xkc}Wnc(){return this.Gb===this.$Be}get gJm(){return this.rha}get rYm(){return this.Wnc()?this.wKg:this.$Be}get t_i(){return this.Wnc()?this.QCg:this.RCg}serialize(){const Ja=
new Eh.a(3,this.Gb,this.Og,this.offset,null,null,null,this.GH),sb=new dk.a(this.wKg,this.QCg,this.$Be,this.RCg);return new he.a(this.metadata.vYa,this.metadata.clientId,1,4,Ja,null,void 0,void 0,void 0,void 0,sb,void 0,void 0,this.metadata.y_a)}static create(Ja){const sb=Ja.BV,Yb=Ja.Iac;return new Xj(sb.wYa,sb.kib,sb.KT,sb.GH,Yb.odg,Yb.PCg,Yb.pdg,Yb.SCg,Cf.create(Ja))}static BZk(Ja,sb,Yb){if(1!==Ja.type)return null;const vc=Yb.rNa(Ja.d7.characterData,Ja.d7.ka);return new Xj(Ja.d7.Gb,Ja.d7.Og,Yb.DGc(vc,
Ja.aXi),Ja.GH,Ja.UNb.Gb,Ja.UNb.Og,Ja.b1c.Gb,Ja.b1c.Og,sb)}}Object(f.a)(Xj,"RttSplitParagraphOp",qi,[338,369]);class Oi{constructor(Ja,sb,Yb,vc){this.Aba=Ja;this.USc=sb;this.Yba=Yb;this.LMb=vc}SSj(Ja,sb,Yb,vc=null){if(sb.isDirty)return vc&&vc.properties.W(Oi.yyi,"1"),!1;const $c=new sf(Ja,sb.nh);try{if(1===Ja.opType||6===Ja.opType){const Qf=Object(y.a)(bf,Ja),Xa=this.Iak(Qf,sb);var Md=Xa.node.characterData;const vb=10<=Xa.cpBegin?Xa.cpBegin-10:0;let Pb=Xa.cpEnd+10<=Md.length?Xa.cpEnd+10:Md.length;
const oc=Md.substr(vb,Xa.cpBegin-vb),zc=Md.substr(Xa.cpEnd,Pb-Xa.cpEnd);Pb=Pb+Qf.jCb.length-(Xa.cpEnd-Xa.cpBegin);var Re=new qd(Xa.node.id,vb,Pb,oc+Qf.jCb+zc);const Kc=6===Qf.opType;Md="";Kc&&(Md=Qf.font);if(!this.Ofm(Xa,Qf.jCb,Kc,Md,vc))return!1;let Sc;Sc=1===Ja.opType?new wl(Qf,sb.id):new Ti(Qf,sb.id);sb.wra=Ja.rha;Qf.s0a=Re;Ja.vda=Sc;Yb.Bag(Sc)}else return 4===Ja.opType?this.RSj(Ja,sb,Yb):!1}finally{$c&&$c.dispose()}return!0}RSj(Ja,sb,Yb){const vc=Object(y.a)(Xj,Ja);var $c=this.LMb.rNa(sb.characterData,
sb.ka);$c=this.LMb.mqb($c,vc.offset);if(!this.Mei(Hc.a.createTextRange(sb,0,Cc.ParagraphReader.textLength(sb))))return!1;var Md=xf.GraphIterator.xa(sb);Md.Na(10);if(this.gvc(Md))return!1;let Re;Md=this.Yba.wc(3);try{Md.Wa(sb);const Qf=sb.lU();try{const Xa=xf.GraphIterator.xa(sb);Xa.Na(10);Xa.Bc(11);let vb=Xa.currentNode;vc.Wnc()&&(Xa.gfe?vb=null:(Xa.gG(),vb=Xa.currentNode));Xa.ub();const Pb=this.USc.BRb();Xa.kG(Pb,vb,89);Xa.Rg(Pb);Re=sb.clone();const oc=Re.lU();try{Re.setValue(Fd.a.Gb,vc.rYm);Re.setValue(Fd.a.Og,
vc.t_i);Re.isDirty=!1;Xa.ee(Re,2);Xa.Rg(Re);this.Xbk(sb,Re);const zc=vc.Wnc()?Re:sb,Kc=vc.Wnc()?sb:Re;zc.xS=!0;Kc.xS=!0;this.Aba.Ung(this.lrf(zc,$c,Cc.ParagraphReader.textLength(zc)),"",!1,"");this.Aba.Ung(this.lrf(Kc,0,$c),"",!1,"");sb.wra=vc.gJm;Re.wra=vc.t_i}finally{oc&&oc.dispose()}}finally{Qf&&Qf.dispose()}Md.Mgb()}finally{Md&&Md.dispose()}sb=new ke(vc,sb.id,Re.id);Ja.vda=sb;Yb.Bag(sb);return!0}gvc(Ja){const sb=new xf.GraphIterator;sb.kc(Ja);sb.Bc(11);return Ne.ListReader.Tf(sb)?(m.ULS.sendTraceTag(16868566,
355,50,"Blocked RTT para operation: in a list"),!0):!1}pzk(Ja,sb,Yb){var vc=sb.iKa(Ja.Gb);if(vc.equals(Dh.a.nil))return null;vc=Yb.Va(vc);if(!vc||!Cc.ParagraphReader.Mb(vc)||!vc.isConnected)return null;const $c=xf.GraphIterator.xa(vc);if(!$c.Na(23))return null;if(Ja.vKg){Ja=sb.iKa(Ja.vKg);if(Ja.equals(Dh.a.nil))return null;Yb=Yb.Va(Ja);if(!Yb||!Cc.ParagraphReader.Mb(Yb)||!Yb.isConnected)return null;Yb=xf.GraphIterator.xa(Yb);if(!Yb.Na(23))return null;Yb.Bc(11);Yb.gG();Yb.ie();if(Yb.currentNode!==
vc)return null}return this.gvc($c)?null:$c}zMm(Ja,sb,Yb,vc){const $c=sb.currentNode,Md=this.Yba.wc(3);try{Md.Wa($c);sb.Bc(11);const Re=sb.currentNode;sb.ub();const Qf=this.USc.BRb();sb.kG(Qf,Re,89);sb.Rg(Qf);const Xa=gh.a.instance.createInstance(393230),vb=Xa.lU();try{Xa.setValue(Mh.a.ml,""),Xa.qla=!0,vc.Vzb(Xa),vc=[0],Xa.setValue(Fd.a.tm,vc),Xa.setValue(Fd.a.po,vc),Xa.qla=!1,Xa.setValue(Fd.a.Gb,Ja.W7f),Xa.setValue(Fd.a.Og,Ja.V7f),Xa.isDirty=!1,sb.ee(Xa,2),Xa.xS=!0,Xa.wra=Ja.V7f}finally{vb&&vb.dispose()}Md.Mgb();
Ja.vda=new Em(Ja,Xa.id);Yb.Bag(Ja.vda)}finally{Md&&Md.dispose()}return!0}lrf(Ja,sb,Yb){return sb===Yb?Hc.a.sc(Ja,sb):Hc.a.createTextRange(Ja,sb,Yb)}Ofm(Ja,sb,Yb,vc,$c=null){const Md=Ja.node;if(Ja.cpBegin!==Ja.cpEnd&&!this.Mei(Ja))return $c&&$c.properties.W(Oi.L3i,"1"),!1;$c=this.Yba.wc(3);try{$c.Wa(Md);const Re=Md.lU();try{Md.xS=!0,this.Aba.Ung(Ja,sb,Yb,vc)}finally{Re&&Re.dispose()}$c.Mgb()}finally{$c&&$c.dispose()}return!0}Xbk(Ja,sb){sb.qla=!0;sb.characterData=Ja.characterData;sb.wra=Ja.wra;sb.ka.clear();
for(var Yb=0;Yb<Ja.ka.length;Yb++){const vc=Ja.ka.J(Yb).R9(sb);sb.ka.add(vc)}sb.Ei();if(sb.wordRunProperties.length)for(Ja=0;Ja<sb.ka.length;Ja++){if((Yb=sb.ka.J(Ja).formatting)&&-1!==Yb.Pc)for(;sb.wordRunProperties.length<=Yb.Pc;)sb.wordRunProperties.sQ(sb.wordRunProperties.length-1,256)}else m.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");sb.qla=!1}t0f(Ja){Ja=xf.GraphIterator.xa(Ja);Ja.Na(23);Ja.ub();return{returnValue:89===Ja.role,iterator:Ja}}Nmg(Ja){const sb=
new xf.GraphIterator;sb.kc(Ja);sb.ub();const Yb=this.Yba.wc(3);try{Yb.Wa(sb.currentNode),Ja.fg()}finally{Yb&&Yb.dispose()}}$bm(Ja){if(Ja.anchor)if(({iterator:sb}=this.t0f(Ja)).returnValue)this.Nmg(sb);else{var sb=Ja.Sb.rj;var Yb=this.Yba.wc(3);try{Yb.Wa(Ja),Ja.load(sb.Va(Ja.id)),Ja.anchor.gB(4)}finally{Yb&&Yb.dispose()}}}Ypg(Ja,sb,Yb){for(let Md=sb.count-1;0<=Md;Md--){var vc=sb.J(Md);switch(vc.opType){case 4:vc=Object(y.a)(ke,vc);if(!Ja.id.equals(vc.pxe)){m.ULS.shipAssertTag(9204885,355,Ja.id.equals(vc.V5c));
continue}vc=Yb.Va(vc.V5c);if(!vc)break;if(!vc||!Cc.ParagraphReader.Mb(vc)){m.ULS.shipAssertTag(9204886,355,!1);break}if(!vc.isConnected)continue;var $c=({iterator:vc}=this.t0f(vc)).returnValue;m.ULS.shipAssertTag(9204887,355,$c);$c&&this.Nmg(vc);break;case 2:(vc=Object(y.a)(Em,vc),Ja.id.equals(vc.paragraphId))?Ja.isConnected&&($c=({iterator:vc}=this.t0f(Ja)).returnValue,m.ULS.shipAssertTag(16820002,355,$c),$c&&this.Nmg(vc)):m.ULS.shipAssertTag(16820001,355,!1)}}}Iak(Ja,sb){const Yb=this.LMb.rNa(sb.characterData,
sb.ka),vc=this.LMb.mqb(Yb,Ja.KT);Ja=this.LMb.mqb(Yb,Ja.c7);return vc===Ja?Hc.a.sc(sb,vc):Hc.a.createTextRange(sb,vc,Ja)}Mei(Ja){const sb=Ja.node.ka,Yb=Ja.cpBegin;Ja=Ja.cpEnd;for(let vc=0;vc<sb.length;vc++){const $c=sb.J(vc);if($c.cp>=Ja)break;if($c.cp>=Yb){if($c.Ee)return m.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if($c.blob)return m.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if($c.Of||$c.Evc||$c.$ee)return m.ULS.sendTraceTag(8242649,
355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}Oi.yyi="ParagraphAlreadyDirty";Oi.L3i="UnsafeWetChange";Object(f.a)(Oi,"RttEditor",null,[341]);var Mj=b(1055),aj=b(108),ek=b(223);class ui{constructor(){this.HFd=new P.a}add(Ja){this.HFd.add(Ja);return!0}O$d(Ja){const sb=new P.a;for(let Yb of this.HFd)Ja(Yb)&&sb.add(Yb);return sb}Vlg(Ja){Ja.activity.W9f("dried");this.HFd.remove(Ja)}Ylg(Ja){Ja.activity.W9f("expired");this.HFd.remove(Ja)}}Object(f.a)(ui,"RttAddParagraphDataStore",
null,[]);var Sh=b(1395);class Fg extends qi{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf){super(2,Qf);this.Gb=Ja;this.Og=sb;this.rha=Yb;this.vKg=vc;this.W7f=$c;this.V7f=Md;this.GH=Re}serialize(){const Ja=new Eh.a(2,this.Gb,this.Og,null,this.vKg,null,null,this.GH),sb=new Sh.a(this.rha,this.W7f,this.V7f);return new he.a(this.metadata.vYa,this.metadata.clientId,1,3,Ja,null,void 0,void 0,sb,void 0,void 0,void 0,void 0,this.metadata.y_a)}static create(Ja){const sb=Ja.BV,Yb=Ja.vlc;let vc=null;null!=Ja.BV.lNa&&(vc=
Ja.BV.lNa);return new Fg(sb.wYa,sb.kib,Yb.TCg,vc,Yb.rdg,Yb.rha,sb.GH,Cf.create(Ja))}static xZk(Ja,sb){return 3!==Ja.type?null:new Fg(Ja.Ita.Gb,Ja.Ita.Og,Ja.ZHl.Og,Ja.cYa?Ja.cYa.Gb:null,Ja.aBa.Gb,Ja.aBa.Og,Ja.GH,sb)}}Object(f.a)(Fg,"RttAddParagraphOp",qi,[]);class cd{constructor(Ja){this.qX=Ja}DEi(){this.qX&&this.qX.properties.W(cd.XLh,"1")}K7l(Ja){this.qX&&(this.qX.properties.Pa(cd.p7f)||this.qX.properties.W(cd.p7f,(Ja-this.qX.startTime).toString()))}W9f(Ja){this.qX&&(this.qX.properties.W(cd.SHi,
Ja),this.qX.end())}z8l(Ja){this.qX&&this.qX.properties.W(cd.Lxi,Ja.toString())}y8l(Ja){this.qX&&this.qX.properties.W(cd.lxi,Ja)}static wSf(Ja){Ja.J7(ch.a.oAb,cd.XLh,Mj.a.nBg);Ja.J7(ch.a.oAb,cd.fxk,Mj.a.nBg);Ja.J7(ch.a.oAb,cd.p7f,Mj.a.yph);Ja.J7(ch.a.oAb,cd.SHi,Mj.a.Yqa);Ja.J7(ch.a.oAb,cd.Lxi,Mj.a.Yqa);Ja.J7(ch.a.oAb,cd.lxi,Mj.a.Yqa)}static create(Ja){if(!Ja)return null;Ja=Ja.$j(ch.a.oAb,cd.FXm);return new cd(Ja)}}cd.XLh="FailedToFindInitialParaID";cd.fxk="FailedToFindInitialTextID";cd.p7f="MsecUntilApplied";
cd.SHi="RemovedBecause";cd.Lxi="PacketVersions";cd.lxi="OperationType";cd.FXm=48E4;Object(f.a)(cd,"RttOpActivity",null,[]);var Zc;(function(Ja){Ja[Ja.unknown=0]="unknown";Ja[Ja.replaceTextRangeOp=1]="replaceTextRangeOp";Ja[Ja.addParagraphOp=2]="addParagraphOp";Ja[Ja.deleteParagraphOp=3]="deleteParagraphOp";Ja[Ja.splitParagraphOp=4]="splitParagraphOp";Ja[Ja.mergeParagraphOp=5]="mergeParagraphOp";Ja[Ja.replaceSymbolRangeOp=6]="replaceSymbolRangeOp"})(Zc||(Zc={}));Object(f.b)("RttOpType",Zc);var pj=
b(124);class Qb extends bf{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa,vb,Pb){super(vc,$c,Md,Re,Qf,Xa,vb,Pb,6);this._font=Ja;this.stj=sb}get font(){return this._font}get legacy(){return this.stj}VMf(){return"OffsetStart: "+this.KT+"OffsetEnd: "+this.c7}serialize(){const Ja=this.QCh();return new he.a(this.metadata.vYa,this.metadata.clientId,1,7,Ja,null,this.rha,this.jCb,void 0,void 0,void 0,void 0,void 0,this.metadata.y_a)}static create(Ja){let sb,Yb,vc,$c;if(!({KT:sb,c7:Yb,Gb:vc,Og:$c}=bf.$1i(Ja,sb,Yb,
vc,$c)).returnValue)return null;let Md,Re;if(1===Ja.text.length)Md=!1,Re=pj.AParagraphNode.YB;else if(2===Ja.text.length)if(Wa.a.oXf(Ja.text,0)&&Wa.a.Pt(Ja.text,1))Md=!0,Re=Ja.text;else return m.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",Ja.HD),null;else return m.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Ja.HD),null;const Qf=Ja.lAd,Xa=Cf.create(Ja);return new Qb(Qf.ebc,Qf.EBg,
Md,vc,$c,sb,Yb,Ja.Cbc,Re,Ja.BV.GH,Xa)}}Object(f.a)(Qb,"RttReplaceSymbolRangeOp",bf,[338,369]);class vk extends bf{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf){super(Ja,sb,Yb,vc,$c,Md,Re,Qf,1)}VMf(){return"OffsetStart: "+this.KT+"OffsetEnd: "+this.c7+"TextAddedLength: "+this.jCb.length}serialize(){const Ja=this.QCh();return new he.a(this.metadata.vYa,this.metadata.clientId,1,2,Ja,null,this.rha,this.jCb,void 0,void 0,void 0,void 0,void 0,this.metadata.y_a)}static create(Ja){let sb,Yb,vc,$c;if(!({KT:sb,c7:Yb,
Gb:vc,Og:$c}=bf.$1i(Ja,sb,Yb,vc,$c)).returnValue)return null;let Md="";Ja.text&&(Md=Ja.text);const Re=Cf.create(Ja);return new vk(vc,$c,sb,Yb,Ja.Cbc,Md,Ja.BV.GH,Re)}static HYk(Ja,sb,Yb){if(Ja.type)return null;const vc=Yb.rNa(Ja.d7.characterData,Ja.d7.ka);return new vk(Ja.d7.Gb,Ja.d7.Og,Yb.DGc(vc,Ja.cpBegin),Yb.DGc(vc,Ja.cpEnd),Ja.aBa.Og,Ja.YXa,Ja.GH,sb)}}Object(f.a)(vk,"RttReplaceTextRangeOp",bf,[338,369]);class Di{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf,Xa,vb,Pb,oc,zc,Kc,Sc,ae,Bd,Rf){this.Ap=null;this.Zah=
this.b6e=this.abh=this.Yah=this.$ah=this.kVe=this.Agh=!1;this.KLb=Ja;this.GFb=sb;this.sRc=Yb;this.smb=vc;this.va=$c;this.GF=Md;this.Oia=Re;this.ri=Qf;this.Za=Xa;this.pw=vb;this.LMb=Pb;this.oc=oc;this.p2e=Kc;this.Qb=Sc;this.keh=ae;this.ZDb=Bd;this.bbf=Rf;this.gUc=new Ag.a(Tb.a.ef());this.LHc=new ui;zc.execute(Di.wSf)}wdl(){const Ja=new Ra.a(3,2,Di.Fdm,Object(c.a)(this,this.twk,"expireWetChangesAndRender"));this.Za.Eb(Ja);this.Agh=!0}init(){return this.Oia?this.Oia.continueWith(Object(c.a)(this,this.qbg,
"onRtcConnected")):U.Task.z1(!1)}OZf(){return this.va.isFeatureEnabled(198)&&this.va.isFeatureEnabled(155)}yei(){return this.OZf()&&this.va.isFeatureEnabled(145)}qbg(){m.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Ap=this.Oia.result;m.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Ap.j5(Object(c.a)(this,this.m7,"onUpdateNotificationReceived"))}Umk(Ja){Ja=Ib.a(Ja);if(!Ja)return null;switch(Ja.HD){case 2:return vk.create(Ja);case 7:return Qb.create(Ja);
case 4:return this.yei()?Xj.create(Ja):null;case 3:return this.yei()?Fg.create(Ja):null;default:return m.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Ja.HD),null}}m7(Ja,sb){if(3===sb.type&&this.OZf())if(this.smb.value&&!this.smb.value.aub)m.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(sb.l8){if(this.I8l(),(Ja=this.Umk(sb.l8))&&1!==Ja.metadata.clientType)switch(this.H8l(),this.Agh||this.wdl(),Ja.opType){case 1:case 6:case 4:if(!({nf:Ja}=
this.HIj(Ja)).returnValue)break;this.keh?this.JMi(Ja):this.U2i(Ja);break;case 2:this.LHc.add(Ja),this.Y7h(Ja),this.keh?this.JMi(Dh.a.nil):this.T2i(Ja)}}else m.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")}HIj(Ja){let sb=Dh.a.nil;if(!this.GFb.GIj(Ja))return{returnValue:!1,nf:sb};this.Y7h(Ja);if(!this.GF)return{returnValue:!1,nf:sb};const Yb=this.GF.iKa(Ja.Gb);if(Yb.equals(Dh.a.nil)||!this.ri.value.Va(Yb))return Ja.activity.DEi(),{returnValue:!1,nf:sb};this.REi();return{returnValue:!0,nf:Yb}}JMi(Ja){Ja.equals(Dh.a.nil)||
this.gUc.add(Ja.toString());this.kVe||(Ja=new Ra.a(0,1,200,()=>{this.TNm();this.kVe=!1},71),this.Za.Eb(Ja),this.kVe=!0)}jlm(Ja){Ja=new Ra.a(0,1,0,Ja,71);this.Za.Eb(Ja)}Y7h(Ja){Ja.activity=cd.create(this.oc);Ja.activity.z8l(Ja.metadata.PVl);Ja.activity.y8l(Zc[Ja.opType])}TNm(){var Ja=this.LHc.O$d(Yb=>!Yb.vda);for(let Yb of Ja)this.T2i(Yb);if(this.gUc.count){Ja=null;for(var sb of this.gUc){sb=Dh.a.pe(sb);Ja=this.ri.value.Va(sb);break}sb=this.Qb.wc(3);try{sb.Wa(Ja);for(let Yb of this.gUc)this.U2i(Dh.a.pe(Yb))}finally{sb&&
sb.dispose()}this.gUc.clear()}}U2i(Ja){Ja=this.ri.value.Va(Ja);let sb;const Yb=this.Qb.wc(3);try{Yb.Wa(Ja);sb=this.oc.$j(ch.a.igf);const vc=this.znh(Ja,sb);sb.end();vc&&this.LKj(vc)}finally{Yb&&Yb.dispose()}}T2i(Ja){var sb=this.KLb.pzk(Ja,this.GF,this.ri.value);sb&&(this.REi(),this.KLb.zMm(Ja,sb,this.ZDb,ea.a.instance.resolve("Box4.IParagraphEditor"))&&(sb=this.ri.value.Va(Ja.vda.paragraphId),this.Nnh(sb,Ja)))}LKj(Ja){this.p2e.continueWith(()=>{if(1===Ja.opType){var sb=this.oXk(Ja);sb&&(this.p2e.result.Ocf(sb),
this.p2e.result.fse(!0))}})}oXk(Ja){const sb=Ja.serialize();if(2!==sb.HD||sb.BV.lNa&&sb.BV.wYa!==sb.BV.lNa)return null;const Yb=Ja.KT.clone();0<Ja.jCb.length&&(Yb.Pmf(),Yb.cp+=Ja.jCb.length);sb.HD=0;sb.text=null;sb.BV.Wqe=0;sb.BV.KT=Yb;sb.BV.kib=sb.Cbc;sb.BV.lNa=null;sb.BV.UEc=null;sb.BV.c7=null;sb.Cbc=null;return nc.a.P2d(sb,this.GF,this.LMb,()=>this.ri.value,this.bbf.instance)}twk(){const Ja=this.ri.value;if(Ja){var sb=this.pw()-Di.jcm,Yb=this.GFb.O$d($c=>$c.metadata.Q_i<sb);0<Yb.count&&this.L7l();
var vc=new ek.a;for(let $c of Yb)if(this.GFb.Ylg($c),$c.vda)switch($c.vda.opType){case 1:vc.add($c.vda.paragraphId.toString());break;case 6:vc.add($c.vda.paragraphId.toString());break;case 4:vc.add($c.vda.pxe.toString()),vc.add($c.vda.V5c.toString())}Yb=this.LHc.O$d($c=>$c.metadata.Q_i<sb);for(let $c of Yb)this.LHc.Ylg($c),$c.vda&&vc.add($c.vda.paragraphId.toString());for(let $c of vc)(vc=Ja.Va(Dh.a.pe($c)))?vc.xS?(this.KLb.$bm(vc),vc.xS||(this.sRc.value.Mmg(vc),vc.ha(aj.a.s3,0))):m.ULS.sendTraceTag(8765829,
355,15,"Expiring wet change from paragraph with no applied changes"):m.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.ri.qQf&&m.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")}Nnh(Ja,sb){return this.sRc.value?this.sRc.value.lhh(Ja,sb.metadata.clientId).returnValue?!0:(m.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(m.ULS.shipAssertTag(7866378,355,!!this.sRc.value,"Unable to apply wet changes as LockManager unavailable"),
!1)}mgf(Ja,sb){this.znh(Ja,sb)}znh(Ja,sb){if(!Ja)return null;if(!Ja.anchor)return sb&&sb.properties.W(Di.Oqi,"1"),null;if(!Ja.hasProperty(Fd.a.Gb))return m.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!Ja.hasProperty(Fd.a.Og))return m.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),null;if(Ja.hasProperty(Fd.a.kGh)&&Ja.getValue(Fd.a.kGh))return m.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const Yb=Ja.getValue(Fd.a.Gb);
var vc=Ja.wra;sb&&(sb.properties.W(Di.QIl,vc.toString()),sb.properties.W(Di.SIl,Yb.toString()));vc=this.GFb.VJf(Yb,vc);if(!vc)return sb&&sb.properties.W(Di.Hqi,"1"),null;if(!this.Nnh(Ja,vc))return sb&&sb.properties.W(Di.SAh,"1"),null;let $c=0,Md=null;for(;vc;){if(!this.KLb.SSj(vc,Ja,this.ZDb,sb)){sb&&sb.properties.W(Di.J8i,"1");break}$c++;vc.activity.K7l(this.pw());Md=vc;vc=Ja.wra;vc=this.GFb.VJf(Yb,vc)}0<$c&&this.lEi();sb&&sb.properties.add(Di.K8i,$c.toString());return Md}VAc(Ja){if(this.OZf()&&
Ja.hasProperty(Fd.a.Gb)&&Ja.hasProperty(Fd.a.Og)){var sb=Ja.getValue(Fd.a.Gb),Yb=Ja.ha(Fd.a.Og,0),vc=this.oc.$j(ch.a.Elg),$c=this.ZDb.IOl(Ja.id);0<$c.count&&(this.KLb.Ypg(Ja,$c,this.ri.value),this.Dcm(Ja,$c,Yb));var Md=this.ZDb.KFk(sb);if(Md&&!Ja.id.equals(Md.paragraphId)){const Re=this.ri.value;this.jlm(()=>{const Qf=this.ZDb.Lxc(Md.paragraphId),Xa=Re.Va(Md.paragraphId);m.ULS.shipAssertTag(16820032,355,!!Xa,"Could not find added graph node");Xa&&(this.KLb.Ypg(Xa,Qf,Re),this.LHc.Vlg(Md.Scf))})}this.GFb.VJf(sb,
Yb)||this.sRc.value.Mmg(Ja);this.mgf(Ja,vc);vc.end()}}Dcm(Ja,sb,Yb){let vc=!1;for(let Md=sb.count-1;0<=Md;Md--){var $c=sb.J(Md);switch($c.opType){case 1:case 6:case 4:$c=Object(y.a)(338,$c.operation);break;default:continue}$c.rha===Yb&&(vc=!0,$c.s0a&&!$c.s0a.fWm(Ja)&&m.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",$c.opType,$c.VMf(),Ja.id,$c.s0a.id,$c.s0a.cpBegin,$c.s0a.cpEnd));
vc&&this.GFb.Vlg($c)}vc&&this.lEi()}yyb(Ja){const sb=this.ZDb.Lxc(Ja.id);0<sb.count&&(2===sb.J(0).opType&&sb.removeAt(0),this.KLb.Ypg(Ja,sb,this.ri.value))}fDc(Ja){var sb=this.ZDb.YUk(Ja.id);for(let Yb of sb)if(4===Yb.opType&&(sb=Object(y.a)(ke,Yb),Ja.id.equals(sb.jHj)))return!0;return!1}I8l(){this.$ah||(m.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.$ah=!0)}H8l(){this.Yah||(m.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),this.Yah=!0)}REi(){this.abh||
(m.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.abh=!0)}lEi(){this.b6e||(m.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.b6e=!0)}L7l(){this.b6e||this.Zah||(m.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.Zah=!0)}static wSf(Ja){const sb=[ch.a.igf,ch.a.Elg];for(let Yb of sb)Ja.J7(Yb,Di.K8i,Mj.a.Yqa),Ja.J7(Yb,Di.Hqi,Mj.a.Yqa),Ja.J7(Yb,Di.Oqi,Mj.a.Yqa),Ja.J7(Yb,Di.SAh,Mj.a.Yqa),Ja.J7(Yb,Di.J8i,Mj.a.Yqa),Ja.J7(Yb,Oi.yyi,
Mj.a.Yqa),Ja.J7(Yb,Oi.L3i,Mj.a.Yqa);cd.wSf(Ja)}}Di.Fdm=6E4;Di.jcm=18E4;Di.K8i="WetChangeCount";Di.Hqi="NoChangesToApply";Di.Oqi="NodeNotConnected";Di.SAh="CouldNotGetLock";Di.J8i="WetChangeBlocked";Di.SIl="NodeWordId";Di.QIl="NodeTextId";Object(f.a)(Di,"RttManager",null,[339]);var nk=b(1649);class Hj{constructor(){this.hWc=new nk.a}nLj(Ja,sb){this.hWc.back()&&sb&&this.hWc.back().xQb(Ja)||this.hWc.enqueue(Ja)}XTk(){return this.hWc.isEmpty?null:this.hWc.dequeue()}}Object(f.a)(Hj,"RttSendDataStore",
null,[340]);var Sl=b(1394);class tj extends qi{constructor(Ja,sb,Yb,vc){super(3,vc);this.qP=Ja;this.tV=sb;this.GH=Yb}get Gb(){return this.qP}get Og(){return this.tV}get rha(){return 0}serialize(){const Ja=new Eh.a(4,this.Gb,this.Og,null,null,null,null,this.GH);return new he.a(this.metadata.vYa,this.metadata.clientId,1,5,Ja,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.y_a)}static create(Ja){const sb=Ja.BV;return new tj(sb.wYa,sb.kib,sb.GH,Cf.create(Ja))}static yZk(Ja,sb){return 4!==
Ja.type?null:new tj(Ja.Ooc.Gb,Ja.Ooc.Og,Ja.GH,sb)}}Object(f.a)(tj,"RttDeleteParagraphOp",qi,[338,369]);var lc=b(1396);class Nk extends qi{constructor(Ja,sb,Yb,vc,$c,Md,Re,Qf){super(5,Qf);this.uKg=Ja;this.s_i=sb;this.qYm=Yb;this.hJm=vc;this.GH=$c;this.j9i=Md;this.VEc=Re}get Gb(){return this.uKg}get Og(){return this.s_i}get rha(){return this.uKg===this.j9i?this.VEc:0}serialize(){const Ja=new Eh.a(5,this.uKg,this.s_i,null,this.qYm,this.hJm,null,this.GH),sb=new lc.a(this.j9i,this.VEc);return new he.a(this.metadata.vYa,
this.metadata.clientId,1,6,Ja,null,void 0,void 0,void 0,sb,void 0,void 0,void 0,this.metadata.y_a)}static create(Ja){const sb=Ja.BV,Yb=Ja.Bnd;return new Nk(sb.wYa,sb.kib,sb.lNa,sb.UEc,sb.GH,Yb.qdg,Yb.VEc,Cf.create(Ja))}static zZk(Ja,sb){return 2!==Ja.type?null:new Nk(Ja.Ita.Gb,Ja.Ita.Og,Ja.cYa.Gb,Ja.cYa.Og,Ja.GH,Ja.Mje.Gb,Ja.Mje.Og,sb)}}Object(f.a)(Nk,"RttMergeParagraphOp",qi,[338,369]);class Mf{constructor(Ja,sb,Yb,vc,$c,Md){this.LWc=this.Gh=null;this.Qoa=!1;this.N9e=this.Deh=0;this.lUd=this.Lfh=
!1;this.f5e=0;this.Oia=Ja;this.gah=sb;this.xia=Yb;this.hr=vc;this.nda=$c;this.va=Md}get ov(){return this.xia.value}init(){return this.Oia?this.Oia.continueWith(Object(c.a)(this,this.qbg,"onRtcConnected")):U.Task.z1(!1)}qbg(){m.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.Gh=this.Oia.result;this.Gh.wre(this)}start(){this.Qoa||(this.l_f()&&this.hr.Rb.ME.oOj(Object(c.a)(this,this.jvi,"onPersistenceTransactionCompleted")),this.Qoa=!0)}stop(){this.Qoa=!1;this.l_f()&&
this.hr.Rb.ME.Fem(Object(c.a)(this,this.jvi,"onPersistenceTransactionCompleted"))}l_f(){return this.va.isFeatureEnabled(198)&&this.va.isFeatureEnabled(165)}zrl(){return this.l_f()?this.va.isFeatureEnabled(146):!1}jvi(Ja,sb){if(this.Gh&&2===this.Gh.connectionState&&(Ja=sb.ME,Ja.length))if(sb.I9)100>this.N9e&&(this.N9e++,m.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",sb.AWj,this.Deh,this.N9e));else{for(sb=0;sb<Ja.length;sb++)if(!this.Htl(Ja[sb]))return;
for(sb=0;sb<Ja.length;sb++){let Yb=Ja[sb];this.gah.nLj(Yb,!Yb.type&&!sb)}this.LWc||this.Sui(this.LWc,this.Gh)}}Htl(Ja){return Ja&&-1!==Ja.GH?!Ja.type||this.zrl()&&(3===Ja.type||1===Ja.type)?!0:!1:!1}QAl(){this.lUd||(this.Lfh||(m.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.Lfh=!0),!this.lUd&&5>=this.f5e&&this.f5e++)}ZAl(){!this.lUd&&5>=this.f5e&&(m.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.lUd=!0)}Sui(Ja,sb){this.QAl();Ja&&(Ja.Sh||Ja.Tn)&&m.ULS.sendTraceTag(8245956,
355,15,"Task is faulted or cancelled with exception {0}",Ja.exception);(Ja=this.AZk(this.gah.XTk()))?(this.Deh++,this.LWc=sb.$Q(3,Ib.b(Ja.serialize())),this.ZAl(),this.LWc.continueWith(Yb=>{this.Sui(Yb,sb)})):this.LWc=null}AZk(Ja){if(!Ja)return null;if(!this.ov)return m.ULS.sendTraceTag(8245957,355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const sb=new Cf(kg.instance.tXh(),this.ov.Sg,1,0,0,Sl.a.instance.hUk());let Yb=null;switch(Ja.type){case 0:Yb=vk.HYk(Ja,
sb,this.nda);break;case 4:Yb=tj.yZk(Ja,sb);break;case 3:Yb=Fg.xZk(Ja,sb);break;case 2:Yb=Nk.zZk(Ja,sb);break;case 1:Yb=Xj.BZk(Ja,sb,this.nda)}return Yb}}Object(f.a)(Mf,"RttSendManager",null,[337]);class jn{constructor(){this.Z=null}get name(){return"WordEditor.RealTimeTyping"}xSk(){return va.App.Ob&&va.App.Ob.Il?va.App.Ob.Il:(m.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)}Nb(Ja){const sb=la.a.Jp(Ja.Fa("Box4.IOutlineElementEditor")),Yb=la.a.Jp(Ja.Fa("Box4.IFeatureHelper")),
vc=la.a.Jp(Ja.Fa("Common.IActivityAggregationInfo")),$c=la.a.Jp(Ja.Fa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"));this.Z=Ja;const Md=new Si.a;U.Task.WAA.call(null,sb,Yb,vc,$c).continueWith(()=>{Ja.ia("WordEditor.RealTimeTyping.IRttEditor",()=>new Oi(Ja.resolve("Box4.ICharacterPropertiesEditor"),Ja.resolve("Box4.IOutlineElementEditor"),Md,Ja.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).fa();Ja.ia("WordEditor.RealTimeTyping.RttManager",()=>new Di(Ja.resolve("WordEditor.RealTimeTyping.IRttEditor"),
new xl(xj.a.instance),new G.a(Object(c.a)(this,this.xSk,"getLockManager")),new G.a(()=>va.App.jA),Ja.resolve("Box4.IFeatureHelper"),Ja.resolve("WordEditor.ParagraphWordIdMapping"),Ja.resolve("Box4.Presence.IRtcProxyProvider").dG(),new G.a(()=>va.App.oa.Ca.Rb.zc),Za.a.instance,()=>Date.now(),Ja.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),xj.a.instance,Ja.Fa("Common.IActivityAggregationInfo"),Gf.dG(),Md,v.AFrameworkApplication.K.$("WordEditorThrottleAndBatchRTTRendering"),
new Ui,Ja.Fa("WordEditor.Presence.IWordPresenceCpFactory"))).as("WordEditor.RealTimeTyping.IRttManager").fa();Ja.ia("WordEditor.RealTimeTyping.RttSendManager",()=>new Mf(Ja.resolve("Box4.Presence.IRtcProxyProvider").dG(),new Hj,new G.a(()=>va.App.Ob),va.App.oa.Ca,Ja.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ja.resolve("Box4.IFeatureHelper"))).fa();this.xSf()})}xSf(){this.Z.resolve("WordEditor.RealTimeTyping.RttManager").init();this.Z.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){Y.a.instance.jc(new jn)}}
Object(f.a)(jn,"WordEditorRealTimeTypingPackage",null,[2,3]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");xa.main();Type.registerNamespace("Common.App.CollabControls");pa.a.prototype.toString=fa.a.prototype.toString;
Ia.prototype.toString=fa.a.prototype.toString;Y.a.instance.jc(new Gj);jn.main();Type.registerNamespace("RealtimePresenceUI");Y.a.instance.jc(new tc);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");X.main()},527:function(z,H,b){b.d(H,"a",function(){return f});z=b(0);class f{}f.clientId="ClientId";f.LIg="UserApp";f.userSessionId="usid";f.userType="UserType";f.VIg="UserVersion";f.wzb="qs";f.inf="clientProtocol";f.f8f="NoAuth";Object(z.a)(f,"RtcFindSessionInputQueryParamConstants",
null,[])}}]);

//# sourceMappingURL=https://wordwebclientbuilds.blob.core.windows.net/ooui/04cb24867ec47a2e5a95fc7fedf79aa260ead425/WordEditorDS.collab.js.map